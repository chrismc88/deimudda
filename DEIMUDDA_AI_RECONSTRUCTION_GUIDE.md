# Deimudda Projekt: Vollständige Rekonstruktionsanleitung für KI-Assistenten

**Version:** 1.0
**Datum:** 14. November 2025
**Autor:** Manus AI

---

## 1. Einleitung & Zielsetzung

Dieses Dokument dient als vollständige, akribische und schrittweise Anleitung für einen KI-Assistenten (z.B. Claude, GPT-4, etc.), um das Projekt **"deimudda"**, eine Online-Plattform für den legalen Handel mit Cannabis-Stecklingen und -Samen, zu rekonstruieren. Das Ziel ist es, den exakten Ist-Zustand des Projekts, wie er in den bereitgestellten Dateien dokumentiert ist, wiederherzustellen.

### Wichtige Anweisungen für die KI:

1.  **Sequenzielle Abarbeitung:** Befolge die Schritte in diesem Dokument strikt in der angegebenen Reihenfolge. Jeder Schritt baut auf dem vorherigen auf.
2.  **Keine Datenbank-Änderungen:** Das bestehende Datenbankschema ist als gegeben anzusehen und darf **nicht** verändert werden. Alle Anweisungen zur Erstellung von Code basieren auf diesem Schema.
3.  **Vollständigkeit:** Der gesamte Code für jede Datei wird bereitgestellt. Kopiere den Inhalt exakt, um die Funktionalität sicherzustellen. Es ist keine Neu-Implementierung von Logik erforderlich, sondern eine exakte Rekonstruktion.
4.  **Umgebung:** Die Anleitung ist für eine Standard-Entwicklungsumgebung mit Node.js, pnpm und einem TypeScript-fähigen Editor (wie Visual Studio Code) ausgelegt.
5.  **Nachfragen:** Obwohl der Benutzer angegeben hat, die Datenbank unangetastet zu lassen, frage explizit nach, falls du auf eine Situation stößt, die eine Datenbankänderung unumgänglich erscheinen lässt. Ansonsten halte dich an die Anweisung.

---

## 2. Projekt-Setup & Basiskonfiguration

In diesem Abschnitt wird die grundlegende Ordnerstruktur und alle notwendigen Konfigurationsdateien erstellt. Dies stellt sicher, dass das Projekt korrekt kompiliert und ausgeführt werden kann.

### Schritt 2.1: Projektverzeichnis erstellen

Erstelle ein Hauptverzeichnis für das Projekt. Alle folgenden Dateien und Ordner werden innerhalb dieses Verzeichnisses erstellt.

```bash
mkdir deimudda-reconstructed
cd deimudda-reconstructed
```

### Schritt 2.2: package.json erstellen

Diese Datei definiert alle Projektabhängigkeiten und Skripte. Erstelle die Datei `package.json` im Hauptverzeichnis mit folgendem Inhalt:

```json
{
  "name": "deimudda",
  "version": "1.0.0",
  "description": "Cannabis-Stecklingsbörse - Online-Plattform für legalen Handel",
  "type": "module",
  "scripts": {
    "dev": "concurrently \"pnpm dev:client\" \"pnpm dev:server\"",
    "dev:client": "vite",
    "dev:server": "tsx watch server/index.ts",
    "build": "pnpm build:client && pnpm build:server",
    "build:client": "vite build",
    "build:server": "esbuild server/index.ts --bundle --platform=node --outfile=dist/server.js --external:@node-rs/argon2 --external:@node-rs/bcrypt",
    "start": "NODE_ENV=production node dist/server.js",
    "db:push": "drizzle-kit push",
    "db:generate": "drizzle-kit generate",
    "db:migrate": "drizzle-kit migrate",
    "db:studio": "drizzle-kit studio"
  },
  "dependencies": {
    "@paypal/paypal-server-sdk": "^0.6.1",
    "@paypal/react-paypal-js": "^8.7.0",
    "@radix-ui/react-alert-dialog": "^1.1.2",
    "@radix-ui/react-avatar": "^1.1.1",
    "@radix-ui/react-checkbox": "^1.1.2",
    "@radix-ui/react-dialog": "^1.1.2",
    "@radix-ui/react-dropdown-menu": "^2.1.2",
    "@radix-ui/react-label": "^2.1.0",
    "@radix-ui/react-popover": "^1.1.2",
    "@radix-ui/react-select": "^2.1.2",
    "@radix-ui/react-separator": "^1.1.0",
    "@radix-ui/react-slot": "^1.1.0",
    "@radix-ui/react-tabs": "^1.1.1",
    "@radix-ui/react-toast": "^1.2.2",
    "@tanstack/react-query": "^5.59.16",
    "@trpc/client": "^11.0.0-rc.553",
    "@trpc/react-query": "^11.0.0-rc.553",
    "@trpc/server": "^11.0.0-rc.553",
    "class-variance-authority": "^0.7.0",
    "clsx": "^2.1.1",
    "cookie-parser": "^1.4.7",
    "cors": "^2.8.5",
    "dotenv": "^16.4.5",
    "drizzle-orm": "^0.36.1",
    "express": "^4.21.1",
    "lucide-react": "^0.454.0",
    "postgres": "^3.4.4",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.28.0",
    "sonner": "^1.7.1",
    "tailwind-merge": "^2.5.4",
    "tailwindcss-animate": "^1.0.7",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@types/cookie-parser": "^1.4.7",
    "@types/cors": "^2.8.17",
    "@types/express": "^5.0.0",
    "@types/node": "^22.8.6",
    "@types/react": "^18.3.12",
    "@types/react-dom": "^18.3.1",
    "@typescript-eslint/eslint-plugin": "^8.11.0",
    "@typescript-eslint/parser": "^8.11.0",
    "@vitejs/plugin-react": "^4.3.3",
    "autoprefixer": "^10.4.20",
    "concurrently": "^9.0.1",
    "drizzle-kit": "^0.29.1",
    "esbuild": "^0.24.0",
    "postcss": "^8.4.47",
    "tailwindcss": "^3.4.14",
    "tsx": "^4.19.1",
    "typescript": "^5.6.3",
    "vite": "^5.4.10"
  },
  "engines": {
    "node": ">=22.0.0",
    "pnpm": ">=9.0.0"
  }
}

```


### Schritt 2.3: TypeScript-Konfiguration (`tsconfig.json`)

Erstelle die Datei `tsconfig.json` im Hauptverzeichnis:

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,

    /* Paths */
    "baseUrl": ".",
    "paths": {
      "@/*": ["./client/src/*"],
      "@db": ["./server/db.ts"],
      "@shared/*": ["./shared/*"]
    }
  },
  "include": ["client/src", "server", "shared"],
  "references": [{ "path": "./tsconfig.node.json" }]
}

```


### Schritt 2.4: TypeScript Node-Konfiguration (`tsconfig.node.json`)

Erstelle die Datei `tsconfig.node.json` im Hauptverzeichnis:
```json
{
  "compilerOptions": {
    "composite": true,
    "skipLibCheck": true,
    "module": "ESNext",
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true,
    "strict": true
  },
  "include": ["vite.config.ts"]
}

```


### Schritt 2.5: Vite-Konfiguration (`vite.config.ts`)

Erstelle die Datei `vite.config.ts` im Hauptverzeichnis:
```typescript
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import path from "path";

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./client/src"),
      "@db": path.resolve(__dirname, "./server/db.ts"),
      "@shared": path.resolve(__dirname, "./shared"),
    },
  },
  server: {
    proxy: {
      "/api": {
        target: "http://localhost:3000",
        changeOrigin: true,
      },
      "/trpc": {
        target: "http://localhost:3000",
        changeOrigin: true,
      },
    },
  },
  build: {
    outDir: "dist/public",
  },
});

```


### Schritt 2.6: Tailwind CSS Konfiguration (`tailwind.config.js`)

Erstelle die Datei `tailwind.config.js` im Hauptverzeichnis:
```javascript
/** @type {import('tailwindcss').Config} */
export default {
  darkMode: ["class"],
  content: [
    "./client/index.html",
    "./client/src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      colors: {},
    },
  },
  plugins: [require("tailwindcss-animate")],
};

```


### Schritt 2.7: PostCSS Konfiguration (`postcss.config.js`)

Erstelle die Datei `postcss.config.js` im Hauptverzeichnis:
```javascript
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};

```


---

## 3. Datenbank-Schema

Das Herzstück der Anwendung ist das Datenbankschema. Es definiert die Struktur aller Daten, die in der Anwendung verwendet werden. Die folgende Datei `schema.ts` muss im Verzeichnis `server/drizzle/` erstellt werden. Stelle sicher, dass der Ordner existiert.

```bash
mkdir -p server/drizzle
```

### Schritt 3.1: `server/drizzle/schema.ts`

Erstelle die Datei `server/drizzle/schema.ts` mit dem folgenden Inhalt. Dies ist die **einzige Quelle der Wahrheit** für die Datenbankstruktur.
```typescript

/**
 * Core user table backing auth flow.
 * Extend this file with additional tables as your product grows.
 * Columns use camelCase to match both database fields and generated types.
 */
export const users = mysqlTable("users", {
  /**
   * Surrogate primary key. Auto-incremented numeric value managed by the database.
   * Use this for relations between tables.
   */
  id: int("id").autoincrement().primaryKey(),
  /** Manus OAuth identifier (openId) returned from the OAuth callback. Unique per user. */
  openId: varchar("openId", { length: 64 }).notNull().unique(),
  name: text("name"),
  email: varchar("email", { length: 320 }),
  loginMethod: varchar("loginMethod", { length: 64 }),
  role: varchar("role", { length: 20 }).default("user").notNull(),
  status: mysqlEnum("status", ["active", "warned", "suspended", "banned"]).default("active").notNull(),
  warningCount: int("warningCount").default(0).notNull(),
  suspendedUntil: timestamp("suspendedUntil"),
  bannedAt: timestamp("bannedAt"),
  bannedReason: text("bannedReason"),
  nickname: varchar("nickname", { length: 100 }),
  location: varchar("location", { length: 255 }),
  profileImageUrl: varchar("profileImageUrl", { length: 500 }),
  isSellerActive: boolean("isSellerActive").default(false).notNull(),
  ageVerified: boolean("ageVerified").default(false).notNull(),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
  updatedAt: timestamp("updatedAt").defaultNow().onUpdateNow().notNull(),
  lastSignedIn: timestamp("lastSignedIn").defaultNow().notNull(),
});

export type User = typeof users.$inferSelect;
export type InsertUser = typeof users.$inferInsert;

/**
 * Seller profiles for users who want to sell cuttings/seeds
 */
export const sellerProfiles = mysqlTable("sellerProfiles", {
  id: int("id").autoincrement().primaryKey(),
  userId: int("userId").notNull().unique(),
  shopName: varchar("shopName", { length: 255 }).notNull(),
  description: text("description"),
  location: varchar("location", { length: 255 }),
  profileImageUrl: varchar("profileImageUrl", { length: 500 }),
  stripeAccountId: varchar("stripeAccountId", { length: 255 }),
  verificationStatus: mysqlEnum("verificationStatus", ["pending", "verified", "rejected"]).default("pending").notNull(),
  rating: decimal("rating", { precision: 3, scale: 2 }).default("0"),```


---

## 4. Backend-Implementierung

Dieser Abschnitt enthält den gesamten serverseitigen Code. Erstelle die folgenden Dateien in den angegebenen Verzeichnissen.

### Schritt 4.1: Server-Einstiegspunkt (`server/index.ts`)

Erstelle das Verzeichnis `server` und darin die Datei `index.ts`.

```bash
mkdir -p server
```

**`server/index.ts`**`ts`**
```typescript
/**
 * Shared Types Index
 * Export all shared types for easy import
 */

// Enums
export * from './enums';

// Models
export * from './models';

// Utility Types
export type Nullable<T> = T | null;
export type Optional<T> = T | undefined;
export type ID = number;

// Form Types
export interface CreateListingInput {
  type: import('./enums').ListingType;
  strain: string;
  description?: string;
  quantity: number;
  priceType: import('./enums').PriceType;
  fixedPrice?: number;
  auctionStartPrice?: number;
  auctionEndTime?: Date;
  imageUrl?: string;
  shippingVerified?: boolean;
  shippingPickup?: boolean;
  acceptsOffers?: boolean;
  offerMinPrice?: number;
  genetics?: import('./enums').Genetics;
  seedBank?: string;
  growMethod?: import('./enums').GrowMethod;
  seedType?: import('./enums').SeedType;
  thcContent?: string;
  cbdContent?: string;
  floweringTime?: string;
  yieldInfo?: string;
  flavorProfile?: string;
  origin?: string;
}

export interface UpdateListingInput extends Partial<CreateListingInput> {
  id: number;
}

export interface CreateOfferInput {
  listingId: number;
  amount: number;
  message?: string;
}

export interface CreateReportInput {
  reportedId: number;
  reportType: import('./enums').ReportType;
  reason: import('./enums').ReportReason;
  description?: string;
}

export interface CreateReviewInput {
  transactionId: number;
  rating: number;
  comment?: string;
}

export interface WarnUserInput {
  userId: number;
  reason: import('./enums').WarningReason;
  message?: string;
}

// API Response Types
export interface PaginatedResponse<T> {
  data: T[];
  total: number;
  page: number;
  pageSize: number;
  hasMore: boolean;
}

export interface ApiError {
  code: string;
  message: string;
  details?: unknown;
}

export interface ApiSuccess<T = void> {
  success: true;
  data?: T;
  message?: string;
}

```


### Schritt 4.2: tRPC-Konfiguration (`server/_core/trpc.ts`)

Erstelle das Verzeichnis `server/_core` und darin die Datei `trpc.ts`.

```bash
mkdir -p server/_core
```

**`server/_core/trpc.ts`**
```typescript
import { NOT_ADMIN_ERR_MSG, UNAUTHED_ERR_MSG } from '@shared/const';
import { initTRPC, TRPCError } from "@trpc/server";
import superjson from "superjson";
import type { TrpcContext } from "./context";
import { getDb } from "../db";
import { users } from "../../drizzle/schema";
import { eq } from "drizzle-orm";

const t = initTRPC.context<TrpcContext>().create({
  transformer: superjson,
});

export const router = t.router;
export const publicProcedure = t.procedure;

const requireUser = t.middleware(async opts => {
  const { ctx, next } = opts;

  if (!ctx.user) {
    throw new TRPCError({ code: "UNAUTHORIZED", message: UNAUTHED_ERR_MSG });
  }

  return next({
    ctx: {
      ...ctx,
      user: ctx.user,
    },
  });
});

export const protectedProcedure = t.procedure.use(requireUser);

export const adminProcedure = t.procedure.use(
  t.middleware(async opts => {
    const { ctx, next } = opts;

    if (!ctx.user) {
      throw new TRPCError({ code: "UNAUTHORIZED", message: UNAUTHED_ERR_MSG });
    }

    console.log('[adminProcedure] Session user:', { id: ctx.user.id, role: ctx.user.role });

    // Reload user from database to get latest role and status
    const db = await getDb();
    if (!db) {
      throw new TRPCError({ code: "INTERNAL_SERVER_ERROR", message: "Database not available" });
    }
    const freshUsers = await db.select().from(users).where(eq(users.id, ctx.user.id)).limit(1);
    const freshUser = freshUsers.length > 0 ? freshUsers[0] : null;

    console.log('[adminProcedure] Fresh user from DB:', freshUser ? { id: freshUser.id, role: freshUser.role } : 'null');

    if (!freshUser || (freshUser.role !== 'admin' && freshUser.role !== 'super_admin')) {
      throw new TRPCError({ code: "FORBIDDEN", message: NOT_ADMIN_ERR_MSG });
    }

    return next({
      ctx: {
        ...ctx,
        user: freshUser,
      },
    });
  }),
);

// Super admin procedure - only for super admins
export const superAdminProcedure = t.procedure.use(
  t.middleware(async opts => {
    const { ctx, next } = opts;

    if (!ctx.user) {
      throw new TRPCError({ code: "UNAUTHORIZED", message: UNAUTHED_ERR_MSG });
    }

    console.log('[superAdminProcedure] Session user:', { id: ctx.user.id, role: ctx.user.role });

    // Reload user from database to get latest role and status
    const db = await getDb();
    if (!db) {
      throw new TRPCError({ code: "INTERNAL_SERVER_ERROR", message: "Database not available" });
    }
    console.log('[superAdminProcedure] About to query database for user ID:', ctx.user.id);
    const freshUsers = await db.select().from(users).where(eq(users.id, ctx.user.id)).limit(1);
    console.log('[superAdminProcedure] Raw query result:', JSON.stringify(freshUsers));
    const freshUser = freshUsers.length > 0 ? freshUsers[0] : null;

    console.log('[superAdminProcedure] Fresh user from DB:', freshUser ? { id: freshUser.id, role: freshUser.role } : 'null');

    if (!freshUser || freshUser.role !== 'super_admin') {
      console.log('[superAdminProcedure] Access denied - role:', freshUser?.role);
      throw new TRPCError({ code: "FORBIDDEN", message: "Super admin access required" });
    }

    return next({
      ctx: {
        ...ctx,
        user: freshUser,
      },
    });
  }),
);

```


### Schritt 4.3: OAuth-Konfiguration (`server/_core/oauth.ts`)

**`server/_core/oauth.ts`**
```typescript
import { COOKIE_NAME, ONE_YEAR_MS } from "@shared/const";
import type { Express, Request, Response } from "express";
import * as db from "../db";
import { getSessionCookieOptions } from "./cookies";
import { sdk } from "./sdk";

function getQueryParam(req: Request, key: string): string | undefined {
  const value = req.query[key];
  return typeof value === "string" ? value : undefined;
}

export function registerOAuthRoutes(app: Express) {
  app.get("/api/oauth/callback", async (req: Request, res: Response) => {
    const code = getQueryParam(req, "code");
    const state = getQueryParam(req, "state");

    if (!code || !state) {
      res.status(400).json({ error: "code and state are required" });
      return;
    }

    try {
      // Extract IP address
      const ipAddress = req.headers['x-forwarded-for']?.toString().split(',')[0].trim() || 
                        req.socket.remoteAddress || 
                        'unknown';
      const userAgent = req.headers['user-agent'] || 'unknown';

      // 1. Check if IP is blocked
      const isBlocked = await db.isIPBlocked(ipAddress);
      if (isBlocked) {
        console.log(`[OAuth] ❌ Login blocked - IP is blacklisted: ${ipAddress}`);
        return res.redirect(302, "/maintenance?reason=ip_blocked");
      }

      const tokenResponse = await sdk.exchangeCodeForToken(code, state);
      const userInfo = await sdk.getUserInfo(tokenResponse.accessToken);

      if (!userInfo.openId) {
        res.status(400).json({ error: "openId missing from user info" });
        return;
      }

      // Upsert user
      await db.upsertUser({
        openId: userInfo.openId,
        name: userInfo.name || null,
        email: userInfo.email ?? null,
        loginMethod: userInfo.loginMethod ?? userInfo.platform ?? null,
        lastSignedIn: new Date(),
      });

      // Get user from database
      const user = await db.getUserByOpenId(userInfo.openId);
      if (!user) {
        res.status(500).json({ error: "Failed to create user" });
        return;
      }

      // 2. Check rate limiting (IP-based)
      const maxAttemptsPerIP = parseInt((await db.getSystemSetting('max_login_attempts_per_ip'))?.value || '10');
      const rateLimitWindow = parseInt((await db.getSystemSetting('login_rate_limit_window_minutes'))?.value || '15');
      
      const ipAttempts = await db.getLoginAttemptsByIP(ipAddress, rateLimitWindow);
      if (ipAttempts.length >= maxAttemptsPerIP) {
        const lockoutDuration = parseInt((await db.getSystemSetting('login_lockout_duration_minutes'))?.value || '30');
        await db.lockUserAccount(user.id, lockoutDuration);
        console.log(`[OAuth] ❌ Too many login attempts from IP: ${ipAddress} (${ipAttempts.length}/${maxAttemptsPerIP})`);
        return res.redirect(302, "/maintenance?reason=rate_limit_ip");
      }

      // 3. Check rate limiting (User-based)
      const maxAttemptsPerUser = parseInt((await db.getSystemSetting('max_login_attempts_per_user'))?.value || '5');
      const userAttempts = await db.getLoginAttemptsByUser(user.id, rateLimitWindow);
      if (userAttempts.length >= maxAttemptsPerUser) {
        const lockoutDuration = parseInt((await db.getSystemSetting('login_lockout_duration_minutes'))?.value || '30');
        await db.lockUserAccount(user.id, lockoutDuration);
        console.log(`[OAuth] ❌ Too many login attempts for user: ${user.email} (${userAttempts.length}/${maxAttemptsPerUser})`);
        return res.redirect(302, "/maintenance?reason=rate_limit_user");
      }

      // 4. Check if user account is locked
      const isLocked = await db.isUserAccountLocked(user.id);
      if (isLocked) {
        console.log(`[OAuth] ❌ User account is locked: ${user.email}`);
        await db.recordLoginAttempt(ipAddress, user.id, userAgent, false);
        return res.redirect(302, "/maintenance?reason=account_locked");
      }

      // 5. Check maintenance mode
      const maintenanceModeSetting = await db.getSystemSetting('maintenance_mode');
      const isMaintenanceMode = maintenanceModeSetting?.value === 'true';
      
      if (isMaintenanceMode && user.role !== 'super_admin') {
        console.log(`[OAuth] ❌ Login blocked during maintenance for user: ${user.email}`);
        await db.recordLoginAttempt(ipAddress, user.id, userAgent, false);
        return res.redirect(302, "/maintenance?reason=login_blocked");
      }

      // Record successful login attempt
      await db.recordLoginAttempt(ipAddress, user.id, userAgent, true);
      console.log(`[OAuth] ✅ Login successful: ${user.email} from ${ipAddress}`);

      const sessionToken = await sdk.createSessionToken(userInfo.openId, {
        name: userInfo.name || "",
        expiresInMs: ONE_YEAR_MS,
      });

      const cookieOptions = getSessionCookieOptions(req);
      res.cookie(COOKIE_NAME, sessionToken, { ...cookieOptions, maxAge: ONE_YEAR_MS });

      res.redirect(302, "/");
    } catch (error) {
      console.error("[OAuth] Callback failed", error);
      res.status(500).json({ error: "OAuth callback failed" });
    }
  });
}

```


### Schritt 4.4: Weitere Backend-Dateien

Erstelle die folgenden Dateien im `server` bzw. `server/_core` Verzeichnis.
### Schritt 4.x:  db.ts 

**`server/db.ts`**

```typescript
import { eq, desc, and, sql, or, inArray, gte, lt } from "drizzle-orm";
import { drizzle } from "drizzle-orm/mysql2";
import { InsertUser, users, sellerProfiles, listings, transactions, offers, reviews, warnings, suspensions, bans, adminLogs, systemSettings, notifications, conversations, messages, reports, loginAttempts, blockedIPs, User, SellerProfile, Listing, Transaction, Offer, Notification, InsertNotification, Conversation, InsertConversation, Message, InsertMessage } from "../drizzle/schema";
import { ENV } from './_core/env';

let _db: ReturnType<typeof drizzle> | null = null;

// Lazily create the drizzle instance so local tooling can run without a DB.
export async function getDb() {
  if (!_db && process.env.DATABASE_URL) {
    try {
      _db = drizzle(process.env.DATABASE_URL);
    } catch (error) {
      console.warn("[Database] Failed to connect:", error);
      _db = null;
    }
  }
  return _db;
}

export async function upsertUser(user: InsertUser): Promise<void> {
  if (!user.openId) {
    throw new Error("User openId is required for upsert");
  }

  const db = await getDb();
  if (!db) {
    console.warn("[Database] Cannot upsert user: database not available");
    return;
  }

  try {
    const values: InsertUser = {
      openId: user.openId,
    };
    const updateSet: Record<string, unknown> = {};

    const textFields = ["name", "email", "loginMethod"] as const;
    type TextField = (typeof textFields)[number];

    const assignNullable = (field: TextField) => {
      const value = user[field];
      if (value === undefined) return;
      const normalized = value ?? null;
      values[field] = normalized;
      updateSet[field] = normalized;
    };

    textFields.forEach(assignNullable);

    if (user.lastSignedIn !== undefined) {
      values.lastSignedIn = user.lastSignedIn;
      updateSet.lastSignedIn = user.lastSignedIn;
    }
    if (user.role !== undefined) {
      values.role = user.role;
      updateSet.role = user.role;
    } else if (user.openId === ENV.ownerOpenId) {
      // Owner always gets super_admin role on every login
      values.role = 'super_admin';
      updateSet.role = 'super_admin';
    }

    if (!values.lastSignedIn) {
      values.lastSignedIn = new Date();
    }

    if (Object.keys(updateSet).length === 0) {
      updateSet.lastSignedIn = new Date();
    }

    await db.insert(users).values(values).onDuplicateKeyUpdate({
      set: updateSet,
    });
  } catch (error) {
    console.error("[Database] Failed to upsert user:", error);
    throw error;
  }
}

export async function getUserByOpenId(openId: string) {
  const db = await getDb();
  if (!db) {
    console.warn("[Database] Cannot get user: database not available");
    return undefined;
  }

  const result = await db.select().from(users).where(eq(users.openId, openId)).limit(1);

  return result.length > 0 ? result[0] : undefined;
}

export async function getUserById(id: number) {
  const db = await getDb();
  if (!db) return undefined;

  const result = await db.select().from(users).where(eq(users.id, id)).limit(1);
  return result.length > 0 ? result[0] : undefined;
}

export async function updateUserProfile(userId: number, updates: Partial<User>) {
  const db = await getDb();
  if (!db) throw new Error("Database not available");

  // Filter out undefined values
  const filteredUpdates = Object.fromEntries(
    Object.entries(updates).filter(([, value]) => value !== undefined)
  );

  if (Object.keys(filteredUpdates).length === 0) {
    return { changes: 0 }; // No updates to apply
  }

  return db.update(users).set(filteredUpdates as any).where(eq(users.id, userId));
}

// Seller Profile functions
export async function createSellerProfile(userId: number, shopName: string, description?: string, location?: string) {
  const db = await getDb();
  if (!db) throw new Error("Database not available");

  const result = await db.insert(sellerProfiles).values({
    userId,
    shopName,
    description,
    location,
  });

  return result;
}

export async function getSellerProfile(userId: number): Promise<(SellerProfile & { profileImageUrl?: string | null }) | undefined> {
  const db = await getDb();
  if (!db) return undefined;

  // Join with users table to get profileImageUrl
  const result = await db.select({
    id: sellerProfiles.id,
    userId: sellerProfiles.userId,
    shopName: sellerProfiles.shopName,
    description: sellerProfiles.description,
    location: sellerProfiles.location,
    profileImageUrl: users.profileImageUrl, // Get from users table
    stripeAccountId: sellerProfiles.stripeAccountId,
    verificationStatus: sellerProfiles.verificationStatus,
    rating: sellerProfiles.rating,
    totalReviews: sellerProfiles.totalReviews,
    createdAt: sellerProfiles.createdAt,
    updatedAt: sellerProfiles.updatedAt,
  })
    .from(sellerProfiles)
    .leftJoin(users, eq(sellerProfiles.userId, users.id))
    .where(eq(sellerProfiles.userId, userId))
    .limit(1);
  
  console.log('[DEBUG] getSellerProfile result:', JSON.stringify(result[0], null, 2));
  return result.length > 0 ? result[0] : undefined;
}

export async function updateSellerProfile(userId: number, updates: Partial<SellerProfile>) {
  const db = await getDb();
  if (!db) throw new Error("Database not available");

  // Filter out undefined values
  const filteredUpdates = Object.fromEntries(
    Object.entries(updates).filter(([, value]) => value !== undefined)
  );

  if (Object.keys(filteredUpdates).length === 0) {
    return { changes: 0 }; // No updates to apply
  }

  return db.update(sellerProfiles).set(filteredUpdates as any).where(eq(sellerProfiles.userId, userId));
}

// Listing functions
export async function createListing(sellerId: number, listing: {
  type: "cutting" | "seed";
  strain: string;
  description?: string;
  quantity: number;
  priceType: "fixed" | "auction";
  fixedPrice?: number | string;
  auctionStartPrice?: number | string;
  auctionEndTime?: Date;
  imageUrl?: string;
  images?: string;
  shippingVerified?: boolean;
  shippingPickup?: boolean;
  // Additional optional fields
  genetics?: "sativa" | "indica" | "hybrid";
  seedBank?: string;
  growMethod?: "hydro" | "bio" | "soil";
  seedType?: "feminized" | "regular" | "autoflower";
  thcContent?: string;
  cbdContent?: string;
  floweringTime?: string;
  yieldInfo?: string;
  flavorProfile?: string;
  origin?: string;
}) {
  const db = await getDb();
  if (!db) throw new Error("Database not available");

  return db.insert(listings).values({
    sellerId,
    type: listing.type,
    strain: listing.strain,
    description: listing.description,
    quantity: listing.quantity,
    shippingVerified: listing.shippingVerified !== undefined ? listing.shippingVerified : true,
    shippingPickup: listing.shippingPickup !== undefined ? listing.shippingPickup : false,
    priceType: listing.priceType,
    fixedPrice: listing.fixedPrice ? String(listing.fixedPrice) : undefined,
    auctionStartPrice: listing.auctionStartPrice ? String(listing.auctionStartPrice) : undefined,
    auctionEndTime: listing.auctionEndTime,
    imageUrl: listing.imageUrl,
    images: listing.images,
    status: "active", // Automatically set to active
    // Additional optional fields
    genetics: listing.genetics,
    seedBank: listing.seedBank,
    growMethod: listing.growMethod,
    seedType: listing.seedType,
    thcContent: listing.thcContent,
    cbdContent: listing.cbdContent,
    floweringTime: listing.floweringTime,
    yieldInfo: listing.yieldInfo,
    flavorProfile: listing.flavorProfile,
    origin: listing.origin,
  });
}

export async function getListing(id: number): Promise<Listing | undefined> {
  const db = await getDb();
  if (!db) return undefined;

  const result = await db.select().from(listings).where(eq(listings.id, id)).limit(1);
  return result.length > 0 ? result[0] : undefined;
}

export async function getSellerListings(sellerId: number) {
  const db = await getDb();
  if (!db) return [];

  return db.select().from(listings)
    .where(eq(listings.sellerId, sellerId))
    .orderBy(desc(listings.createdAt));
}

export async function getActiveListings(limit: number = 50, offset: number = 0) {
  const db = await getDb();
  if (!db) return [];

  return db.select().from(listings)
    .where(eq(listings.status, "active"))
    .orderBy(desc(listings.createdAt))
    .limit(limit)
    .offset(offset);
}

export async function getAllListings() {
  const db = await getDb();
  if (!db) return [];

  return db.select().from(listings)
    .orderBy(desc(listings.createdAt));
}

export async function updateListing(id: number, updates: Partial<Listing>) {
  const db = await getDb();
  if (!db) throw new Error("Database not available");

  return db.update(listings).set(updates).where(eq(listings.id, id));
}

// Transaction functions
export async function createTransaction(transaction: {
  listingId: number;
  buyerId: number;
  sellerId: number;
  quantity: number;
  totalAmount: number | string;
  platformFee: number | string;
  sellerAmount: number | string;
  stripeChargeId?: string;
}): Promise<number> {
  const db = await getDb();
  if (!db) throw new Error("Database not available");

  const result = await db.insert(transactions).values({
    listingId: transaction.listingId,
    buyerId: transaction.buyerId,
    sellerId: transaction.sellerId,
    quantity: transaction.quantity,
    totalAmount: String(transaction.totalAmount),
    platformFee: String(transaction.platformFee),
    sellerAmount: String(transaction.sellerAmount),
    stripeChargeId: transaction.stripeChargeId,
  });

  // Return the inserted transaction ID
  // @ts-ignore - insertId exists on the result but TypeScript doesn't recognize it
  return result.insertId || result[0]?.insertId || 0;
}

export async function getTransaction(id: number): Promise<Transaction | undefined> {
  const db = await getDb();
  if (!db) return undefined;

  const result = await db.select().from(transactions).where(eq(transactions.id, id)).limit(1);
  return result.length > 0 ? result[0] : undefined;
}

export async function getBuyerTransactions(buyerId: number) {
  const db = await getDb();
  if (!db) return [];

  return db.select().from(transactions)
    .where(eq(transactions.buyerId, buyerId))
    .orderBy(desc(transactions.createdAt));
}

export async function getSellerTransactions(sellerId: number) {
  const db = await getDb();
  if (!db) return [];

  return db.select().from(transactions)
    .where(eq(transactions.sellerId, sellerId))
    .orderBy(desc(transactions.createdAt));
}

export async function updateTransaction(id: number, updates: Partial<Transaction>) {
  const db = await getDb();
  if (!db) throw new Error("Database not available");

  return db.update(transactions).set(updates).where(eq(transactions.id, id));
}

// Review functions
export async function createReview(review: {
  transactionId: number;
  sellerId: number;
  buyerId: number;
  rating: number;
  comment?: string;
}) {
  const db = await getDb();
  if (!db) throw new Error("Database not available");

  return db.insert(reviews).values({
    transactionId: review.transactionId,
    sellerId: review.sellerId,
    buyerId: review.buyerId,
    rating: review.rating,
    comment: review.comment,
  });
}

export async function getReviewsBySellerId(sellerId: number) {
  const db = await getDb();
  if (!db) return [];

  const result = await db.select({
    id: reviews.id,
    rating: reviews.rating,
    comment: reviews.comment,
    createdAt: reviews.createdAt,
    buyerName: users.nickname,
  })
    .from(reviews)
    .leftJoin(users, eq(reviews.buyerId, users.id))
    .where(eq(reviews.sellerId, sellerId))
    .orderBy(desc(reviews.createdAt));

  return result;
}

export async function getReviewByTransactionAndBuyer(transactionId: number, buyerId: number) {
  const db = await getDb();
  if (!db) return undefined;

  const result = await db.select().from(reviews)
    .where(and(eq(reviews.transactionId, transactionId), eq(reviews.buyerId, buyerId)))
    .limit(1);

  return result.length > 0 ? result[0] : undefined;
}

export async function getTransactionById(id: number): Promise<Transaction | undefined> {
  const db = await getDb();
  if (!db) return undefined;

  const result = await db.select().from(transactions).where(eq(transactions.id, id)).limit(1);
  return result.length > 0 ? result[0] : undefined;
}

export async function updateSellerRating(sellerId: number) {
  const db = await getDb();
  if (!db) throw new Error("Database not available");

  // Calculate average rating
  const allReviews = await db.select().from(reviews).where(eq(reviews.sellerId, sellerId));
  
  if (allReviews.length === 0) {
    await db.update(sellerProfiles)
      .set({ rating: "0", totalReviews: 0 })
      .where(eq(sellerProfiles.userId, sellerId));
    return;
  }

  const totalRating = allReviews.reduce((sum, review) => sum + review.rating, 0);
  const averageRating = (totalRating / allReviews.length).toFixed(2);

  await db.update(sellerProfiles)
    .set({ rating: averageRating, totalReviews: allReviews.length })
    .where(eq(sellerProfiles.userId, sellerId));
}


// ============================================
// Offer Functions (Price Proposals)
// ============================================

export async function createOffer(data: {
  listingId: number;
  buyerId: number;
  sellerId: number;
  offerAmount: string;
  message?: string;
}) {
  const db = await getDb();
  if (!db) throw new Error("Database not available");

  await db.insert(offers).values({
    listingId: data.listingId,
    buyerId: data.buyerId,
    sellerId: data.sellerId,
    offerAmount: data.offerAmount,
    message: data.message || null,
    status: "pending",
    createdAt: new Date(),
    updatedAt: new Date(),
  });

  // Return success without needing the ID
  return {
    success: true,
  };
}

export async function getOfferById(id: number) {
  const db = await getDb();
  if (!db) return undefined;

  const result = await db.select().from(offers).where(eq(offers.id, id)).limit(1);
  return result.length > 0 ? result[0] : undefined;
}

export async function getOffersByListingId(listingId: number) {
  const db = await getDb();
  if (!db) return [];

  const result = await db.select({
    id: offers.id,
    listingId: offers.listingId,
    buyerId: offers.buyerId,
    sellerId: offers.sellerId,
    offerAmount: offers.offerAmount,
    message: offers.message,
    status: offers.status,
    createdAt: offers.createdAt,
    updatedAt: offers.updatedAt,
    respondedAt: offers.respondedAt,
    buyerNickname: users.nickname,
    buyerProfileImageUrl: users.profileImageUrl,
  })
    .from(offers)
    .leftJoin(users, eq(offers.buyerId, users.id))
    .where(eq(offers.listingId, listingId))
    .orderBy(desc(offers.createdAt));

  return result;
}

export async function getOffersByBuyerId(buyerId: number) {
  const db = await getDb();
  if (!db) return [];

  const result = await db.select({
    id: offers.id,
    listingId: offers.listingId,
    buyerId: offers.buyerId,
    sellerId: offers.sellerId,
    offerAmount: offers.offerAmount,
    message: offers.message,
    status: offers.status,
    createdAt: offers.createdAt,
    updatedAt: offers.updatedAt,
    respondedAt: offers.respondedAt,
    listingStrain: listings.strain,
    listingType: listings.type,
    sellerNickname: users.nickname,
  })
    .from(offers)
    .leftJoin(listings, eq(offers.listingId, listings.id))
    .leftJoin(users, eq(offers.sellerId, users.id))
    .where(eq(offers.buyerId, buyerId))
    .orderBy(desc(offers.createdAt));

  return result;
}

export async function getOffersBySellerId(sellerId: number) {
  const db = await getDb();
  if (!db) return [];

  const result = await db.select({
    id: offers.id,
    listingId: offers.listingId,
    buyerId: offers.buyerId,
    sellerId: offers.sellerId,
    offerAmount: offers.offerAmount,
    message: offers.message,
    status: offers.status,
    createdAt: offers.createdAt,
    updatedAt: offers.updatedAt,
    respondedAt: offers.respondedAt,
    listingStrain: listings.strain,
    listingType: listings.type,
    listingFixedPrice: listings.fixedPrice,
    buyerNickname: users.nickname,
    buyerName: users.name,
    buyerProfileImageUrl: users.profileImageUrl,
  })
    .from(offers)
    .leftJoin(listings, eq(offers.listingId, listings.id))
    .leftJoin(users, eq(offers.buyerId, users.id))
    .where(eq(offers.sellerId, sellerId))
    .orderBy(desc(offers.createdAt));

  // Transform to expected format with nested objects
  return result.map(row => ({
    id: row.id,
    listingId: row.listingId,
    buyerId: row.buyerId,
    sellerId: row.sellerId,
    offerAmount: row.offerAmount,
    message: row.message,
    status: row.status,
    createdAt: row.createdAt,
    updatedAt: row.updatedAt,
    respondedAt: row.respondedAt,
    listing: {
      strain: row.listingStrain,
      type: row.listingType,
      fixedPrice: row.listingFixedPrice,
    },
    buyer: {
      nickname: row.buyerNickname,
      name: row.buyerName,
      profileImageUrl: row.buyerProfileImageUrl,
    },
  }));
}

export async function updateOfferStatus(id: number, status: "accepted" | "rejected") {
  const db = await getDb();
  if (!db) throw new Error("Database not available");

  await db.update(offers)
    .set({ 
      status, 
      respondedAt: new Date(),
      updatedAt: new Date(),
    })
    .where(eq(offers.id, id));
}




// Admin functions
export async function getAdminStats() {
  const db = await getDb();
  if (!db) return null;

  try {
    // Get total transactions and revenue
    const allTransactions = await db.select().from(transactions);
    const totalTransactions = allTransactions.length;
    const totalRevenue = allTransactions.reduce((sum, t) => sum + parseFloat(t.totalAmount as any), 0);
    const platformFees = allTransactions.reduce((sum, t) => sum + parseFloat(t.platformFee as any), 0);
    
    // Get today's transactions
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const transactionsToday = allTransactions.filter(t => new Date(t.createdAt) >= today).length;

    // Get total users and sellers
    const allUsers = await db.select().from(users);
    const totalUsers = allUsers.length;
    const totalSellers = allUsers.filter(u => u.isSellerActive).length;
    const warnedUsers = allUsers.filter(u => u.status === 'warned').length;
    const suspendedUsers = allUsers.filter(u => u.status === 'suspended').length;

    // Get listings
    const allListings = await db.select().from(listings);
    const totalListings = allListings.length;
    const activeListings = allListings.filter(l => l.status === 'active').length;

    // Get pending reports (will be 0 for now until reports are implemented)
    const pendingReports = 0;

    return {
      totalRevenue,
      platformFees,
      totalTransactions,
      transactionsToday,
      totalUsers,
      totalSellers,
      warnedUsers,
      suspendedUsers,
      activeListings,
      totalListings,
      pendingReports,
    };
  } catch (error) {
    console.error("[Database] Failed to get admin stats:", error);
    return null;
  }
}




// Get all users for admin
export async function getAllUsers() {
  const db = await getDb();
  if (!db) return [];

  try {
    const allUsers = await db.select().from(users);
    return allUsers;
  } catch (error) {
    console.error("[Database] Failed to get all users:", error);
    return [];
  }
}

// Warn user
export async function warnUser(userId: number, adminId: number, reason: 'fraud' | 'tos_violation' | 'illegal_products' | 'harassment' | 'fake_listing' | 'non_delivery' | 'other', message: string) {
  const db = await getDb();
  if (!db) {
    throw new Error("Database not available");
  }

  try {
    console.log("[Database] Warning user:", { userId, adminId, reason, message });
    
    // Insert warning
    await db.insert(warnings).values({
      userId,
      adminId,
      reason: reason as any,
      message,
      createdAt: new Date(),
    });

    console.log("[Database] Warning inserted successfully");

    // Update user status and warning count
    const user = await db.select().from(users).where(eq(users.id, userId)).limit(1);
    if (user.length > 0) {
      const newWarningCount = (user[0].warningCount || 0) + 1;
      await db.update(users)
        .set({ 
          status: 'warned' as any,
          warningCount: newWarningCount,
        })
        .where(eq(users.id, userId));
      
      console.log("[Database] User status updated to warned, count:", newWarningCount);
    }

    // Log admin action
    await db.insert(adminLogs).values({
      adminId,
      action: 'warn_user' as any,
      targetType: 'user' as any,
      targetId: userId,
      details: `Reason: ${reason}, Message: ${message}`,
      createdAt: new Date(),
    });
    
    console.log("[Database] Admin log created successfully");

    // Create notification for user
    await createNotification({
      userId,
      type: 'warning',
      title: 'Sie haben eine Verwarnung erhalten',
      message: `Grund: ${reason}\n\n${message}`,
      actionUrl: '/profile',
    });
    
    console.log("[Database] Notification created for user");
  } catch (error) {
    console.error("[Database] Failed to warn user:", error);
    throw error;
  }
}

// Suspend user
export async function suspendUser(userId: number, adminId: number, reason: string, days: number) {
  const db = await getDb();
  if (!db) return;

  try {
    const suspendedUntil = new Date();
    suspendedUntil.setDate(suspendedUntil.getDate() + days);

    // Insert suspension
    await db.insert(suspensions).values({
      userId,
      adminId,
      reason,
      suspendedUntil,
      createdAt: new Date(),
    });

    // Update user status
    await db.update(users)
      .set({ 
        status: 'suspended',
        suspendedUntil,
      })
      .where(eq(users.id, userId));

    // Log admin action
    await db.insert(adminLogs).values({
      adminId,
      action: 'suspend_user' as any,
      targetType: 'user' as any,
      targetId: userId,
      details: `Reason: ${reason}, Days: ${days}, Until: ${suspendedUntil.toISOString()}`,
      createdAt: new Date(),
    });

    // Create notification for user
    await createNotification({
      userId,
      type: 'suspension',
      title: 'Ihr Account wurde temporär gesperrt',
      message: `Grund: ${reason}\n\nIhr Account ist bis zum ${suspendedUntil.toLocaleDateString('de-DE')} gesperrt.`,
      actionUrl: '/profile',
    });
  } catch (error) {
    console.error("[Database] Failed to suspend user:", error);
  }
}

// Ban user
export async function banUser(userId: number, adminId: number, reason: string) {
  const db = await getDb();
  if (!db) return;

  try {
    // Insert ban
    await db.insert(bans).values({
      userId,
      adminId,
      reason,
      createdAt: new Date(),
    });

    // Update user status
    await db.update(users)
      .set({ 
        status: 'banned',
        bannedAt: new Date(),
        bannedReason: reason,
      })
      .where(eq(users.id, userId));

    // Log admin action
    await db.insert(adminLogs).values({
      adminId,
      action: 'ban_user' as any,
      targetType: 'user' as any,
      targetId: userId,
      details: `Reason: ${reason}`,
      createdAt: new Date(),
    });

    // Create notification for user
    await createNotification({
      userId,
      type: 'ban',
      title: 'Ihr Account wurde permanent gesperrt',
      message: `Grund: ${reason}\n\nIhr Account wurde aufgrund schwerwiegender Verstöße gegen unsere Nutzungsbedingungen permanent gesperrt. Bei Fragen kontaktieren Sie bitte den Support.`,
      actionUrl: '/support',
    });
  } catch (error) {
    console.error("[Database] Failed to ban user:", error);
  }
}

// Unsuspend user
export async function unsuspendUser(userId: number) {
  const db = await getDb();
  if (!db) return;

  try {
    // Check if user has warnings
    const user = await db.select().from(users).where(eq(users.id, userId)).limit(1);
    const newStatus = user[0]?.warningCount > 0 ? 'warned' : 'active';

    await db.update(users)
      .set({ 
        status: newStatus,
        suspendedUntil: null,
      })
      .where(eq(users.id, userId));
  } catch (error) {
    console.error("[Database] Failed to unsuspend user:", error);
  }
}

// Unban user
export async function unbanUser(userId: number) {
  const db = await getDb();
  if (!db) return;

  try {
    // Check if user has warnings or is suspended
    const user = await db.select().from(users).where(eq(users.id, userId)).limit(1);
    let newStatus = 'active';
    
    if (user[0]?.warningCount > 0) {
      newStatus = 'warned';
    } else if (user[0]?.suspendedUntil && new Date(user[0].suspendedUntil) > new Date()) {
      newStatus = 'suspended';
    }

    await db.update(users)
      .set({ 
        status: newStatus,
      })
      .where(eq(users.id, userId));

    // Create notification for user
    await createNotification({
      userId,
      type: 'unban',
      title: 'Ihr Account wurde entsperrt',
      message: `Ihr Account wurde entsperrt und Sie können deimudda wieder nutzen. Bitte beachten Sie unsere Nutzungsbedingungen.`,
      actionUrl: '/profile',
    });
  } catch (error) {
    console.error("[Database] Failed to unban user:", error);
  }
}

// Promote to admin
export async function promoteToAdmin(userId: number) {
  const db = await getDb();
  if (!db) return;

  try {
    await db.update(users)
      .set({ role: 'admin' })
      .where(eq(users.id, userId));
  } catch (error) {
    console.error("[Database] Failed to promote to admin:", error);
  }
}

// Demote from admin
export async function demoteFromAdmin(userId: number) {
  const db = await getDb();
  if (!db) return;

  try {
    await db.update(users)
      .set({ role: 'user' })
      .where(eq(users.id, userId));
  } catch (error) {
    console.error("[Database] Failed to demote from admin:", error);
  }
}



// Remove warning from user
export async function removeWarning(warningId: number, adminId: number) {
  const db = await getDb();
  if (!db) {
    throw new Error("Database not available");
  }

  try {
    console.log("[Database] Removing warning:", { warningId, adminId });
    
    // Get the warning to find the user
    const warning = await db.select().from(warnings).where(eq(warnings.id, warningId)).limit(1);
    if (warning.length === 0) {
      throw new Error("Warning not found");
    }

    const userId = warning[0].userId;

    // Delete the warning
    await db.delete(warnings).where(eq(warnings.id, warningId));
    console.log("[Database] Warning deleted successfully");

    // Update user warning count
    const userWarnings = await db.select().from(warnings).where(eq(warnings.userId, userId));
    const newWarningCount = userWarnings.length;
    
    // Update user status based on remaining warnings
    const newStatus = newWarningCount > 0 ? 'warned' : 'active';
    await db.update(users)
      .set({ 
        status: newStatus as any,
        warningCount: newWarningCount,
      })
      .where(eq(users.id, userId));
    
    console.log("[Database] User status updated, new warning count:", newWarningCount);

    // Log admin action
    await db.insert(adminLogs).values({
      adminId,
      action: 'remove_warning' as any,
      targetType: 'user' as any,
      targetId: userId,
      details: `Removed warning ID: ${warningId}`,
      createdAt: new Date(),
    });
    
    console.log("[Database] Admin log created successfully");
  } catch (error) {
    console.error("[Database] Failed to remove warning:", error);
    throw error;
  }
}



// Get warnings for a specific user
export async function getUserWarnings(userId: number) {
  const db = await getDb();
  if (!db) {
    return [];
  }

  try {
    const userWarnings = await db
      .select({
        id: warnings.id,
        reason: warnings.reason,
        message: warnings.message,
        createdAt: warnings.createdAt,
        adminId: warnings.adminId,
        adminName: users.name,
      })
      .from(warnings)
      .leftJoin(users, eq(warnings.adminId, users.id))
      .where(eq(warnings.userId, userId))
      .orderBy(desc(warnings.createdAt));

    return userWarnings;
  } catch (error) {
    console.error("[Database] Failed to get user warnings:", error);
    return [];
  }
}



// Get all admin logs
export async function getAdminLogs() {
  const db = await getDb();
  if (!db) {
    return [];
  }

  try {
    const logs = await db
      .select({
        id: adminLogs.id,
        adminId: adminLogs.adminId,
        adminName: users.name,
        action: adminLogs.action,
        targetType: adminLogs.targetType,
        targetId: adminLogs.targetId,
        details: adminLogs.details,
        createdAt: adminLogs.createdAt,
      })
      .from(adminLogs)
      .leftJoin(users, eq(adminLogs.adminId, users.id))
      .orderBy(desc(adminLogs.createdAt))
      .limit(1000); // Limit to last 1000 logs

    return logs;
  } catch (error) {
    console.error("[Database] Failed to get admin logs:", error);
    return [];
  }
}



// Block listing (admin moderation)
export async function blockListing(listingId: number, adminId: number, reason: string) {
  const db = await getDb();
  if (!db) {
    throw new Error("Database connection failed");
  }

  try {
    // Update listing status to blocked
    await db
      .update(listings)
      .set({ status: 'blocked' })
      .where(eq(listings.id, listingId));

    // Create admin log
    await db.insert(adminLogs).values({
      adminId,
      action: 'block_listing',
      targetType: 'listing',
      targetId: listingId,
      details: `Listing gesperrt. Grund: ${reason}`,
    });

    console.log(`[Admin] Listing ${listingId} blocked by admin ${adminId}`);
    return { success: true };
  } catch (error) {
    console.error("[Database] Failed to block listing:", error);
    throw error;
  }
}

// Unblock listing (admin moderation)
export async function unblockListing(listingId: number, adminId: number) {
  const db = await getDb();
  if (!db) {
    throw new Error("Database connection failed");
  }

  try {
    // Update listing status to active
    await db
      .update(listings)
      .set({ status: 'active' })
      .where(eq(listings.id, listingId));

    // Create admin log
    await db.insert(adminLogs).values({
      adminId,
      action: 'unblock_listing',
      targetType: 'listing',
      targetId: listingId,
      details: `Listing-Sperrung aufgehoben`,
    });

    console.log(`[Admin] Listing ${listingId} unblocked by admin ${adminId}`);
    return { success: true };
  } catch (error) {
    console.error("[Database] Failed to unblock listing:", error);
    throw error;
  }
}

// Delete listing (super admin only)
export async function deleteListing(listingId: number, adminId: number, reason: string) {
  const db = await getDb();
  if (!db) {
    throw new Error("Database connection failed");
  }

  try {
    // Update listing status to deleted (soft delete)
    await db
      .update(listings)
      .set({ status: 'deleted' })
      .where(eq(listings.id, listingId));

    // Create admin log
    await db.insert(adminLogs).values({
      adminId,
      action: 'delete_listing',
      targetType: 'listing',
      targetId: listingId,
      details: `Listing gelöscht. Grund: ${reason}`,
    });

    console.log(`[Admin] Listing ${listingId} deleted by admin ${adminId}`);
    return { success: true };
  } catch (error) {
    console.error("[Database] Failed to delete listing:", error);
    throw error;
  }
}



// Get all reports (admin)
export async function getAllReports() {
  const db = await getDb();
  if (!db) {
    return [];
  }

  try {
    const allReports = await db
      .select({
        id: reports.id,
        reporterId: reports.reporterId,
        reporterName: users.name,
        targetType: reports.reportedType,
        targetId: reports.reportedId,
        reason: reports.reason,
        description: reports.message,
        status: reports.status,
        createdAt: reports.createdAt,
        reviewedAt: reports.reviewedAt,
        reviewedBy: reports.reviewedBy,
      })
      .from(reports)
      .leftJoin(users, eq(reports.reporterId, users.id))
      .orderBy(desc(reports.createdAt))
      .limit(1000);

    return allReports;
  } catch (error) {
    console.error("[Database] Failed to get reports:", error);
    return [];
  }
}

// Update report status (admin)
export async function updateReportStatus(
  reportId: number,
  adminId: number,
  status: 'pending' | 'reviewing' | 'resolved' | 'dismissed'
) {
  const db = await getDb();
  if (!db) {
    throw new Error("Database connection failed");
  }

  try {
    const updateData: any = { status };
    
    if (status === 'resolved' || status === 'rejected') {
      updateData.reviewedAt = new Date();
      updateData.reviewedBy = adminId;
    }

    await db
      .update(reports)
      .set(updateData)
      .where(eq(reports.id, reportId));

    // Create admin log
    await db.insert(adminLogs).values({
      adminId,
      action: 'update_report',
      targetType: 'report',
      targetId: reportId,
      details: `Report-Status geändert zu: ${status}`,
    });

    console.log(`[Admin] Report ${reportId} status updated to ${status} by admin ${adminId}`);
    return { success: true };
  } catch (error) {
    console.error("[Database] Failed to update report status:", error);
    throw error;
  }
}



// Get all system settings (admin)
export async function getSystemSettings() {
  const db = await getDb();
  if (!db) {
    return [];
  }

  try {
    const settings = await db
      .select()
      .from(systemSettings)
      .orderBy(systemSettings.key);

    return settings;
  } catch (error) {
    console.error("[Database] Failed to get system settings:", error);
    return [];
  }
}

// Update system setting (super admin)
export async function updateSystemSetting(
  key: string,
  value: string,
  adminId: number
) {
  const db = await getDb();
  if (!db) {
    throw new Error("Database connection failed");
  }

  try {
    // Check if setting exists
    const existing = await db
      .select()
      .from(systemSettings)
      .where(eq(systemSettings.key, key))
      .limit(1);

    if (existing.length > 0) {
      // Update existing setting
      await db
        .update(systemSettings)
        .set({
          value,
          updatedBy: adminId,
          updatedAt: new Date(),
        })
        .where(eq(systemSettings.key, key));
    } else {
      // Insert new setting
      await db.insert(systemSettings).values({
        key,
        value,
        updatedBy: adminId,
      });
    }

    // Invalidate cache
    const { settingsCache } = await import('./settings-cache.js');
    settingsCache.invalidate(key);
    
    // Create admin log
    await db.insert(adminLogs).values({
      adminId,
      action: 'update_setting',
      targetType: 'system_setting',
      targetId: 0,
      details: `System setting updated: ${key} = ${value}`,
    });

    console.log(`[Admin] System setting ${key} updated by admin ${adminId}`);
    return { success: true };
  } catch (error) {
    console.error("[Database] Failed to update system setting:", error);
    throw error;
  }
}

// Get all admins (for admin management)
export async function getAllAdmins() {
  const db = await getDb();
  if (!db) {
    return [];
  }

  try {
    console.log('[getAllAdmins] Fetching admins...');
    const admins = await db
      .select({
        id: users.id,
        name: users.name,
        email: users.email,
        role: users.role,
        status: users.status,
        createdAt: users.createdAt,
        lastSignedIn: users.lastSignedIn,
      })
      .from(users)
      .where(
        sql`${users.role} IN ('admin', 'super_admin')`
      )
      .orderBy(desc(users.createdAt));

    console.log('[getAllAdmins] Found admins:', admins.length, JSON.stringify(admins));
    return admins;
  } catch (error) {
    console.error("[Database] Failed to get admins:", error);
    return [];
  }
}



// ===== NOTIFICATION FUNCTIONS =====

/**
 * Create a notification for a user
 */
export async function createNotification(data: {
  userId: number;
  type: "warning" | "suspension" | "ban" | "unban" | "listing_approved" | "listing_rejected" | "offer_received" | "offer_accepted" | "offer_rejected" | "system";
  title: string;
  message: string;
  actionUrl?: string;
}) {
  const db = await getDb();
  if (!db) {
    throw new Error("Database connection failed");
  }

  try {
    const result = await db.insert(notifications).values({
      userId: data.userId,
      type: data.type,
      title: data.title,
      message: data.message,
      actionUrl: data.actionUrl,
      read: false,
    });

    console.log(`[Notification] Created notification for user ${data.userId}: ${data.title}`);
    return { success: true, notificationId: Number(result.insertId) };
  } catch (error) {
    console.error("[Database] Failed to create notification:", error);
    throw error;
  }
}

/**
 * Get all notifications for a user
 */
export async function getMyNotifications(userId: number) {
  const db = await getDb();
  if (!db) {
    return [];
  }

  try {
    const userNotifications = await db
      .select()
      .from(notifications)
      .where(eq(notifications.userId, userId))
      .orderBy(desc(notifications.createdAt));

    return userNotifications;
  } catch (error) {
    console.error("[Database] Failed to get notifications:", error);
    return [];
  }
}

/**
 * Get unread notification count for a user
 */
export async function getUnreadNotificationCount(userId: number) {
  const db = await getDb();
  if (!db) {
    return 0;
  }

  try {
    const result = await db
      .select({ count: sql<number>`count(*)` })
      .from(notifications)
      .where(
        and(
          eq(notifications.userId, userId),
          eq(notifications.read, false)
        )
      );

    return result[0]?.count || 0;
  } catch (error) {
    console.error("[Database] Failed to get unread notification count:", error);
    return 0;
  }
}

/**
 * Mark a notification as read
 */
export async function markNotificationAsRead(notificationId: number, userId: number) {
  const db = await getDb();
  if (!db) {
    throw new Error("Database connection failed");
  }

  try {
    await db
      .update(notifications)
      .set({ read: true })
      .where(
        and(
          eq(notifications.id, notificationId),
          eq(notifications.userId, userId)
        )
      );

    console.log(`[Notification] Marked notification ${notificationId} as read for user ${userId}`);
    return { success: true };
  } catch (error) {
    console.error("[Database] Failed to mark notification as read:", error);
    throw error;
  }
}

/**
 * Mark all notifications as read for a user
 */
export async function markAllNotificationsAsRead(userId: number) {
  const db = await getDb();
  if (!db) {
    throw new Error("Database connection failed");
  }

  try {
    await db
      .update(notifications)
      .set({ read: true })
      .where(
        and(
          eq(notifications.userId, userId),
          eq(notifications.read, false)
        )
      );

    console.log(`[Notification] Marked all notifications as read for user ${userId}`);
    return { success: true };
  } catch (error) {
    console.error("[Database] Failed to mark all notifications as read:", error);
    throw error;
  }
}

/**
 * Delete a notification
 */
export async function deleteNotification(notificationId: number, userId: number) {
  const db = await getDb();
  if (!db) {
    throw new Error("Database connection failed");
  }

  try {
    await db
      .delete(notifications)
      .where(
        and(
          eq(notifications.id, notificationId),
          eq(notifications.userId, userId)
        )
      );

    console.log(`[Notification] Deleted notification ${notificationId} for user ${userId}`);
    return { success: true };
  } catch (error) {
    console.error("[Database] Failed to delete notification:", error);
    throw error;
  }
}



// ============================================================================
// CHAT SYSTEM FUNCTIONS
// ============================================================================

/**
 * Get or create a conversation between buyer and seller for a listing
 */
export async function getOrCreateConversation(listingId: number, buyerId: number, sellerId: number): Promise<Conversation> {
  const db = await getDb();
  if (!db) {
    throw new Error("Database connection failed");
  }

  try {
    // Check if conversation already exists
    const existing = await db
      .select()
      .from(conversations)
      .where(
        and(
          eq(conversations.listingId, listingId),
          eq(conversations.buyerId, buyerId),
          eq(conversations.sellerId, sellerId)
        )
      )
      .limit(1);

    if (existing.length > 0) {
      return existing[0];
    }

    // Create new conversation
    const result = await db.insert(conversations).values({
      listingId,
      buyerId,
      sellerId,
      lastMessageAt: new Date(),
      createdAt: new Date(),
    });

    const conversationId = Number(result[0].insertId);

    const newConversation = await db
      .select()
      .from(conversations)
      .where(eq(conversations.id, conversationId))
      .limit(1);

    console.log(`[Chat] Created new conversation ${conversationId} for listing ${listingId}`);
    return newConversation[0];
  } catch (error) {
    console.error("[Database] Failed to get or create conversation:", error);
    throw error;
  }
}

/**
 * Send a message in a conversation
 */
export async function sendMessage(conversationId: number, senderId: number, messageText: string): Promise<Message> {
  const db = await getDb();
  if (!db) {
    throw new Error("Database connection failed");
  }

  try {
    // Insert message
    const result = await db.insert(messages).values({
      conversationId,
      senderId,
      message: messageText,
      read: false,
      createdAt: new Date(),
    });

    const messageId = Number(result[0].insertId);

    // Update conversation lastMessageAt
    await db
      .update(conversations)
      .set({ lastMessageAt: new Date() })
      .where(eq(conversations.id, conversationId));

    // Get the created message
    const newMessage = await db
      .select()
      .from(messages)
      .where(eq(messages.id, messageId))
      .limit(1);

    // Get conversation details to send notification to recipient
    const conversation = await db
      .select()
      .from(conversations)
      .where(eq(conversations.id, conversationId))
      .limit(1);

    if (conversation.length > 0) {
      const conv = conversation[0];
      const recipientId = conv.buyerId === senderId ? conv.sellerId : conv.buyerId;

      // Get listing details for notification
      const listing = await db
        .select()
        .from(listings)
        .where(eq(listings.id, conv.listingId))
        .limit(1);

      if (listing.length > 0) {
        // Create notification for recipient
        await createNotification({
          userId: recipientId,
          type: "system",
          title: "Neue Nachricht erhalten",
          message: `Sie haben eine neue Nachricht zu "${listing[0].strain}" erhalten.`,
          actionUrl: `/messages/${conversationId}`,
        });
      }
    }

    console.log(`[Chat] Message ${messageId} sent in conversation ${conversationId}`);
    return newMessage[0];
  } catch (error) {
    console.error("[Database] Failed to send message:", error);
    throw error;
  }
}

/**
 * Get all messages in a conversation
 */
export async function getConversationMessages(conversationId: number, userId: number): Promise<any[]> {
  const db = await getDb();
  if (!db) {
    return [];
  }

  try {
    // Verify user is part of the conversation
    const conversation = await db
      .select()
      .from(conversations)
      .where(eq(conversations.id, conversationId))
      .limit(1);

    if (conversation.length === 0) {
      throw new Error("Conversation not found");
    }

    const conv = conversation[0];
    if (conv.buyerId !== userId && conv.sellerId !== userId) {
      throw new Error("Unauthorized access to conversation");
    }

    // Get all messages with sender info
    const msgs = await db
      .select({
        id: messages.id,
        conversationId: messages.conversationId,
        senderId: messages.senderId,
        senderName: users.name,
        message: messages.message,
        read: messages.read,
        createdAt: messages.createdAt,
      })
      .from(messages)
      .leftJoin(users, eq(messages.senderId, users.id))
      .where(eq(messages.conversationId, conversationId))
      .orderBy(messages.createdAt);

    // Mark messages as read if user is not the sender
    const unreadMessageIds = msgs
      .filter(m => !m.read && m.senderId !== userId)
      .map(m => m.id);

    if (unreadMessageIds.length > 0) {
      await db
        .update(messages)
        .set({ read: true })
        .where(inArray(messages.id, unreadMessageIds));
    }

    return msgs;
  } catch (error) {
    console.error("[Database] Failed to get conversation messages:", error);
    throw error;
  }
}

/**
 * Get all conversations for a user
 */
export async function getUserConversations(userId: number): Promise<any[]> {
  const db = await getDb();
  if (!db) {
    return [];
  }

  try {
    const convs = await db
      .select({
        id: conversations.id,
        listingId: conversations.listingId,
        listingStrain: listings.strain,
        listingImage: listings.imageUrl,
        buyerId: conversations.buyerId,
        buyerName: sql<string>`buyer.name`,
        sellerId: conversations.sellerId,
        sellerName: sql<string>`seller.name`,
        lastMessageAt: conversations.lastMessageAt,
        createdAt: conversations.createdAt,
      })
      .from(conversations)
      .leftJoin(listings, eq(conversations.listingId, listings.id))
      .leftJoin(
        sql`users AS buyer`,
        sql`${conversations.buyerId} = buyer.id`
      )
      .leftJoin(
        sql`users AS seller`,
        sql`${conversations.sellerId} = seller.id`
      )
      .where(
        or(
          eq(conversations.buyerId, userId),
          eq(conversations.sellerId, userId)
        )
      )
      .orderBy(desc(conversations.lastMessageAt));

    // Get unread count for each conversation
    const conversationsWithUnread = await Promise.all(
      convs.map(async (conv) => {
        const unreadResult = await db
          .select({ count: sql<number>`count(*)` })
          .from(messages)
          .where(
            and(
              eq(messages.conversationId, conv.id),
              eq(messages.read, false),
              sql`${messages.senderId} != ${userId}`
            )
          );

        return {
          ...conv,
          unreadCount: unreadResult[0]?.count || 0,
        };
      })
    );

    return conversationsWithUnread;
  } catch (error) {
    console.error("[Database] Failed to get user conversations:", error);
    return [];
  }
}

/**
 * Get unread message count for a user
 */
export async function getUnreadMessageCount(userId: number): Promise<number> {
  const db = await getDb();
  if (!db) {
    return 0;
  }

  try {
    // Get all conversations where user is participant
    const userConvs = await db
      .select({ id: conversations.id })
      .from(conversations)
      .where(
        or(
          eq(conversations.buyerId, userId),
          eq(conversations.sellerId, userId)
        )
      );

    if (userConvs.length === 0) {
      return 0;
    }

    const conversationIds = userConvs.map(c => c.id);

    // Count unread messages in those conversations where user is not the sender
    const result = await db
      .select({ count: sql<number>`count(*)` })
      .from(messages)
      .where(
        and(
          inArray(messages.conversationId, conversationIds),
          eq(messages.read, false),
          sql`${messages.senderId} != ${userId}`
        )
      );

    return result[0]?.count || 0;
  } catch (error) {
    console.error("[Database] Failed to get unread message count:", error);
    return 0;
  }
}



// Account Deletion (GDPR Compliance)
export async function deleteAccount(userId: number): Promise<void> {
  const db = await getDb();
  if (!db) {
    throw new Error("Database connection failed");
  }

  try {
    // Delete in order to respect foreign key constraints
    
    // 1. Delete messages sent by user
    await db.delete(messages).where(eq(messages.senderId, userId));
    
    // 2. Delete conversations where user is participant
    await db.delete(conversations).where(
      or(
        eq(conversations.buyerId, userId),
        eq(conversations.sellerId, userId)
      )
    );
    
    // 3. Delete notifications
    await db.delete(notifications).where(eq(notifications.userId, userId));
    
    // 4. Delete admin logs (where user is the admin)
    await db.delete(adminLogs).where(eq(adminLogs.adminId, userId));
    
    // 5. Delete bans
    await db.delete(bans).where(eq(bans.userId, userId));
    
    // 6. Delete suspensions
    await db.delete(suspensions).where(eq(suspensions.userId, userId));
    
    // 7. Delete warnings
    await db.delete(warnings).where(eq(warnings.userId, userId));
    
    // 8. Delete reviews (as buyer or seller)
    await db.delete(reviews).where(
      or(
        eq(reviews.buyerId, userId),
        eq(reviews.sellerId, userId)
      )
    );
    
    // 9. Delete offers (as buyer or seller)
    await db.delete(offers).where(
      or(
        eq(offers.buyerId, userId),
        eq(offers.sellerId, userId)
      )
    );
    
    // 10. Delete transactions (as buyer or seller)
    await db.delete(transactions).where(
      or(
        eq(transactions.buyerId, userId),
        eq(transactions.sellerId, userId)
      )
    );
    
    // 11. Delete listings
    await db.delete(listings).where(eq(listings.sellerId, userId));
    
    // 12. Delete seller profile
    await db.delete(sellerProfiles).where(eq(sellerProfiles.userId, userId));
    
    // 13. Finally, delete user
    await db.delete(users).where(eq(users.id, userId));
    
    console.log(`[Database] Account deleted for user ID ${userId}`);
  } catch (error) {
    console.error("[Database] Failed to delete account:", error);
    throw new Error("Failed to delete account");
  }
}




// Get a single system setting by key (with caching)
export async function getSystemSetting(key: string): Promise<string | null> {
  // Import cache dynamically to avoid circular dependencies
  const { settingsCache } = await import('./settings-cache.js');
  
  // Check cache first
  const cached = settingsCache.get(key);
  if (cached !== null) {
    return cached;
  }

  const db = await getDb();
  if (!db) {
    return null;
  }

  try {
    const setting = await db
      .select()
      .from(systemSettings)
      .where(eq(systemSettings.key, key))
      .limit(1);

    const value = setting[0]?.value || null;
    
    // Cache the result (even if null)
    if (value !== null) {
      settingsCache.set(key, value);
    }
    
    return value;
  } catch (error) {
    console.error(`[Database] Failed to get system setting '${key}':`, error);
    return null;
  }
}



/**
 * IP Blocking Functions
 */

export async function blockIP(ipAddress: string, reason: string, blockedBy: number): Promise<void> {
  const db = await getDb();
  if (!db) return;

  try {
    await db.insert(blockedIPs).values({
      ipAddress,
      reason,
      blockedBy,
    });
    console.log(`[Database] IP blocked: ${ipAddress} by user ${blockedBy}`);
  } catch (error) {
    console.error("[Database] Failed to block IP:", error);
    throw error;
  }
}

export async function unblockIP(ipAddress: string): Promise<void> {
  const db = await getDb();
  if (!db) return;

  try {
    await db
      .update(blockedIPs)
      .set({ unblockedAt: new Date() })
      .where(eq(blockedIPs.ipAddress, ipAddress));
    console.log(`[Database] IP unblocked: ${ipAddress}`);
  } catch (error) {
    console.error("[Database] Failed to unblock IP:", error);
    throw error;
  }
}

export async function isIPBlocked(ipAddress: string): Promise<boolean> {
  const db = await getDb();
  if (!db) return false;

  try {
    const blocked = await db
      .select()
      .from(blockedIPs)
      .where(
        and(
          eq(blockedIPs.ipAddress, ipAddress),
          sql`${blockedIPs.unblockedAt} IS NULL`
        )
      )
      .limit(1);
    
    return blocked.length > 0;
  } catch (error) {
    console.error("[Database] Failed to check IP block status:", error);
    return false;
  }
}

export async function getIPsWithMostAttempts(limit: number = 20): Promise<Array<{ ipAddress: string; attemptCount: number; lastAttempt: Date }>> {
  const db = await getDb();
  if (!db) return [];

  try {
    const last24Hours = new Date(Date.now() - 24 * 60 * 60 * 1000);
    
    const result = await db
      .select({
        ipAddress: loginAttempts.ipAddress,
        attemptCount: sql<number>`COUNT(*)`,
        lastAttempt: sql<Date>`MAX(${loginAttempts.createdAt})`,
      })
      .from(loginAttempts)
      .where(gte(loginAttempts.createdAt, last24Hours))
      .groupBy(loginAttempts.ipAddress)
      .orderBy(sql`COUNT(*) DESC`)
      .limit(limit);
    
    return result;
  } catch (error) {
    console.error("[Database] Failed to get IPs with most attempts:", error);
    return [];
  }
}

export async function getBlockedIPs(): Promise<Array<{ id: number; ipAddress: string; reason: string | null; blockedBy: number; blockedAt: Date; unblockedAt: Date | null }>> {
  const db = await getDb();
  if (!db) return [];

  try {
    const blocked = await db
      .select()
      .from(blockedIPs)
      .where(sql`${blockedIPs.unblockedAt} IS NULL`)
      .orderBy(desc(blockedIPs.blockedAt));
    
    return blocked;
  } catch (error) {
    console.error("[Database] Failed to get blocked IPs:", error);
    return [];
  }
}



// ============================================
// RATE LIMITING & LOGIN SECURITY
// ============================================

/**
 * Record a login attempt (successful or failed)
 */
export async function recordLoginAttempt(
  ipAddress: string,
  userId: number,
  userAgent: string,
  success: boolean
): Promise<void> {
  const db = await getDb();
  if (!db) return;

  try {
    await db.insert(loginAttempts).values({
      ipAddress,
      userId,
      userAgent,
      success,
      createdAt: new Date(),
    });
  } catch (error) {
    console.error("[Database] Failed to record login attempt:", error);
  }
}

/**
 * Get login attempts by IP address within a time window
 */
export async function getLoginAttemptsByIP(
  ipAddress: string,
  windowMinutes: number
): Promise<Array<{ id: number; ipAddress: string; userId: number | null; userAgent: string | null; success: boolean; createdAt: Date }>> {
  const db = await getDb();
  if (!db) return [];

  try {
    const windowStart = new Date(Date.now() - windowMinutes * 60 * 1000);
    const attempts = await db
      .select()
      .from(loginAttempts)
      .where(
        and(
          eq(loginAttempts.ipAddress, ipAddress),
          gte(loginAttempts.createdAt, windowStart)
        )
      )
      .orderBy(desc(loginAttempts.createdAt));
    
    return attempts;
  } catch (error) {
    console.error("[Database] Failed to get login attempts by IP:", error);
    return [];
  }
}

/**
 * Get login attempts by user ID within a time window
 */
export async function getLoginAttemptsByUser(
  userId: number,
  windowMinutes: number
): Promise<Array<{ id: number; ipAddress: string; userId: number | null; userAgent: string | null; success: boolean; createdAt: Date }>> {
  const db = await getDb();
  if (!db) return [];

  try {
    const windowStart = new Date(Date.now() - windowMinutes * 60 * 1000);
    const attempts = await db
      .select()
      .from(loginAttempts)
      .where(
        and(
          eq(loginAttempts.userId, userId),
          gte(loginAttempts.createdAt, windowStart)
        )
      )
      .orderBy(desc(loginAttempts.createdAt));
    
    return attempts;
  } catch (error) {
    console.error("[Database] Failed to get login attempts by user:", error);
    return [];
  }
}

/**
 * Check if a user account is locked
 */
export async function isUserAccountLocked(userId: number): Promise<boolean> {
  const db = await getDb();
  if (!db) return false;

  try {
    const user = await db
      .select()
      .from(users)
      .where(eq(users.id, userId))
      .limit(1);
    
    if (user.length === 0) return false;
    
    // Check if user is suspended
    const activeSuspension = await db
      .select()
      .from(suspensions)
      .where(
        and(
          eq(suspensions.userId, userId),
          eq(suspensions.active, true),
          gte(suspensions.suspendedUntil, new Date())
        )
      )
      .limit(1);
    
    if (activeSuspension.length > 0) return true;
    
    // Check if user is banned
    const activeBan = await db
      .select()
      .from(bans)
      .where(eq(bans.userId, userId))
      .limit(1);
    
    return activeBan.length > 0;
  } catch (error) {
    console.error("[Database] Failed to check if user is locked:", error);
    return false;
  }
}

/**
 * Lock a user account by creating a temporary suspension
 */
export async function lockUserAccount(userId: number, durationMinutes: number): Promise<void> {
  const db = await getDb();
  if (!db) return;

  try {
    const suspendedUntil = new Date(Date.now() + durationMinutes * 60 * 1000);
    
    await db.insert(suspensions).values({
      userId,
      adminId: 0, // System-generated suspension
      reason: `Account temporarily locked due to too many login attempts. Try again after ${durationMinutes} minutes.`,
      suspendedAt: new Date(),
      suspendedUntil,
      active: true,
    });
    
    // Update user status
    await db.update(users)
      .set({ status: 'suspended' })
      .where(eq(users.id, userId));
    
    console.log(`[Database] User ${userId} locked for ${durationMinutes} minutes due to rate limiting`);
  } catch (error) {
    console.error("[Database] Failed to lock user account:", error);
  }
}


/**
 * Reduce listing quantity after purchase
 * Sets status to 'sold' if quantity reaches 0
 */
export async function reduceListingQuantity(listingId: number, quantityPurchased: number): Promise<void> {
  const db = await getDb();
  if (!db) throw new Error("Database not available");

  try {
    // Get current listing
    const listing = await db
      .select()
      .from(listings)
      .where(eq(listings.id, listingId))
      .limit(1);

    if (listing.length === 0) {
      throw new Error(`Listing ${listingId} not found`);
    }

    const currentQuantity = listing[0].quantity || 0;
    const newQuantity = Math.max(0, currentQuantity - quantityPurchased);

    // Update quantity
    const updates: Partial<typeof listings.$inferInsert> = {
      quantity: newQuantity,
    };

    // Set status to 'sold' if quantity is 0
    if (newQuantity === 0) {
      updates.status = 'sold';
    }

    await db.update(listings)
      .set(updates)
      .where(eq(listings.id, listingId));

    console.log(`[Database] Listing ${listingId} quantity reduced from ${currentQuantity} to ${newQuantity}`);
  } catch (error) {
    console.error("[Database] Failed to reduce listing quantity:", error);
    throw error;
  }
}

```

### Schritt 4.x:  routers.ts 

**`server/routers.ts`**

```typescript
import { COOKIE_NAME } from "@shared/const";
import { getSessionCookieOptions } from "./_core/cookies";
import { systemRouter } from "./_core/systemRouter";
import { publicProcedure, router, protectedProcedure, adminProcedure, superAdminProcedure } from "./_core/trpc";
import { z } from "zod";
import * as db from "./db";
import { TRPCError } from "@trpc/server";
import { listings } from "../drizzle/schema";
import { eq } from "drizzle-orm";
// PayPal integration will be added when API keys are provided

export const appRouter = router({
  system: systemRouter,

  auth: router({
    me: publicProcedure.query(opts => opts.ctx.user),
    logout: publicProcedure.mutation(({ ctx }) => {
      const cookieOptions = getSessionCookieOptions(ctx.req);
      ctx.res.clearCookie(COOKIE_NAME, { ...cookieOptions, maxAge: -1 });
      return {
        success: true,
      } as const;
    }),
  }),

  // User Profile routes
  profile: router({
    update: protectedProcedure
      .input(z.object({
        nickname: z.string().optional(),
        location: z.string().optional(),
        profileImageUrl: z.string().optional(),
      }))
      .mutation(async ({ ctx, input }) => {
        await db.updateUserProfile(ctx.user.id, input);
        return { success: true };
      }),

    activateSeller: protectedProcedure
      .input(z.object({
        shopName: z.string().min(3).max(255),
        description: z.string().optional(),
      }))
      .mutation(async ({ ctx, input }) => {
        // Check if user is already a seller
        if (ctx.user.isSellerActive) {
          throw new TRPCError({
            code: "CONFLICT",
            message: "User is already a seller",
          });
        }

        // Check if seller profile already exists (from previous activation)
        const existingProfile = await db.getSellerProfile(ctx.user.id);
        
        if (existingProfile) {
          // Update existing profile instead of creating new one
          await db.updateSellerProfile(ctx.user.id, {
            shopName: input.shopName,
            description: input.description,
          });
        } else {
          // Create new seller profile
          await db.createSellerProfile(
            ctx.user.id,
            input.shopName,
            input.description,
            ctx.user.location || undefined
          );
        }

        // Activate seller mode
        await db.updateUserProfile(ctx.user.id, { isSellerActive: true });

        return { success: true };
      }),

    deactivateSeller: protectedProcedure
      .mutation(async ({ ctx }) => {
        if (!ctx.user.isSellerActive) {
          throw new TRPCError({
            code: "BAD_REQUEST",
            message: "User is not a seller",
          });
        }

        await db.updateUserProfile(ctx.user.id, { isSellerActive: false });
        return { success: true };
      }),

    deleteAccount: protectedProcedure
      .mutation(async ({ ctx }) => {
        // Delete all user data (GDPR compliance)
        await db.deleteAccount(ctx.user.id);
        
        // Clear session cookie
        const cookieOptions = getSessionCookieOptions(ctx.req);
        ctx.res.clearCookie(COOKIE_NAME, { ...cookieOptions, maxAge: -1 });
        
        return { success: true };
      }),
  }),

  // Seller Profile routes
  seller: router({
    // Get or create seller profile for current user
    getProfile: protectedProcedure.query(async ({ ctx }) => {
      const profile = await db.getSellerProfile(ctx.user.id);
      return profile;
    }),

    // Create a new seller profile
    createProfile: protectedProcedure
      .input(z.object({
        shopName: z.string().min(3).max(255),
        description: z.string().optional(),
        location: z.string().optional(),
      }))
      .mutation(async ({ ctx, input }) => {
        // Check if user already has a seller profile
        const existing = await db.getSellerProfile(ctx.user.id);
        if (existing) {
          throw new TRPCError({
            code: "CONFLICT",
            message: "User already has a seller profile",
          });
        }

        // Create seller profile
        await db.createSellerProfile(
          ctx.user.id,
          input.shopName,
          input.description,
          input.location
        );

        return { success: true };
      }),

    // Update seller profile
    updateProfile: protectedProcedure
      .input(z.object({
        shopName: z.string().min(3).max(255).optional(),
        description: z.string().optional(),
        location: z.string().optional(),
      }))
      .mutation(async ({ ctx, input }) => {
        const profile = await db.getSellerProfile(ctx.user.id);
        if (!profile) {
          throw new TRPCError({
            code: "NOT_FOUND",
            message: "Seller profile not found",
          });
        }

        await db.updateSellerProfile(ctx.user.id, input);
        return { success: true };
      }),

    // Get seller profile by ID (public)
    getProfileById: publicProcedure
      .input(z.number())
      .query(async ({ input }) => {
        const profile = await db.getSellerProfile(input);
        if (!profile) {
          throw new TRPCError({
            code: "NOT_FOUND",
            message: "Seller profile not found",
          });
        }
        return profile;
      }),
  }),

  // Listing routes
  listing: router({
    // Create a new listing
    create: protectedProcedure
      .input(z.object({
        type: z.enum(["cutting", "seed"]),
        strain: z.string().min(1).max(255),
        description: z.string().optional(),
        quantity: z.number().int().positive(),
        priceType: z.enum(["fixed", "auction"]),
        fixedPrice: z.number().positive().optional(),
        auctionStartPrice: z.number().positive().optional(),
        auctionEndTime: z.date().optional(),
        imageUrl: z.string().url().optional(),
        images: z.array(z.string().url()).optional(),
        shippingVerified: z.boolean().default(true),
        shippingPickup: z.boolean().default(false),
        acceptsOffers: z.boolean().default(false),
        offerMinPrice: z.number().positive().optional(),
        // Additional optional fields
        genetics: z.enum(["sativa", "indica", "hybrid"]).optional(),
        seedBank: z.string().max(255).optional(),
        growMethod: z.enum(["hydro", "bio", "soil"]).optional(),
        seedType: z.enum(["feminized", "regular", "autoflower"]).optional(),
        thcContent: z.string().max(50).optional(),
        cbdContent: z.string().max(50).optional(),
        floweringTime: z.string().max(100).optional(),
        yieldInfo: z.string().max(255).optional(),
        flavorProfile: z.string().max(500).optional(),
        origin: z.string().max(255).optional(),
      }))
      .mutation(async ({ ctx, input }) => {
        // Check if user is a seller
        const profile = await db.getSellerProfile(ctx.user.id);
        if (!profile) {
          throw new TRPCError({
            code: "FORBIDDEN",
            message: "User must have a seller profile to create listings",
          });
        }

        // Validate price based on type
        if (input.priceType === "fixed" && !input.fixedPrice) {
          throw new TRPCError({
            code: "BAD_REQUEST",
            message: "Fixed price listings must have a fixedPrice",
          });
        }

        if (input.priceType === "auction" && !input.auctionStartPrice) {
          throw new TRPCError({
            code: "BAD_REQUEST",
            message: "Auction listings must have an auctionStartPrice",
          });
        }

        // Validate max active listings per user
        const maxActiveListingsSetting = await db.getSystemSetting('max_active_listings_per_user');
        const maxActiveListings = maxActiveListingsSetting ? parseInt(maxActiveListingsSetting) : 50;
        const userListings = await db.getDb().then(db => 
          db?.select().from(listings).where(eq(listings.sellerId, ctx.user.id)).where(eq(listings.status, 'active'))
        );
        const activeListingsCount = userListings?.length || 0;
        if (activeListingsCount >= maxActiveListings) {
          console.warn(`[Validation] User ${ctx.user.id} attempted to create listing but has ${activeListingsCount} active listings (max: ${maxActiveListings})`);
          throw new TRPCError({
            code: "BAD_REQUEST",
            message: `Maximale Anzahl aktiver Listings erreicht (${maxActiveListings})`,
          });
        }

        // Validate max images
        const maxImagesSetting = await db.getSystemSetting('max_listing_images');
        const maxImages = maxImagesSetting ? parseInt(maxImagesSetting) : 10;
        if (input.images && input.images.length > maxImages) {
          console.warn(`[Validation] User ${ctx.user.id} attempted to create listing with ${input.images.length} images (max: ${maxImages})`);
          throw new TRPCError({
            code: "BAD_REQUEST",
            message: `Maximal ${maxImages} Bilder pro Listing erlaubt`,
          });
        }

        // Validate min price
        const minPriceSetting = await db.getSystemSetting('min_listing_price');
        const minPrice = minPriceSetting ? parseFloat(minPriceSetting) : 0.50;
        const listingPrice = input.fixedPrice || input.auctionStartPrice || 0;
        if (listingPrice < minPrice) {
          console.warn(`[Validation] User ${ctx.user.id} attempted to create listing with price €${listingPrice} (min: €${minPrice})`);
          throw new TRPCError({
            code: "BAD_REQUEST",
            message: `Minimaler Listing-Preis ist €${minPrice}`,
          });
        }

        // Validate max price
        const maxPriceSetting = await db.getSystemSetting('max_listing_price');
        const maxPrice = maxPriceSetting ? parseFloat(maxPriceSetting) : 1000;
        if (listingPrice > maxPrice) {
          console.warn(`[Validation] User ${ctx.user.id} attempted to create listing with price €${listingPrice} (max: €${maxPrice})`);
          throw new TRPCError({
            code: "BAD_REQUEST",
            message: `Maximaler Listing-Preis ist €${maxPrice}`,
          });
        }

        await db.createListing(ctx.user.id, {
          type: input.type,
          strain: input.strain,
          description: input.description,
          quantity: input.quantity,
          priceType: input.priceType,
          fixedPrice: input.fixedPrice,
          auctionStartPrice: input.auctionStartPrice,
          auctionEndTime: input.auctionEndTime,
          imageUrl: input.imageUrl,
          images: input.images ? JSON.stringify(input.images) : undefined,
          shippingVerified: input.shippingVerified,
          shippingPickup: input.shippingPickup,
          // Additional optional fields
          genetics: input.genetics,
          seedBank: input.seedBank,
          growMethod: input.growMethod,
          seedType: input.seedType,
          thcContent: input.thcContent,
          cbdContent: input.cbdContent,
          floweringTime: input.floweringTime,
          yieldInfo: input.yieldInfo,
          flavorProfile: input.flavorProfile,
          origin: input.origin,
        });

        return { success: true };
      }),

    // Get listing by ID
    getById: publicProcedure
      .input(z.number())
      .query(async ({ input }) => {
        const listing = await db.getListing(input);
        if (!listing) {
          throw new TRPCError({
            code: "NOT_FOUND",
            message: "Listing not found",
          });
        }
        return listing;
      }),

    // Get all listings (admin only)
    getAll: adminProcedure
      .query(async () => {
        const listings = await db.getAllListings();
        return listings;
      }),

    // Get all active listings (paginated)
    getActive: publicProcedure
      .input(z.object({
        limit: z.number().int().positive().max(100).default(50),
        offset: z.number().int().nonnegative().default(0),
      }))
      .query(async ({ input }) => {
        return db.getActiveListings(input.limit, input.offset);
      }),

    // Get seller's listings
    getBySellerID: publicProcedure
      .input(z.number())
      .query(async ({ input }) => {
        return db.getSellerListings(input);
      }),

    // Get current user's listings
    getMine: protectedProcedure.query(async ({ ctx }) => {
      return db.getSellerListings(ctx.user.id);
    }),

    // Update a listing
    update: protectedProcedure
      .input(z.object({
        listingId: z.number(),
        strain: z.string().optional(),
        description: z.string().optional(),
        quantity: z.number().int().positive().optional(),
        fixedPrice: z.number().positive().optional(),
        status: z.enum(["active", "sold", "ended", "draft"]).optional(),
        shippingVerified: z.boolean().optional(),
        shippingPickup: z.boolean().optional(),
        acceptsOffers: z.boolean().optional(),
        offerMinPrice: z.number().positive().optional(),
      }))
      .mutation(async ({ ctx, input }) => {
        const listing = await db.getListing(input.listingId);
        if (!listing) {
          throw new TRPCError({
            code: "NOT_FOUND",
            message: "Listing not found",
          });
        }

        // Check ownership
        if (listing.sellerId !== ctx.user.id) {
          throw new TRPCError({
            code: "FORBIDDEN",
            message: "You can only update your own listings",
          });
        }

        await db.updateListing(input.listingId, {
          strain: input.strain,
          description: input.description,
          quantity: input.quantity,
          fixedPrice: input.fixedPrice ? String(input.fixedPrice) : undefined,
          status: input.status,
          shippingVerified: input.shippingVerified,
          shippingPickup: input.shippingPickup,
          acceptsOffers: input.acceptsOffers,
          offerMinPrice: input.offerMinPrice ? String(input.offerMinPrice) : undefined,
        } as any);

        return { success: true };
      }),

    // Delete/archive a listing
    delete: protectedProcedure
      .input(z.number())
      .mutation(async ({ ctx, input }) => {
        const listing = await db.getListing(input);
        if (!listing) {
          throw new TRPCError({
            code: "NOT_FOUND",
            message: "Listing not found",
          });
        }

        // Check ownership
        if (listing.sellerId !== ctx.user.id) {
          throw new TRPCError({
            code: "FORBIDDEN",
            message: "You can only delete your own listings",
          });
        }

        await db.updateListing(input, { status: "ended" } as any);
        return { success: true };
      }),
  }),

  // Transaction routes
  transaction: router({
    // Get all transactions (admin only)
    getAll: adminProcedure
      .query(async () => {
        const transactions = await db.query.transactions.findMany({
          with: {
            buyer: {
              columns: {
                id: true,
                name: true,
                email: true,
              },
            },
            seller: {
              columns: {
                id: true,
                name: true,
                email: true,
              },
            },
            listing: {
              columns: {
                id: true,
                strain: true,
                type: true,
              },
            },
          },
          orderBy: (transactions, { desc }) => [desc(transactions.createdAt)],
        });
        return transactions;
      }),

    // Get buyer's transactions
    getBuyerTransactions: protectedProcedure.query(async ({ ctx }) => {
      return db.getBuyerTransactions(ctx.user.id);
    }),

    // Get seller's transactions
    getSellerTransactions: protectedProcedure.query(async ({ ctx }) => {
      return db.getSellerTransactions(ctx.user.id);
    }),
  }),

  // PayPal routes
  paypal: router({
    createOrder: publicProcedure
      .input(
        z.object({
          listingId: z.number(),
          quantity: z.number(),
          amount: z.string(),
          buyerId: z.number(),
          sellerId: z.number(),
        })
      )
      .mutation(async ({ input }) => {
        return {
          id: `MOCK-ORDER-${Date.now()}`,
          status: "CREATED",
        };
      }),

    captureOrder: publicProcedure
      .input(z.object({ orderId: z.string() }))
      .mutation(async ({ input }) => {
        return {
          transactionId: `MOCK-TXN-${Date.now()}`,
          status: "COMPLETED",
        };
      }),
  }),

  // Image upload router
  upload: router({
    image: protectedProcedure
      .input(z.object({
        filename: z.string(),
        data: z.string(), // base64 encoded image
        contentType: z.string(),
      }))
      .mutation(async ({ input }) => {
        const { storagePut } = await import("./storage");
        const { externalStoragePut, isExternalStorageEnabled } = await import("./external-storage");
        
        // Extract base64 data (remove data:image/...;base64, prefix)
        const base64Data = input.data.split(",")[1];
        const buffer = Buffer.from(base64Data, "base64");
        
        // Generate unique filename
        const ext = input.filename.split(".").pop() || "jpg";
        const randomSuffix = Math.random().toString(36).substring(7);
        const fileKey = `uploads/${Date.now()}-${randomSuffix}.${ext}`;
        
        // Choose storage provider (Manus or external)
        let url: string;
        
        if (isExternalStorageEnabled()) {
          // Use external storage (Cloudflare R2 or Backblaze B2)
          const result = await externalStoragePut(fileKey, buffer, input.contentType);
          url = result.url;
          console.log(`[Upload] Uploaded to external storage: ${url}`);
        } else {
          // Use Manus built-in storage (default)
          const result = await storagePut(fileKey, buffer, input.contentType);
          url = result.url;
        }
        
        return { url };
      }),
  }),

  // Offer routes (Price Proposals)
  offer: router({
    // Create a new offer
    create: protectedProcedure
      .input(z.object({
        listingId: z.number(),
        offerAmount: z.string(),
        message: z.string().optional(),
      }))
      .mutation(async ({ ctx, input }) => {
        // Get listing to validate
        const listing = await db.getListing(input.listingId);
        if (!listing) {
          throw new TRPCError({
            code: "NOT_FOUND",
            message: "Listing not found",
          });
        }

        // Check if listing accepts offers
        if (!listing.acceptsOffers) {
          throw new TRPCError({
            code: "BAD_REQUEST",
            message: "This listing does not accept price offers",
          });
        }

        // Validate offer amount against minimum price
        const offerAmountNum = parseFloat(input.offerAmount);
        if (listing.offerMinPrice && offerAmountNum < parseFloat(listing.offerMinPrice)) {
          throw new TRPCError({
            code: "BAD_REQUEST",
            message: `Offer must be at least €${listing.offerMinPrice}`,
          });
        }

        // Cannot make offer on own listing
        if (listing.sellerId === ctx.user.id) {
          throw new TRPCError({
            code: "BAD_REQUEST",
            message: "You cannot make an offer on your own listing",
          });
        }

        // Create offer
        await db.createOffer({
          listingId: input.listingId,
          buyerId: ctx.user.id,
          sellerId: listing.sellerId,
          offerAmount: input.offerAmount,
          message: input.message,
        });

        return { success: true };
      }),

    // Get offers for a listing (seller only)
    getByListingId: protectedProcedure
      .input(z.number())
      .query(async ({ ctx, input }) => {
        const listing = await db.getListing(input);
        if (!listing || listing.sellerId !== ctx.user.id) {
          throw new TRPCError({
            code: "FORBIDDEN",
            message: "You can only view offers for your own listings",
          });
        }
        return await db.getOffersByListingId(input);
      }),

    // Get offers made by current user
    getMyOffers: protectedProcedure
      .query(async ({ ctx }) => {
        return await db.getOffersByBuyerId(ctx.user.id);
      }),

    // Get offers received by current user (as seller)
    getReceivedOffers: protectedProcedure
      .query(async ({ ctx }) => {
        return await db.getOffersBySellerId(ctx.user.id);
      }),

    // Alias for getReceivedOffers (for consistency)
    getMine: protectedProcedure
      .query(async ({ ctx }) => {
        return await db.getOffersBySellerId(ctx.user.id);
      }),

    // Accept an offer
    accept: protectedProcedure
      .input(z.number()) // offerId
      .mutation(async ({ ctx, input }) => {
        const offer = await db.getOfferById(input);
        if (!offer || offer.sellerId !== ctx.user.id) {
          throw new TRPCError({
            code: "FORBIDDEN",
            message: "You can only accept your own offers",
          });
        }

        if (offer.status !== "pending") {
          throw new TRPCError({
            code: "BAD_REQUEST",
            message: "Offer has already been responded to",
          });
        }

        // Get listing details
        const listing = await db.getListing(offer.listingId);
        if (!listing) {
          throw new TRPCError({
            code: "NOT_FOUND",
            message: "Listing not found",
          });
        }

        // Update offer status
        await db.updateOfferStatus(input, "accepted");

        // Calculate fees for the offer amount
        const offerAmountNum = parseFloat(offer.offerAmount);
        const platformFee = parseFloat(await db.getSystemSetting('platform_fee_fixed') || '0.42');
        const paypalFeePercentage = parseFloat(await db.getSystemSetting('paypal_fee_percentage') || '2.49') / 100;
        const paypalFeeFixed = parseFloat(await db.getSystemSetting('paypal_fee_fixed') || '0.49');
        const paypalFee = offerAmountNum * paypalFeePercentage + paypalFeeFixed;
        const totalAmount = offerAmountNum + platformFee + paypalFee;
        const sellerAmount = offerAmountNum;

        // Create a transaction with the offer amount
        const transactionId = await db.createTransaction({
          listingId: offer.listingId,
          buyerId: offer.buyerId,
          sellerId: offer.sellerId,
          quantity: 1, // Offers are for single items
          totalAmount: totalAmount.toFixed(2),
          platformFee: platformFee.toFixed(2),
          sellerAmount: sellerAmount.toFixed(2),
        });

        // Return transaction ID for checkout redirect
        return { 
          success: true, 
          transactionId,
          checkoutUrl: `/checkout/${transactionId}`,
        };
      }),

    // Decline an offer
    decline: protectedProcedure
      .input(z.number()) // offerId
      .mutation(async ({ ctx, input }) => {
        const offer = await db.getOfferById(input);
        if (!offer || offer.sellerId !== ctx.user.id) {
          throw new TRPCError({
            code: "FORBIDDEN",
            message: "You can only decline your own offers",
          });
        }

        if (offer.status !== "pending") {
          throw new TRPCError({
            code: "BAD_REQUEST",
            message: "Offer has already been responded to",
          });
        }

        await db.updateOfferStatus(input, "rejected");
        return { success: true };
      }),
  }),

  // Review routes
  review: router({  
    // Create a new review
    create: protectedProcedure
      .input(z.object({
        transactionId: z.number(),
        sellerId: z.number(),
        rating: z.number().min(1).max(5),
        comment: z.string().optional(),
      }))
      .mutation(async ({ ctx, input }) => {
        // Check if user already reviewed this transaction
        const existingReview = await db.getReviewByTransactionAndBuyer(input.transactionId, ctx.user.id);
        if (existingReview) {
          throw new TRPCError({
            code: "CONFLICT",
            message: "You have already reviewed this transaction",
          });
        }

        // Check if transaction exists and belongs to the buyer
        const transaction = await db.getTransactionById(input.transactionId);
        if (!transaction || transaction.buyerId !== ctx.user.id) {
          throw new TRPCError({
            code: "NOT_FOUND",
            message: "Transaction not found",
          });
        }

        // Check if transaction is within 90 days
        const daysSincePurchase = Math.floor((Date.now() - new Date(transaction.createdAt).getTime()) / (1000 * 60 * 60 * 24));
        if (daysSincePurchase > 90) {
          throw new TRPCError({
            code: "BAD_REQUEST",
            message: "Review period has expired (90 days)",
          });
        }

        // Create review
        await db.createReview({
          sellerId: input.sellerId,
          buyerId: ctx.user.id,
          transactionId: input.transactionId,
          rating: input.rating,
          comment: input.comment,
        });

        // Update seller rating
        await db.updateSellerRating(input.sellerId);

        return { success: true };
      }),

    // Get all reviews for a seller
    getBySellerId: publicProcedure
      .input(z.number())
      .query(async ({ input }) => {
        const reviews = await db.getReviewsBySellerId(input);
        return reviews;
      }),

    // Check if user can review a transaction
    canReview: protectedProcedure
      .input(z.number()) // transactionId
      .query(async ({ ctx, input }) => {
        const transaction = await db.getTransactionById(input);
        if (!transaction || transaction.buyerId !== ctx.user.id) {
          return { canReview: false, reason: "Transaction not found" };
        }

        const existingReview = await db.getReviewByTransactionAndBuyer(input, ctx.user.id);
        if (existingReview) {
          return { canReview: false, reason: "Already reviewed" };
        }

        const daysSincePurchase = Math.floor((Date.now() - new Date(transaction.createdAt).getTime()) / (1000 * 60 * 60 * 24));
        if (daysSincePurchase > 90) {
          return { canReview: false, reason: "Review period expired" };
        }

        return { canReview: true };
      }),
  }),

  // Admin routes
  admin: router({
    // Get dashboard stats
    getStats: adminProcedure.query(async () => {
      const stats = await db.getAdminStats();
      return stats;
    }),

    // Get all users
    getAllUsers: adminProcedure.query(async () => {
      const users = await db.getAllUsers();
      return users;
    }),

    // Warn user
    warnUser: adminProcedure
      .input(z.object({
        userId: z.number(),
        reason: z.enum(['fraud', 'tos_violation', 'illegal_products', 'harassment', 'fake_listing', 'non_delivery', 'other']),
        message: z.string(),
      }))
      .mutation(async ({ ctx, input }) => {
        await db.warnUser(input.userId, ctx.user.id, input.reason, input.message);
        return { success: true };
      }),

    // Suspend user
    suspendUser: adminProcedure
      .input(z.object({
        userId: z.number(),
        reason: z.string(),
        days: z.number(),
      }))
      .mutation(async ({ ctx, input }) => {
        await db.suspendUser(input.userId, ctx.user.id, input.reason, input.days);
        return { success: true };
      }),

    // Ban user
    banUser: adminProcedure
      .input(z.object({
        userId: z.number(),
        reason: z.string(),
      }))
      .mutation(async ({ ctx, input }) => {
        await db.banUser(input.userId, ctx.user.id, input.reason);
        return { success: true };
      }),

    // Unsuspend user
    unsuspendUser: adminProcedure
      .input(z.number())
      .mutation(async ({ input }) => {
        await db.unsuspendUser(input);
        return { success: true };
      }),

    // Unban user
    unbanUser: adminProcedure
      .input(z.number())
      .mutation(async ({ input }) => {
        await db.unbanUser(input);
        return { success: true };
      }),

    // Promote to admin (super admin only)
    promoteToAdmin: superAdminProcedure
      .input(z.number())
      .mutation(async ({ input }) => {
        await db.promoteToAdmin(input);
        return { success: true };
      }),

    // Demote from admin (super admin only)
    demoteFromAdmin: superAdminProcedure
      .input(z.number())
      .mutation(async ({ input }) => {
        await db.demoteFromAdmin(input);
        return { success: true };
      }),

    // Remove warning from user (super admin only)
    removeWarning: superAdminProcedure
      .input(z.number()) // warningId
      .mutation(async ({ ctx, input }) => {
        await db.removeWarning(input, ctx.user.id);
        return { success: true };
      }),

    // Get warnings for a specific user
    getUserWarnings: adminProcedure
      .input(z.number()) // userId
      .query(async ({ input }) => {
        const warnings = await db.getUserWarnings(input);
        return warnings;
      }),

    // Get all admin logs
    getAdminLogs: adminProcedure
      .query(async () => {
        const logs = await db.getAdminLogs();
        return logs;
      }),

    // Block listing
    blockListing: adminProcedure
      .input(z.object({
        listingId: z.number(),
        reason: z.string(),
      }))
      .mutation(async ({ input, ctx }) => {
        await db.blockListing(input.listingId, ctx.user.id, input.reason);
        return { success: true };
      }),

    // Unblock listing
    unblockListing: adminProcedure
      .input(z.number()) // listingId
      .mutation(async ({ input, ctx }) => {
        await db.unblockListing(input, ctx.user.id);
        return { success: true };
      }),

    // Delete listing (super admin only)
    deleteListing: superAdminProcedure
      .input(z.object({
        listingId: z.number(),
        reason: z.string(),
      }))
      .mutation(async ({ input, ctx }) => {
        await db.deleteListing(input.listingId, ctx.user.id, input.reason);
        return { success: true };
      }),

    // Get all reports
    getAllReports: adminProcedure
      .query(async () => {
        const allReports = await db.getAllReports();
        return allReports;
      }),

    // Update report status
    updateReportStatus: adminProcedure
      .input(z.object({
        reportId: z.number(),
        status: z.enum(['pending', 'reviewing', 'resolved', 'dismissed']),
      }))
      .mutation(async ({ input, ctx }) => {
        await db.updateReportStatus(input.reportId, ctx.user.id, input.status);
        return { success: true };
      }),

    // Get all admins
    getAllAdmins: superAdminProcedure
      .query(async () => {
        const admins = await db.getAllAdmins();
        return admins;
      }),

    // Get system settings
    getSystemSettings: superAdminProcedure
      .query(async () => {
        const settings = await db.getSystemSettings();
        return settings;
      }),

    // Update system setting
    updateSystemSetting: superAdminProcedure
      .input(z.object({
        key: z.string(),
        value: z.string(),
      }))
      .mutation(async ({ input, ctx }) => {
        await db.updateSystemSetting(input.key, input.value, ctx.user.id);
        return { success: true };
      }),

    // Get single system setting (public - for frontend display)
    getSystemSetting: publicProcedure
      .input(z.string()) // key
      .query(async ({ input }) => {
        const value = await db.getSystemSetting(input);
        return value;
      }),

    // Toggle maintenance mode
    toggleMaintenanceMode: superAdminProcedure
      .mutation(async ({ ctx }) => {
        const setting = await db.getSystemSetting('maintenance_mode');
        const currentValue = setting?.value === 'true';
        const newValue = !currentValue;
        
        await db.updateSystemSetting('maintenance_mode', newValue.toString(), ctx.user.id);
        
        return { maintenanceMode: newValue };
      }),

    // IP Blocking / Security
    getSuspiciousIPs: superAdminProcedure
      .query(async () => {
        const ips = await db.getIPsWithMostAttempts(20);
        return ips;
      }),

    getBlockedIPs: superAdminProcedure
      .query(async () => {
        const ips = await db.getBlockedIPs();
        return ips;
      }),

    blockIP: superAdminProcedure
      .input(z.object({
        ipAddress: z.string(),
        reason: z.string().optional(),
      }))
      .mutation(async ({ input, ctx }) => {
        await db.blockIP(input.ipAddress, input.reason || 'Manually blocked', ctx.user.id);
        return { success: true };
      }),

    unblockIP: superAdminProcedure
      .input(z.object({
        ipAddress: z.string(),
      }))
      .mutation(async ({ input }) => {
        await db.unblockIP(input.ipAddress);
        return { success: true };
      }),
  }),

  // Notification routes
  notifications: router({
    // Get my notifications
    getMyNotifications: protectedProcedure
      .query(async ({ ctx }) => {
        const notifications = await db.getMyNotifications(ctx.user.id);
        return notifications;
      }),

    // Get unread count
    getUnreadCount: protectedProcedure
      .query(async ({ ctx }) => {
        const count = await db.getUnreadNotificationCount(ctx.user.id);
        return count;
      }),

    // Mark as read
    markAsRead: protectedProcedure
      .input(z.number())
      .mutation(async ({ ctx, input }) => {
        await db.markNotificationAsRead(input, ctx.user.id);
        return { success: true };
      }),

    // Mark all as read
    markAllAsRead: protectedProcedure
      .mutation(async ({ ctx }) => {
        await db.markAllNotificationsAsRead(ctx.user.id);
        return { success: true };
      }),

    // Delete notification
    deleteNotification: protectedProcedure
      .input(z.number())
      .mutation(async ({ ctx, input }) => {
        await db.deleteNotification(input, ctx.user.id);
        return { success: true };
      }),
  }),

  // Chat routes
  chat: router({
    // Get or create conversation
    getOrCreateConversation: protectedProcedure
      .input(z.object({
        listingId: z.number(),
        sellerId: z.number(),
      }))
      .mutation(async ({ ctx, input }) => {
        const conversation = await db.getOrCreateConversation(
          input.listingId,
          ctx.user.id,
          input.sellerId
        );
        return conversation;
      }),

    // Send message
    sendMessage: protectedProcedure
      .input(z.object({
        conversationId: z.number(),
        message: z.string().min(1).max(5000),
      }))
      .mutation(async ({ ctx, input }) => {
        const message = await db.sendMessage(
          input.conversationId,
          ctx.user.id,
          input.message
        );
        return message;
      }),

    // Get conversation messages
    getMessages: protectedProcedure
      .input(z.number())
      .query(async ({ ctx, input }) => {
        const messages = await db.getConversationMessages(input, ctx.user.id);
        return messages;
      }),

    // Get all conversations
    getConversations: protectedProcedure
      .query(async ({ ctx }) => {
        const conversations = await db.getUserConversations(ctx.user.id);
        return conversations;
      }),

    // Get unread count
    getUnreadCount: protectedProcedure
      .query(async ({ ctx }) => {
        const count = await db.getUnreadMessageCount(ctx.user.id);
        return count;
      }),
  }),

  // PayPal integration
  paypal: router({
    // Create PayPal order and transaction
    createOrder: protectedProcedure
      .input(z.object({
        listingId: z.number(),
        quantity: z.number().min(1),
      }))
      .mutation(async ({ ctx, input }) => {
        const { createPayPalOrder } = await import('./_core/paypalHelpers');
        
        // Get listing details
        const listing = await db.getListingById(input.listingId);
        if (!listing) {
          throw new TRPCError({
            code: 'NOT_FOUND',
            message: 'Listing not found',
          });
        }

        // Check if enough quantity available
        if ((listing.quantity || 0) < input.quantity) {
          throw new TRPCError({
            code: 'BAD_REQUEST',
            message: 'Not enough quantity available',
          });
        }

        // Calculate fees dynamically
        const unitPrice = listing.priceType === 'fixed' 
          ? parseFloat(listing.fixedPrice || '0')
          : parseFloat(listing.auctionStartPrice || '0');
        const subtotal = unitPrice * input.quantity;
        
        const platformFee = parseFloat(await db.getSystemSetting('platform_fee_fixed') || '0.42') * input.quantity;
        const paypalFeePercentage = parseFloat(await db.getSystemSetting('paypal_fee_percentage') || '2.49') / 100;
        const paypalFeeFixed = parseFloat(await db.getSystemSetting('paypal_fee_fixed') || '0.49');
        const paypalFee = subtotal * paypalFeePercentage + paypalFeeFixed;
        
        const totalAmount = subtotal + platformFee + paypalFee;
        const sellerAmount = subtotal;

        // Create transaction
        const transactionId = await db.createTransaction({
          listingId: input.listingId,
          buyerId: ctx.user.id,
          sellerId: listing.sellerId,
          quantity: input.quantity,
          totalAmount: totalAmount.toFixed(2),
          platformFee: platformFee.toFixed(2),
          sellerAmount: sellerAmount.toFixed(2),
        });

        // Create PayPal order
        const orderId = await createPayPalOrder(
          totalAmount,
          'EUR'
        );

        // Update transaction with PayPal order ID
        await db.updateTransaction(transactionId, {
          paypalOrderId: orderId,
        });

        return { orderId, transactionId };
      }),

    // Capture PayPal order
    captureOrder: protectedProcedure
      .input(z.object({
        orderId: z.string(),
        transactionId: z.number(),
      }))
      .mutation(async ({ input }) => {
        const { capturePayPalOrder } = await import('./_core/paypalHelpers');
        
        // Get transaction details
        const transaction = await db.getTransactionById(input.transactionId);
        if (!transaction) {
          throw new TRPCError({
            code: 'NOT_FOUND',
            message: 'Transaction not found',
          });
        }

        // Capture the payment
        const captureResult = await capturePayPalOrder(input.orderId);

        // Update transaction status
        await db.updateTransaction(input.transactionId, {
          status: 'completed',
        });

        // Reduce listing quantity
        await db.reduceListingQuantity(transaction.listingId, transaction.quantity);

        return { success: true, transactionId: input.transactionId };
      }),
  }),
});

export type AppRouter = typeof appRouter;

```

### Schritt 4.x:  paypal.ts 

**`server/paypal.ts`**

```typescript
import axios from "axios";

const PAYPAL_API_BASE = process.env.NODE_ENV === "production"
  ? "https://api.paypal.com"
  : "https://api.sandbox.paypal.com";

const PAYPAL_CLIENT_ID = process.env.NODE_ENV === "production"
  ? process.env.PAYPAL_CLIENT_ID_LIVE
  : process.env.PAYPAL_CLIENT_ID_SANDBOX;

const PAYPAL_CLIENT_SECRET = process.env.NODE_ENV === "production"
  ? process.env.PAYPAL_CLIENT_SECRET_LIVE
  : process.env.PAYPAL_CLIENT_SECRET_SANDBOX;

let cachedAccessToken: { token: string; expiresAt: number } | null = null;

/**
 * Get PayPal access token
 */
export async function getPayPalAccessToken(): Promise<string> {
  // Return cached token if still valid
  if (cachedAccessToken && cachedAccessToken.expiresAt > Date.now()) {
    return cachedAccessToken.token;
  }

  const auth = Buffer.from(`${PAYPAL_CLIENT_ID}:${PAYPAL_CLIENT_SECRET}`).toString("base64");

  try {
    const response = await axios.post(
      `${PAYPAL_API_BASE}/v1/oauth2/token`,
      "grant_type=client_credentials",
      {
        headers: {
          Authorization: `Basic ${auth}`,
          "Content-Type": "application/x-www-form-urlencoded",
        },
      }
    );

    const token = response.data.access_token;
    const expiresIn = response.data.expires_in * 1000; // Convert to milliseconds

    cachedAccessToken = {
      token,
      expiresAt: Date.now() + expiresIn - 60000, // Refresh 1 minute before expiry
    };

    return token;
  } catch (error) {
    console.error("Failed to get PayPal access token:", error);
    throw new Error("PayPal authentication failed");
  }
}

/**
 * Create a PayPal order
 */
export async function createPayPalOrder(params: {
  amount: string;
  description: string;
  listingId: number;
  buyerId: number;
  sellerId: number;
  quantity: number;
}) {
  const accessToken = await getPayPalAccessToken();

  const orderData = {
    intent: "CAPTURE",
    purchase_units: [
      {
        reference_id: `listing-${params.listingId}`,
        amount: {
          currency_code: "EUR",
          value: params.amount,
          breakdown: {
            item_total: {
              currency_code: "EUR",
              value: params.amount,
            },
          },
        },
        description: params.description,
        custom_id: JSON.stringify({
          listingId: params.listingId,
          buyerId: params.buyerId,
          sellerId: params.sellerId,
          quantity: params.quantity,
        }),
      },
    ],
    application_context: {
      brand_name: "deimudda",
      locale: "de-DE",
      user_action: "PAY_NOW",
      return_url: `${process.env.VITE_APP_URL || "http://localhost:3000"}/order/success`,
      cancel_url: `${process.env.VITE_APP_URL || "http://localhost:3000"}/order/cancel`,
    },
  };

  try {
    const response = await axios.post(
      `${PAYPAL_API_BASE}/v2/checkout/orders`,
      orderData,
      {
        headers: {
          Authorization: `Bearer ${accessToken}`,
          "Content-Type": "application/json",
        },
      }
    );

    return response.data;
  } catch (error) {
    console.error("Failed to create PayPal order:", error);
    throw new Error("Failed to create PayPal order");
  }
}

/**
 * Capture a PayPal order
 */
export async function capturePayPalOrder(orderId: string) {
  const accessToken = await getPayPalAccessToken();

  try {
    const response = await axios.post(
      `${PAYPAL_API_BASE}/v2/checkout/orders/${orderId}/capture`,
      {},
      {
        headers: {
          Authorization: `Bearer ${accessToken}`,
          "Content-Type": "application/json",
        },
      }
    );

    return response.data;
  } catch (error) {
    console.error("Failed to capture PayPal order:", error);
    throw new Error("Failed to capture PayPal order");
  }
}

/**
 * Refund a PayPal capture
 */
export async function refundPayPalCapture(captureId: string, amount: string) {
  const accessToken = await getPayPalAccessToken();

  try {
    const response = await axios.post(
      `${PAYPAL_API_BASE}/v2/payments/captures/${captureId}/refund`,
      {
        amount: {
          currency_code: "EUR",
          value: amount,
        },
      },
      {
        headers: {
          Authorization: `Bearer ${accessToken}`,
          "Content-Type": "application/json",
        },
      }
    );

    return response.data;
  } catch (error) {
    console.error("Failed to refund PayPal capture:", error);
    throw new Error("Failed to refund PayPal capture");
  }
}

/**
 * Verify webhook signature
 */
export async function verifyPayPalWebhookSignature(
  webhookId: string,
  eventBody: string,
  transmissionId: string,
  transmissionTime: string,
  certUrl: string,
  authAlgo: string,
  transmissionSig: string
): Promise<boolean> {
  const accessToken = await getPayPalAccessToken();

  try {
    const response = await axios.post(
      `${PAYPAL_API_BASE}/v1/notifications/verify-webhook-signature`,
      {
        transmission_id: transmissionId,
        transmission_time: transmissionTime,
        cert_url: certUrl,
        auth_algo: authAlgo,
        transmission_sig: transmissionSig,
        webhook_id: webhookId,
        webhook_event: JSON.parse(eventBody),
      },
      {
        headers: {
          Authorization: `Bearer ${accessToken}`,
          "Content-Type": "application/json",
        },
      }
    );

    return response.data.verification_status === "SUCCESS";
  } catch (error) {
    console.error("Failed to verify webhook signature:", error);
    return false;
  }
}

```

### Schritt 4.x:  paypalHelpers.ts 

**`server/paypalHelpers.ts`**

```typescript
import paypalClient from './paypal';

/**
 * Create a PayPal order
 * @param amount Total amount in EUR
 * @param currency Currency code (default: EUR)
 * @returns PayPal order ID
 */
export async function createPayPalOrder(
  amount: number,
  currency: string = 'EUR'
): Promise<string> {
  try {
    const ordersController = paypalClient.orders;
    
    const request = {
      body: {
        intent: 'CAPTURE',
        purchaseUnits: [
          {
            amount: {
              currencyCode: currency,
              value: amount.toFixed(2),
            },
          },
        ],
      },
    };

    const response = await ordersController.ordersCreate(request);
    
    if (!response.result || !response.result.id) {
      throw new Error('Failed to create PayPal order');
    }

    console.log('[PayPal] Order created:', response.result.id);
    return response.result.id;
  } catch (error) {
    console.error('[PayPal] Error creating order:', error);
    throw error;
  }
}

/**
 * Capture a PayPal order (complete the payment)
 * @param orderId PayPal order ID
 * @returns Capture details
 */
export async function capturePayPalOrder(orderId: string) {
  try {
    const ordersController = paypalClient.orders;
    
    const request = {
      id: orderId,
    };

    const response = await ordersController.ordersCapture(request);
    
    if (!response.result) {
      throw new Error('Failed to capture PayPal order');
    }

    console.log('[PayPal] Order captured:', orderId);
    return response.result;
  } catch (error) {
    console.error('[PayPal] Error capturing order:', error);
    throw error;
  }
}

/**
 * Get PayPal order details
 * @param orderId PayPal order ID
 * @returns Order details
 */
export async function getPayPalOrderDetails(orderId: string) {
  try {
    const ordersController = paypalClient.orders;
    
    const request = {
      id: orderId,
    };

    const response = await ordersController.ordersGet(request);
    
    if (!response.result) {
      throw new Error('Failed to get PayPal order details');
    }

    return response.result;
  } catch (error) {
    console.error('[PayPal] Error getting order details:', error);
    throw error;
  }
}

```

### Schritt 4.x:  storage.ts 

**`server/storage.ts`**

```typescript
// Preconfigured storage helpers for Manus WebDev templates
// Uses the Biz-provided storage proxy (Authorization: Bearer <token>)

import { ENV } from './_core/env';

type StorageConfig = { baseUrl: string; apiKey: string };

function getStorageConfig(): StorageConfig {
  const baseUrl = ENV.forgeApiUrl;
  const apiKey = ENV.forgeApiKey;

  if (!baseUrl || !apiKey) {
    throw new Error(
      "Storage proxy credentials missing: set BUILT_IN_FORGE_API_URL and BUILT_IN_FORGE_API_KEY"
    );
  }

  return { baseUrl: baseUrl.replace(/\/+$/, ""), apiKey };
}

function buildUploadUrl(baseUrl: string, relKey: string): URL {
  const url = new URL("v1/storage/upload", ensureTrailingSlash(baseUrl));
  url.searchParams.set("path", normalizeKey(relKey));
  return url;
}

async function buildDownloadUrl(
  baseUrl: string,
  relKey: string,
  apiKey: string
): Promise<string> {
  const downloadApiUrl = new URL(
    "v1/storage/downloadUrl",
    ensureTrailingSlash(baseUrl)
  );
  downloadApiUrl.searchParams.set("path", normalizeKey(relKey));
  const response = await fetch(downloadApiUrl, {
    method: "GET",
    headers: buildAuthHeaders(apiKey),
  });
  return (await response.json()).url;
}

function ensureTrailingSlash(value: string): string {
  return value.endsWith("/") ? value : `${value}/`;
}

function normalizeKey(relKey: string): string {
  return relKey.replace(/^\/+/, "");
}

function toFormData(
  data: Buffer | Uint8Array | string,
  contentType: string,
  fileName: string
): FormData {
  const blob =
    typeof data === "string"
      ? new Blob([data], { type: contentType })
      : new Blob([data as any], { type: contentType });
  const form = new FormData();
  form.append("file", blob, fileName || "file");
  return form;
}

function buildAuthHeaders(apiKey: string): HeadersInit {
  return { Authorization: `Bearer ${apiKey}` };
}

export async function storagePut(
  relKey: string,
  data: Buffer | Uint8Array | string,
  contentType = "application/octet-stream"
): Promise<{ key: string; url: string }> {
  const { baseUrl, apiKey } = getStorageConfig();
  const key = normalizeKey(relKey);
  const uploadUrl = buildUploadUrl(baseUrl, key);
  const formData = toFormData(data, contentType, key.split("/").pop() ?? key);
  const response = await fetch(uploadUrl, {
    method: "POST",
    headers: buildAuthHeaders(apiKey),
    body: formData,
  });

  if (!response.ok) {
    const message = await response.text().catch(() => response.statusText);
    throw new Error(
      `Storage upload failed (${response.status} ${response.statusText}): ${message}`
    );
  }
  const url = (await response.json()).url;
  return { key, url };
}

export async function storageGet(relKey: string): Promise<{ key: string; url: string; }> {
  const { baseUrl, apiKey } = getStorageConfig();
  const key = normalizeKey(relKey);
  return {
    key,
    url: await buildDownloadUrl(baseUrl, key, apiKey),
  };
}
```

### Schritt 4.x:  external-storage.ts 

**`server/external-storage.ts`**

```typescript

// Konfiguration für externen Storage (Cloudflare R2 oder Backblaze B2)
const EXTERNAL_STORAGE_ENABLED = process.env.EXTERNAL_STORAGE_ENABLED === "true";
const STORAGE_PROVIDER = process.env.STORAGE_PROVIDER || "cloudflare"; // "cloudflare" oder "backblaze"

// Cloudflare R2 Konfiguration
const R2_CONFIG = {
  endpoint: process.env.R2_ENDPOINT,
  credentials: {
    accessKeyId: process.env.R2_ACCESS_KEY_ID || "",
    secretAccessKey: process.env.R2_SECRET_ACCESS_KEY || "",
  },
  region: "auto",
};

// Backblaze B2 Konfiguration
const B2_CONFIG = {
  endpoint: process.env.B2_ENDPOINT,
  credentials: {
    accessKeyId: process.env.B2_KEY_ID || "",
    secretAccessKey: process.env.B2_APPLICATION_KEY || "",
  },
  region: "us-west-004",
};

// S3 Client initialisieren
const s3Client = EXTERNAL_STORAGE_ENABLED
  ? new S3Client(STORAGE_PROVIDER === "cloudflare" ? R2_CONFIG : B2_CONFIG)
  : null;

const BUCKET_NAME = STORAGE_PROVIDER === "cloudflare"
  ? process.env.R2_BUCKET_NAME || "deimudda-images"
  : process.env.B2_BUCKET_NAME || "deimudda-images";

const PUBLIC_URL = STORAGE_PROVIDER === "cloudflare"
  ? process.env.R2_PUBLIC_URL || ""
  : process.env.B2_PUBLIC_URL || "";

/**
 * Upload zu externem Storage (Cloudflare R2 oder Backblaze B2)
 */
export async function externalStoragePut(
  key: string,
  data: Buffer,
  contentType: string
): Promise<{ key: string; url: string }> {
  if (!EXTERNAL_STORAGE_ENABLED || !s3Client) {
    throw new Error("External storage not enabled");
  }```

### Schritt 4.x:  upload.ts 

**`server/upload.ts`**

```typescript
import { Router, Request, Response } from "express";
import { storagePut } from "../storage";
import multer from "multer";
import { randomBytes } from "crypto";

const router = Router();
const upload = multer({ storage: multer.memoryStorage(), limits: { fileSize: 5 * 1024 * 1024 } });

router.post("/upload", upload.single("file"), async (req: any, res: Response) => {
  try {
    if (!req.file) {
      return res.status(400).json({ error: "No file provided" });
    }

    // Validate file type
    if (!req.file.mimetype.startsWith("image/")) {
      return res.status(400).json({ error: "File must be an image" });
    }

    // Generate unique filename
    const ext = req.file.originalname.split(".").pop();
    const filename = `${randomBytes(8).toString("hex")}-${Date.now()}.${ext}`;
    const key = `uploads/images/${filename}`;

    // Upload to S3
    const { url } = await storagePut(key, req.file.buffer, req.file.mimetype);

    res.json({ url });
  } catch (error: unknown) {
    console.error("Upload error:", error);
    res.status(500).json({ error: "Upload failed" });
  }
});

export default router;

```

### Schritt 4.x:  systemRouter.ts 

**`server/systemRouter.ts`**

```typescript
import { z } from "zod";
import { notifyOwner } from "./notification";
import { adminProcedure, publicProcedure, router } from "./trpc";

export const systemRouter = router({
  health: publicProcedure
    .input(
      z.object({
        timestamp: z.number().min(0, "timestamp cannot be negative"),
      })
    )
    .query(() => ({
      ok: true,
    })),

  notifyOwner: adminProcedure
    .input(
      z.object({
        title: z.string().min(1, "title is required"),
        content: z.string().min(1, "content is required"),
      })
    )
    .mutation(async ({ input }) => {
      const delivered = await notifyOwner(input);
      return {
        success: delivered,
      } as const;
    }),

  // Get maintenance mode status (public - for frontend guard)
  getMaintenanceStatus: publicProcedure
    .query(async () => {
      const { getSystemSetting } = await import("../db");
      const setting = await getSystemSetting('maintenance_mode');
      return { maintenanceMode: setting === 'true' };
    }),
});

```

### Schritt 4.x:  models.ts 

**`server/models.ts`**

```typescript
/**
 * Shared Model Types
 * These types mirror the Drizzle schema for client-side use
 */

import type {
  ListingType,
  PriceType,
  ListingStatus,
  Genetics,
  GrowMethod,
  SeedType,
  UserRole,
  UserStatus,
  TransactionStatus,
  PaymentMethod,
  OfferStatus,
  ReportReason,
  ReportStatus,
  ReportType,
  WarningReason,
  AdminAction,
  VerificationStatus,
  NotificationType,
} from './enums';

// User
export interface User {
  id: number;
  openId: string;
  name: string;
  email: string | null;
  avatarUrl: string | null;
  role: UserRole;
  status: UserStatus;
  isSellerActive: boolean;
  location: string | null;
  bio: string | null;
  createdAt: Date;
  updatedAt: Date;
}

// Seller Profile
export interface SellerProfile {
  id: number;
  userId: number;
  shopName: string;
  description: string | null;
  location: string | null;
  profileImageUrl: string | null;
  stripeAccountId: string | null;
  verificationStatus: VerificationStatus;
  rating: string; // Decimal as string
  totalReviews: number;
  createdAt: Date;
  updatedAt: Date;
}

// Listing
export interface Listing {
  id: number;
  sellerId: number;
  type: ListingType;
  strain: string;
  description: string | null;
  quantity: number;
  priceType: PriceType;
  fixedPrice: string | null; // Decimal as string
  auctionStartPrice: string | null; // Decimal as string
  auctionEndTime: Date | null;
  imageUrl: string | null;
  images: string | null; // JSON string
  shippingVerified: boolean;
  shippingPickup: boolean;
  acceptsOffers: boolean;
  offerMinPrice: string | null; // Decimal as string
  status: ListingStatus;
  genetics: Genetics | null;
  seedBank: string | null;
  growMethod: GrowMethod | null;
  seedType: SeedType | null;
  thcContent: string | null;
  cbdContent: string | null;
  floweringTime: string | null;
  yieldInfo: string | null;
  flavorProfile: string | null;
  origin: string | null;
  createdAt: Date;
  updatedAt: Date;
}

// Transaction
export interface Transaction {
  id: number;
  buyerId: number;
  sellerId: number;
  listingId: number;
  quantity: number;
  unitPrice: string; // Decimal as string
  totalAmount: string; // Decimal as string
  platformFee: string; // Decimal as string
  paymentMethod: PaymentMethod;
  paymentId: string | null;
  status: TransactionStatus;
  shippingAddress: string | null;
  trackingNumber: string | null;
  notes: string | null;
  createdAt: Date;
  updatedAt: Date;
}

// Offer
export interface Offer {
  id: number;
  listingId: number;
  buyerId: number;
  amount: string; // Decimal as string
  message: string | null;
  status: OfferStatus;
  createdAt: Date;
  updatedAt: Date;
}

// Review
export interface Review {
  id: number;
  transactionId: number;
  reviewerId: number;
  revieweeId: number;
  rating: number;
  comment: string | null;
  createdAt: Date;
}

// Report
export interface Report {
  id: number;
  reporterId: number;
  reportedId: number;
  reportType: ReportType;
  reason: ReportReason;
  description: string | null;
  status: ReportStatus;
  resolvedBy: number | null;
  resolvedAt: Date | null;
  createdAt: Date;
}

// Warning
export interface Warning {
  id: number;
  userId: number;
  issuedBy: number;
  reason: WarningReason;
  message: string | null;
  createdAt: Date;
}

// Admin Log
export interface AdminLog {
  id: number;
  adminId: number;
  action: AdminAction;
  targetId: number | null;
  details: string | null;
  createdAt: Date;
}

// Message
export interface Message {
  id: number;
  senderId: number;
  receiverId: number;
  listingId: number | null;
  content: string;
  read: boolean;
  createdAt: Date;
}

// Notification
export interface Notification {
  id: number;
  userId: number;
  type: NotificationType;
  title: string;
  message: string;
  link: string | null;
  read: boolean;
  createdAt: Date;
}

// Extended types with relations (for queries that include joins)
export interface ListingWithSeller extends Listing {
  seller: SellerProfile;
}

export interface TransactionWithDetails extends Transaction {
  buyer: User;
  seller: User;
  listing: Listing;
}

export interface OfferWithDetails extends Offer {
  listing: Listing;
  buyer: User;
}

export interface ReviewWithDetails extends Review {
  reviewer: User;
  reviewee: User;
  transaction: Transaction;
}

export interface ReportWithDetails extends Report {
  reporter: User;
  reported: User;
}

export interface WarningWithDetails extends Warning {
  user: User;
  issuedByUser: User;
}

export interface MessageWithDetails extends Message {
  sender: User;
  receiver: User;
  listing: Listing | null;
}

```

### Schritt 4.x:  enums.ts 

**`server/enums.ts`**

```typescript
/**
 * Shared Enum Types
 * These types are used across client and server to ensure type-safety
 */

// Listing Types
export type ListingType = "cutting" | "seed";
export type PriceType = "fixed" | "auction";
export type ListingStatus = "active" | "sold" | "ended" | "draft" | "blocked";

// Genetics
export type Genetics = "sativa" | "indica" | "hybrid";
export type GrowMethod = "hydro" | "bio" | "soil";
export type SeedType = "feminized" | "regular" | "autoflower";

// User Types
export type UserRole = "user" | "admin" | "super_admin";
export type UserStatus = "active" | "suspended" | "banned" | "warned";

// Transaction Types
export type TransactionStatus = "pending" | "completed" | "cancelled" | "refunded";
export type PaymentMethod = "paypal" | "stripe" | "cash";

// Offer Types
export type OfferStatus = "pending" | "accepted" | "rejected" | "expired";

// Report Types
export type ReportReason = "spam" | "inappropriate" | "scam" | "other";
export type ReportStatus = "pending" | "reviewing" | "resolved" | "dismissed";
export type ReportType = "listing" | "user" | "message";

// Warning Types
export type WarningReason = "tos_violation" | "spam" | "inappropriate_content" | "scam_attempt" | "other";

// Admin Log Types
export type AdminAction = 
  | "warn_user"
  | "suspend_user"
  | "ban_user"
  | "delete_listing"
  | "promote_admin"
  | "demote_admin"
  | "resolve_report"
  | "update_setting"
  | "remove_warning"
  | "unsuspend_user"
  | "unban_user";

// Seller Profile Types
export type VerificationStatus = "pending" | "verified" | "rejected";

// Notification Types
export type NotificationType = 
  | "message"
  | "offer"
  | "purchase"
  | "review"
  | "admin"
  | "system";

// Type Guards
export const isListingType = (value: string): value is ListingType => 
  ["cutting", "seed"].includes(value);

export const isPriceType = (value: string): value is PriceType => 
  ["fixed", "auction"].includes(value);

export const isListingStatus = (value: string): value is ListingStatus => 
  ["active", "sold", "ended", "draft", "blocked"].includes(value);

export const isUserRole = (value: string): value is UserRole => 
  ["user", "admin", "super_admin"].includes(value);

export const isUserStatus = (value: string): value is UserStatus => 
  ["active", "suspended", "banned", "warned"].includes(value);

```

### Schritt 4.x:  const.ts 

**`server/const.ts`**

```typescript
export { COOKIE_NAME, ONE_YEAR_MS } from "@shared/const";

export const APP_TITLE = import.meta.env.VITE_APP_TITLE || "App";

export const APP_LOGO =
  import.meta.env.VITE_APP_LOGO ||
  "https://placehold.co/128x128/E1E7EF/1F2937?text=App";

// Generate login URL at runtime so redirect URI reflects the current origin.
export const getLoginUrl = () => {
  const oauthPortalUrl = import.meta.env.VITE_OAUTH_PORTAL_URL;
  const appId = import.meta.env.VITE_APP_ID;
  const redirectUri = `${window.location.origin}/api/oauth/callback`;
  const state = btoa(redirectUri);

  const url = new URL(`${oauthPortalUrl}/app-auth`);
  url.searchParams.set("appId", appId);
  url.searchParams.set("redirectUri", redirectUri);
  url.searchParams.set("state", state);
  url.searchParams.set("type", "signIn");

  return url.toString();
};```

### Schritt 4.x:  settings-cache.ts 

**`server/settings-cache.ts`**

```typescript
/**
 * System Settings Cache
 * 
 * Simple in-memory cache for system settings to reduce database queries.
 * Cache entries expire after TTL (default: 5 minutes).
 */

interface CacheEntry {
  value: string;
  expiresAt: number;
}

class SettingsCache {
  private cache: Map<string, CacheEntry> = new Map();
  private ttl: number; // Time-to-live in milliseconds

  constructor(ttlSeconds: number = 300) { // Default: 5 minutes
    this.ttl = ttlSeconds * 1000;
  }

  /**
   * Get a setting from cache
   * Returns null if not found or expired
   */
  get(key: string): string | null {
    const entry = this.cache.get(key);
    
    if (!entry) {
      console.log(`[SettingsCache] Cache MISS for key: ${key}`);
      return null;
    }

    // Check if expired
    if (Date.now() > entry.expiresAt) {
      this.cache.delete(key);
      console.log(`[SettingsCache] Cache EXPIRED for key: ${key}`);
      return null;
    }

    console.log(`[SettingsCache] Cache HIT for key: ${key}, value: ${entry.value}`);
    return entry.value;
  }

  /**
   * Set a setting in cache
   */
  set(key: string, value: string): void {
    this.cache.set(key, {
      value,
      expiresAt: Date.now() + this.ttl,
    });
  }

  /**
   * Invalidate a specific setting
   */
  invalidate(key: string): void {
    const hadKey = this.cache.has(key);
    this.cache.delete(key);
    console.log(`[SettingsCache] Invalidated key: ${key} (existed: ${hadKey})`);
  }

  /**
   * Clear all cached settings
   */
  clear(): void {
    this.cache.clear();
  }

  /**
   * Get cache statistics
   */
  getStats() {
    const now = Date.now();
    let validEntries = 0;
    let expiredEntries = 0;

    for (const [key, entry] of this.cache.entries()) {
      if (now > entry.expiresAt) {
        expiredEntries++;
      } else {
        validEntries++;
      }
    }

    return {
      totalEntries: this.cache.size,
      validEntries,
      expiredEntries,
      ttlSeconds: this.ttl / 1000,
    };
  }
}

// Export singleton instance
// Reduced TTL to 10 seconds for faster maintenance mode updates
export const settingsCache = new SettingsCache(10); // 10 seconds TTL

```

### Schritt 4.x:  useAuth.ts 

**`server/useAuth.ts`**

```typescript
    ...state,
    refresh: () => meQuery.refetch(),
    logout,
  };
}
```

### Schritt 4.x:  useMaintenanceMode.ts 

**`server/useMaintenanceMode.ts`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import { trpc } from "@/lib/trpc";

export function useMaintenanceMode() {
  const { user, isLoading: isAuthLoading } = useAuth();
  
  const { data, isLoading: isQueryLoading } = trpc.system.getMaintenanceStatus.useQuery(undefined, {
    // Only fetch if:
    // 1. User is loaded (not undefined)
    // 2. User is not a super_admin (super_admins bypass maintenance)
    enabled: !isAuthLoading && user?.role !== "super_admin",
    refetchInterval: 5000, // Refetch every 5 seconds for faster maintenance mode updates
    refetchOnMount: true, // Always refetch on mount to get latest status
    refetchOnWindowFocus: true, // Refetch when window regains focus
    staleTime: 0, // Consider data stale immediately to force refetch
    cacheTime: 0, // Don't cache query results at all
  });

  // Super admins always bypass maintenance mode
  if (user?.role === "super_admin") {
    return {
      isMaintenanceMode: false,
      isLoading: false,
    };
  }

  // While auth is loading, don't show maintenance page
  if (isAuthLoading) {
    return {
      isMaintenanceMode: false,
      isLoading: true,
    };
  }

  return {
    isMaintenanceMode: data?.maintenanceMode === true,
    isLoading: isQueryLoading,
  };
}

```


---

## 5. Frontend-Implementierung

Dieser Abschnitt enthält den gesamten clientseitigen Code. Erstelle die folgenden Dateien in den angegebenen Verzeichnissen.

### Schritt 5.1: Client-Einstiegspunkt (`client/src/main.tsx`)

Erstelle die Verzeichnisstruktur `client/src` und darin die Datei `main.tsx`.

```bash
mkdir -p client/src
```

**`client/src/main.tsx`**
```typescript
import { trpc } from "@/lib/trpc";
import { UNAUTHED_ERR_MSG } from '@shared/const';
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { httpBatchLink, TRPCClientError } from "@trpc/client";
import { createRoot } from "react-dom/client";
import superjson from "superjson";
import App from "./App";
import { getLoginUrl } from "./const";
import "./index.css";

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: 3, // Retry failed queries 3 times
      retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000), // Exponential backoff: 1s, 2s, 4s, max 30s
      staleTime: 5000, // Data is fresh for 5 seconds
      refetchOnWindowFocus: false, // Don't refetch on window focus
    },
    mutations: {
      retry: 1, // Retry failed mutations once
      retryDelay: 1000, // Wait 1 second before retry
    },
  },
});

const redirectToLoginIfUnauthorized = (error: unknown) => {
  if (!(error instanceof TRPCClientError)) return;
  if (typeof window === "undefined") return;

  const isUnauthorized = error.message === UNAUTHED_ERR_MSG;

  if (!isUnauthorized) return;

  window.location.href = getLoginUrl();
};

queryClient.getQueryCache().subscribe(event => {
  if (event.type === "updated" && event.action.type === "error") {
    const error = event.query.state.error;
    redirectToLoginIfUnauthorized(error);
    console.error("[API Query Error]", error);
  }
});

queryClient.getMutationCache().subscribe(event => {
  if (event.type === "updated" && event.action.type === "error") {
    const error = event.mutation.state.error;
    redirectToLoginIfUnauthorized(error);
    console.error("[API Mutation Error]", error);
  }
});

const trpcClient = trpc.createClient({
  links: [
    httpBatchLink({
      url: "/api/trpc",
      transformer: superjson,
      fetch(input, init) {
        return globalThis.fetch(input, {
          ...(init ?? {}),
          credentials: "include",
        });
      },
    }),
  ],
});

createRoot(document.getElementById("root")!).render(
  <trpc.Provider client={trpcClient} queryClient={queryClient}>
    <QueryClientProvider client={queryClient}>
      <App />
    </QueryClientProvider>
  </trpc.Provider>
);
```


### Schritt 5.2: Haupt-App-Komponente (`client/src/App.tsx`)

**`client/src/App.tsx`**
```typescript
import { Toaster } from "@/components/ui/sonner";
import { TooltipProvider } from "@/components/ui/tooltip";
import NotFound from "@/pages/NotFound";
import { Route, Switch } from "wouter";
import ErrorBoundary from "./components/ErrorBoundary";
import CookieBanner from "./components/CookieBanner";
import { ThemeProvider } from "./contexts/ThemeContext";
import Home from "./pages/Home";
import Impressum from "./pages/Impressum";
import SellerDashboard from "./pages/SellerDashboard";
import OfferManagement from "./pages/OfferManagement";
import BuyerDashboard from "./pages/BuyerDashboard";
import SellerShop from "./pages/SellerShop";
import ListingDetail from "./pages/ListingDetail";
import BrowseListings from "./pages/BrowseListings";
import Checkout from "./pages/Checkout";
import Terms from "./pages/Terms";
import Privacy from "./pages/Privacy";
import Widerruf from "./pages/Widerruf";
import Profile from "./pages/Profile";
import About from "./pages/About";
import Contact from "./pages/Contact";
import FAQ from "./pages/FAQ";
import SellerGuidelines from "./pages/SellerGuidelines";
import FeeStructure from "./pages/FeeStructure";
import Support from "./pages/Support";
import AdminDashboard from "./pages/AdminDashboard";
import AdminUsers from "./pages/AdminUsers";
import AdminLogs from "./pages/AdminLogs";
import AdminListings from "./pages/AdminListings";
import AdminTransactions from "./pages/AdminTransactions";
import AdminReports from "./pages/AdminReports";
import AdminStats from "./pages/AdminStats";
import AdminManage from "./pages/AdminManage";
import AdminSettings from "./pages/AdminSettings";
import AdminManagement from "./pages/AdminManagement";
import AdminSecurity from "./pages/AdminSecurity";

import Notifications from "./pages/Notifications";
import Messages from "./pages/Messages";
import ChatWindow from "./pages/ChatWindow";
import NewMessage from "./pages/NewMessage";

function Router() {
  // make sure to consider if you need authentication for certain routes
  return (
    <Switch>
      <Route path={"/"} component={Home} />
      <Route path={"/impressum"} component={Impressum} />
      <Route path={"/browse"} component={BrowseListings} />
      <Route path="/listing/:id" component={ListingDetail} />
      <Route path="/checkout/:id" component={Checkout} />
      <Route path="/terms" component={Terms} />
      <Route path="/datenschutz" component={Privacy} />
      <Route path="/widerruf" component={Widerruf} />
      <Route path="/about" component={About} />
      <Route path="/contact" component={Contact} />
      <Route path="/faq" component={FAQ} />
      <Route path="/seller-guidelines" component={SellerGuidelines} />
      <Route path="/fee-structure" component={FeeStructure} />
      <Route path="/support" component={Support} />
      <Route path="/profile" component={Profile} />
      <Route path="/notifications" component={Notifications} />
      <Route path="/messages" component={Messages} />
      <Route path="/messages/new" component={NewMessage} />
      <Route path="/messages/:id" component={ChatWindow} />
      <Route path="/seller/dashboard" component={SellerDashboard} />
      <Route path="/seller/offers" component={OfferManagement} />
      <Route path="/buyer/dashboard" component={BuyerDashboard} />
      <Route path="/seller/:sellerId" component={SellerShop} />
      <Route path="/admin" component={AdminDashboard} />
      <Route path="/admin/users" component={AdminUsers} />
      <Route path="/admin/logs" component={AdminLogs} />
      <Route path="/admin/listings" component={AdminListings} />
      <Route path="/admin/transactions" component={AdminTransactions} />
      <Route path="/admin/reports" component={AdminReports} />
      <Route path="/admin/stats" component={AdminStats} />
      <Route path="/admin/manage" component={AdminManage} />
      <Route path="/admin/settings" component={AdminSettings} />
      <Route path="/admin/security" component={AdminSecurity} />
      <Route path="/admin/admins" component={AdminManagement} />

      <Route path="/404" component={NotFound} />
      {/* Final fallback route */}
      <Route component={NotFound} />
    </Switch>
  );
}

// NOTE: About Theme
// - First choose a default theme according to your design style (dark or light bg), than change color palette in index.css
//   to keep consistent foreground/background color across components
// - If you want to make theme switchable, pass `switchable` ThemeProvider and use `useTheme` hook

function App() {
  return (
    <ErrorBoundary>
      <ThemeProvider
        defaultTheme="light"
        // switchable
      >
        <TooltipProvider>
          <Toaster />
          <Router />
          <CookieBanner />
        </TooltipProvider>
      </ThemeProvider>
    </ErrorBoundary>
  );
}

export default App;

```


### Schritt 5.3: Frontend-Komponenten (`client/src/components`)

Erstelle das Verzeichnis `client/src/components` und füge die folgenden Komponenten hinzu.

```bash
mkdir -p client/src/components
```
#### Schritt 5.x: About.tsx

**`client/src/components/About.tsx`**

```typescript
import BackButton from "@/components/BackButton";

export default function About() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 py-12">
      <div className="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
        <BackButton href="/" label="Zurück zur Startseite" />
        <div className="bg-white rounded-lg shadow-lg overflow-hidden">
          {/* Hero Section */}
          <div className="bg-gradient-to-r from-green-600 to-emerald-600 p-8 text-white">
            <h1 className="text-4xl font-bold mb-4">Über uns</h1>
            <p className="text-xl text-green-50">
              Mit Herz und Seele für biologischen Cannabis-Anbau
            </p>
          </div>

          <div className="p-8 space-y-8">
            {/* Logos */}
            <div className="flex flex-wrap items-center justify-center gap-8 py-6 border-b">
              <img 
                src="/vaperge-logo.png" 
                alt="Vaperge Logo" 
                className="h-24 w-auto"
              />
              <img 
                src="/kalidad-logo.png" 
                alt="Kalidad Logo" 
                className="h-20 w-auto bg-white p-2 rounded"
              />
            </div>

            {/* Mission Statement */}
            <div className="bg-green-50 border-l-4 border-green-500 p-6 rounded-r-lg">
              <h2 className="text-2xl font-bold text-green-900 mb-3">Unsere Mission</h2>
              <p className="text-lg text-green-800 leading-relaxed">
                Wir möchten jedem ermöglichen, Cannabis in <strong>Kali-Qualität</strong> zu produzieren – 
                unabhängig von der Genetik. Denn Spitzenqualität ist keine Frage der Sorte, sondern eine Frage 
                der <strong>richtigen Anbau-Methodik</strong>.
              </p>
            </div>

            {/* Die Geschichte */}
            <section>
              <h2 className="text-3xl font-bold text-gray-900 mb-4">Die Geschichte von deimudda</h2>
              
              <div className="prose prose-lg max-w-none text-gray-700 space-y-4">
                <p>
                  <strong>deimudda</strong> ist mehr als nur eine Plattform – es ist das Ergebnis jahrelanger 
                  Leidenschaft, Forschung und Hingabe zum biologischen Cannabis-Anbau. Hinter deimudda steht 
                  <strong> Vaperge - Eau de Terpènes</strong>, gegründet von Chris Rohleder, in enger Kooperation 
                  mit <strong>Kalidad - Grow- & Headshop</strong> in Malsch.
                </p>

                <p>
                  Was als Neugier und Experimentierfreude begann, entwickelte sich über die Jahre zu einer echten 
                  Expertise: Wir haben uns intensiv damit beschäftigt, wie man Cannabis <strong>biologisch</strong>, 
                  <strong>nachhaltig</strong> und in <strong>höchster Qualität</strong> anbauen kann – ohne auf 
                  synthetische Dünger oder aggressive Chemie zurückzugreifen.
                </p>
              </div>
            </section>

            {/* Der Cannabis-Foliant */}
            <section className="bg-amber-50 p-6 rounded-lg border border-amber-200">
              <h2 className="text-2xl font-bold text-amber-900 mb-4">📖 Der Cannabis-Foliant</h2>
              
              <div className="space-y-3 text-gray-700">
                <p>
                  Aus unserer jahrelangen Forschung und unzähligen Anbau-Experimenten entstand der 
                  <strong> Cannabis-Foliant</strong> – ein umfassendes Handbuch, das unser gesamtes Wissen 
                  über biologischen Cannabis-Anbau bündelt.
                </p>

                <p>
                  Der Foliant dokumentiert nicht nur Theorie, sondern <strong>praxiserprobte Methoden</strong>:
                </p>

                <ul className="list-disc pl-6 space-y-2">
                  <li>Biologische Dünge-Schemata für verschiedene Wachstumsphasen</li>
                  <li>Natürliche Schädlingsbekämpfung ohne Chemie</li>
                  <li>Optimierung von Boden, Mikrobiologie und Nährstoffkreisläufen</li>
                  <li>Terpenen-Entwicklung und Aromaprofil-Optimierung</li>
                  <li>Ernte, Trocknung und Fermentation für maximale Qualität</li>
                </ul>

                <p className="text-sm text-amber-800 italic mt-4">
                  Der Foliant ist das Herzstück unserer Philosophie: Wissen teilen, damit jeder Grower 
                  sein volles Potenzial entfalten kann.
                </p>
              </div>
            </section>

            {/* Das Dünge-Schema */}
            <section>
              <h2 className="text-2xl font-bold text-gray-900 mb-4">🌱 Das ganzheitliche Grow-Konzept: Der Schlüssel zur Qualität</h2>
              
              <div className="space-y-4 text-gray-700">
                <p>
                  Aus dem Cannabis-Folianten heraus haben wir ein <strong>ganzheitliches Grow-Konzept</strong> entwickelt, 
                  das auf rein <strong>biologischen Prinzipien</strong> basiert. Dieses Konzept ist das Ergebnis von 
                  Jahren des Experimentierens, Testens und Verfeinerns.
                </p>

                <div className="bg-green-50 p-5 rounded-lg border-l-4 border-green-500">
                  <h3 className="font-bold text-green-900 mb-2">Die Philosophie dahinter:</h3>
                  <p className="text-green-800">
                    Spitzenqualität entsteht nicht durch teure Genetik oder High-Tech-Equipment, sondern durch 
                    <strong> Verständnis der biologischen Prozesse</strong>. Unser Grow-Konzept arbeitet mit der 
                    Natur, nicht gegen sie – und ermöglicht es jedem Grower, Premium-Qualität zu 
                    produzieren, egal welche Sorte angebaut wird.
                  </p>
                </div>

                <p>
                  Das Konzept umfasst:
                </p>

                <ul className="list-disc pl-6 space-y-2">
                  <li><strong>Bodenbiologie:</strong> Aufbau eines gesunden Mikrobioms</li>
                  <li><strong>Nährstoff-Timing:</strong> Die richtige Düngung zur richtigen Zeit</li>
                  <li><strong>Organische Materialien:</strong> Kompost, Wurmhumus, Pflanzenjauchen</li>
                  <li><strong>Mineralien:</strong> Gesteinsmehl, Kalk, Spurenelemente</li>
                  <li><strong>Mikroorganismen:</strong> Mykorrhiza, Bakterien, Pilze</li>
                </ul>

                <p className="font-semibold text-green-700">
                  Das Ergebnis? Pflanzen, die nicht nur gesund wachsen, sondern <strong>Terpenen-Profile</strong> 
                  entwickeln, die höchste Qualitätsansprüche erfüllen – unabhängig von der Ausgangssorte.
                </p>
              </div>
            </section>

            {/* German Kali */}
            <section className="bg-purple-50 p-6 rounded-lg border border-purple-200">
              <h2 className="text-2xl font-bold text-purple-900 mb-4">🌿 German Kali</h2>
              
              <div className="space-y-3 text-gray-700">
                <p>
                  <strong>German Kali</strong> steht für <strong>Qualität</strong> – echte, ehrliche, 
                  biologisch produzierte Qualität. Keine Abkürzungen, keine Chemie, keine Tricks. 
                  Nur <strong>ganzheitliches Grow-Konzept</strong>, das auf Verständnis der Natur basiert.
                </p>

                <p>
                  Unser Ansatz ist simpel: Mit der <strong>richtigen Methodik</strong> – biologischem Anbau, 
                  effektiven Mikroorganismen (EMs), einem durchdachten Nährstoff-Management und tiefem Verständnis 
                  der Bodenbiologie – wird aus <strong>jeder Genetik</strong> ein Premium-Produkt.
                </p>

                <p>
                  <strong>German Kali</strong> ist unsere Art zu zeigen: Man braucht keine überteuerten 
                  "Hype-Strains" oder synthetische Wundermittel. Was zählt, ist <strong>Methodik</strong>, 
                  <strong>Geduld</strong> und <strong>Respekt vor der Pflanze</strong>.
                </p>

                <div className="bg-purple-100 p-4 rounded mt-4">
                  <p className="text-purple-900 font-semibold">
                    💡 Kurz gesagt: <strong>German Kali</strong> bedeutet Spitzenqualität durch Methodik, 
                    nicht durch Genetik. Selbst aus einfachen Sorten wird mit unserem ganzheitlichen Grow-Konzept 
                    erstklassiges Cannabis.
                  </p>
                </div>
              </div>
            </section>

            {/* Die Vision */}
            <section>
              <h2 className="text-2xl font-bold text-gray-900 mb-4">🎯 Unsere Vision: Wissen teilen, Qualität demokratisieren</h2>
              
              <div className="space-y-4 text-gray-700">
                <p>
                  Mit <strong>deimudda</strong> wollen wir nicht nur Stecklinge und Samen vermitteln – wir wollen 
                  eine <strong>Community</strong> aufbauen, in der Wissen geteilt, Erfahrungen ausgetauscht und 
                  gemeinsam gelernt wird.
                </p>

                <div className="grid md:grid-cols-3 gap-4 my-6">
                  <div className="bg-blue-50 p-4 rounded-lg text-center">
                    <div className="text-3xl mb-2">🌱</div>
                    <h3 className="font-bold text-blue-900 mb-2">Biologisch</h3>
                    <p className="text-sm text-blue-800">
                      Nur natürliche Methoden, keine synthetischen Chemikalien
                    </p>
                  </div>

                  <div className="bg-green-50 p-4 rounded-lg text-center">
                    <div className="text-3xl mb-2">🤝</div>
                    <h3 className="font-bold text-green-900 mb-2">Community</h3>
                    <p className="text-sm text-green-800">
                      Wissen teilen, voneinander lernen, gemeinsam wachsen
                    </p>
                  </div>

                  <div className="bg-purple-50 p-4 rounded-lg text-center">
                    <div className="text-3xl mb-2">⭐</div>
                    <h3 className="font-bold text-purple-900 mb-2">Qualität</h3>
                    <p className="text-sm text-purple-800">
                      Kali-Standard für jeden – unabhängig von Budget oder Erfahrung
                    </p>
                  </div>
                </div>

                <p>
                  Wir glauben daran, dass <strong>jeder Grower</strong> – ob Anfänger oder Profi – in der Lage sein sollte, 
                  Cannabis in höchster Qualität zu produzieren. Dafür braucht es keine teuren Anlagen oder geheime Tricks, 
                  sondern nur das <strong>richtige Wissen</strong> und die <strong>richtige Methode</strong>.
                </p>

                <p className="font-semibold text-lg text-green-700">
                  Genau das bieten wir: <strong>Stecklinge</strong>, <strong>Wissen</strong> und eine 
                  <strong> Community</strong>, die mit Herz und Seele dabei ist.
                </p>
              </div>
            </section>

            {/* Das Team */}
            <section className="bg-gray-50 p-6 rounded-lg">
              <h2 className="text-2xl font-bold text-gray-900 mb-4">👥 Das Team</h2>
              
              <div className="space-y-4">
                <div className="flex items-start gap-4">
                  <div className="flex-shrink-0">
                    <img 
                      src="/vaperge-logo.png" 
                      alt="Vaperge" 
                      className="h-16 w-auto"
                    />
                  </div>
                  <div>
                    <h3 className="font-bold text-lg text-gray-900">Vaperge - Eau de Terpènes</h3>
                    <p className="text-gray-600">
                      Gegründet von Chris Rohleder. Spezialisiert auf Terpenen-Forschung, biologischen Anbau 
                      und die Entwicklung von Dünge-Schemata. Vaperge ist die treibende Kraft hinter dem 
                      Cannabis-Folianten und dem deimudda-Projekt.
                    </p>
                  </div>
                </div>

                <div className="flex items-start gap-4">
                  <div className="flex-shrink-0">
                    <img 
                      src="/kalidad-logo.png" 
                      alt="Kalidad" 
                      className="h-16 w-auto bg-white p-2 rounded"
                    />
                  </div>
                  <div>
                    <h3 className="font-bold text-lg text-gray-900">Kalidad - Grow- & Headshop</h3>
                    <p className="text-gray-600">
                      Unser Partner in Malsch. Kalidad bringt jahrelange Erfahrung im Grow-Bereich mit und 
                      unterstützt die Community mit Fachwissen, Equipment und Beratung. Gemeinsam bilden wir 
                      ein starkes Team für biologischen Cannabis-Anbau.
                    </p>
                    <p className="text-sm text-gray-500 mt-2">
                      Instagram: <a href="https://www.instagram.com/kalidad420/" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">@kalidad420</a>
                    </p>
                  </div>
                </div>
              </div>
            </section>

            {/* Warum deimudda? */}
            <section>
              <h2 className="text-2xl font-bold text-gray-900 mb-4">❓ Warum "deimudda"?</h2>
              
              <div className="space-y-3 text-gray-700">
                <p>
                  Der Name <strong>deimudda</strong> ist eine liebevolle Anspielung auf die <strong>Mutterpflanzen</strong> 
                  (engl. "mother plants"), von denen Stecklinge geschnitten werden. Im Pfälzischen Dialekt wird daraus 
                  "dei Mudda" – deine Mutter.
                </p>

                <p>
                  Es ist ein Augenzwinkern, aber auch ein Statement: <strong>Respekt vor der Natur</strong>, 
                  <strong>Respekt vor der Pflanze</strong> und <strong>Respekt vor dem Handwerk</strong> des Anbaus.
                </p>

                <div className="bg-green-100 p-4 rounded-lg border-l-4 border-green-500">
                  <p className="text-green-900 italic">
                    "Bei uns geht's nicht um schnelles Geld oder Massenproduktion. Bei uns geht's um Leidenschaft, 
                    Qualität und die Liebe zur Pflanze. Deimudda – weil jede gute Ernte mit einer guten Mutter beginnt." 
                    <span className="block mt-2 text-right font-semibold">– Das deimudda-Team</span>
                  </p>
                </div>
              </div>
            </section>

            {/* Call to Action */}
            <section className="bg-gradient-to-r from-green-600 to-emerald-600 p-8 rounded-lg text-white text-center">
              <h2 className="text-3xl font-bold mb-4">Werde Teil der Community!</h2>
              <p className="text-lg text-green-50 mb-6">
                Entdecke hochwertige Stecklinge, tausche dich mit Gleichgesinnten aus und lerne, 
                wie du Cannabis in Kali-Qualität produzierst.
              </p>
              <div className="flex flex-wrap gap-4 justify-center">
                <a 
                  href="/browse" 
                  className="bg-white text-green-600 px-6 py-3 rounded-lg font-semibold hover:bg-green-50 transition"
                >
                  Stecklinge entdecken
                </a>
                <a 
                  href="/register" 
                  className="bg-green-700 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-800 transition border-2 border-white"
                >
                  Jetzt registrieren
                </a>
              </div>
            </section>

            {/* Kontakt */}
            <section className="text-center text-gray-600">
              <p className="mb-2">Fragen? Anregungen? Feedback?</p>
              <p>
                Schreib uns: <a href="mailto:info@deimudda.de" className="text-green-600 hover:underline font-semibold">info@deimudda.de</a>
              </p>
            </section>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: AdminDashboard.tsx

**`client/src/components/AdminDashboard.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { 
  Users, 
  Package, 
  DollarSign, 
  TrendingUp, 
  AlertTriangle,
  Shield,
  BarChart3,
  FileText,
  Settings
} from "lucide-react";
import { Link } from "wouter";
import BackButton from "@/components/BackButton";

export default function AdminDashboard() {
  const { user } = useAuth();
  const { data: stats } = trpc.admin.getStats.useQuery(undefined, { staleTime: 300000 });

  // Check if user is admin or super_admin
  if (!user || (user.role !== 'admin' && user.role !== 'super_admin')) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf das Admin-Dashboard zuzugreifen.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/profile" label="Zurück zum Profil" />
      {/* Header */}
      <div className="mb-8">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Admin-Dashboard</h1>
            <p className="text-gray-600 mt-2">
              Willkommen, {user.name}
              {user.role === 'super_admin' ? (
                <Badge className="ml-2 bg-purple-600">Super Admin</Badge>
              ) : user.role === 'admin' ? (
                <Badge className="ml-2 bg-blue-600">Admin</Badge>
              ) : null}
            </p>
          </div>
          <Shield className="h-12 w-12 text-purple-600" />
        </div>
      </div>

      {/* Quick Stats */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Gesamtumsatz</CardTitle>
            <DollarSign className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">
              €{stats?.totalRevenue?.toFixed(2) || '0.00'}
            </div>
            <p className="text-xs text-muted-foreground">
              Plattformgebühren: €{stats?.platformFees?.toFixed(2) || '0.00'}
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Transaktionen</CardTitle>
            <TrendingUp className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats?.totalTransactions || 0}</div>
            <p className="text-xs text-muted-foreground">
              Heute: {stats?.transactionsToday || 0}
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Nutzer</CardTitle>
            <Users className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats?.totalUsers || 0}</div>
            <p className="text-xs text-muted-foreground">
              Verkäufer: {stats?.totalSellers || 0}
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Aktive Listings</CardTitle>
            <Package className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats?.activeListings || 0}</div>
            <p className="text-xs text-muted-foreground">
              Gesamt: {stats?.totalListings || 0}
            </p>
          </CardContent>
        </Card>
      </div>

      {/* Warnings & Reports */}
      {stats && (stats.pendingReports > 0 || stats.warnedUsers > 0 || stats.suspendedUsers > 0) && (
        <Card className="mb-8 border-yellow-200 bg-yellow-50">
          <CardHeader>
            <CardTitle className="flex items-center text-yellow-800">
              <AlertTriangle className="h-5 w-5 mr-2" />
              Aktionen erforderlich
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-2">
              {stats.pendingReports > 0 && (
                <p className="text-yellow-700">
                  • {stats.pendingReports} offene Report(s) warten auf Bearbeitung
                </p>
              )}
              {stats.warnedUsers > 0 && (
                <p className="text-yellow-700">
                  • {stats.warnedUsers} verwarnte Nutzer
                </p>
              )}
              {stats.suspendedUsers > 0 && (
                <p className="text-yellow-700">
                  • {stats.suspendedUsers} gesperrte Nutzer
                </p>
              )}
            </div>
          </CardContent>
        </Card>
      )}

      {/* Navigation Cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <Link href="/admin/users">
          <Card className="cursor-pointer hover:shadow-lg transition-shadow">
            <CardHeader>
              <CardTitle className="flex items-center">
                <Users className="h-5 w-5 mr-2" />
                Nutzer-Verwaltung
              </CardTitle>
              <CardDescription>
                Nutzer verwalten, verwarnen, sperren oder bannen
              </CardDescription>
            </CardHeader>
          </Card>
        </Link>

        <Link href="/admin/transactions">
          <Card className="cursor-pointer hover:shadow-lg transition-shadow">
            <CardHeader>
              <CardTitle className="flex items-center">
                <DollarSign className="h-5 w-5 mr-2" />
                Transaktionen
              </CardTitle>
              <CardDescription>
                Alle Plattform-Transaktionen und Gebühren einsehen
              </CardDescription>
            </CardHeader>
          </Card>
        </Link>

        <Link href="/admin/listings">
          <Card className="cursor-pointer hover:shadow-lg transition-shadow">
            <CardHeader>
              <CardTitle className="flex items-center">
                <Package className="h-5 w-5 mr-2" />
                Listing-Moderation
              </CardTitle>
              <CardDescription>
                Listings prüfen, deaktivieren oder löschen
              </CardDescription>
            </CardHeader>
          </Card>
        </Link>

        <Link href="/admin/reports">
          <Card className="cursor-pointer hover:shadow-lg transition-shadow">
            <CardHeader>
              <CardTitle className="flex items-center">
                <AlertTriangle className="h-5 w-5 mr-2" />
                Reports
              </CardTitle>
              <CardDescription>
                Meldungen von Nutzern bearbeiten
              </CardDescription>
            </CardHeader>
          </Card>
        </Link>

        <Link href="/admin/stats">
          <Card className="cursor-pointer hover:shadow-lg transition-shadow">
            <CardHeader>
              <CardTitle className="flex items-center">
                <BarChart3 className="h-5 w-5 mr-2" />
                Statistiken
              </CardTitle>
              <CardDescription>
                Detaillierte Plattform-Statistiken und Charts
              </CardDescription>
            </CardHeader>
          </Card>
        </Link>

        <Link href="/admin/logs">
          <Card className="cursor-pointer hover:shadow-lg transition-shadow">
            <CardHeader>
              <CardTitle className="flex items-center">
                <FileText className="h-5 w-5 mr-2" />
                Admin-Logs
              </CardTitle>
              <CardDescription>
                Alle Admin-Aktionen einsehen (Audit Trail)
              </CardDescription>
            </CardHeader>
          </Card>
        </Link>

        <Link href="/admin/security">
          <Card className="cursor-pointer hover:shadow-lg transition-shadow">
            <CardHeader>
              <CardTitle className="flex items-center">
                <Shield className="h-5 w-5 mr-2" />
                Sicherheit & IPs
              </CardTitle>
              <CardDescription>
                IP-Blocking und Login-Sicherheit verwalten
              </CardDescription>
            </CardHeader>
          </Card>
        </Link>
      </div>

      {/* Super Admin Only Section */}
      {user.role === 'super_admin' && (
        <div className="mt-8">
          <Card className="border-purple-200 bg-purple-50">
            <CardHeader>
              <CardTitle className="text-purple-800">Super Admin Funktionen</CardTitle>
              <CardDescription className="text-purple-600">
                Nur für Super Admins verfügbar
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-2">
                <Link href="/admin/manage">
                  <Button variant="outline" className="w-full justify-start">
                    <Shield className="h-4 w-4 mr-2" />
                    Admins ernennen/entfernen
                  </Button>
                </Link>
                <Link href="/admin/admins">
                  <Button variant="outline" className="w-full justify-start">
                    <Users className="h-4 w-4 mr-2" />
                    Admin-Verwaltung
                  </Button>
                </Link>
                <Link href="/admin/settings">
                  <Button variant="outline" className="w-full justify-start">
                    <BarChart3 className="h-4 w-4 mr-2" />
                    System-Einstellungen
                  </Button>
                </Link>

              </div>
            </CardContent>
          </Card>
        </div>
      )}
    </div>
  );
}

```

#### Schritt 5.x: AdminListings.tsx

**`client/src/components/AdminListings.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import type { Listing } from "@/../../shared/types";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from "@/components/ui/dialog";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { Package, Search, Filter, Ban, CheckCircle, Trash2, Eye } from "lucide-react";
import BackButton from "@/components/BackButton";
import { toast } from "sonner";

export default function AdminListings() {
  const { user } = useAuth();
  const { data: listings, refetch } = trpc.listing.getAll.useQuery(undefined, { staleTime: 60000 });
  
  // Mutations
  const blockListingMutation = trpc.admin.blockListing.useMutation({
    onSuccess: () => {
      toast.success("Listing erfolgreich gesperrt");
      refetch();
      setBlockDialogOpen(false);
    },
    onError: (error) => {
      toast.error(`Fehler: ${error.message}`);
    },
  });
  
  const unblockListingMutation = trpc.admin.unblockListing.useMutation({
    onSuccess: () => {
      toast.success("Listing-Sperrung aufgehoben");
      refetch();
    },
    onError: (error) => {
      toast.error(`Fehler: ${error.message}`);
    },
  });
  
  const deleteListingMutation = trpc.admin.deleteListing.useMutation({
    onSuccess: () => {
      toast.success("Listing erfolgreich gelöscht");
      refetch();
      setDeleteDialogOpen(false);
    },
    onError: (error) => {
      toast.error(`Fehler: ${error.message}`);
    },
  });
  
  const [searchQuery, setSearchQuery] = useState("");
  const [statusFilter, setStatusFilter] = useState<string>("all");
  const [typeFilter, setTypeFilter] = useState<string>("all");
  
  const [blockDialogOpen, setBlockDialogOpen] = useState(false);
  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);
  const [selectedListing, setSelectedListing] = useState<any>(null);
  const [reason, setReason] = useState("");

  // Check if user is admin
  if (!user || (user.role !== 'admin' && user.role !== 'super_admin')) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf die Listing-Moderation zuzugreifen.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  // Filter listings
  const filteredListings = listings?.filter((listing: Listing) => {
    const matchesSearch = searchQuery === "" || 
      listing.strain?.toLowerCase().includes(searchQuery.toLowerCase()) ||
      listing.description?.toLowerCase().includes(searchQuery.toLowerCase());
    
    const matchesStatus = statusFilter === "all" || listing.status === statusFilter;
    const matchesType = typeFilter === "all" || listing.priceType === typeFilter;
    
    return matchesSearch && matchesStatus && matchesType;
  });

  const getStatusBadge = (status: string) => {
    const badges: Record<string, { label: string; className: string }> = {
      active: { label: "Aktiv", className: "bg-green-100 text-green-800" },
      sold: { label: "Verkauft", className: "bg-blue-100 text-blue-800" },
      blocked: { label: "Gesperrt", className: "bg-red-100 text-red-800" },
      deleted: { label: "Gelöscht", className: "bg-gray-100 text-gray-800" },
    };
    
    const badge = badges[status] || { label: status, className: "bg-gray-100 text-gray-800" };
    return <Badge className={badge.className}>{badge.label}</Badge>;
  };

  const getPriceTypeBadge = (type: string) => {
    const badges: Record<string, { label: string; className: string }> = {
      fixed: { label: "Festpreis", className: "bg-blue-100 text-blue-800" },
      auction: { label: "Auktion", className: "bg-purple-100 text-purple-800" },
      offer: { label: "Preisvorschlag", className: "bg-green-100 text-green-800" },
    };
    
    const badge = badges[type] || { label: type, className: "bg-gray-100 text-gray-800" };
    return <Badge variant="outline" className={badge.className}>{badge.label}</Badge>;
  };

  const handleBlockListing = (listing: Listing) => {
    setSelectedListing(listing);
    setReason("");
    setBlockDialogOpen(true);
  };

  const handleDeleteListing = (listing: Listing) => {
    setSelectedListing(listing);
    setReason("");
    setDeleteDialogOpen(true);
  };

  const submitBlock = () => {
    if (!reason.trim()) {
      toast.error("Bitte geben Sie einen Grund an");
      return;
    }
    
    if (!selectedListing) return;
    
    blockListingMutation.mutate({
      listingId: selectedListing.id,
      reason: reason,
    });
  };

  const submitDelete = () => {
    if (!reason.trim()) {
      toast.error("Bitte geben Sie einen Grund an");
      return;
    }
    
    if (!selectedListing) return;
    
    deleteListingMutation.mutate({
      listingId: selectedListing.id,
      reason: reason,
    });
  };

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/admin" label="Zurück zum Dashboard" />
      
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-4">
          <Package className="h-8 w-8 text-yellow-600" />
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Listing-Moderation</h1>
            <p className="text-gray-600">Überwachen und moderieren Sie alle Listings</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Gesamt</CardDescription>
            <CardTitle className="text-2xl">{listings?.length || 0}</CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Aktiv</CardDescription>
            <CardTitle className="text-2xl text-green-600">
              {listings?.filter((l: Listing) => l.status === 'active').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Verkauft</CardDescription>
            <CardTitle className="text-2xl text-blue-600">
              {listings?.filter((l: Listing) => l.status === 'sold').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Entwurf</CardDescription>
            <CardTitle className="text-2xl text-gray-600">
              {listings?.filter((l: Listing) => l.status === 'draft').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
      </div>

      {/* Filters */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Filter className="h-5 w-5" />
            Filter & Suche
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label className="text-sm font-medium mb-2 block">Suche</label>
              <div className="relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" />
                <Input
                  placeholder="Titel, Strain..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className="pl-10"
                />
              </div>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Status</label>
              <Select value={statusFilter} onValueChange={setStatusFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle Status</SelectItem>
                  <SelectItem value="active">Aktiv</SelectItem>
                  <SelectItem value="sold">Verkauft</SelectItem>
                  <SelectItem value="blocked">Gesperrt</SelectItem>
                  <SelectItem value="deleted">Gelöscht</SelectItem>
                </SelectContent>
              </Select>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Preistyp</label>
              <Select value={typeFilter} onValueChange={setTypeFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle Typen</SelectItem>
                  <SelectItem value="fixed">Festpreis</SelectItem>
                  <SelectItem value="auction">Auktion</SelectItem>
                  <SelectItem value="offer">Preisvorschlag</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
          
          <div className="mt-4 flex gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={() => {
                setSearchQuery("");
                setStatusFilter("all");
                setTypeFilter("all");
              }}
            >
              Zurücksetzen
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Listings List */}
      <div className="space-y-4">
        {filteredListings && filteredListings.length > 0 ? (
          filteredListings.map((listing: Listing) => (
            <Card key={listing.id}>
              <CardContent className="pt-6">
                <div className="flex items-start gap-4">
                  {listing.imageUrl && (
                    <img 
                      src={listing.imageUrl} 
                      alt={listing.strain}
                      className="w-24 h-24 object-cover rounded-lg"
                    />
                  )}
                  
                  <div className="flex-1">
                    <div className="flex items-start justify-between mb-2">
                      <div>
                        <div className="flex items-center gap-2 mb-1">
                          <h3 className="text-lg font-semibold">{listing.strain}</h3>
                          {getStatusBadge(listing.status)}
                          {getPriceTypeBadge(listing.priceType)}
                        </div>
                        <p className="text-sm text-gray-600">{listing.type === 'cutting' ? 'Steckling' : 'Samen'}</p>
                      </div>
                      <div className="text-right">
                        <p className="text-lg font-bold text-green-600">
                          {listing.priceType === 'fixed' && listing.fixedPrice ? `€${Number(listing.fixedPrice).toFixed(2)}` : 
                           listing.priceType === 'auction' && listing.auctionStartPrice ? `Start: €${Number(listing.auctionStartPrice).toFixed(2)}` : 'N/A'}
                        </p>
                      </div>
                    </div>
                    
                    <p className="text-sm text-gray-700 mb-3 line-clamp-2">
                      {listing.description}
                    </p>
                    
                    <div className="flex items-center justify-between">
                      <div className="text-sm text-gray-500">
                        <span>ID: {listing.id}</span>
                        <span className="mx-2">•</span>
                        <span>Verkäufer-ID: {listing.sellerId}</span>
                        <span className="mx-2">•</span>
                        <span>Erstellt: {new Date(listing.createdAt).toLocaleDateString('de-DE')}</span>
                      </div>
                      
                      <div className="flex gap-2">
                        <Button
                          size="sm"
                          variant="outline"
                          onClick={() => window.open(`/listing/${listing.id}`, '_blank')}
                        >
                          <Eye className="h-4 w-4 mr-1" />
                          Ansehen
                        </Button>
                        
                        {listing.status === 'active' && (
                          <Button
                            size="sm"
                            variant="outline"
                            onClick={() => handleBlockListing(listing)}
                            className="text-orange-600 border-orange-600 hover:bg-orange-50"
                          >
                            <Ban className="h-4 w-4 mr-1" />
                            Sperren
                          </Button>
                        )}
                        

                        {user.role === 'super_admin' && (
                          <Button
                            size="sm"
                            variant="outline"
                            onClick={() => handleDeleteListing(listing)}
                            className="text-red-600 border-red-600 hover:bg-red-50"
                          >
                            <Trash2 className="h-4 w-4 mr-1" />
                            Löschen
                          </Button>
                        )}
                      </div>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          ))
        ) : (
          <Card>
            <CardContent className="py-8">
              <p className="text-gray-500 text-center">Keine Listings gefunden</p>
            </CardContent>
          </Card>
        )}
      </div>

      {/* Block Dialog */}
      <Dialog open={blockDialogOpen} onOpenChange={setBlockDialogOpen}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Listing sperren</DialogTitle>
            <DialogDescription>
              Sperren Sie "{selectedListing?.title}" wegen Verstoß gegen die Richtlinien
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4">
            <div>
              <Label>Grund für Sperrung</Label>
              <Textarea
                placeholder="Erklären Sie, warum dieses Listing gesperrt wird..."
                value={reason}
                onChange={(e) => setReason(e.target.value)}
                rows={4}
              />
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setBlockDialogOpen(false)}>
              Abbrechen
            </Button>
            <Button onClick={submitBlock} className="bg-orange-600 hover:bg-orange-700">
              Listing sperren
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Delete Dialog */}
      <Dialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Listing löschen</DialogTitle>
            <DialogDescription>
              Löschen Sie "{selectedListing?.title}" permanent. Diese Aktion kann nicht rückgängig gemacht werden.
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4">
            <div>
              <Label>Grund für Löschung</Label>
              <Textarea
                placeholder="Erklären Sie, warum dieses Listing gelöscht wird..."
                value={reason}
                onChange={(e) => setReason(e.target.value)}
                rows={4}
              />
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setDeleteDialogOpen(false)}>
              Abbrechen
            </Button>
            <Button onClick={submitDelete} className="bg-red-600 hover:bg-red-700">
              Listing löschen
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  );
}

```

#### Schritt 5.x: AdminLogin.tsx

**`client/src/components/AdminLogin.tsx`**

```typescript
import { useEffect } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import { useLocation } from "wouter";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Shield, AlertTriangle } from "lucide-react";
import { getLoginUrl } from "@/const";

export default function AdminLogin() {
  const { user } = useAuth();
  const [, setLocation] = useLocation();

  // Redirect to admin dashboard if already logged in as super_admin
  useEffect(() => {
    if (user?.role === "super_admin") {
      setLocation("/admin");
    }
  }, [user, setLocation]);

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4">
      <Card className="w-full max-w-md">
        <CardHeader className="text-center">
          <div className="flex justify-center mb-4">
            <Shield className="h-16 w-16 text-blue-600" />
          </div>
          <CardTitle className="text-2xl font-bold">Administrator-Zugang</CardTitle>
          <CardDescription>
            Dieser Bereich ist nur für Super-Administratoren zugänglich
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          {/* Warning for maintenance mode */}
          <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
            <div className="flex items-start gap-3">
              <AlertTriangle className="h-5 w-5 text-yellow-600 mt-0.5 flex-shrink-0" />
              <div className="text-sm text-yellow-800">
                <p className="font-semibold mb-1">Wartungsmodus aktiv</p>
                <p>
                  Die Plattform befindet sich im Wartungsmodus. 
                  Nur Super-Administratoren können sich anmelden und auf das System zugreifen.
                </p>
              </div>
            </div>
          </div>

          {/* Login button */}
          <div className="space-y-4">
            {user ? (
              user.role === "super_admin" ? (
                <div className="text-center">
                  <p className="text-sm text-gray-600 mb-4">
                    Sie sind als Super-Administrator angemeldet.
                  </p>
                  <Button
                    onClick={() => setLocation("/admin")}
                    className="w-full"
                    size="lg"
                  >
                    Zum Admin-Dashboard
                  </Button>
                </div>
              ) : (
                <div className="text-center">
                  <p className="text-sm text-red-600 mb-4">
                    Sie sind als <strong>{user.name}</strong> angemeldet, haben aber keine Super-Administrator-Rechte.
                  </p>
                  <Button
                    onClick={() => setLocation("/maintenance")}
                    variant="outline"
                    className="w-full"
                  >
                    Zurück zur Wartungsseite
                  </Button>
                </div>
              )
            ) : (
              <Button
                onClick={() => window.location.href = getLoginUrl()}
                className="w-full"
                size="lg"
              >
                <Shield className="h-5 w-5 mr-2" />
                Als Administrator anmelden
              </Button>
            )}
          </div>

          {/* Info text */}
          <div className="text-center text-sm text-gray-500">
            <p>
              Nach erfolgreicher Anmeldung werden Sie automatisch zum Admin-Dashboard weitergeleitet.
            </p>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: AdminLogs.tsx

**`client/src/components/AdminLogs.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import type { AdminLog } from "@/../../shared/types";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { FileText, Search, Filter } from "lucide-react";
import BackButton from "@/components/BackButton";

export default function AdminLogs() {
  const { user } = useAuth();
  const { data: logs } = trpc.admin.getAdminLogs.useQuery(undefined, { staleTime: 60000 });
  
  const [searchQuery, setSearchQuery] = useState("");
  const [actionFilter, setActionFilter] = useState<string>("all");
  const [dateFilter, setDateFilter] = useState<string>("all");

  // Check if user is admin
  if (!user || (user.role !== 'admin' && user.role !== 'super_admin')) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf die Admin-Logs zuzugreifen.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  // Filter logs
  const filteredLogs = logs?.filter((log) => {
    // Search filter
    const matchesSearch = searchQuery === "" || 
      log.details?.toLowerCase().includes(searchQuery.toLowerCase()) ||
      log.adminName?.toLowerCase().includes(searchQuery.toLowerCase());
    
    // Action filter
    const matchesAction = actionFilter === "all" || log.action === actionFilter;
    
    // Date filter
    let matchesDate = true;
    if (dateFilter !== "all") {
      const logDate = new Date(log.createdAt);
      const now = new Date();
      const daysDiff = Math.floor((now.getTime() - logDate.getTime()) / (1000 * 60 * 60 * 24));
      
      switch (dateFilter) {
        case "today":
          matchesDate = daysDiff === 0;
          break;
        case "week":
          matchesDate = daysDiff <= 7;
          break;
        case "month":
          matchesDate = daysDiff <= 30;
          break;
      }
    }
    
    return matchesSearch && matchesAction && matchesDate;
  });

  const getActionBadge = (action: string) => {
    const badges: Record<string, { label: string; className: string }> = {
      warn_user: { label: "Verwarnung", className: "bg-yellow-100 text-yellow-800" },
      suspend_user: { label: "Sperrung", className: "bg-orange-100 text-orange-800" },
      ban_user: { label: "Bann", className: "bg-red-100 text-red-800" },
      remove_warning: { label: "Verwarnung aufgehoben", className: "bg-green-100 text-green-800" },
      promote_admin: { label: "Admin ernannt", className: "bg-purple-100 text-purple-800" },
      demote_admin: { label: "Admin entzogen", className: "bg-gray-100 text-gray-800" },
    };
    
    const badge = badges[action] || { label: action, className: "bg-gray-100 text-gray-800" };
    return <Badge className={badge.className}>{badge.label}</Badge>;
  };

  const getTargetTypeBadge = (type: string) => {
    const badges: Record<string, { label: string; className: string }> = {
      user: { label: "Nutzer", className: "bg-blue-100 text-blue-800" },
      listing: { label: "Listing", className: "bg-green-100 text-green-800" },
      transaction: { label: "Transaktion", className: "bg-purple-100 text-purple-800" },
    };
    
    const badge = badges[type] || { label: type, className: "bg-gray-100 text-gray-800" };
    return <Badge variant="outline" className={badge.className}>{badge.label}</Badge>;
  };

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/admin" label="Zurück zum Dashboard" />
      
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-4">
          <FileText className="h-8 w-8 text-pink-600" />
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Admin-Logs</h1>
            <p className="text-gray-600">Audit Trail aller Admin-Aktionen</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Gesamt</CardDescription>
            <CardTitle className="text-2xl">{logs?.length || 0}</CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Heute</CardDescription>
            <CardTitle className="text-2xl">
              {logs?.filter((l: AdminLog) => {
                const logDate = new Date(l.createdAt);
                const today = new Date();
                return logDate.toDateString() === today.toDateString();
              }).length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Diese Woche</CardDescription>
            <CardTitle className="text-2xl">
              {logs?.filter((l: AdminLog) => {
                const logDate = new Date(l.createdAt);
                const now = new Date();
                const daysDiff = Math.floor((now.getTime() - logDate.getTime()) / (1000 * 60 * 60 * 24));
                return daysDiff <= 7;
              }).length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Dieser Monat</CardDescription>
            <CardTitle className="text-2xl">
              {logs?.filter((l: AdminLog) => {
                const logDate = new Date(l.createdAt);
                const now = new Date();
                const daysDiff = Math.floor((now.getTime() - logDate.getTime()) / (1000 * 60 * 60 * 24));
                return daysDiff <= 30;
              }).length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
      </div>

      {/* Filters */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Filter className="h-5 w-5" />
            Filter & Suche
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label className="text-sm font-medium mb-2 block">Suche</label>
              <div className="relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" />
                <Input
                  placeholder="Details, Admin-Name..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className="pl-10"
                />
              </div>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Aktion</label>
              <Select value={actionFilter} onValueChange={setActionFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle Aktionen</SelectItem>
                  <SelectItem value="warn_user">Verwarnung</SelectItem>
                  <SelectItem value="suspend_user">Sperrung</SelectItem>
                  <SelectItem value="ban_user">Bann</SelectItem>
                  <SelectItem value="remove_warning">Verwarnung aufgehoben</SelectItem>
                  <SelectItem value="promote_admin">Admin ernannt</SelectItem>
                  <SelectItem value="demote_admin">Admin entzogen</SelectItem>
                </SelectContent>
              </Select>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Zeitraum</label>
              <Select value={dateFilter} onValueChange={setDateFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle</SelectItem>
                  <SelectItem value="today">Heute</SelectItem>
                  <SelectItem value="week">Diese Woche</SelectItem>
                  <SelectItem value="month">Dieser Monat</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
          
          <div className="mt-4 flex gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={() => {
                setSearchQuery("");
                setActionFilter("all");
                setDateFilter("all");
              }}
            >
              Zurücksetzen
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Logs List */}
      <Card>
        <CardHeader>
          <CardTitle>Aktivitäts-Log ({filteredLogs?.length || 0})</CardTitle>
        </CardHeader>
        <CardContent>
          {filteredLogs && filteredLogs.length > 0 ? (
            <div className="space-y-4">
              {filteredLogs.map((log: AdminLog) => (
                <div key={log.id} className="border rounded-lg p-4 hover:bg-gray-50 transition">
                  <div className="flex items-start justify-between">
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-2">
                        {getActionBadge(log.action)}
                        {getTargetTypeBadge(log.targetType)}
                        <span className="text-sm text-gray-500">
                          {new Date(log.createdAt).toLocaleDateString('de-DE', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                          })}
                        </span>
                      </div>
                      <p className="text-sm text-gray-700 mb-1">{log.details}</p>
                      <div className="flex items-center gap-4 text-xs text-gray-500">
                        <span>Admin: {log.adminName || 'Unbekannt'}</span>
                        <span>Ziel-ID: {log.targetId}</span>
                        <span>Log-ID: {log.id}</span>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <p className="text-gray-500 text-center py-8">Keine Logs gefunden</p>
          )}
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: AdminManage.tsx

**`client/src/components/AdminManage.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import type { User } from "@/../../shared/types";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Shield, UserPlus, UserMinus, Crown } from "lucide-react";
import BackButton from "@/components/BackButton";
import { toast } from "sonner";

export default function AdminManage() {
  const { user } = useAuth();
  const utils = trpc.useUtils();
  const { data: allUsers } = trpc.admin.getAllUsers.useQuery(undefined, { staleTime: 60000 });
  const { data: admins, refetch: refetchAdmins } = trpc.admin.getAllAdmins.useQuery(undefined, { staleTime: 60000 });
  
  // Mutations
  const promoteToAdminMutation = trpc.admin.promoteToAdmin.useMutation({
    onSuccess: () => {
      toast.success("Nutzer erfolgreich zum Admin ernannt");
      refetchAdmins();
      utils.auth.me.invalidate(); // Refresh session for affected user
    },
    onError: (error) => {
      toast.error(`Fehler: ${error.message}`);
    },
  });
  
  const demoteFromAdminMutation = trpc.admin.demoteFromAdmin.useMutation({
    onSuccess: () => {
      toast.success("Admin-Rechte erfolgreich entzogen");
      refetchAdmins();
      utils.auth.me.invalidate(); // Refresh session for affected user
    },
    onError: (error) => {
      toast.error(`Fehler: ${error.message}`);
    },
  });

  // Check if user is super admin
  if (!user || user.role !== 'super_admin') {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf die Admin-Verwaltung zuzugreifen. Nur Super-Admins können Admins ernennen oder entfernen.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  const getRoleBadge = (role: string) => {
    if (role === 'super_admin') {
      return <Badge className="bg-purple-100 text-purple-800"><Crown className="h-3 w-3 mr-1 inline" />Super Admin</Badge>;
    }
    if (role === 'admin') {
      return <Badge className="bg-blue-100 text-blue-800"><Shield className="h-3 w-3 mr-1 inline" />Admin</Badge>;
    }
    return <Badge variant="outline">User</Badge>;
  };

  const handlePromote = (userId: number) => {
    if (confirm("Möchten Sie diesen Nutzer wirklich zum Admin ernennen?")) {
      promoteToAdminMutation.mutate(userId);
    }
  };

  const handleDemote = (userId: number) => {
    if (confirm("Möchten Sie diesem Nutzer wirklich die Admin-Rechte entziehen?")) {
      demoteFromAdminMutation.mutate(userId);
    }
  };

  // Get regular users (for promotion)
  const regularUsers = allUsers?.filter((u: User) => u.role === 'user') || [];

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/admin" label="Zurück zum Dashboard" />
      
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-4">
          <Shield className="h-8 w-8 text-purple-600" />
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Admin-Verwaltung</h1>
            <p className="text-gray-600">Verwalten Sie Admin-Rechte (nur Super Admin)</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Super Admins</CardDescription>
            <CardTitle className="text-2xl text-purple-600">
              {admins?.filter((a: User) => a.role === 'super_admin').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Admins</CardDescription>
            <CardTitle className="text-2xl text-blue-600">
              {admins?.filter((a: User) => a.role === 'admin').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Gesamt</CardDescription>
            <CardTitle className="text-2xl">
              {admins?.length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
      </div>

      {/* Current Admins */}
      <Card className="mb-8">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Shield className="h-5 w-5" />
            Aktuelle Admins
          </CardTitle>
          <CardDescription>Alle Nutzer mit Admin- oder Super-Admin-Rechten</CardDescription>
        </CardHeader>
        <CardContent>
          {admins && admins.length > 0 ? (
            <div className="space-y-4">
              {admins.map((admin) => (
                <div key={admin.id} className="flex items-center justify-between p-4 border rounded-lg">
                  <div className="flex-1">
                    <div className="flex items-center gap-3 mb-2">
                      <h3 className="text-lg font-semibold">{admin.name || 'Unbekannt'}</h3>
                      {getRoleBadge(admin.role)}
                    </div>
                    <div className="space-y-1 text-sm text-gray-600">
                      <p><span className="font-medium">ID:</span> {admin.id}</p>
                      <p><span className="font-medium">Email:</span> {admin.email || 'Keine Email'}</p>
                      <p><span className="font-medium">Erstellt:</span> {new Date(admin.createdAt).toLocaleDateString('de-DE')}</p>
                      <p><span className="font-medium">Letzter Login:</span> {new Date(admin.lastSignedIn).toLocaleDateString('de-DE')}</p>
                    </div>
                  </div>
                  
                  <div className="flex flex-col gap-2">
                    {admin.role === 'admin' && admin.id !== user.id && (
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() => handleDemote(admin.id)}
                        className="text-red-600 border-red-600 hover:bg-red-50"
                      >
                        <UserMinus className="h-4 w-4 mr-1" />
                        Rechte entziehen
                      </Button>
                    )}
                    
                    {admin.role === 'super_admin' && (
                      <Badge className="bg-purple-100 text-purple-800">
                        Kann nicht geändert werden
                      </Badge>
                    )}
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <p className="text-gray-500 text-center py-4">Keine Admins gefunden</p>
          )}
        </CardContent>
      </Card>

      {/* Promote Users */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <UserPlus className="h-5 w-5" />
            Nutzer zu Admin ernennen
          </CardTitle>
          <CardDescription>Wählen Sie einen Nutzer aus, um ihn zum Admin zu ernennen</CardDescription>
        </CardHeader>
        <CardContent>
          {regularUsers.length > 0 ? (
            <div className="space-y-3 max-h-96 overflow-y-auto">
              {regularUsers.map((u: User) => (
                <div key={u.id} className="flex items-center justify-between p-3 border rounded-lg">
                  <div>
                    <p className="font-medium">{u.name || 'Unbekannt'}</p>
                    <p className="text-sm text-gray-600">ID: {u.id} • {u.email || 'Keine Email'}</p>
                  </div>
                  <Button
                    size="sm"
                    onClick={() => handlePromote(u.id)}
                    className="bg-blue-600 hover:bg-blue-700"
                  >
                    <UserPlus className="h-4 w-4 mr-1" />
                    Zum Admin ernennen
                  </Button>
                </div>
              ))}
            </div>
          ) : (
            <p className="text-gray-500 text-center py-4">Keine Nutzer zum Ernennen verfügbar</p>
          )}
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: AdminManagement.tsx

**`client/src/components/AdminManagement.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import type { User } from "@/../../shared/types";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { trpc } from "@/lib/trpc";
import { Link } from "wouter";
import { ArrowLeft, UserPlus, UserMinus, Shield, Users } from "lucide-react";
import { toast } from "sonner";
import BackButton from "@/components/BackButton";
import { formatDistanceToNow } from "date-fns";
import { de } from "date-fns/locale";

export default function AdminManagement() {
  const { user, isAuthenticated } = useAuth();
  const utils = trpc.useUtils();

  const { data: admins = [], isLoading } = trpc.admin.getAllAdmins.useQuery();

  const promoteToAdmin = trpc.admin.promoteToAdmin.useMutation({
    onSuccess: () => {
      toast.success("Benutzer wurde zum Admin befördert!");
      utils.admin.getAllAdmins.invalidate();
    },
    onError: (error) => {
      console.error("[AdminManagement] Promote error:", error);
      toast.error("Fehler: " + error.message);
    },
  });

  const demoteAdmin = trpc.admin.demoteFromAdmin.useMutation({
    onSuccess: () => {
      toast.success("Admin-Rechte entzogen!");
      utils.admin.getAllAdmins.invalidate();
    },
    onError: (error) => {
      console.error("[AdminManagement] Demote error:", error);
      toast.error("Fehler: " + error.message);
    },
  });

  if (!isAuthenticated || (user?.role !== "superadmin" && user?.role !== "super_admin")) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center">
        <Card className="max-w-md">
          <CardHeader>
            <CardTitle>Zugriff verweigert</CardTitle>
            <CardDescription>Nur Super-Admins haben Zugriff.</CardDescription>
          </CardHeader>
          <CardContent>
            <Link href="/"><Button>Zur Startseite</Button></Link>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <BackButton href="/admin" label="Zurück zum Dashboard" />
        <div className="mb-8">
          <div className="flex items-center gap-3 mb-2">
            <Shield className="h-8 w-8 text-purple-600" />
            <h1 className="text-3xl font-bold">Admin-Verwaltung</h1>
          </div>
          <p className="text-gray-600">Verwalten Sie Administrator-Rechte.</p>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Gesamt Admins</CardTitle>
              <Users className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">{admins.length}</div>
            </CardContent>
          </Card>
          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Super Admins</CardTitle>
              <Shield className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">{admins.filter(a => a.role === "superadmin" || a.role === "super_admin").length}</div>
            </CardContent>
          </Card>
          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Reguläre Admins</CardTitle>
              <UserPlus className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">{admins.filter(a => a.role === "admin").length}</div>
            </CardContent>
          </Card>
        </div>

        <Card>
          <CardHeader>
            <CardTitle>Alle Administratoren</CardTitle>
            <CardDescription>Liste aller Benutzer mit Admin-Rechten</CardDescription>
          </CardHeader>
          <CardContent>
            {isLoading ? (
              <div className="text-center py-12"><p className="text-muted-foreground">Lädt...</p></div>
            ) : admins.length === 0 ? (
              <div className="text-center py-12"><p className="text-muted-foreground">Keine Admins gefunden.</p></div>
            ) : (
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead>
                    <tr className="border-b">
                      <th className="text-left py-3 px-4">Benutzer</th>
                      <th className="text-left py-3 px-4">Rolle</th>
                      <th className="text-left py-3 px-4">Status</th>
                      <th className="text-left py-3 px-4">Letzter Login</th>
                      <th className="text-right py-3 px-4">Aktionen</th>
                    </tr>
                  </thead>
                  <tbody>
                    {admins.map((admin) => (
                      <tr key={admin.id} className="border-b hover:bg-gray-50">
                        <td className="py-4 px-4">
                          <div>
                            <p className="font-medium">{admin.nickname || admin.name || "Unbekannt"}</p>
                            <p className="text-sm text-gray-500">{admin.email}</p>
                          </div>
                        </td>
                        <td className="py-4 px-4">
                          {admin.role === "superadmin" || admin.role === "super_admin" ? (
                            <Badge className="bg-purple-600"><Shield className="h-3 w-3 mr-1" />Super Admin</Badge>
                          ) : (
                            <Badge variant="secondary"><UserPlus className="h-3 w-3 mr-1" />Admin</Badge>
                          )}
                        </td>
                        <td className="py-4 px-4">
                          {admin.status === "active" ? (
                            <Badge variant="outline" className="bg-green-50 text-green-700">Aktiv</Badge>
                          ) : admin.status === "warned" ? (
                            <Badge variant="outline" className="bg-yellow-50 text-yellow-700">Verwarnt</Badge>
                          ) : admin.status === "suspended" ? (
                            <Badge variant="outline" className="bg-orange-50 text-orange-700">Gesperrt</Badge>
                          ) : (
                            <Badge variant="outline" className="bg-red-50 text-red-700">Gebannt</Badge>
                          )}
                        </td>
                        <td className="py-4 px-4 text-sm text-gray-600">
                          {admin.lastSignedIn ? formatDistanceToNow(new Date(admin.lastSignedIn), { addSuffix: true, locale: de }) : "Nie"}
                        </td>
                        <td className="py-4 px-4 text-right">
                          {admin.role === "superadmin" || admin.role === "super_admin" ? (
                            <span className="text-sm text-gray-400">Keine Aktionen</span>
                          ) : (
                            <Button size="sm" variant="destructive" onClick={() => {
                              if (confirm("Admin-Rechte entziehen?")) demoteAdmin.mutate(admin.id);
                            }} disabled={demoteAdmin.isPending}>
                              <UserMinus className="h-4 w-4 mr-1" />Degradieren
                            </Button>
                          )}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
```

#### Schritt 5.x: AdminReports.tsx

**`client/src/components/AdminReports.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import type { Report } from "@/../../shared/types";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { AlertTriangle, Search, Filter, Eye, CheckCircle, XCircle } from "lucide-react";
import BackButton from "@/components/BackButton";
import { toast } from "sonner";

export default function AdminReports() {
  const { user } = useAuth();
  const { data: reports, refetch } = trpc.admin.getAllReports.useQuery(undefined, { staleTime: 60000 });
  
  const [searchQuery, setSearchQuery] = useState("");
  const [statusFilter, setStatusFilter] = useState<string>("all");
  const [typeFilter, setTypeFilter] = useState<string>("all");
  
  // Mutations
  const updateStatusMutation = trpc.admin.updateReportStatus.useMutation({
    onSuccess: () => {
      toast.success("Report-Status aktualisiert");
      refetch();
    },
    onError: (error) => {
      toast.error(`Fehler: ${error.message}`);
    },
  });

  // Check if user is admin
  if (!user || (user.role !== 'admin' && user.role !== 'super_admin')) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf die Report-Verwaltung zuzugreifen.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  // Filter reports
  const filteredReports = reports?.filter((report) => {
    const matchesSearch = searchQuery === "" || 
      report.reporterName?.toLowerCase().includes(searchQuery.toLowerCase()) ||
      report.description?.toLowerCase().includes(searchQuery.toLowerCase());
    
    const matchesStatus = statusFilter === "all" || report.status === statusFilter;
    const matchesType = typeFilter === "all" || report.targetType === typeFilter;
    
    return matchesSearch && matchesStatus && matchesType;
  });

  const getStatusBadge = (status: string) => {
    const badges: Record<string, { label: string; className: string }> = {
      pending: { label: "Ausstehend", className: "bg-yellow-100 text-yellow-800" },
      reviewing: { label: "In Bearbeitung", className: "bg-blue-100 text-blue-800" },
      resolved: { label: "Gelöst", className: "bg-green-100 text-green-800" },
      dismissed: { label: "Abgelehnt", className: "bg-gray-100 text-gray-800" },
    };
    
    const badge = badges[status] || { label: status, className: "bg-gray-100 text-gray-800" };
    return <Badge className={badge.className}>{badge.label}</Badge>;
  };

  const getTypeBadge = (type: string) => {
    const badges: Record<string, { label: string; className: string }> = {
      user: { label: "Nutzer", className: "bg-purple-100 text-purple-800" },
      listing: { label: "Listing", className: "bg-blue-100 text-blue-800" },
      review: { label: "Bewertung", className: "bg-green-100 text-green-800" },
    };
    
    const badge = badges[type] || { label: type, className: "bg-gray-100 text-gray-800" };
    return <Badge variant="outline" className={badge.className}>{badge.label}</Badge>;
  };

  const getReasonLabel = (reason: string) => {
    const reasons: Record<string, string> = {
      spam: "Spam",
      inappropriate: "Unangemessener Inhalt",
      fraud: "Betrug",
      harassment: "Belästigung",
      fake: "Fake/Falsch",
      illegal: "Illegal",
      other: "Sonstiges",
    };
    return reasons[reason] || reason;
  };

  const handleStatusChange = (reportId: number, newStatus: 'pending' | 'reviewing' | 'resolved' | 'dismissed') => {
    updateStatusMutation.mutate({
      reportId,
      status: newStatus,
    });
  };

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/admin" label="Zurück zum Dashboard" />
      
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-4">
          <AlertTriangle className="h-8 w-8 text-purple-600" />
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Report-Verwaltung</h1>
            <p className="text-gray-600">Bearbeiten Sie Nutzer-Meldungen</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Gesamt</CardDescription>
            <CardTitle className="text-2xl">{reports?.length || 0}</CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Ausstehend</CardDescription>
            <CardTitle className="text-2xl text-yellow-600">
              {reports?.filter((r: Report) => r.status === 'pending').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>In Bearbeitung</CardDescription>
            <CardTitle className="text-2xl text-blue-600">
              {reports?.filter((r: Report) => r.status === 'reviewing').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Gelöst</CardDescription>
            <CardTitle className="text-2xl text-green-600">
              {reports?.filter((r: Report) => r.status === 'resolved').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
      </div>

      {/* Filters */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Filter className="h-5 w-5" />
            Filter & Suche
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label className="text-sm font-medium mb-2 block">Suche</label>
              <div className="relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" />
                <Input
                  placeholder="Reporter, Beschreibung..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className="pl-10"
                />
              </div>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Status</label>
              <Select value={statusFilter} onValueChange={setStatusFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle Status</SelectItem>
                  <SelectItem value="pending">Ausstehend</SelectItem>
                  <SelectItem value="reviewing">In Bearbeitung</SelectItem>
                  <SelectItem value="resolved">Gelöst</SelectItem>
                  <SelectItem value="dismissed">Abgelehnt</SelectItem>
                </SelectContent>
              </Select>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Typ</label>
              <Select value={typeFilter} onValueChange={setTypeFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle Typen</SelectItem>
                  <SelectItem value="user">Nutzer</SelectItem>
                  <SelectItem value="listing">Listing</SelectItem>
                  <SelectItem value="review">Bewertung</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
          
          <div className="mt-4 flex gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={() => {
                setSearchQuery("");
                setStatusFilter("all");
                setTypeFilter("all");
              }}
            >
              Zurücksetzen
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Reports List */}
      <div className="space-y-4">
        {filteredReports && filteredReports.length > 0 ? (
          filteredReports.map((report: Report) => (
            <Card key={report.id}>
              <CardContent className="pt-6">
                <div className="flex items-start justify-between mb-4">
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-2">
                      <h3 className="text-lg font-semibold">
                        Report #{report.id}
                      </h3>
                      {getStatusBadge(report.status)}
                    </div>
                    
                    <div className="space-y-2 text-sm text-gray-700">
                      <p><span className="font-medium">Grund:</span> {getReasonLabel(report.reason)}</p>
                      <p><span className="font-medium">Nachricht:</span> {report.message || 'Keine Nachricht'}</p>
                      <p><span className="font-medium">Reporter:</span> ID: {report.reporterId}</p>
                      <p><span className="font-medium">Ziel:</span> {report.reportedType} ID: {report.reportedId}</p>
                      <p><span className="font-medium">Erstellt:</span> {new Date(report.createdAt).toLocaleDateString('de-DE', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                      })}</p>
                      {report.reviewedAt && (
                        <p><span className="font-medium">Bearbeitet:</span> {new Date(report.reviewedAt).toLocaleDateString('de-DE', {
                          day: '2-digit',
                          month: '2-digit',
                          year: 'numeric',
                          hour: '2-digit',
                          minute: '2-digit'
                        })}</p>
                      )}
                    </div>
                  </div>
                  
                  <div className="flex flex-col gap-2">
                    {report.status === 'pending' && (
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() => handleStatusChange(report.id, 'reviewing')}
                        className="text-blue-600 border-blue-600 hover:bg-blue-50"
                      >
                        <Eye className="h-4 w-4 mr-1" />
                        Bearbeiten
                      </Button>
                    )}
                    
                    {report.status === 'pending' && (
                      <>
                        <Button
                          size="sm"
                          variant="outline"
                          onClick={() => handleStatusChange(report.id, 'resolved')}
                          className="text-green-600 border-green-600 hover:bg-green-50"
                        >
                          <CheckCircle className="h-4 w-4 mr-1" />
                          Lösen
                        </Button>
                        <Button
                          size="sm"
                          variant="outline"
                          onClick={() => handleStatusChange(report.id, 'dismissed')}
                          className="text-gray-600 border-gray-600 hover:bg-gray-50"
                        >
                          <XCircle className="h-4 w-4 mr-1" />
                          Ablehnen
                        </Button>
                      </>
                    )}
                    
                    {report.reportedType === 'listing' && (
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() => window.open(`/listing/${report.reportedId}`, '_blank')}
                      >
                        <Eye className="h-4 w-4 mr-1" />
                        Ansehen
                      </Button>
                    )}
                  </div>
                </div>
              </CardContent>
            </Card>
          ))
        ) : (
          <Card>
            <CardContent className="py-8">
              <p className="text-gray-500 text-center">Keine Reports gefunden</p>
            </CardContent>
          </Card>
        )}
      </div>
    </div>
  );
}

```

#### Schritt 5.x: AdminSecurity.tsx

**`client/src/components/AdminSecurity.tsx`**

```typescript
import { useState } from "react";
import { trpc } from "../lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "../components/ui/card";
import { Button } from "../components/ui/button";
import { Input } from "../components/ui/input";
import { Label } from "../components/ui/label";
import { Textarea } from "../components/ui/textarea";
import { Shield, Ban, CheckCircle, AlertTriangle } from "lucide-react";
import { useAuth } from "../_core/hooks/useAuth";

export default function AdminSecurity() {
  const { user } = useAuth();
  const [ipToBlock, setIpToBlock] = useState("");
  const [blockReason, setBlockReason] = useState("");

  // Queries
  const { data: suspiciousIPs, isLoading: loadingSuspicious, refetch: refetchSuspicious } = 
    trpc.admin.getSuspiciousIPs.useQuery();
  
  const { data: blockedIPs, isLoading: loadingBlocked, refetch: refetchBlocked } = 
    trpc.admin.getBlockedIPs.useQuery();

  // Mutations
  const blockIPMutation = trpc.admin.blockIP.useMutation({
    onSuccess: () => {
      alert("IP erfolgreich blockiert!");
      setIpToBlock("");
      setBlockReason("");
      refetchBlocked();
      refetchSuspicious();
    },
    onError: (error) => {
      alert(`Fehler beim Blockieren: ${error.message}`);
    },
  });

  const unblockIPMutation = trpc.admin.unblockIP.useMutation({
    onSuccess: () => {
      alert("IP erfolgreich entsperrt!");
      refetchBlocked();
    },
    onError: (error) => {
      alert(`Fehler beim Entsperren: ${error.message}`);
    },
  });

  const handleBlockIP = (ip: string, reason?: string) => {
    if (!confirm(`Möchten Sie die IP ${ip} wirklich blockieren?`)) return;
    blockIPMutation.mutate({ ipAddress: ip, reason: reason || blockReason });
  };

  const handleUnblockIP = (ip: string) => {
    if (!confirm(`Möchten Sie die IP ${ip} wirklich entsperren?`)) return;
    unblockIPMutation.mutate({ ipAddress: ip });
  };

  // Check if user is super admin
  if (!user || user.role !== 'super_admin') {
    return (
      <div className="container mx-auto py-8">
        <Card>
          <CardContent className="pt-6">
            <p className="text-red-600">Zugriff verweigert. Nur Super-Admins können diese Seite sehen.</p>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="container mx-auto py-8 space-y-6">
      <h1 className="text-3xl font-bold flex items-center gap-2">
        <Shield className="h-8 w-8" />
        Sicherheit & IP-Verwaltung
      </h1>

      {/* Manual IP Blocking */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Ban className="h-5 w-5" />
            IP manuell blockieren
          </CardTitle>
          <CardDescription>Blockiere eine IP-Adresse manuell</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <Label htmlFor="ipToBlock">IP-Adresse</Label>
            <Input
              id="ipToBlock"
              type="text"
              value={ipToBlock}
              onChange={(e) => setIpToBlock(e.target.value)}
              placeholder="192.168.1.1"
            />
          </div>
          <div>
            <Label htmlFor="blockReason">Grund (optional)</Label>
            <Textarea
              id="blockReason"
              value={blockReason}
              onChange={(e) => setBlockReason(e.target.value)}
              placeholder="Zu viele Login-Versuche, Spam, etc."
              rows={3}
            />
          </div>
          <Button
            onClick={() => handleBlockIP(ipToBlock)}
            disabled={!ipToBlock || blockIPMutation.isPending}
            variant="destructive"
          >
            <Ban className="h-4 w-4 mr-1" />
            IP blockieren
          </Button>
        </CardContent>
      </Card>

      {/* Suspicious IPs */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <AlertTriangle className="h-5 w-5 text-yellow-600" />
            Verdächtige IPs (letzte 24 Stunden)
          </CardTitle>
          <CardDescription>IPs mit vielen Login-Versuchen</CardDescription>
        </CardHeader>
        <CardContent>
          {loadingSuspicious ? (
            <p>Lade Daten...</p>
          ) : !suspiciousIPs || suspiciousIPs.length === 0 ? (
            <p className="text-gray-600">Keine verdächtigen IPs gefunden.</p>
          ) : (
            <div className="space-y-4">
              {suspiciousIPs.map((item) => (
                <div
                  key={item.ipAddress}
                  className="flex items-center justify-between p-4 border rounded-lg"
                >
                  <div>
                    <p className="font-semibold">{item.ipAddress}</p>
                    <p className="text-sm text-gray-600">
                      {item.attemptCount} Versuche | Letzter Versuch: {new Date(item.lastAttempt).toLocaleString('de-DE')}
                    </p>
                  </div>
                  <Button
                    onClick={() => handleBlockIP(item.ipAddress, `Zu viele Login-Versuche (${item.attemptCount})`)}
                    disabled={blockIPMutation.isPending}
                    variant="destructive"
                    size="sm"
                  >
                    <Ban className="h-4 w-4 mr-1" />
                    Blockieren
                  </Button>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>

      {/* Blocked IPs */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Ban className="h-5 w-5 text-red-600" />
            Blockierte IPs
          </CardTitle>
          <CardDescription>Aktuell gesperrte IP-Adressen</CardDescription>
        </CardHeader>
        <CardContent>
          {loadingBlocked ? (
            <p>Lade Daten...</p>
          ) : !blockedIPs || blockedIPs.length === 0 ? (
            <p className="text-gray-600">Keine blockierten IPs vorhanden.</p>
          ) : (
            <div className="space-y-4">
              {blockedIPs.map((item) => (
                <div
                  key={item.id}
                  className="flex items-center justify-between p-4 border rounded-lg"
                >
                  <div>
                    <p className="font-semibold">{item.ipAddress}</p>
                    <p className="text-sm text-gray-600">
                      Blockiert am: {new Date(item.blockedAt).toLocaleString('de-DE')}
                    </p>
                    {item.reason && (
                      <p className="text-sm text-gray-600 mt-1">
                        Grund: {item.reason}
                      </p>
                    )}
                  </div>
                  <Button
                    onClick={() => handleUnblockIP(item.ipAddress)}
                    disabled={unblockIPMutation.isPending}
                    variant="outline"
                    size="sm"
                    className="text-green-600 border-green-600 hover:bg-green-50"
                  >
                    <CheckCircle className="h-4 w-4 mr-1" />
                    Entsperren
                  </Button>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: AdminSettings.tsx

**`client/src/components/AdminSettings.tsx`**

```typescript
import { useState, useEffect } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Settings, Save, DollarSign, Image, TrendingUp, AlertTriangle } from "lucide-react";
import BackButton from "@/components/BackButton";
import { toast } from "sonner";

export default function AdminSettings() {
  const { user } = useAuth();
  const { data: settings, refetch } = trpc.admin.getSystemSettings.useQuery(undefined, { staleTime: 300000 });
  
  // All useState initialized with empty strings - values loaded from database
  const [platformFee, setPlatformFee] = useState("");
  const [maxImages, setMaxImages] = useState("");
  const [maxPrice, setMaxPrice] = useState("");
  const [maintenanceMode, setMaintenanceMode] = useState("");
  
  // New critical settings
  const [minPrice, setMinPrice] = useState("");
  const [maxActiveListings, setMaxActiveListings] = useState("");
  const [imageMaxSize, setImageMaxSize] = useState("");
  const [minAge, setMinAge] = useState("");
  const [reviewWindow, setReviewWindow] = useState("");
  const [warningThreshold, setWarningThreshold] = useState("");
  const [suspensionMaxDays, setSuspensionMaxDays] = useState("");
  const [registrationEnabled, setRegistrationEnabled] = useState("");
  
  // Rate limiting settings
  const [maxLoginAttemptsPerIP, setMaxLoginAttemptsPerIP] = useState("");
  const [maxLoginAttemptsPerUser, setMaxLoginAttemptsPerUser] = useState("");
  const [loginLockoutDuration, setLoginLockoutDuration] = useState("");
  const [loginRateLimitWindow, setLoginRateLimitWindow] = useState("");
  
  // Update mutation
  const updateSettingMutation = trpc.admin.updateSystemSetting.useMutation({
    onSuccess: () => {
      toast.success("Einstellung erfolgreich aktualisiert");
      refetch();
    },
    onError: (error) => {
      toast.error(`Fehler: ${error.message}`);
    },
  });

  // Load settings from database
  useEffect(() => {
    if (settings) {
      settings.forEach((setting: { key: string; value: string }) => {
        switch (setting.key) {
          case 'platform_fee_fixed':
            setPlatformFee(setting.value);
            break;
          case 'max_listing_images':
            setMaxImages(setting.value);
            break;
          case 'max_listing_price':
            setMaxPrice(setting.value);
            break;
          case 'maintenance_mode':
            setMaintenanceMode(setting.value);
            break;
          case 'min_listing_price':
            setMinPrice(setting.value);
            break;
          case 'max_active_listings_per_user':
            setMaxActiveListings(setting.value);
            break;
          case 'image_max_size_mb':
            setImageMaxSize(setting.value);
            break;
          case 'min_age_requirement':
            setMinAge(setting.value);
            break;
          case 'review_window_days':
            setReviewWindow(setting.value);
            break;
          case 'warning_threshold':
            setWarningThreshold(setting.value);
            break;
          case 'suspension_max_days':
            setSuspensionMaxDays(setting.value);
            break;
          case 'registration_enabled':
            setRegistrationEnabled(setting.value);
            break;
          case 'max_login_attempts_per_ip':
            setMaxLoginAttemptsPerIP(setting.value);
            break;
          case 'max_login_attempts_per_user':
            setMaxLoginAttemptsPerUser(setting.value);
            break;
          case 'login_lockout_duration_minutes':
            setLoginLockoutDuration(setting.value);
            break;
          case 'login_rate_limit_window_minutes':
            setLoginRateLimitWindow(setting.value);
            break;
        }
      });
    }
  }, [settings]);

  // Check if user is super admin
  if (!user || user.role !== 'super_admin') {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf die System-Einstellungen zuzugreifen. Nur Super-Admins können System-Einstellungen ändern.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  const handleSaveSetting = (key: string, value: string) => {
    updateSettingMutation.mutate({ key, value });
  };

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/admin" label="Zurück zum Dashboard" />
      
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-4">
          <Settings className="h-8 w-8 text-gray-600" />
          <div>
            <h1 className="text-3xl font-bold text-gray-900">System-Einstellungen</h1>
            <p className="text-gray-600">Konfigurieren Sie plattformweite Einstellungen (nur Super Admin)</p>
          </div>
        </div>
      </div>

      {/* Warning */}
      <Card className="mb-6 border-yellow-200 bg-yellow-50">
        <CardContent className="pt-6">
          <div className="flex items-start gap-3">
            <AlertTriangle className="h-5 w-5 text-yellow-600 mt-0.5" />
            <div>
              <h3 className="font-semibold text-yellow-800 mb-1">Vorsicht bei Änderungen</h3>
              <p className="text-sm text-yellow-700">
                Änderungen an diesen Einstellungen wirken sich auf die gesamte Plattform aus. 
                Bitte überprüfen Sie alle Werte sorgfältig, bevor Sie sie speichern.
              </p>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Platform Fees */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <DollarSign className="h-5 w-5" />
            Plattformgebühren
          </CardTitle>
          <CardDescription>Konfigurieren Sie die Gebührenstruktur</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <Label htmlFor="platformFee">Plattformgebühr (€)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="platformFee"
                type="number"
                step="0.01"
                min="0"
                max="1000"
                value={platformFee}
                onChange={(e) => setPlatformFee(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('platform_fee_fixed', platformFee)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: €{parseFloat(platformFee).toFixed(2)} feste Gebühr pro Transaktion
            </p>
          </div>
        </CardContent>
      </Card>

      {/* Listing Limits */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <TrendingUp className="h-5 w-5" />
            Listing-Limits
          </CardTitle>
          <CardDescription>Maximale Werte für Listings</CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          <div>
            <Label htmlFor="maxImages">Maximale Anzahl Bilder pro Listing</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="maxImages"
                type="number"
                min="1"
                max="50"
                value={maxImages}
                onChange={(e) => setMaxImages(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('max_listing_images', maxImages)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: {maxImages} Bilder
            </p>
          </div>

          <div>
            <Label htmlFor="minPrice">Minimaler Listing-Preis (€)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="minPrice"
                type="number"
                step="0.01"
                min="0"
                max="1000"
                value={minPrice}
                onChange={(e) => setMinPrice(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('min_listing_price', minPrice)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: €{parseFloat(minPrice).toFixed(2)} (verhindert Spam-Listings)
            </p>
          </div>

          <div>
            <Label htmlFor="maxPrice">Maximaler Listing-Preis (€)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="maxPrice"
                type="number"
                min="1"
                max="100000"
                value={maxPrice}
                onChange={(e) => setMaxPrice(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('max_listing_price', maxPrice)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: €{maxPrice}
            </p>
          </div>

          <div>
            <Label htmlFor="maxActiveListings">Max. aktive Listings pro Nutzer</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="maxActiveListings"
                type="number"
                min="1"
                max="1000"
                value={maxActiveListings}
                onChange={(e) => setMaxActiveListings(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('max_active_listings_per_user', maxActiveListings)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: {maxActiveListings} Listings (Spam-Schutz & Performance)
            </p>
          </div>
        </CardContent>
      </Card>

      {/* System Settings */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Settings className="h-5 w-5" />
            System-Einstellungen
          </CardTitle>
          <CardDescription>Technische Limits und Moderation</CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          <div>
            <Label htmlFor="imageMaxSize">Max. Bildgröße (MB)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="imageMaxSize"
                type="number"
                min="1"
                max="50"
                value={imageMaxSize}
                onChange={(e) => setImageMaxSize(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('image_max_size_mb', imageMaxSize)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: {imageMaxSize} MB (Performance & Storage)
            </p>
          </div>

          <div>
            <Label htmlFor="warningThreshold">Verwarnungs-Schwelle</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="warningThreshold"
                type="number"
                min="1"
                max="10"
                value={warningThreshold}
                onChange={(e) => setWarningThreshold(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('warning_threshold', warningThreshold)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: {warningThreshold} Verwarnungen vor automatischer Sperrung
            </p>
          </div>

          <div>
            <Label htmlFor="suspensionMaxDays">Max. Sperrdauer (Tage)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="suspensionMaxDays"
                type="number"
                min="1"
                max="3650"
                value={suspensionMaxDays}
                onChange={(e) => setSuspensionMaxDays(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('suspension_max_days', suspensionMaxDays)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: {suspensionMaxDays} Tage maximale Sperrung
            </p>
          </div>
        </CardContent>
      </Card>

      {/* Legal & Business Settings */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <AlertTriangle className="h-5 w-5" />
            Rechtliche & Geschäfts-Einstellungen
          </CardTitle>
          <CardDescription>Altersbeschränkungen und Bewertungsfenster</CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          <div>
            <Label htmlFor="minAge">Mindestalter</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="minAge"
                type="number"
                min="16"
                max="21"
                value={minAge}
                onChange={(e) => setMinAge(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('min_age_requirement', minAge)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: {minAge} Jahre (gesetzliche Anforderung)
            </p>
          </div>

          <div>
            <Label htmlFor="reviewWindow">Bewertungsfenster (Tage)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="reviewWindow"
                type="number"
                min="1"
                max="365"
                value={reviewWindow}
                onChange={(e) => setReviewWindow(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('review_window_days', reviewWindow)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: {reviewWindow} Tage nach Kauf können Bewertungen abgegeben werden
            </p>
          </div>
        </CardContent>
      </Card>

      {/* Feature Toggles */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Settings className="h-5 w-5" />
            Feature-Toggles
          </CardTitle>
          <CardDescription>Aktivieren oder deaktivieren Sie Plattform-Features</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="flex items-center justify-between p-4 border rounded-lg">
            <div>
              <h3 className="font-semibold mb-1">Registrierung</h3>
              <p className="text-sm text-gray-600">
                Status: <span className={registrationEnabled === 'true' ? 'text-green-600 font-semibold' : 'text-red-600 font-semibold'}>
                  {registrationEnabled === 'true' ? 'Aktiv' : 'Deaktiviert'}
                </span>
              </p>
            </div>
            <div className="flex gap-2">
              {registrationEnabled === 'true' ? (
                <Button
                  variant="destructive"
                  onClick={() => {
                    if (confirm("Möchten Sie neue Registrierungen wirklich deaktivieren?")) {
                      handleSaveSetting('registration_enabled', 'false');
                      setRegistrationEnabled('false');
                    }
                  }}
                  disabled={updateSettingMutation.isPending}
                >
                  <AlertTriangle className="h-4 w-4 mr-1" />
                  Deaktivieren
                </Button>
              ) : (
                <Button
                  variant="outline"
                  onClick={() => {
                    handleSaveSetting('registration_enabled', 'true');
                    setRegistrationEnabled('true');
                  }}
                  disabled={updateSettingMutation.isPending}
                  className="text-green-600 border-green-600 hover:bg-green-50"
                >
                  <Save className="h-4 w-4 mr-1" />
                  Aktivieren
                </Button>
              )}
            </div>
          </div>
          <p className="text-sm text-gray-600 mt-4">
            <strong>Hinweis:</strong> Wenn deaktiviert, können sich keine neuen Nutzer registrieren. 
            Bestehende Nutzer können sich weiterhin anmelden.
          </p>
        </CardContent>
      </Card>

      {/* Rate Limiting / Login Security */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Settings className="h-5 w-5" />
            Login-Sicherheit & Rate Limiting
          </CardTitle>
          <CardDescription>Schutz vor Brute-Force-Angriffen und zu vielen Login-Versuchen</CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          {/* Max Login Attempts per IP */}
          <div>
            <Label htmlFor="maxLoginAttemptsPerIP">Max. Login-Versuche pro IP</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="maxLoginAttemptsPerIP"
                type="number"
                value={maxLoginAttemptsPerIP}
                onChange={(e) => setMaxLoginAttemptsPerIP(e.target.value)}
                placeholder="10"
              />
              <Button
                onClick={() => handleSaveSetting('max_login_attempts_per_ip', maxLoginAttemptsPerIP)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-1">
              Maximale Anzahl an Login-Versuchen von derselben IP-Adresse im Zeitfenster. Empfohlen: 10
            </p>
          </div>

          {/* Max Login Attempts per User */}
          <div>
            <Label htmlFor="maxLoginAttemptsPerUser">Max. Login-Versuche pro User</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="maxLoginAttemptsPerUser"
                type="number"
                value={maxLoginAttemptsPerUser}
                onChange={(e) => setMaxLoginAttemptsPerUser(e.target.value)}
                placeholder="5"
              />
              <Button
                onClick={() => handleSaveSetting('max_login_attempts_per_user', maxLoginAttemptsPerUser)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-1">
              Maximale Anzahl an Login-Versuchen pro User im Zeitfenster. Empfohlen: 5
            </p>
          </div>

          {/* Lockout Duration */}
          <div>
            <Label htmlFor="loginLockoutDuration">Sperrdauer (Minuten)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="loginLockoutDuration"
                type="number"
                value={loginLockoutDuration}
                onChange={(e) => setLoginLockoutDuration(e.target.value)}
                placeholder="30"
              />
              <Button
                onClick={() => handleSaveSetting('login_lockout_duration_minutes', loginLockoutDuration)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-1">
              Dauer der temporären Sperrung nach Überschreitung der Limits. Empfohlen: 30 Minuten
            </p>
          </div>

          {/* Rate Limit Window */}
          <div>
            <Label htmlFor="loginRateLimitWindow">Zeitfenster (Minuten)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="loginRateLimitWindow"
                type="number"
                value={loginRateLimitWindow}
                onChange={(e) => setLoginRateLimitWindow(e.target.value)}
                placeholder="15"
              />
              <Button
                onClick={() => handleSaveSetting('login_rate_limit_window_minutes', loginRateLimitWindow)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-1">
              Zeitfenster für die Zählung der Login-Versuche. Empfohlen: 15 Minuten
            </p>
          </div>

          <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4">
            <p className="text-sm text-blue-800">
              <strong>Beispiel:</strong> Mit den Standardwerten (10/5/30/15) wird eine IP nach 10 Login-Versuchen in 15 Minuten 
              für 30 Minuten gesperrt. Ein User wird nach 5 Versuchen in 15 Minuten für 30 Minuten gesperrt.
            </p>
          </div>
        </CardContent>
      </Card>

      {/* Maintenance Mode */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <AlertTriangle className="h-5 w-5" />
            Wartungsmodus
          </CardTitle>
          <CardDescription>Plattform für Wartungsarbeiten deaktivieren</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="flex items-center justify-between p-4 border rounded-lg">
            <div>
              <h3 className="font-semibold mb-1">Wartungsmodus</h3>
              <p className="text-sm text-gray-600">
                Status: <span className={maintenanceMode === 'true' ? 'text-red-600 font-semibold' : 'text-green-600 font-semibold'}>
                  {maintenanceMode === 'true' ? 'AKTIV' : 'Inaktiv'}
                </span>
              </p>
            </div>
            <div className="flex gap-2">
              {maintenanceMode === 'false' ? (
                <Button
                  variant="destructive"
                  onClick={() => {
                    if (confirm("Möchten Sie den Wartungsmodus wirklich aktivieren? Die Plattform wird für normale Nutzer nicht mehr zugänglich sein.")) {
                      handleSaveSetting('maintenance_mode', 'true');
                      setMaintenanceMode('true');
                    }
                  }}
                  disabled={updateSettingMutation.isPending}
                >
                  <AlertTriangle className="h-4 w-4 mr-1" />
                  Aktivieren
                </Button>
              ) : (
                <Button
                  variant="outline"
                  onClick={() => {
                    handleSaveSetting('maintenance_mode', 'false');
                    setMaintenanceMode('false');
                  }}
                  disabled={updateSettingMutation.isPending}
                  className="text-green-600 border-green-600 hover:bg-green-50"
                >
                  <Save className="h-4 w-4 mr-1" />
                  Deaktivieren
                </Button>
              )}
            </div>
          </div>
          <p className="text-sm text-gray-600 mt-4">
            <strong>Hinweis:</strong> Im Wartungsmodus können nur Super-Admins auf die Plattform zugreifen. 
            Alle anderen Nutzer sehen eine Wartungsseite.
          </p>
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: AdminStats.tsx

**`client/src/components/AdminStats.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import { trpc } from "@/lib/trpc";
import type { Listing, Transaction } from "@/../../shared/types";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { BarChart3, TrendingUp, Users, Package, DollarSign, Star } from "lucide-react";
import BackButton from "@/components/BackButton";

export default function AdminStats() {
  const { user } = useAuth();
  const { data: listings } = trpc.listing.getAll.useQuery(undefined, { staleTime: 60000 });
  const { data: transactions } = trpc.transaction.getAll.useQuery(undefined, { staleTime: 60000 });
  
  const [timeRange, setTimeRange] = useState<string>("month");

  // Check if user is admin
  if (!user || (user.role !== 'admin' && user.role !== 'super_admin')) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf die Statistiken zuzugreifen.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  // Calculate stats
  const totalRevenue = transactions?.reduce((sum: number, tx: Transaction) => 
    tx.status === 'completed' ? sum + (Number(tx.totalAmount) || 0) : sum, 0) || 0;
  
  const totalFees = transactions?.reduce((sum: number, tx: Transaction) => 
    tx.status === 'completed' ? sum + (Number(tx.platformFee) || 0) : sum, 0) || 0;

  const activeListings = listings?.filter((l: Listing) => l.status === 'active').length || 0;
  const soldListings = listings?.filter((l: Listing) => l.status === 'sold').length || 0;

  // Calculate conversion rate
  const conversionRate = listings && listings.length > 0 
    ? ((soldListings / listings.length) * 100).toFixed(1) 
    : '0.0';

  // Get top strains
  const strainCounts: Record<string, number> = {};
  listings?.forEach((listing: Listing) => {
    if (listing.strain) {
      strainCounts[listing.strain] = (strainCounts[listing.strain] || 0) + 1;
    }
  });
  const topStrains = Object.entries(strainCounts)
    .sort(([, a], [, b]) => b - a)
    .slice(0, 10);

  // Get top price types
  const priceTypeCounts: Record<string, number> = {
    fixed: 0,
    auction: 0,
    offer: 0,
  };
  listings?.forEach((listing: Listing) => {
    if (listing.priceType) {
      priceTypeCounts[listing.priceType]++;
    }
  });

  // Calculate average listing price
  const avgPrice = listings && listings.length > 0
    ? (listings.reduce((sum: number, l: Listing) => sum + (parseFloat(l.fixedPrice || l.auctionStartPrice || "0")), 0) / listings.length).toFixed(2)
    : '0.00';

  // Get recent transactions (last 30 days)
  const thirtyDaysAgo = new Date();
  thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
  const recentTransactions = transactions?.filter((tx: Transaction) => 
    new Date(tx.createdAt) > thirtyDaysAgo
  ) || [];

  const recentRevenue = recentTransactions.reduce((sum: number, tx: Transaction) => 
    tx.status === 'completed' ? sum + (Number(tx.totalAmount) || 0) : sum, 0);

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/admin" label="Zurück zum Dashboard" />
      
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div className="flex items-center gap-3">
            <BarChart3 className="h-8 w-8 text-cyan-600" />
            <div>
              <h1 className="text-3xl font-bold text-gray-900">Statistiken & Analytics</h1>
              <p className="text-gray-600">Detaillierte Plattform-Statistiken</p>
            </div>
          </div>
          
          <Select value={timeRange} onValueChange={setTimeRange}>
            <SelectTrigger className="w-[180px]">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="week">Diese Woche</SelectItem>
              <SelectItem value="month">Dieser Monat</SelectItem>
              <SelectItem value="year">Dieses Jahr</SelectItem>
              <SelectItem value="all">Gesamt</SelectItem>
            </SelectContent>
          </Select>
        </div>
      </div>

      {/* Revenue Stats */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <Card>
          <CardHeader className="pb-3">
            <CardDescription className="flex items-center gap-1">
              <DollarSign className="h-4 w-4" />
              Gesamtumsatz
            </CardDescription>
            <CardTitle className="text-2xl text-green-600">
              €{totalRevenue.toFixed(2)}
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-xs text-gray-600">
              Letzte 30 Tage: €{recentRevenue.toFixed(2)}
            </p>
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader className="pb-3">
            <CardDescription className="flex items-center gap-1">
              <TrendingUp className="h-4 w-4" />
              Plattformgebühren
            </CardDescription>
            <CardTitle className="text-2xl text-blue-600">
              €{totalFees.toFixed(2)}
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-xs text-gray-600">
              {totalRevenue > 0 ? ((totalFees / totalRevenue) * 100).toFixed(1) : '0'}% vom Umsatz
            </p>
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader className="pb-3">
            <CardDescription className="flex items-center gap-1">
              <Package className="h-4 w-4" />
              Conversion Rate
            </CardDescription>
            <CardTitle className="text-2xl text-purple-600">
              {conversionRate}%
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-xs text-gray-600">
              {soldListings} von {listings?.length || 0} verkauft
            </p>
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader className="pb-3">
            <CardDescription className="flex items-center gap-1">
              <Star className="h-4 w-4" />
              Ø Listing-Preis
            </CardDescription>
            <CardTitle className="text-2xl text-orange-600">
              €{avgPrice}
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-xs text-gray-600">
              Über alle Listings
            </p>
          </CardContent>
        </Card>
      </div>

      {/* Listing Stats */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Package className="h-5 w-5" />
              Listing-Statistiken
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              <div className="flex items-center justify-between">
                <span className="text-sm font-medium">Aktive Listings</span>
                <span className="text-lg font-bold text-green-600">{activeListings}</span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-sm font-medium">Verkaufte Listings</span>
                <span className="text-lg font-bold text-blue-600">{soldListings}</span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-sm font-medium">Entwurf</span>
                <span className="text-lg font-bold text-gray-600">
                  {listings?.filter((l: Listing) => l.status === 'draft').length || 0}
                </span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-sm font-medium">Gesamt</span>
                <span className="text-lg font-bold">{listings?.length || 0}</span>
              </div>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <TrendingUp className="h-5 w-5" />
              Preistyp-Verteilung
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              <div className="flex items-center justify-between">
                <span className="text-sm font-medium">Festpreis</span>
                <span className="text-lg font-bold text-blue-600">{priceTypeCounts.fixed}</span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-sm font-medium">Auktionen</span>
                <span className="text-lg font-bold text-purple-600">{priceTypeCounts.auction}</span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-sm font-medium">Preisvorschläge</span>
                <span className="text-lg font-bold text-green-600">{priceTypeCounts.offer}</span>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Top Strains */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Star className="h-5 w-5" />
            Top 10 Strains
          </CardTitle>
          <CardDescription>Beliebteste Strains nach Anzahl der Listings</CardDescription>
        </CardHeader>
        <CardContent>
          {topStrains.length > 0 ? (
            <div className="space-y-3">
              {topStrains.map(([strain, count], index) => (
                <div key={strain} className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <span className="text-lg font-bold text-gray-400 w-6">#{index + 1}</span>
                    <span className="font-medium">{strain}</span>
                  </div>
                  <span className="text-sm text-gray-600">{count} Listings</span>
                </div>
              ))}
            </div>
          ) : (
            <p className="text-gray-500 text-center py-4">Keine Daten verfügbar</p>
          )}
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: AdminTransactions.tsx

**`client/src/components/AdminTransactions.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import type { Transaction } from "@/../../shared/types";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { CreditCard, Search, Filter, TrendingUp, DollarSign } from "lucide-react";
import BackButton from "@/components/BackButton";

export default function AdminTransactions() {
  const { user } = useAuth();
  const { data: transactions } = trpc.transaction.getAll.useQuery(undefined, { staleTime: 60000 });
  
  const [searchQuery, setSearchQuery] = useState("");
  const [statusFilter, setStatusFilter] = useState<string>("all");
  const [dateFilter, setDateFilter] = useState<string>("all");

  // Check if user is admin
  if (!user || (user.role !== 'admin' && user.role !== 'super_admin')) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf die Transaktions-Überwachung zuzugreifen.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  // Filter transactions
  const filteredTransactions = transactions?.filter((tx: Transaction) => {
    const matchesSearch = searchQuery === "" || 
      tx.id.toString().includes(searchQuery) ||
      tx.listingId.toString().includes(searchQuery);
    
    const matchesStatus = statusFilter === "all" || tx.status === statusFilter;
    
    let matchesDate = true;
    if (dateFilter !== "all") {
      const txDate = new Date(tx.createdAt);
      const now = new Date();
      const daysDiff = Math.floor((now.getTime() - txDate.getTime()) / (1000 * 60 * 60 * 24));
      
      switch (dateFilter) {
        case "today":
          matchesDate = daysDiff === 0;
          break;
        case "week":
          matchesDate = daysDiff <= 7;
          break;
        case "month":
          matchesDate = daysDiff <= 30;
          break;
      }
    }
    
    return matchesSearch && matchesStatus && matchesDate;
  });

  // Calculate stats
  const totalRevenue = transactions?.reduce((sum: number, tx: Transaction) => 
    tx.status === 'completed' ? sum + (Number(tx.totalAmount) || 0) : sum, 0) || 0;
  
  const totalFees = transactions?.reduce((sum: number, tx: Transaction) => 
    tx.status === 'completed' ? sum + (Number(tx.platformFee) || 0) : sum, 0) || 0;

  const getStatusBadge = (status: string) => {
    const badges: Record<string, { label: string; className: string }> = {
      pending: { label: "Ausstehend", className: "bg-yellow-100 text-yellow-800" },
      completed: { label: "Abgeschlossen", className: "bg-green-100 text-green-800" },
      cancelled: { label: "Storniert", className: "bg-gray-100 text-gray-800" },
      refunded: { label: "Erstattet", className: "bg-blue-100 text-blue-800" },
    };
    
    const badge = badges[status] || { label: status, className: "bg-gray-100 text-gray-800" };
    return <Badge className={badge.className}>{badge.label}</Badge>;
  };

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/admin" label="Zurück zum Dashboard" />
      
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-4">
          <CreditCard className="h-8 w-8 text-blue-600" />
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Transaktions-Überwachung</h1>
            <p className="text-gray-600">Überwachen Sie alle Zahlungen und Gebühren</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <Card>
          <CardHeader className="pb-3">
            <CardDescription className="flex items-center gap-1">
              <DollarSign className="h-4 w-4" />
              Gesamtumsatz
            </CardDescription>
            <CardTitle className="text-2xl text-green-600">
              €{totalRevenue.toFixed(2)}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription className="flex items-center gap-1">
              <TrendingUp className="h-4 w-4" />
              Plattformgebühren
            </CardDescription>
            <CardTitle className="text-2xl text-blue-600">
              €{totalFees.toFixed(2)}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Transaktionen</CardDescription>
            <CardTitle className="text-2xl">{transactions?.length || 0}</CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Abgeschlossen</CardDescription>
            <CardTitle className="text-2xl text-green-600">
              {transactions?.filter((t: Transaction) => t.status === 'completed').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
      </div>

      {/* Filters */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Filter className="h-5 w-5" />
            Filter & Suche
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label className="text-sm font-medium mb-2 block">Suche</label>
              <div className="relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" />
                <Input
                  placeholder="Transaktions-ID, Listing..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className="pl-10"
                />
              </div>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Status</label>
              <Select value={statusFilter} onValueChange={setStatusFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle Status</SelectItem>
                  <SelectItem value="pending">Ausstehend</SelectItem>
                  <SelectItem value="completed">Abgeschlossen</SelectItem>
                  <SelectItem value="cancelled">Storniert</SelectItem>
                  <SelectItem value="refunded">Erstattet</SelectItem>
                </SelectContent>
              </Select>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Zeitraum</label>
              <Select value={dateFilter} onValueChange={setDateFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle</SelectItem>
                  <SelectItem value="today">Heute</SelectItem>
                  <SelectItem value="week">Diese Woche</SelectItem>
                  <SelectItem value="month">Dieser Monat</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
          
          <div className="mt-4 flex gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={() => {
                setSearchQuery("");
                setStatusFilter("all");
                setDateFilter("all");
              }}
            >
              Zurücksetzen
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Transactions List */}
      <Card>
        <CardHeader>
          <CardTitle>Transaktionen ({filteredTransactions?.length || 0})</CardTitle>
        </CardHeader>
        <CardContent>
          {filteredTransactions && filteredTransactions.length > 0 ? (
            <div className="space-y-4">
              {filteredTransactions.map((tx: Transaction) => (
                <div key={tx.id} className="border rounded-lg p-4 hover:bg-gray-50 transition">
                  <div className="flex items-start justify-between mb-3">
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-2">
                        <h3 className="font-semibold">{tx.listingTitle || 'Unbekanntes Listing'}</h3>
                        {getStatusBadge(tx.status)}
                      </div>
                      <div className="text-sm text-gray-600 space-y-1">
                        <p>Transaktions-ID: {tx.id}</p>
                        <p>Käufer-ID: {tx.buyerId} | Verkäufer-ID: {tx.sellerId}</p>
                        <p>Listing-ID: {tx.listingId}</p>
                        <p>Datum: {new Date(tx.createdAt).toLocaleDateString('de-DE', {
                          day: '2-digit',
                          month: '2-digit',
                          year: 'numeric',
                          hour: '2-digit',
                          minute: '2-digit'
                        })}</p>
                      </div>
                    </div>
                    
                    <div className="text-right">
                      <div className="mb-2">
                        <p className="text-sm text-gray-600">Gesamtbetrag</p>
                        <p className="text-lg font-bold text-gray-900">
                          €{(tx.totalAmount || 0).toFixed(2)}
                        </p>
                      </div>
                      <div className="text-sm text-gray-600 space-y-1">
                        <p>Artikel: €{(tx.itemPrice || 0).toFixed(2)}</p>
                        <p>Versand: €{(tx.shippingCost || 0).toFixed(2)}</p>
                        <p className="text-blue-600 font-medium">
                          Gebühr: €{(tx.platformFee || 0).toFixed(2)}
                        </p>
                        <p className="text-green-600 font-medium">
                          Verkäufer: €{((tx.totalAmount || 0) - (tx.platformFee || 0)).toFixed(2)}
                        </p>
                      </div>
                    </div>
                  </div>
                  
                  {tx.paypalOrderId && (
                    <div className="text-xs text-gray-500 border-t pt-2">
                      PayPal Order ID: {tx.paypalOrderId}
                    </div>
                  )}
                </div>
              ))}
            </div>
          ) : (
            <p className="text-gray-500 text-center py-8">Keine Transaktionen gefunden</p>
          )}
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: AdminUsers.tsx

**`client/src/components/AdminUsers.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import type { User, Warning, WarningReason } from "@/../../shared/types";
import { trpc } from "@/lib/trpc";
import { toast } from "sonner";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { 
  Users, 
  Search,
  AlertTriangle,
  Ban,
  UserX,
  Shield,
  CheckCircle,
  Clock
} from "lucide-react";
import { Link } from "wouter";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";

export default function AdminUsers() {
  const { user } = useAuth();
  const utils = trpc.useUtils();
  const { data: users, refetch } = trpc.admin.getAllUsers.useQuery(undefined, { staleTime: 60000 });
  
  const [selectedUserId, setSelectedUserId] = useState<number | null>(null);
  const { data: userWarnings, refetch: refetchWarnings } = trpc.admin.getUserWarnings.useQuery(
    selectedUserId!,
    { enabled: selectedUserId !== null }
  );
  
  const [searchQuery, setSearchQuery] = useState("");
  const [roleFilter, setRoleFilter] = useState<string>("all");
  const [statusFilter, setStatusFilter] = useState<string>("all");
  
  // Dialog states
  const [warnDialogOpen, setWarnDialogOpen] = useState(false);
  const [suspendDialogOpen, setSuspendDialogOpen] = useState(false);
  const [banDialogOpen, setBanDialogOpen] = useState(false);
  const [promoteDialogOpen, setPromoteDialogOpen] = useState(false);
  const [warningsDialogOpen, setWarningsDialogOpen] = useState(false);
  const [selectedUser, setSelectedUser] = useState<any>(null);
  
  // Form states
  const [warnReason, setWarnReason] = useState("tos_violation");
  const [warnMessage, setWarnMessage] = useState("");
  const [suspendReason, setSuspendReason] = useState("");
  const [suspendDays, setSuspendDays] = useState("7");
  const [banReason, setBanReason] = useState("");

  // Mutations
  const warnUserMutation = trpc.admin.warnUser.useMutation({
    onSuccess: () => {
      toast.success("Nutzer wurde erfolgreich verwarnt");
      refetch();
      setWarnDialogOpen(false);
      setWarnMessage("");
    },
    onError: (error) => {
      toast.error(`Fehler beim Verwarnen: ${error.message}`);
      console.error("Warn user error:", error);
    },
  });

  const suspendUserMutation = trpc.admin.suspendUser.useMutation({
    onSuccess: () => {
      toast.success("Nutzer wurde erfolgreich gesperrt");
      refetch();
      setSuspendDialogOpen(false);
      setSuspendReason("");
    },
    onError: (error) => {
      toast.error(`Fehler beim Sperren: ${error.message}`);
    },
  });

  const banUserMutation = trpc.admin.banUser.useMutation({
    onSuccess: () => {
      toast.success("Nutzer wurde erfolgreich gebannt");
      refetch();
      setBanDialogOpen(false);
      setBanReason("");
    },
    onError: (error) => {
      toast.error(`Fehler beim Bannen: ${error.message}`);
    },
  });
```

#### Schritt 5.x: BackButton.tsx

**`client/src/components/BackButton.tsx`**

```typescript
import { ArrowLeft } from "lucide-react";
import { Link } from "wouter";

interface BackButtonProps {
  href?: string;
  label?: string;
  className?: string;
  useHistory?: boolean; // If true, uses browser history instead of href
}

/**
 * Standardisierter Zurücklink für alle Seiten
 * Verwendet konsistente Farben, Icons und Styling
 * 
 * @param href - Target URL (default: "/")
 * @param label - Button text (default: "Zurück")
 * @param useHistory - If true, uses window.history.back() instead of href
 */
export default function BackButton({ 
  href = "/", 
  label = "Zurück",
  className = "",
  useHistory = false
}: BackButtonProps) {
  if (useHistory) {
    return (
      <button
        onClick={() => window.history.back()}
        className={`inline-flex items-center gap-2 text-blue-600 hover:text-blue-800 mb-6 transition-colors ${className}`}
      >
        <ArrowLeft className="w-4 h-4" />
        {label}
      </button>
    );
  }

  return (
    <Link 
      href={href} 
      className={`inline-flex items-center gap-2 text-blue-600 hover:text-blue-800 mb-6 transition-colors ${className}`}
    >
      <ArrowLeft className="w-4 h-4" />
      {label}
    </Link>
  );
}

```

#### Schritt 5.x: Breadcrumbs.tsx

**`client/src/components/Breadcrumbs.tsx`**

```typescript
import { ChevronRight, Home } from "lucide-react";
import { Link } from "wouter";

interface BreadcrumbItem {
  label: string;
  href?: string;
}

interface BreadcrumbsProps {
  items: BreadcrumbItem[];
}

export function Breadcrumbs({ items }: BreadcrumbsProps) {
  return (
    <nav className="flex items-center gap-2 text-sm text-gray-600 mb-6">
      <Link href="/" className="hover:text-green-600 transition flex items-center gap-1">
        <Home className="w-4 h-4" />
        <span>Start</span>
      </Link>
      
      {items.map((item, index) => (
        <div key={index} className="flex items-center gap-2">
          <ChevronRight className="w-4 h-4" />
          {item.href && index < items.length - 1 ? (
            <Link href={item.href} className="hover:text-green-600 transition">
              {item.label}
            </Link>
          ) : (
            <span className="text-gray-900 font-medium">{item.label}</span>
          )}
        </div>
      ))}
    </nav>
  );
}

```

#### Schritt 5.x: BrowseListings.tsx

**`client/src/components/BrowseListings.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import { useState } from "react";
import type { Listing, PriceType } from "@/../../shared/types";
import { Link } from "wouter";
import { trpc } from "@/lib/trpc";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Badge } from "@/components/ui/badge";
import { Search, Filter, Package } from "lucide-react";
import { ListingSkeletonGrid } from "@/components/ListingSkeleton";
import { Breadcrumbs } from "@/components/Breadcrumbs";
import { Header } from "@/components/Header";

export default function BrowseListings() {
  // Get search query from URL
  const urlParams = new URLSearchParams(window.location.search);
  const urlSearch = urlParams.get('search') || '';
  
  const [limit] = useState(50);
  const [offset, setOffset] = useState(0);
  const [filterType, setFilterType] = useState<"all" | "cutting" | "seed">("all");
  const [searchQuery, setSearchQuery] = useState(urlSearch);
  const [sortBy, setSortBy] = useState<"newest" | "price-low" | "price-high">("newest");
  const [minPrice, setMinPrice] = useState<string>("");
  const [maxPrice, setMaxPrice] = useState<string>("");

  const listings = trpc.listing.getActive.useQuery({ limit, offset });

  // Filter and sort listings
  const filteredListings = listings.data
    ?.filter((listing) => {
      // Type filter
      if (filterType !== "all" && listing.type !== filterType) return false;
      
      // Search filter
      if (searchQuery && !listing.strain.toLowerCase().includes(searchQuery.toLowerCase())) {
        return false;
      }
      
      // Price filter
      const price = listing.priceType === "fixed" ? parseFloat(listing.fixedPrice || "0") : parseFloat(listing.auctionStartPrice || "0");
      if (minPrice && price < parseFloat(minPrice)) return false;
      if (maxPrice && price > parseFloat(maxPrice)) return false;
      
      return true;
    })
    .sort((a, b) => {
      if (sortBy === "newest") {
        return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();
      }
      if (sortBy === "price-low") {
        const priceA = a.priceType === "fixed" ? parseFloat(a.fixedPrice || "0") : parseFloat(a.auctionStartPrice || "0");
        const priceB = b.priceType === "fixed" ? parseFloat(b.fixedPrice || "0") : parseFloat(b.auctionStartPrice || "0");
        return priceA - priceB;
      }
      if (sortBy === "price-high") {
        const priceA = a.priceType === "fixed" ? parseFloat(a.fixedPrice || "0") : parseFloat(a.auctionStartPrice || "0");
        const priceB = b.priceType === "fixed" ? parseFloat(b.fixedPrice || "0") : parseFloat(b.auctionStartPrice || "0");
        return priceB - priceA;
      }
      return 0;
    }) || [];

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      <Header />
      <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <Breadcrumbs items={[{ label: "Stecklinge & Samen" }]} />
        
        {/* Header */}
        <div className="mb-8">
          <h1 className="text-3xl font-bold mb-2">Stecklinge & Samen durchsuchen</h1>
          <p className="text-gray-600">
            {filteredListings.length} Angebot{filteredListings.length !== 1 ? "e" : ""} verfügbar
          </p>
        </div>

        {/* Filters */}
        <Card className="mb-8">
          <CardHeader>
            <CardTitle className="text-lg flex items-center gap-2">
              <Filter className="w-5 h-5" />
              Filter & Suche
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="grid md:grid-cols-2 lg:grid-cols-5 gap-4">
              {/* Search */}
              <div>
                <label className="text-sm font-medium">Sorte suchen</label>
                <div className="relative mt-2">
                  <Search className="absolute left-3 top-3 w-4 h-4 text-gray-400" />
                  <Input
                    placeholder="z.B. Blue Dream"
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    className="pl-10"
                  />
                </div>
              </div>

              {/* Type Filter */}
              <div>
                <label className="text-sm font-medium">Typ</label>
                <Select value={filterType} onValueChange={(value: "all" | "cutting" | "seed") => setFilterType(value)}>
                  <SelectTrigger className="mt-2">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="all">Alle</SelectItem>
                    <SelectItem value="cutting">Stecklinge</SelectItem>
                    <SelectItem value="seed">Samen</SelectItem>
                  </SelectContent>
                </Select>
              </div>

              {/* Price Min */}
              <div>
                <label className="text-sm font-medium">Preis min (€)</label>
                <Input
                  type="number"
                  placeholder="z.B. 5"
                  value={minPrice}
                  onChange={(e) => setMinPrice(e.target.value)}
                  className="mt-2"
                  min="0"
                  step="0.01"
                />
              </div>

              {/* Price Max */}
              <div>
                <label className="text-sm font-medium">Preis max (€)</label>
                <Input
                  type="number"
                  placeholder="z.B. 50"
                  value={maxPrice}
                  onChange={(e) => setMaxPrice(e.target.value)}
                  className="mt-2"
                  min="0"
                  step="0.01"
                />
              </div>

              {/* Sort */}
              <div>
                <label className="text-sm font-medium">Sortieren nach</label>
                <Select value={sortBy} onValueChange={(value: "newest" | "price-low" | "price-high") => setSortBy(value)}>
                  <SelectTrigger className="mt-2">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="newest">Neueste zuerst</SelectItem>
                    <SelectItem value="price-low">Preis: Niedrig zu Hoch</SelectItem>
                    <SelectItem value="price-high">Preis: Hoch zu Niedrig</SelectItem>
                  </SelectContent>
                </Select>
              </div>

              {/* Reset */}
              <div className="flex items-end">
                <Button
                  variant="outline"
                  className="w-full"
                  onClick={() => {
                    setSearchQuery("");
                    setFilterType("all");
                    setSortBy("newest");
                    setMinPrice("");
                    setMaxPrice("");
                  }}
                >
                  Zurücksetzen
                </Button>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Listings Grid */}
        {listings.isLoading ? (
          <ListingSkeletonGrid count={8} />
        ) : filteredListings.length === 0 ? (
          <Card>
            <CardContent className="py-16 text-center">
              <div className="flex flex-col items-center gap-4">
                <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center">
                  <Package className="w-8 h-8 text-gray-400" />
                </div>
                <div>
                  <h3 className="text-lg font-semibold text-gray-900 mb-2">
                    Keine Angebote gefunden
                  </h3>
                  <p className="text-gray-500 mb-4">
                    {searchQuery || minPrice || maxPrice || filterType !== "all"
                      ? "Versuche es mit anderen Filtereinstellungen"
                      : "Aktuell sind keine Angebote verfügbar"}
                  </p>
                </div>
                <Button
                  variant="outline"
                  onClick={() => {
                    setSearchQuery("");
                    setFilterType("all");
                    setMinPrice("");
                    setMaxPrice("");
                    setSortBy("newest");
                  }}
                >
                  Alle Filter zurücksetzen
                </Button>
              </div>
            </CardContent>
          </Card>
        ) : (
          <div className="grid md:grid-cols-3 lg:grid-cols-4 gap-6">
            {filteredListings.map((listing) => (
              <Link key={listing.id} href={`/listing/${listing.id}`}>
                <Card className="h-full hover:shadow-lg transition-shadow cursor-pointer overflow-hidden">
                  {/* Image */}
                  {listing.imageUrl ? (
                    <img
                      src={listing.imageUrl}
                      alt={listing.strain}
                      className="w-full h-40 object-cover"
                    />
                  ) : (
                    <div className="w-full h-40 bg-gray-200 flex items-center justify-center">
                      <p className="text-gray-500 text-sm">Kein Bild</p>
                    </div>
                  )}

                  <CardHeader className="pb-3">
                    <CardTitle className="text-base line-clamp-2">{listing.strain}</CardTitle>
                    <CardDescription>
                      {listing.type === "cutting" ? "Steckling" : "Samen"}
                    </CardDescription>
                  </CardHeader>

                  <CardContent className="space-y-3">
                    {/* Description */}
                    {listing.description && (
                      <p className="text-sm text-gray-600 line-clamp-2">{listing.description}</p>
                    )}

                    {/* Quantity */}
                    <div className="flex justify-between items-center text-sm">
                      <span className="text-gray-600">Verfügbar:</span>
                      <Badge variant="outline">{listing.quantity}</Badge>
                    </div>

                    {/* Price */}
                    <div className="pt-2 border-t">
                      <p className="text-lg font-bold text-green-600">
                        {listing.priceType === "fixed"
                          ? `€${parseFloat(listing.fixedPrice || "0").toFixed(2)}`
                          : listing.auctionStartPrice
                          ? `Ab €${parseFloat(listing.auctionStartPrice || "0").toFixed(2)}`
                          : "Auktion"}
                      </p>
                      <p className="text-xs text-gray-500">
                        {listing.priceType === "fixed" ? "Festpreis" : "Auktion"}
                      </p>
                    </div>

                    {/* CTA */}
                    <Button className="w-full mt-2" size="sm">
                      Details anschauen
                    </Button>
                  </CardContent>
                </Card>
              </Link>
            ))}
          </div>
        )}

        {/* Pagination */}
        {filteredListings.length > 0 && (
          <div className="flex justify-center gap-4 mt-8">
            <Button
              variant="outline"
              disabled={offset === 0}
              onClick={() => setOffset(Math.max(0, offset - limit))}
            >
              Zurück
            </Button>
            <span className="flex items-center text-gray-600">
              Seite {Math.floor(offset / limit) + 1}
            </span>
            <Button
              variant="outline"
              disabled={filteredListings.length < limit}
              onClick={() => setOffset(offset + limit)}
            >
              Weiter
            </Button>
          </div>
        )}
      </div>
    </div>
  );
}

```

#### Schritt 5.x: BuyerDashboard.tsx

**`client/src/components/BuyerDashboard.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import type { Transaction, Offer } from "@/../../shared/types";
import { trpc } from "../lib/trpc";
import { Star, MessageSquare, Check, X } from "lucide-react";
import { useLocation } from "wouter";
import { Header } from "@/components/Header";

export default function BuyerDashboard() {
  const [reviewDialogOpen, setReviewDialogOpen] = useState(false);
  const [selectedTransaction, setSelectedTransaction] = useState<number | null>(null);
  const [rating, setRating] = useState(0);
  const [hoverRating, setHoverRating] = useState(0);
  const [comment, setComment] = useState("");

  const transactions = trpc.transaction.getBuyerTransactions.useQuery(undefined, { staleTime: 60000 });
  const myOffers = trpc.offer.getMyOffers.useQuery(undefined, { staleTime: 60000 });
  const [, setLocation] = useLocation();
  const createReviewMutation = trpc.review.create.useMutation({
    onSuccess: () => {
      setReviewDialogOpen(false);
      setSelectedTransaction(null);
      setRating(0);
      setComment("");
      transactions.refetch();
    },
  });

  const handleReviewClick = (transactionId: number) => {
    setSelectedTransaction(transactionId);
    setReviewDialogOpen(true);
  };

  const handleSubmitReview = () => {
    if (!selectedTransaction || rating === 0) return;

    const transaction = transactions.data?.find((t) => t.id === selectedTransaction);
    if (!transaction) return;

    createReviewMutation.mutate({
      transactionId: selectedTransaction,
      sellerId: transaction.sellerId,
      rating,
      comment: comment || undefined,
    });
  };

  const canReview = (transaction: Transaction) => {
    const daysSincePurchase = Math.floor(
      (Date.now() - new Date(transaction.createdAt).getTime()) / (1000 * 60 * 60 * 24)
    );
    return daysSincePurchase <= 90 && transaction.status === "completed";
  };

  if (transactions.isLoading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-gray-600">Lädt...</div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <Header />
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-gray-900">Käufer-Dashboard</h1>
          <p className="mt-2 text-gray-600">
            Übersicht über deine Preisvorschläge, Bestellungen und Bewertungsmöglichkeiten
          </p>
        </div>

        {/* Offers Section */}
        {myOffers.data && myOffers.data.length > 0 && (
          <div className="mb-8">
            <h2 className="text-2xl font-bold text-gray-900 mb-4">Meine Preisvorschläge</h2>
            <div className="space-y-3">
              {myOffers.data.map((offer: Offer) => {
                const getStatusBadge = () => {
                  switch (offer.status) {
                    case "pending":
                      return <span className="px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">Ausstehend</span>;
                    case "accepted":
                      return <span className="px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">Angenommen</span>;
                    case "rejected":
                      return <span className="px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">Abgelehnt</span>;
                    default:
                      return <span className="px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800">{offer.status}</span>;
                  }
                };

                return (
                  <div key={offer.id} className="bg-white rounded-lg shadow p-4">
                    <div className="flex items-center justify-between">
                      <div className="flex-1">
                        <div className="flex items-center gap-3 mb-2">
                          <h3 className="text-lg font-semibold text-gray-900">{offer.listingStrain}</h3>
                          {getStatusBadge()}
                        </div>
                        <div className="text-sm text-gray-600">
                          <p>Angebot: <span className="font-bold text-green-600">€{parseFloat(offer.offerAmount).toFixed(2)}</span></p>
                          <p>Verkäufer: {offer.sellerNickname || "Unbekannt"}</p>
                          <p className="text-xs text-gray-500">
                            {new Date(offer.createdAt).toLocaleDateString("de-DE", {
                              day: "2-digit",
                              month: "2-digit",
                              year: "numeric",
                              hour: "2-digit",
                              minute: "2-digit",
                            })}
                          </p>
                          {offer.message && (
                            <div className="mt-2 flex items-start gap-2">
                              <MessageSquare className="w-4 h-4 text-gray-400 mt-0.5" />
                              <p className="text-sm italic">"{ offer.message}"</p>
                            </div>
                          )}
                        </div>
                      </div>
                      {offer.status === "accepted" && (
                        <div className="ml-4">
                          <button
                            onClick={() => setLocation(`/listing/${offer.listingId}`)}
                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                          >
                            Zur Zahlung
                          </button>
                        </div>
                      )}
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        )}

        {/* Transactions Section */}
        <h2 className="text-2xl font-bold text-gray-900 mb-4">Meine Käufe</h2>

        {transactions.data?.length === 0 ? (
          <div className="bg-white rounded-lg shadow p-8 text-center">
            <p className="text-gray-600">Du hast noch keine Käufe getätigt.</p>
          </div>
        ) : (
          <div className="space-y-4">
            {transactions.data?.map((transaction) => {
              const daysLeft = 90 - Math.floor(
                (Date.now() - new Date(transaction.createdAt).getTime()) / (1000 * 60 * 60 * 24)
              );

              return (
                <div key={transaction.id} className="bg-white rounded-lg shadow p-6">
                  <div className="flex justify-between items-start">
                    <div className="flex-1">
                      <div className="flex items-center gap-3 mb-2">
                        <h3 className="text-lg font-semibold text-gray-900">
                          Bestellung #{transaction.id}
                        </h3>
                        <span
                          className={`px-3 py-1 rounded-full text-sm font-medium ${
                            transaction.status === "completed"
                              ? "bg-green-100 text-green-800"
                              : transaction.status === "pending"
                              ? "bg-yellow-100 text-yellow-800"
                              : "bg-gray-100 text-gray-800"
                          }`}
                        >
                          {transaction.status === "completed"
                            ? "Abgeschlossen"
                            : transaction.status === "pending"
                            ? "Ausstehend"
                            : transaction.status}
                        </span>
                      </div>

                      <div className="grid grid-cols-2 gap-4 text-sm text-gray-600 mb-4">
                        <div>
                          <span className="font-medium">Datum:</span>{" "}
                          {new Date(transaction.createdAt).toLocaleDateString("de-DE")}
                        </div>
                        <div>
                          <span className="font-medium">Betrag:</span> €
                          {parseFloat(transaction.totalAmount).toFixed(2)}
                        </div>
                        <div>
                          <span className="font-medium">Menge:</span> {transaction.quantity}
                        </div>
                        <div>
                          <span className="font-medium">Plattformgebühr:</span> €
                          {parseFloat(transaction.platformFee).toFixed(2)}
                        </div>
                      </div>

                      {canReview(transaction) && (
                        <div className="mt-4 p-3 bg-blue-50 rounded-lg">
                          <p className="text-sm text-blue-800">
                            ✨ Du kannst diese Transaktion noch {daysLeft} Tage lang bewerten
                          </p>
                        </div>
                      )}

                      {!canReview(transaction) && daysLeft < 0 && (
                        <div className="mt-4 p-3 bg-gray-50 rounded-lg">
                          <p className="text-sm text-gray-600">
                            ⏰ Bewertungszeitraum abgelaufen (90 Tage)
                          </p>
                        </div>
                      )}
                    </div>

                    {canReview(transaction) && (
                      <button
                        onClick={() => handleReviewClick(transaction.id)}
                        className="ml-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                      >
                        Bewerten
                      </button>
                    )}
                  </div>
                </div>
              );
            })}
          </div>
        )}

        {/* Review Dialog */}
        {reviewDialogOpen && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div className="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
              <h2 className="text-2xl font-bold text-gray-900 mb-4">Bewertung abgeben</h2>

              <div className="mb-6">
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Wie zufrieden warst du mit diesem Kauf?
                </label>
                <div className="flex gap-2">
                  {[1, 2, 3, 4, 5].map((star) => (
                    <button
                      key={star}
                      type="button"
                      onClick={() => setRating(star)}
                      onMouseEnter={() => setHoverRating(star)}
                      onMouseLeave={() => setHoverRating(0)}
                      className="focus:outline-none transition-transform hover:scale-110"
                    >
                      <Star
                        className={`w-10 h-10 ${
                          star <= (hoverRating || rating)
                            ? "fill-yellow-400 text-yellow-400"
                            : "text-gray-300"
                        }`}
                      />
                    </button>
                  ))}
                </div>
                {rating > 0 && (
                  <p className="mt-2 text-sm text-gray-600">
                    {rating === 1 && "Sehr unzufrieden"}
                    {rating === 2 && "Unzufrieden"}
                    {rating === 3 && "Neutral"}
                    {rating === 4 && "Zufrieden"}
                    {rating === 5 && "Sehr zufrieden"}
                  </p>
                )}
              </div>

              <div className="mb-6">
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Kommentar (optional)
                </label>
                <textarea
                  value={comment}
                  onChange={(e) => setComment(e.target.value)}
                  rows={4}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                  placeholder="Teile deine Erfahrungen mit anderen Käufern..."
                />
              </div>

              <div className="flex gap-3">
                <button
                  onClick={() => {
                    setReviewDialogOpen(false);
                    setSelectedTransaction(null);
                    setRating(0);
                    setComment("");
                  }}
                  className="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                >
                  Abbrechen
                </button>
                <button
                  onClick={handleSubmitReview}
                  disabled={rating === 0 || createReviewMutation.isPending}
                  className="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
                >
                  {createReviewMutation.isPending ? "Wird gesendet..." : "Bewertung abschicken"}
                </button>
              </div>

              {createReviewMutation.error && (
                <div className="mt-4 p-3 bg-red-50 text-red-800 rounded-lg text-sm">
                  {createReviewMutation.error.message}
                </div>
              )}
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

```

#### Schritt 5.x: ChatWindow.tsx

**`client/src/components/ChatWindow.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import type { Message } from "@/../../shared/types";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { trpc } from "@/lib/trpc";
import { Link, useParams } from "wouter";
import { ArrowLeft, Send, AlertCircle } from "lucide-react";
import { formatDistanceToNow } from "date-fns";
import { de } from "date-fns/locale";
import { useState, useEffect, useRef } from "react";
import { toast } from "sonner";
import { Header } from "@/components/Header";

export default function ChatWindow() {
  const { user, isAuthenticated } = useAuth();
  const params = useParams<{ id: string }>();
  const conversationId = parseInt(params.id || "0");
  const [messageText, setMessageText] = useState("");
  const messagesEndRef = useRef<HTMLDivElement>(null);
  const utils = trpc.useUtils();

  // Get messages
  const { data: messages = [], isLoading } = trpc.chat.getMessages.useQuery(conversationId, {
    refetchInterval: 5000, // Refresh every 5 seconds
    staleTime: 10000, // 10s - Real-time
    enabled: conversationId > 0,
  });

  // Send message mutation
  const sendMessageMutation = trpc.chat.sendMessage.useMutation({
    onSuccess: () => {
      setMessageText("");
      utils.chat.getMessages.invalidate();
      utils.chat.getConversations.invalidate();
      utils.chat.getUnreadCount.invalidate();
    },
    onError: (error) => {
      toast.error("Fehler beim Senden: " + error.message);
    },
  });

  // Scroll to bottom when messages change
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [messages]);

  const handleSendMessage = (e: React.FormEvent) => {
    e.preventDefault();
    if (!messageText.trim()) return;

    sendMessageMutation.mutate({
      conversationId,
      message: messageText.trim(),
    });
  };

  if (!isAuthenticated) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center">
        <Card className="max-w-md">
          <CardHeader>
            <CardTitle>Zugriff verweigert</CardTitle>
            <CardDescription>
              Sie müssen eingeloggt sein, um Nachrichten zu sehen.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Link href="/">
              <Button>Zur Startseite</Button>
            </Link>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      <Header />
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="mb-6">
          <Link href="/messages">
            <Button variant="outline" size="sm" className="hidden">
              <ArrowLeft className="h-4 w-4 mr-2" />
              Zurück zu Nachrichten
            </Button>
          </Link>
        </div>

        {/* Legal Disclaimer */}
        <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-6 rounded-r-lg">
          <div className="flex items-start gap-3">
            <AlertCircle className="h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5" />
            <div className="text-sm text-yellow-800">
              <p className="font-semibold mb-1">⚠️ Datenschutz-Hinweis:</p>
              <p className="mb-2">Geben Sie <strong>persönliche Daten</strong> (Telefonnummer, vollständige Adresse) <strong>erst nach Kaufabschluss</strong> weiter. Der Standort des Verkäufers ist bereits auf der Plattform sichtbar.</p>
              <p className="text-xs"><strong>🔒 Empfehlung:</strong> Nutzen Sie <strong>verschlüsselte Messenger</strong> (Signal, Telegram, WhatsApp) für den Austausch sensibler Daten außerhalb dieser Plattform.</p>
            </div>
          </div>
        </div>

        <Card className="h-[600px] flex flex-col">
          <CardHeader className="border-b">
            <CardTitle>Chat</CardTitle>
            <CardDescription>
              {messages.length > 0 && `${messages.length} Nachricht${messages.length > 1 ? "en" : ""}`}
            </CardDescription>
          </CardHeader>

          {/* Messages Area */}
          <CardContent className="flex-1 overflow-y-auto p-6">
            {isLoading ? (
              <div className="text-center py-12">
                <p className="text-muted-foreground">Lädt...</p>
              </div>
            ) : messages.length === 0 ? (
              <div className="text-center py-12">
                <p className="text-muted-foreground">
                  Noch keine Nachrichten. Schreiben Sie die erste Nachricht!
                </p>
              </div>
            ) : (
              <div className="space-y-4">
                {messages.map((message: Message) => {
                  const isOwnMessage = message.senderId === user?.id;

                  return (
                    <div
                      key={message.id}
                      className={`flex ${isOwnMessage ? "justify-end" : "justify-start"}`}
                    >
                      <div
                        className={`max-w-[70%] rounded-lg p-3 ${
                          isOwnMessage
                            ? "bg-blue-600 text-white"
                            : "bg-gray-200 text-gray-900"
                        }`}
                      >
                        <div className="flex items-center gap-2 mb-1">
                          <p className={`text-xs font-semibold ${isOwnMessage ? "text-blue-100" : "text-gray-600"}`}>
                            {isOwnMessage ? "Sie" : message.senderName}
                          </p>
                          <p className={`text-xs ${isOwnMessage ? "text-blue-100" : "text-gray-500"}`}>
                            {formatDistanceToNow(new Date(message.createdAt), {
                              addSuffix: true,
                              locale: de,
                            })}
                          </p>
                        </div>
                        <p className="text-sm whitespace-pre-line break-words">
                          {message.message}
                        </p>
                      </div>
                    </div>
                  );
                })}
                <div ref={messagesEndRef} />
              </div>
            )}
          </CardContent>

          {/* Message Input */}
          <div className="border-t p-4">
            <form onSubmit={handleSendMessage} className="flex gap-2">
              <Input
                value={messageText}
                onChange={(e) => setMessageText(e.target.value)}
                placeholder="Nachricht schreiben..."
                maxLength={5000}
                disabled={sendMessageMutation.isPending}
                className="flex-1"
              />
              <Button
                type="submit"
                disabled={!messageText.trim() || sendMessageMutation.isPending}
              >
                <Send className="h-4 w-4 mr-2" />
                Senden
              </Button>
            </form>
          </div>
        </Card>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: Checkout.tsx

**`client/src/components/Checkout.tsx`**

```typescript
import { useParams, useLocation } from "wouter";
import { useAuth } from "@/_core/hooks/useAuth";
import { trpc } from "@/lib/trpc";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Badge } from "@/components/ui/badge";
import { AlertCircle, Loader2 } from "lucide-react";
import { Alert, AlertDescription } from "@/components/ui/alert";

// PayPal SDK types
interface PayPalOrderData {
  orderID: string;
}

interface PayPalError {
  message: string;
}

declare global {
  interface Window {
    paypal?: {
      Buttons: (config: {
        createOrder: () => Promise<string>;
        onApprove: (data: PayPalOrderData) => Promise<void>;
        onError: (err: PayPalError) => void;
      }) => {
        render: (selector: string) => void;
      };
    };
  }
}

export default function Checkout() {
  const { id } = useParams<{ id: string }>();
  const [, navigate] = useLocation();
  const { user, isAuthenticated } = useAuth();
  const [quantity, setQuantity] = useState(1);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [ageVerified, setAgeVerified] = useState(false);
  const [termsAccepted, setTermsAccepted] = useState(false);
  const [paymentMethod, setPaymentMethod] = useState<'paypal' | 'cash'>('paypal');

  const listingId = parseInt(id || "0");
  const listing = trpc.listing.getById.useQuery(listingId, { enabled: !!id });
  const sellerProfile = trpc.seller.getProfileById.useQuery(listing.data?.sellerId || 0, {
    enabled: !!listing.data?.sellerId,
  });```

#### Schritt 5.x: CheckoutNew.tsx

**`client/src/components/CheckoutNew.tsx`**

```typescript
import { useState, useEffect } from "react";
import { useParams, useLocation } from "wouter";
import { useAuth } from "@/_core/hooks/useAuth";
import { trpc } from "@/lib/trpc";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Badge } from "@/components/ui/badge";
import { AlertCircle, Loader2, ShoppingCart, Package, CreditCard } from "lucide-react";
import { Alert, AlertDescription } from "@/components/ui/alert";
import PayPalButton from "@/components/PayPalButton";

export default function Checkout() {
  const { id } = useParams<{ id: string }>();
  const [, navigate] = useLocation();
  const { user, isAuthenticated } = useAuth();
  const [quantity, setQuantity] = useState(1);
  const [ageVerified, setAgeVerified] = useState(false);
  const [termsAccepted, setTermsAccepted] = useState(false);
  const [paymentMethod, setPaymentMethod] = useState<'paypal' | 'cash'>('paypal');

  const listingId = parseInt(id || "0");
  const listing = trpc.listing.getById.useQuery(listingId, { enabled: !!id });
  const sellerProfile = trpc.seller.getProfileById.useQuery(listing.data?.sellerId || 0, {
    enabled: !!listing.data?.sellerId,
  });

  // Get dynamic fees from system settings
  const platformFee = trpc.system.getSettings.useQuery();
  const platformFeeFixed = platformFee.data?.find(s => s.key === 'platform_fee_fixed')?.value || '0.42';
  const paypalFeePercentage = platformFee.data?.find(s => s.key === 'paypal_fee_percentage')?.value || '2.49';
  const paypalFeeFixed = platformFee.data?.find(s => s.key === 'paypal_fee_fixed')?.value || '0.49';

  // Calculate totals
  const calculateTotals = () => {
    if (!listing.data) return { subtotal: 0, platformFee: 0, paypalFee: 0, total: 0 };

    const unitPrice =
      listing.data.priceType === "fixed"
        ? parseFloat(listing.data.fixedPrice || "0")
        : parseFloat(listing.data.auctionStartPrice || "0");

    const subtotal = unitPrice * quantity;
    const platformFeeAmount = parseFloat(platformFeeFixed) * quantity;
    const paypalFeeAmount = paymentMethod === 'paypal' 
      ? (subtotal * (parseFloat(paypalFeePercentage) / 100) + parseFloat(paypalFeeFixed))
      : 0;
    const total = subtotal + platformFeeAmount + paypalFeeAmount;

    return {
      subtotal,
      platformFee: platformFeeAmount,
      paypalFee: paypalFeeAmount,
      total,
    };
  };

  const totals = calculateTotals();

  // Redirect if not authenticated
  if (!isAuthenticated) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100 p-4">
        <Card className="w-full max-w-md">
          <CardHeader>
            <CardTitle>Authentifizierung erforderlich</CardTitle>
            <CardDescription>Bitte melden Sie sich an, um zu kaufen.</CardDescription>
          </CardHeader>
          <CardContent>
            <Button className="w-full" onClick={() => navigate("/")}>
              Zur Startseite
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Loading state
  if (listing.isLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <Loader2 className="w-8 h-8 animate-spin text-gray-400" />
      </div>
    );
  }

  // Not found
  if (!listing.data) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <Card className="w-full max-w-md">
          <CardHeader>
            <CardTitle>Angebot nicht gefunden</CardTitle>
          </CardHeader>
          <CardContent>
            <Button className="w-full" onClick={() => navigate("/browse")}>
              Zurück zum Browse
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  const canPurchase = ageVerified && termsAccepted;

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 py-8">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h1 className="text-3xl font-bold mb-8">Checkout</h1>

        <div className="grid md:grid-cols-3 gap-8">
          {/* Order Summary */}
          <div className="md:col-span-2 space-y-6">
            {/* Listing Info */}
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Package className="w-5 h-5" />
                  Produktdetails
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="flex gap-4">
                  {listing.data.images && listing.data.images.length > 0 && (
                    <img
                      src={listing.data.images[0]}
                      alt={listing.data.strain}
                      className="w-24 h-24 object-cover rounded-lg"
                    />
                  )}
                  <div className="flex-1">
                    <h3 className="font-semibold text-lg">{listing.data.strain}</h3>
                    <p className="text-sm text-gray-600 mb-2">{listing.data.type}</p>
                    <div className="flex items-center gap-2">
                      <span className="text-2xl font-bold text-green-600">
                        €{listing.data.priceType === "fixed" ? listing.data.fixedPrice : listing.data.auctionStartPrice}
                      </span>
                      <Badge variant="outline">pro Stück</Badge>
                    </div>
                  </div>
                </div>

                {/* Quantity Selector */}
                <div className="mt-4 pt-4 border-t">
                  <label className="block text-sm font-medium mb-2">Menge</label>
                  <Input
                    type="number"
                    min="1"
                    max={listing.data.quantity || 1}
                    value={quantity}
                    onChange={(e) => setQuantity(Math.max(1, Math.min(parseInt(e.target.value) || 1, listing.data?.quantity || 1)))}
                    className="w-32"
                  />
                  <p className="text-xs text-gray-500 mt-1">
                    Verfügbar: {listing.data.quantity} Stück
                  </p>
                </div>
              </CardContent>
            </Card>

            {/* Payment Method */}
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <CreditCard className="w-5 h-5" />
                  Zahlungsmethode
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                {/* PayPal Option */}
                <label className="flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                  <input
                    type="radio"
                    name="paymentMethod"
                    value="paypal"
                    checked={paymentMethod === 'paypal'}
                    onChange={(e) => setPaymentMethod(e.target.value as 'paypal')}
                    className="w-4 h-4"
                  />
                  <div className="flex-1">
                    <div className="font-medium">PayPal</div>
                    <div className="text-sm text-gray-500">Sichere Online-Zahlung mit Käuferschutz</div>
                  </div>
                  <Badge variant="outline" className="bg-blue-50 text-blue-700 border-blue-200">
                    +€{totals.paypalFee.toFixed(2)} Gebühr
                  </Badge>
                </label>

                {/* Cash Option */}
                <label className="flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                  <input
                    type="radio"
                    name="paymentMethod"
                    value="cash"
                    checked={paymentMethod === 'cash'}
                    onChange={(e) => setPaymentMethod(e.target.value as 'cash')}
                    className="w-4 h-4"
                  />
                  <div className="flex-1">
                    <div className="font-medium">Barzahlung bei Abholung</div>
                    <div className="text-sm text-gray-500">Zahlung direkt beim Verkäufer</div>
                  </div>
                  <Badge variant="outline" className="bg-green-50 text-green-700 border-green-200">
                    Keine PayPal-Gebühr
                  </Badge>
                </label>

                {/* Terms & Conditions */}
                <div className="space-y-3 pt-4 border-t">
                  <label className="flex items-start gap-2 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={ageVerified}
                      onChange={(e) => setAgeVerified(e.target.checked)}
                      className="mt-1"
                    />
                    <span className="text-sm">
                      Ich bestätige, dass ich mindestens 18 Jahre alt bin und die{" "}
                      <a href="/age-verification" className="text-blue-600 hover:underline">
                        Altersverifikation
                      </a>{" "}
                      akzeptiere.
                    </span>
                  </label>

                  <label className="flex items-start gap-2 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={termsAccepted}
                      onChange={(e) => setTermsAccepted(e.target.checked)}
                      className="mt-1"
                    />
                    <span className="text-sm">
                      Ich akzeptiere die{" "}
                      <a href="/terms" className="text-blue-600 hover:underline">
                        Nutzungsbedingungen
                      </a>
                      ,{" "}
                      <a href="/privacy" className="text-blue-600 hover:underline">
                        Datenschutzerklärung
                      </a>{" "}
                      und{" "}
                      <a href="/widerruf" className="text-blue-600 hover:underline">
                        Widerrufsbelehrung
                      </a>
                      .
                    </span>
                  </label>
                </div>

                {/* PayPal Button */}
                {paymentMethod === 'paypal' && canPurchase && (
                  <div className="pt-4">
                    <PayPalButton
                      listingId={listingId}
                      quantity={quantity}
                      onSuccess={(transactionId) => {
                        navigate(`/order/${transactionId}`);
                      }}
                      disabled={!canPurchase}
                    />
                  </div>
                )}

                {/* Cash Payment Info */}
                {paymentMethod === 'cash' && (
                  <Alert>
                    <AlertCircle className="h-4 w-4" />
                    <AlertDescription className="text-sm">
                      Bei Barzahlung kontaktieren Sie bitte den Verkäufer direkt, um die Übergabe zu vereinbaren.
                    </AlertDescription>
                  </Alert>
                )}
              </CardContent>
            </Card>
          </div>

          {/* Price Summary */}
          <div className="md:col-span-1">
            <Card className="sticky top-8">
              <CardHeader>
                <CardTitle>Zusammenfassung</CardTitle>
              </CardHeader>
              <CardContent className="space-y-3">
                <div className="flex justify-between text-sm">
                  <span>Zwischensumme ({quantity}x)</span>
                  <span>€{totals.subtotal.toFixed(2)}</span>
                </div>
                <div className="flex justify-between text-sm">
                  <span>Plattformgebühr ({quantity}x €{platformFeeFixed})</span>
                  <span>€{totals.platformFee.toFixed(2)}</span>
                </div>
                {paymentMethod === 'paypal' && totals.paypalFee > 0 && (
                  <div className="flex justify-between text-sm text-blue-600">
                    <span>PayPal-Gebühren</span>
                    <span>€{totals.paypalFee.toFixed(2)}</span>
                  </div>
                )}
                <div className="border-t pt-2 flex justify-between font-bold">
                  <span>Gesamtbetrag</span>
                  <span className="text-green-600">€{totals.total.toFixed(2)}</span>
                </div>

                <Alert>
                  <AlertCircle className="h-4 w-4" />
                  <AlertDescription className="text-xs">
                    {paymentMethod === 'paypal' 
                      ? 'Die PayPal-Gebühren werden zum Gesamtbetrag hinzugerechnet.'
                      : 'Die Plattformgebühr wird zum Gesamtbetrag hinzugerechnet.'}
                  </AlertDescription>
                </Alert>

                {paymentMethod === 'paypal' && (
                  <div className="text-xs text-gray-500 space-y-1">
                    <p>✓ Sichere Zahlung mit PayPal</p>
                    <p>✓ Käuferschutz garantiert</p>
                    <p>✓ Versand nach Zahlungsbestätigung</p>
                  </div>
                )}
                {paymentMethod === 'cash' && (
                  <div className="text-xs text-gray-500 space-y-1">
                    <p>✓ Barzahlung bei Übergabe</p>
                    <p>✓ Keine zusätzlichen PayPal-Gebühren</p>
                    <p>✓ Nur Plattformgebühr von €{platformFeeFixed}</p>
                  </div>
                )}
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: Contact.tsx

**`client/src/components/Contact.tsx`**

```typescript
import BackButton from "@/components/BackButton";
import { Mail, Phone, MapPin, Instagram, MessageCircle } from "lucide-react";

export default function Contact() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 py-12">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <BackButton href="/" label="Zurück zur Startseite" />
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-8 text-gray-900">Kontakt</h1>
          
          <div className="prose prose-lg max-w-none">
            <p className="text-lg text-gray-700 mb-8">
              Hast du Fragen, Anregungen oder Feedback? Wir freuen uns auf deine Nachricht!
            </p>

            {/* Kontakt-Karten */}
            <div className="grid md:grid-cols-2 gap-6 not-prose mb-8">
              {/* deimudda / Vaperge */}
              <div className="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-lg border border-green-200">
                <div className="flex items-center gap-3 mb-4">
                  <img 
                    src="/vaperge-logo.png" 
                    alt="Vaperge Logo" 
                    className="h-12 w-auto"
                  />
                  <h2 className="text-xl font-bold text-gray-900">deimudda / Vaperge</h2>
                </div>
                
                <div className="space-y-3 text-gray-700">
                  <div className="flex items-start gap-3">
                    <MapPin className="h-5 w-5 text-green-600 flex-shrink-0 mt-1" />
                    <div>
                      <p className="font-semibold">Vaperge - Eau de Terpènes</p>
                      <p>Chris Rohleder</p>
                      <p>Lessingstraße 11</p>
                      <p>69254 Malsch</p>
                      <p>Deutschland</p>
                    </div>
                  </div>

                  <div className="flex items-center gap-3">
                    <Mail className="h-5 w-5 text-green-600 flex-shrink-0" />
                    <a href="mailto:info@deimudda.de" className="text-green-600 hover:underline font-semibold">
                      info@deimudda.de
                    </a>
                  </div>

                  <div className="flex items-center gap-3">
                    <Phone className="h-5 w-5 text-green-600 flex-shrink-0" />
                    <span>[Telefonnummer einfügen]</span>
                  </div>
                </div>
              </div>

              {/* Kalidad */}
              <div className="bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-lg border border-purple-200">
                <div className="flex items-center gap-3 mb-4">
                  <img 
                    src="/kalidad-logo.png" 
                    alt="Kalidad Logo" 
                    className="h-12 w-auto bg-white p-2 rounded"
                  />
                  <h2 className="text-xl font-bold text-gray-900">Kalidad</h2>
                </div>
                
                <div className="space-y-3 text-gray-700">
                  <div className="flex items-start gap-3">
                    <MapPin className="h-5 w-5 text-purple-600 flex-shrink-0 mt-1" />
                    <div>
                      <p className="font-semibold">Kalidad - Grow- & Headshop</p>
                      <p>Kahlbachring 16</p>
                      <p>69254 Malsch</p>
                      <p>Deutschland</p>
                    </div>
                  </div>

                  <div className="flex items-center gap-3">
                    <Instagram className="h-5 w-5 text-purple-600 flex-shrink-0" />
                    <a 
                      href="https://www.instagram.com/kalidad420/" 
                      target="_blank" 
                      rel="noopener noreferrer" 
                      className="text-purple-600 hover:underline font-semibold"
                    >
                      @kalidad420
                    </a>
                  </div>
                </div>
              </div>
            </div>

            {/* Kontakt-Bereiche */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Wofür kannst du uns kontaktieren?</h2>
              
              <div className="grid md:grid-cols-2 gap-4 not-prose">
                <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                  <div className="flex items-center gap-2 mb-2">
                    <MessageCircle className="h-5 w-5 text-blue-600" />
                    <h3 className="font-bold text-blue-900">Allgemeine Fragen</h3>
                  </div>
                  <p className="text-sm text-blue-800">
                    Fragen zur Plattform, Registrierung, Nutzung oder Features
                  </p>
                  <p className="text-sm text-blue-600 mt-2">
                    → <a href="mailto:info@deimudda.de" className="hover:underline">info@deimudda.de</a>
                  </p>
                </div>

                <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                  <div className="flex items-center gap-2 mb-2">
                    <Mail className="h-5 w-5 text-green-600" />
                    <h3 className="font-bold text-green-900">Technischer Support</h3>
                  </div>
                  <p className="text-sm text-green-800">
                    Probleme mit der Website, Bugs oder technische Fragen
                  </p>
                  <p className="text-sm text-green-600 mt-2">
                    → <a href="mailto:support@deimudda.de" className="hover:underline">support@deimudda.de</a>
                  </p>
                </div>

                <div className="bg-purple-50 p-4 rounded-lg border border-purple-200">
                  <div className="flex items-center gap-2 mb-2">
                    <MessageCircle className="h-5 w-5 text-purple-600" />
                    <h3 className="font-bold text-purple-900">Verkäufer-Support</h3>
                  </div>
                  <p className="text-sm text-purple-800">
                    Fragen zum Verkaufen, Listings, Gebühren oder Auszahlungen
                  </p>
                  <p className="text-sm text-purple-600 mt-2">
                    → <a href="mailto:seller@deimudda.de" className="hover:underline">seller@deimudda.de</a>
                  </p>
                </div>

                <div className="bg-orange-50 p-4 rounded-lg border border-orange-200">
                  <div className="flex items-center gap-2 mb-2">
                    <Mail className="h-5 w-5 text-orange-600" />
                    <h3 className="font-bold text-orange-900">Datenschutz</h3>
                  </div>
                  <p className="text-sm text-orange-800">
                    Fragen zu deinen Daten, Löschung oder Auskunft
                  </p>
                  <p className="text-sm text-orange-600 mt-2">
                    → <a href="mailto:datenschutz@deimudda.de" className="hover:underline">datenschutz@deimudda.de</a>
                  </p>
                </div>

                <div className="bg-red-50 p-4 rounded-lg border border-red-200">
                  <div className="flex items-center gap-2 mb-2">
                    <MessageCircle className="h-5 w-5 text-red-600" />
                    <h3 className="font-bold text-red-900">Meldungen</h3>
                  </div>
                  <p className="text-sm text-red-800">
                    Rechtswidrige Inhalte, Verstöße gegen Nutzungsbedingungen
                  </p>
                  <p className="text-sm text-red-600 mt-2">
                    → <a href="mailto:report@deimudda.de" className="hover:underline">report@deimudda.de</a>
                  </p>
                </div>

                <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                  <div className="flex items-center gap-2 mb-2">
                    <Mail className="h-5 w-5 text-yellow-600" />
                    <h3 className="font-bold text-yellow-900">Presse & Kooperationen</h3>
                  </div>
                  <p className="text-sm text-yellow-800">
                    Presseanfragen, Partnerschaften oder Business-Anfragen
                  </p>
                  <p className="text-sm text-yellow-600 mt-2">
                    → <a href="mailto:business@deimudda.de" className="hover:underline">business@deimudda.de</a>
                  </p>
                </div>
              </div>
            </section>

            {/* Wichtiger Hinweis */}
            <div className="bg-amber-50 border-l-4 border-amber-400 p-4 mb-8">
              <h3 className="text-lg font-bold text-amber-900 mb-2">⚠️ Wichtiger Hinweis</h3>
              <p className="text-amber-800 text-sm">
                <strong>Bei Problemen mit einem Kauf oder Verkäufer:</strong> deimudda ist nur Vermittler. 
                Wende dich bitte zuerst direkt an den Verkäufer (Kontaktdaten auf der Produktseite). 
                Bei schwerwiegenden Problemen kannst du uns kontaktieren, und wir helfen bei der Vermittlung.
              </p>
            </div>

            {/* Öffnungszeiten / Antwortzeiten */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Antwortzeiten</h2>
              
              <div className="bg-gray-50 p-4 rounded-lg not-prose">
                <p className="text-gray-700 mb-2">
                  Wir bemühen uns, alle Anfragen schnellstmöglich zu beantworten:
                </p>
                <ul className="list-disc pl-6 text-gray-700 space-y-1">
                  <li><strong>Allgemeine Anfragen:</strong> Innerhalb von 24-48 Stunden</li>
                  <li><strong>Technischer Support:</strong> Innerhalb von 48 Stunden</li>
                  <li><strong>Dringende Meldungen:</strong> Innerhalb von 24 Stunden</li>
                </ul>
                <p className="text-sm text-gray-500 mt-3">
                  Bitte beachte: An Wochenenden und Feiertagen kann die Antwortzeit länger sein.
                </p>
              </div>
            </section>

            {/* FAQ-Hinweis */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Häufig gestellte Fragen</h2>
              
              <p className="text-gray-700 mb-4">
                Viele Fragen werden bereits in unseren <a href="/faq" className="text-green-600 hover:underline font-semibold">FAQ</a> beantwortet. 
                Schau dort gerne zuerst nach, bevor du uns kontaktierst!
              </p>

              <div className="bg-green-50 p-4 rounded-lg border border-green-200 not-prose">
                <p className="text-green-800 text-sm">
                  💡 <strong>Tipp:</strong> Die meisten Fragen zu Registrierung, Verkaufen, Gebühren und 
                  rechtlichen Themen werden in den FAQ ausführlich erklärt.
                </p>
              </div>
            </section>

            {/* Social Media */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Folge uns</h2>
              
              <div className="flex items-center gap-4 not-prose">
                <a 
                  href="https://www.instagram.com/kalidad420/" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  className="flex items-center gap-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-2 rounded-lg hover:from-purple-600 hover:to-pink-600 transition"
                >
                  <Instagram className="h-5 w-5" />
                  <span>@kalidad420</span>
                </a>
              </div>
              
              <p className="text-sm text-gray-600 mt-3">
                Bleib auf dem Laufenden über neue Stecklinge, Anbau-Tipps und Community-Events!
              </p>
            </section>

            {/* Besuch uns */}
            <section>
              <h2 className="text-2xl font-bold mb-4">Besuch uns vor Ort</h2>
              
              <div className="bg-gray-50 p-4 rounded-lg not-prose">
                <div className="flex items-start gap-3 mb-4">
                  <MapPin className="h-5 w-5 text-purple-600 flex-shrink-0 mt-1" />
                  <div>
                    <p className="font-bold text-gray-900">Kalidad - Grow- & Headshop</p>
                    <p className="text-gray-700">Kahlbachring 16, 69254 Malsch</p>
                  </div>
                </div>
                
                <p className="text-sm text-gray-600 mb-3">
                  Unser Partner Kalidad bietet vor Ort Beratung, Equipment und Fachwissen rund um den 
                  biologischen Cannabis-Anbau. Schau vorbei und lass dich beraten!
                </p>

                <a 
                  href="https://www.google.com/maps/search/?api=1&query=Kahlbachring+16,+69254+Malsch" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  className="text-blue-600 hover:underline text-sm font-semibold"
                >
                  → Auf Google Maps öffnen
                </a>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: CookieBanner.tsx

**`client/src/components/CookieBanner.tsx`**

```typescript
import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { X } from "lucide-react";

export default function CookieBanner() {
  const [showBanner, setShowBanner] = useState(false);

  useEffect(() => {
    // Check if user has already accepted/declined cookies
    const cookieConsent = localStorage.getItem("cookieConsent");
    if (!cookieConsent) {
      // Show banner after a short delay for better UX
      setTimeout(() => setShowBanner(true), 1000);
    }
  }, []);

  const acceptCookies = () => {
    localStorage.setItem("cookieConsent", "accepted");
    setShowBanner(false);
  };

  const declineCookies = () => {
    localStorage.setItem("cookieConsent", "declined");
    setShowBanner(false);
  };

  if (!showBanner) return null;

  return (
    <div className="fixed bottom-0 left-0 right-0 z-50 bg-gray-900 text-white p-4 shadow-2xl border-t-2 border-green-500">
      <div className="max-w-7xl mx-auto">
        <div className="flex flex-col md:flex-row items-center justify-between gap-4">
          <div className="flex-1">
            <h3 className="text-lg font-bold mb-2">🍪 Cookie-Hinweis</h3>
            <p className="text-sm text-gray-300">
              Wir verwenden nur technisch notwendige Cookies, um die Funktionalität dieser Website zu gewährleisten. 
              Diese Cookies sind für den Betrieb der Seite erforderlich und können nicht deaktiviert werden. 
              Weitere Informationen finden Sie in unserer{" "}
              <a href="/datenschutz" className="text-green-400 hover:text-green-300 underline">
                Datenschutzerklärung
              </a>.
            </p>
          </div>
          
          <div className="flex gap-3 items-center">
            <Button
              variant="outline"
              size="sm"
              onClick={declineCookies}
              className="bg-transparent border-gray-500 text-white hover:bg-gray-800"
            >
              Ablehnen
            </Button>
            <Button
              size="sm"
              onClick={acceptCookies}
              className="bg-green-600 hover:bg-green-700 text-white"
            >
              Akzeptieren
            </Button>
            <button
              onClick={() => setShowBanner(false)}
              className="text-gray-400 hover:text-white ml-2"
              aria-label="Schließen"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: DashboardLayout.tsx

**`client/src/components/DashboardLayout.tsx`**

```typescript
import { Avatar, AvatarFallback } from "@/components/ui/avatar";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarHeader,
  SidebarInset,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarProvider,
  SidebarTrigger,
  useSidebar,
} from "@/components/ui/sidebar";
import { APP_LOGO, APP_TITLE, getLoginUrl } from "@/const";
import { useIsMobile } from "@/hooks/useMobile";
import { LayoutDashboard, LogOut, PanelLeft, Users } from "lucide-react";
import { CSSProperties, useEffect, useRef, useState } from "react";
import { useLocation } from "wouter";
import { DashboardLayoutSkeleton } from './DashboardLayoutSkeleton';
import { Button } from "./ui/button";

const menuItems = [
  { icon: LayoutDashboard, label: "Page 1", path: "/" },
  { icon: Users, label: "Page 2", path: "/some-path" },
];

const SIDEBAR_WIDTH_KEY = "sidebar-width";
const DEFAULT_WIDTH = 280;
const MIN_WIDTH = 200;
const MAX_WIDTH = 480;

export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const [sidebarWidth, setSidebarWidth] = useState(() => {
    const saved = localStorage.getItem(SIDEBAR_WIDTH_KEY);
    return saved ? parseInt(saved, 10) : DEFAULT_WIDTH;
  });
  const { loading, user } = useAuth();

  useEffect(() => {
    localStorage.setItem(SIDEBAR_WIDTH_KEY, sidebarWidth.toString());
  }, [sidebarWidth]);

  if (loading) {
    return <DashboardLayoutSkeleton />
  }

  if (!user) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="flex flex-col items-center gap-8 p-8 max-w-md w-full">
          <div className="flex flex-col items-center gap-6">
            <div className="relative group">
              <div className="relative">
                <img
                  src={APP_LOGO}
                  alt={APP_TITLE}
                  className="h-20 w-20 rounded-xl object-cover shadow"
                />
              </div>
            </div>
            <div className="text-center space-y-2">
              <h1 className="text-2xl font-bold tracking-tight">{APP_TITLE}</h1>
              <p className="text-sm text-muted-foreground">
                Please sign in to continue
              </p>
            </div>
          </div>
          <Button```

#### Schritt 5.x: FAQ.tsx

**`client/src/components/FAQ.tsx`**

```typescript
import BackButton from "@/components/BackButton";
import { useState } from "react";
import { ChevronDown, ChevronUp } from "lucide-react";
import { trpc } from "@/lib/trpc";

interface FAQItem {
  question: string;
  answer: string | React.ReactNode;
  category: string;
}

export default function FAQ() {
  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);
  
  // Load dynamic fees from system settings
  const { data: platformFeeStr } = trpc.admin.getSystemSetting.useQuery('platform_fee_fixed', { staleTime: 300000 });
  const { data: paypalFeePercentageStr } = trpc.admin.getSystemSetting.useQuery('paypal_fee_percentage', { staleTime: 300000 });
  const { data: paypalFeeFixedStr } = trpc.admin.getSystemSetting.useQuery('paypal_fee_fixed', { staleTime: 300000 });
  
  const PLATFORM_FEE = parseFloat(platformFeeStr || "0.42");
  const PAYPAL_FEE_PERCENTAGE = parseFloat(paypalFeePercentageStr || "0.0249");
  const PAYPAL_FEE_FIXED = parseFloat(paypalFeeFixedStr || "0.49");
  const EXAMPLE_PAYPAL_FEE_20 = (20 * PAYPAL_FEE_PERCENTAGE + PAYPAL_FEE_FIXED).toFixed(2);

  const faqData: FAQItem[] = [
  // Allgemeine Fragen
  {
    category: "Allgemein",
    question: "Was ist deimudda?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>deimudda</strong> ist ein Online-Marktplatz für Cannabis-Stecklinge und Samen in Deutschland. 
          Wir vermitteln zwischen privaten und gewerblichen Verkäufern und Käufern.
        </p>
        <p>
          <strong>Wichtig:</strong> deimudda ist <strong>kein Händler</strong>, sondern nur Vermittler. 
          Der Kaufvertrag kommt direkt zwischen Käufer und Verkäufer zustande.
        </p>
      </div>
    )
  },
  {
    category: "Allgemein",
    question: "Ist deimudda legal?",
    answer: (
      <div>
        <p className="mb-2">
          Ja! Cannabis-Stecklinge und Samen sind seit dem <strong>Konsumcannabisgesetz (KCanG)</strong> vom 1. April 2024 
          in Deutschland legal.
        </p>
        <p className="mb-2">
          <strong>Wichtige Einschränkungen:</strong>
        </p>
        <ul className="list-disc pl-6 space-y-1">
          <li>Nur für Personen ab 18 Jahren</li>
          <li>Maximal 3 Pflanzen gleichzeitig im privaten Besitz (§ 3 Abs. 1 KCanG)</li>
          <li>Nur für legale Zwecke (Eigenanbau nach KCanG)</li>
        </ul>
      </div>
    )
  },
  {
    category: "Allgemein",
    question: "Wie funktioniert deimudda?",
    answer: (
      <div>
        <ol className="list-decimal pl-6 space-y-2">
          <li><strong>Registrierung:</strong> Erstelle einen Account (kostenlos)</li>
          <li><strong>Stöbern:</strong> Durchsuche Listings von Verkäufern</li>
          <li><strong>Kaufen:</strong> Wähle ein Listing und schließe den Kauf ab (PayPal)</li>
          <li><strong>Kontakt:</strong> Der Verkäufer kontaktiert dich für Versand/Abholung</li>
          <li><strong>Bewerten:</strong> Nach Erhalt kannst du den Verkäufer bewerten</li>
        </ol>
      </div>
    )
  },
  {
    category: "Allgemein",
    question: "Was kostet die Nutzung von deimudda?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>Für Käufer:</strong> Die Nutzung ist <strong>kostenlos</strong>. Du zahlst nur den Produktpreis + ggf. Versandkosten.
        </p>
        <p>
          <strong>Für Verkäufer:</strong> Pro verkauftem Artikel fällt eine <strong>Plattformgebühr von €{PLATFORM_FEE.toFixed(2).replace('.', ',')}</strong> an. 
          Bei Online-Zahlung über PayPal kommen zusätzlich PayPal-Gebühren hinzu (ca. {(PAYPAL_FEE_PERCENTAGE * 100).toFixed(2)}% + €{PAYPAL_FEE_FIXED.toFixed(2).replace('.', ',')}).
        </p>
      </div>
    )
  },

  // Registrierung & Account
  {
    category: "Registrierung & Account",
    question: "Wie registriere ich mich?",
    answer: (
      <div>
        <ol className="list-decimal pl-6 space-y-2">
          <li>Klicke auf "Zum Dashboard" oder "Registrieren"</li>
          <li>Melde dich über OAuth an (z.B. Google, GitHub)</li>
          <li>Wähle einen Nickname</li>
          <li>Fertig! Du kannst jetzt kaufen und verkaufen</li>
        </ol>
        <p className="mt-3 text-sm text-gray-600">
          <strong>Hinweis:</strong> Wir verwenden OAuth für sichere Authentifizierung. Deine Zugangsdaten werden nicht bei uns gespeichert.
        </p>
      </div>
    )
  },
  {
    category: "Registrierung & Account",
    question: "Kann ich meinen Account löschen?",
    answer: (
      <div>
        <p className="mb-2">
          Ja, du kannst deinen Account jederzeit in den <strong>Profil-Einstellungen</strong> löschen.
        </p>
        <p className="text-sm text-gray-600">
          <strong>Wichtig:</strong> Transaktionsdaten werden aus steuerrechtlichen Gründen 10 Jahre aufbewahrt 
          (anonymisiert nach Account-Löschung).
        </p>
      </div>
    )
  },
  {
    category: "Registrierung & Account",
    question: "Wie ändere ich mein Profil?",
    answer: (
      <div>
        <p className="mb-2">
          Gehe zu <strong>Dashboard → Profil-Einstellungen</strong>. Dort kannst du ändern:
        </p>
        <ul className="list-disc pl-6 space-y-1">
          <li>Nickname</li>
          <li>Standort</li>
          <li>Profilbild</li>
        </ul>
      </div>
    )
  },

  // Kaufen
  {
    category: "Kaufen",
    question: "Wie kaufe ich einen Steckling?",
    answer: (
      <div>
        <ol className="list-decimal pl-6 space-y-2">
          <li>Suche ein Listing auf der <strong>Browse-Seite</strong></li>
          <li>Klicke auf "Details" für mehr Informationen</li>
          <li>Klicke auf "Kaufen" oder mache einen Preisvorschlag (falls aktiviert)</li>
          <li>Wähle Versand oder Abholung</li>
          <li>Zahle über PayPal</li>
          <li>Der Verkäufer wird dich kontaktieren</li>
        </ol>
      </div>
    )
  },
  {
    category: "Kaufen",
    question: "Welche Zahlungsmethoden gibt es?",
    answer: (
      <div>
        <p className="mb-2">
          Aktuell unterstützen wir nur <strong>PayPal</strong> für Online-Zahlungen.
        </p>
        <p className="mb-2">
          <strong>Bei Abholung:</strong> Barzahlung vor Ort möglich (Vereinbarung mit Verkäufer).
        </p>
        <p className="text-sm text-gray-600">
          <strong>Hinweis:</strong> Die Zahlung geht direkt an den Verkäufer, nicht an deimudda.
        </p>
      </div>
    )
  },
  {
    category: "Kaufen",
    question: "Was sind Preisvorschläge?",
    answer: (
      <div>
        <p className="mb-2">
          Verkäufer können bei ihren Listings die <strong>Preisvorschlag-Funktion</strong> aktivieren. 
          Als Käufer kannst du dann ein Angebot machen.
        </p>
        <p className="mb-2">
          <strong>Ablauf:</strong>
        </p>
        <ol className="list-decimal pl-6 space-y-1">
          <li>Du machst ein Angebot mit deinem Wunschpreis</li>
          <li>Der Verkäufer kann annehmen oder ablehnen</li>
          <li>Bei Annahme wird automatisch eine Transaktion erstellt</li>
          <li>Du wirst zur Zahlung weitergeleitet</li>
        </ol>
      </div>
    )
  },
  {
    category: "Kaufen",
    question: "Kann ich einen Kauf widerrufen?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>Grundsätzlich ja</strong>, aber mit Einschränkungen bei lebenden Pflanzen.
        </p>
        <p className="mb-2">
          <strong>Wichtig:</strong> Der Widerruf erfolgt gegenüber dem <strong>Verkäufer</strong>, nicht gegenüber deimudda. 
          Kontaktdaten findest du auf der Produktseite.
        </p>
        <p className="mb-2">
          <strong>Ausschluss des Widerrufsrechts:</strong> Bei lebenden Pflanzen (Stecklinge) kann das Widerrufsrecht 
          ausgeschlossen sein (§ 312g Abs. 2 Nr. 2 BGB), besonders wenn die Verpackung bereits geöffnet wurde.
        </p>
        <p className="text-sm text-gray-600">
          Mehr Infos: <a href="/widerruf" className="text-blue-600 hover:underline">Widerrufsbelehrung</a>
        </p>
      </div>
    )
  },
  {
    category: "Kaufen",
    question: "Was mache ich bei Problemen mit einem Verkäufer?",
    answer: (
      <div>
        <ol className="list-decimal pl-6 space-y-2">
          <li><strong>Erst:</strong> Kontaktiere den Verkäufer direkt (Kontaktdaten auf Produktseite)</li>
          <li><strong>Dann:</strong> Falls keine Lösung, kontaktiere unseren Support: <a href="mailto:support@deimudda.de" className="text-blue-600 hover:underline">support@deimudda.de</a></li>
          <li><strong>Bei schwerwiegenden Verstößen:</strong> Wir können Maßnahmen gegen den Verkäufer ergreifen (z.B. Account-Sperrung)</li>
        </ol>
      </div>
    )
  },

  // Verkaufen
  {
    category: "Verkaufen",
    question: "Wie werde ich Verkäufer?",
    answer: (
      <div>
        <ol className="list-decimal pl-6 space-y-2">
          <li>Registriere dich auf deimudda</li>
          <li>Gehe zu <strong>Dashboard → Verkäufer werden</strong></li>
          <li>Fülle das Verkäufer-Profil aus (Shop-Name, Beschreibung, Standort)</li>
          <li>Erstelle dein erstes Listing</li>
        </ol>
        <p className="mt-3 text-sm text-gray-600">
          <strong>Hinweis:</strong> Gewerbliche Verkäufer müssen ein eigenes Impressum und eine Datenschutzerklärung bereitstellen.
        </p>
      </div>
    )
  },
  {
    category: "Verkaufen",
    question: "Was kostet das Verkaufen?",
    answer: (
      <div>
        <p className="mb-2">
          Pro verkauftem Artikel fällt eine <strong>Plattformgebühr von €{PLATFORM_FEE.toFixed(2).replace('.', ',')}</strong> an.
        </p>
        <p className="mb-2">
          <strong>Bei Online-Zahlung (PayPal):</strong>
        </p>
        <ul className="list-disc pl-6 space-y-1">
          <li>PayPal-Gebühr: ca. {(PAYPAL_FEE_PERCENTAGE * 100).toFixed(2)}% + €{PAYPAL_FEE_FIXED.toFixed(2).replace('.', ',')}</li>
          <li>Beispiel: Bei €20 Verkaufspreis → €{EXAMPLE_PAYPAL_FEE_20.replace('.', ',')} PayPal-Gebühr</li>
        </ul>
        <p className="mt-2 text-sm text-gray-600">
          <strong>Bei Abholung (Barzahlung):</strong> Nur die Plattformgebühr (€{PLATFORM_FEE.toFixed(2).replace('.', ',')}), keine PayPal-Gebühren.
        </p>
      </div>
    )
  },
  {
    category: "Verkaufen",
    question: "Wie erstelle ich ein Listing?",
    answer: (
      <div>
        <ol className="list-decimal pl-6 space-y-2">
          <li>Gehe zu <strong>Verkäufer-Dashboard → Neues Listing</strong></li>
          <li>Fülle alle Pflichtfelder aus:
            <ul className="list-disc pl-6 mt-1">
              <li>Strain-Name (Sorte)</li>
              <li>Produkttyp (Steckling oder Samen)</li>
              <li>Preis</li>
              <li>Menge</li>
              <li>Beschreibung</li>
              <li>Bilder (mindestens 1)</li>
            </ul>
          </li>
          <li>Wähle Versandoptionen (Versand, Abholung oder beides)</li>
          <li>Optional: Aktiviere Preisvorschläge</li>
          <li>Klicke auf "Listing erstellen"</li>
        </ol>
      </div>
    )
  },
  {
    category: "Verkaufen",
    question: "Wie funktioniert die Auszahlung?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>Bei Online-Zahlung (PayPal):</strong> Das Geld geht direkt auf dein PayPal-Konto (abzüglich Gebühren).
        </p>
        <p className="mb-2">
          <strong>Bei Abholung (Barzahlung):</strong> Du erhältst das Geld direkt vom Käufer. Die Plattformgebühr (€{PLATFORM_FEE.toFixed(2).replace('.', ',')}) 
          wird später von deinem PayPal-Konto abgebucht.
        </p>
        <p className="text-sm text-gray-600">
          <strong>Wichtig:</strong> Stelle sicher, dass dein PayPal-Konto ausreichend Guthaben für die Plattformgebühren hat.
        </p>
      </div>
    )
  },
  {
    category: "Verkaufen",
    question: "Muss ich als Verkäufer ein Impressum haben?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>Gewerbliche Verkäufer: Ja!</strong> Du bist verpflichtet, ein eigenes Impressum und eine Datenschutzerklärung bereitzustellen.
        </p>
        <p className="mb-2">
          <strong>Private Verkäufer: Nein.</strong> Bei gelegentlichem Verkauf (z.B. Überschuss aus eigenem Anbau) ist kein Impressum erforderlich.
        </p>
        <p className="text-sm text-gray-600">
          <strong>Tipp:</strong> Bei Unsicherheit konsultiere einen Rechtsanwalt für IT-Recht.
        </p>
      </div>
    )
  },

  // Rechtliches
  {
    category: "Rechtliches",
    question: "Darf ich Cannabis-Blüten verkaufen?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>Nein!</strong> Auf deimudda dürfen nur <strong>Stecklinge und Samen</strong> gehandelt werden.
        </p>
        <p className="mb-2">
          Der Verkauf von <strong>Blütenständen</strong> (Cannabis-Blüten, Ernteprodukte) ist <strong>nicht erlaubt</strong> 
          und verstößt gegen unsere Nutzungsbedingungen.
        </p>
        <p className="text-sm text-gray-600">
          <strong>Konsequenz:</strong> Verstöße führen zur sofortigen Account-Sperrung und ggf. Strafanzeige.
        </p>
      </div>
    )
  },
  {
    category: "Rechtliches",
    question: "Wie viele Pflanzen darf ich besitzen?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>Private Nutzer:</strong> Maximal <strong>3 Pflanzen gleichzeitig</strong> (§ 3 Abs. 1 KCanG).
        </p>
        <p className="mb-2">
          <strong>Anbauvereinigungen:</strong> Andere Regelungen (siehe KCanG).
        </p>
        <p className="text-sm text-gray-600">
          <strong>Wichtig:</strong> deimudda übernimmt keine Haftung für Verstöße gegen das KCanG. 
          Informiere dich über die gesetzlichen Bestimmungen!
        </p>
      </div>
    )
  },
  {
    category: "Rechtliches",
    question: "Wer ist für Widerrufe zuständig?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>Der Verkäufer</strong>, nicht deimudda!
        </p>
        <p className="mb-2">
          deimudda ist nur Vermittler. Der Kaufvertrag kommt direkt zwischen dir und dem Verkäufer zustande. 
          Für Widerrufe, Rücksendungen und Reklamationen ist der Verkäufer verantwortlich.
        </p>
        <p className="text-sm text-gray-600">
          Mehr Infos: <a href="/widerruf" className="text-blue-600 hover:underline">Widerrufsbelehrung</a>
        </p>
      </div>
    )
  },
  {
    category: "Rechtliches",
    question: "Wie werden meine Daten geschützt?",
    answer: (
      <div>
        <p className="mb-2">
          Wir nehmen Datenschutz ernst und halten uns an die <strong>DSGVO</strong>.
        </p>
        <p className="mb-2">
          <strong>Wichtig:</strong> Wenn du einen Kauf tätigst, werden deine Kontaktdaten an den Verkäufer übermittelt 
          (für Versand/Abholung). Der Verkäufer ist eigenständiger Datenverantwortlicher.
        </p>
        <p className="text-sm text-gray-600">
          Mehr Infos: <a href="/datenschutz" className="text-blue-600 hover:underline">Datenschutzerklärung</a>
        </p>
      </div>
    )
  },

  // Technisches
  {
    category: "Technisches",
    question: "Welche Browser werden unterstützt?",
    answer: (
      <div>
        <p className="mb-2">
          deimudda funktioniert mit allen modernen Browsern:
        </p>
        <ul className="list-disc pl-6 space-y-1">
          <li>Chrome / Chromium (empfohlen)</li>
          <li>Firefox</li>
          <li>Safari</li>
          <li>Edge</li>
        </ul>
        <p className="text-sm text-gray-600 mt-2">
          <strong>Hinweis:</strong> Stelle sicher, dass JavaScript aktiviert ist und Cookies erlaubt sind.
        </p>
      </div>
    )
  },
  {
    category: "Technisches",
    question: "Ich habe einen Bug gefunden. Was tun?",
    answer: (
      <div>
        <p className="mb-2">
          Danke für deine Hilfe! Bitte melde Bugs an: <a href="mailto:support@deimudda.de" className="text-blue-600 hover:underline">support@deimudda.de</a>
        </p>
        <p className="mb-2">
          <strong>Bitte gib an:</strong>
        </p>
        <ul className="list-disc pl-6 space-y-1">
          <li>Was ist passiert?</li>
          <li>Was hast du erwartet?</li>
          <li>Welcher Browser / welches Gerät?</li>
          <li>Screenshots (falls möglich)</li>
        </ul>
      </div>
    )
  },
  {
    category: "Technisches",
    question: "Gibt es eine mobile App?",
    answer: (
      <div>
        <p className="mb-2">
          Aktuell nicht, aber die Website ist <strong>mobilfreundlich</strong> (responsive Design).
        </p>
        <p className="text-sm text-gray-600">
          Du kannst deimudda problemlos auf deinem Smartphone oder Tablet nutzen.
        </p>
      </div>
    )
  }
  ];

  const categories = Array.from(new Set(faqData.map(item => item.category)));

  function FAQAccordion({ item }: { item: FAQItem }) {
    const [isOpen, setIsOpen] = useState(false);

    return (
      <div className="border border-gray-200 rounded-lg overflow-hidden">
        <button
          onClick={() => setIsOpen(!isOpen)}
          className="w-full px-6 py-4 text-left bg-white hover:bg-gray-50 transition flex items-center justify-between"
        >
          <span className="font-semibold text-gray-900">{item.question}</span>
          {isOpen ? (
            <ChevronUp className="h-5 w-5 text-gray-500 flex-shrink-0" />
          ) : (
            <ChevronDown className="h-5 w-5 text-gray-500 flex-shrink-0" />
          )}
        </button>
        {isOpen && (
          <div className="px-6 py-4 bg-gray-50 border-t border-gray-200">
            <div className="text-gray-700 prose prose-sm max-w-none">
              {item.answer}
            </div>
          </div>
        )}
      </div>
    );
  }

  const filteredFAQs = selectedCategory
    ? faqData.filter(item => item.category === selectedCategory)
    : faqData;

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 py-12">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <BackButton href="/" label="Zurück zur Startseite" />
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-4 text-gray-900">Häufig gestellte Fragen (FAQ)</h1>
          <p className="text-lg text-gray-700 mb-8">
            Hier findest du Antworten auf die häufigsten Fragen zu deimudda.
          </p>

          {/* Category Filter */}
          <div className="mb-8">
            <h2 className="text-sm font-semibold text-gray-600 mb-3">Kategorie filtern:</h2>
            <div className="flex flex-wrap gap-2">
              <button
                onClick={() => setSelectedCategory(null)}
                className={`px-4 py-2 rounded-lg font-medium transition ${
                  selectedCategory === null
                    ? "bg-green-600 text-white"
                    : "bg-gray-100 text-gray-700 hover:bg-gray-200"
                }`}
              >
                Alle
              </button>
              {categories.map(category => (
                <button
                  key={category}
                  onClick={() => setSelectedCategory(category)}
                  className={`px-4 py-2 rounded-lg font-medium transition ${
                    selectedCategory === category
                      ? "bg-green-600 text-white"
                      : "bg-gray-100 text-gray-700 hover:bg-gray-200"
                  }`}
                >
                  {category}
                </button>
              ))}
            </div>
          </div>

          {/* FAQ Items */}
          <div className="space-y-3">
            {filteredFAQs.map((item, index) => (
              <FAQAccordion key={index} item={item} />
            ))}
          </div>

          {/* Contact Hint */}
          <div className="mt-8 bg-green-50 border-l-4 border-green-500 p-6 rounded-r-lg">
            <h3 className="text-lg font-bold text-green-900 mb-2">Deine Frage ist nicht dabei?</h3>
            <p className="text-green-800 mb-3">
              Kein Problem! Kontaktiere uns einfach:
            </p>
            <a
              href="/contact"
              className="inline-block bg-green-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-green-700 transition"
            >
              Zum Kontaktformular
            </a>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: FeeStructure.tsx

**`client/src/components/FeeStructure.tsx`**

```typescript
import BackButton from "@/components/BackButton";
import { Calculator, Info, TrendingUp } from "lucide-react";
import { useState } from "react";
import { trpc } from "@/lib/trpc";

export default function FeeStructure() {
  const [price, setPrice] = useState<number>(20);
  const [method, setMethod] = useState<"online" | "cash">("online");

  // Load dynamic fees from system settings
  const { data: platformFeeStr } = trpc.admin.getSystemSetting.useQuery('platform_fee_fixed', { staleTime: 300000 });
  const { data: paypalFeePercentageStr } = trpc.admin.getSystemSetting.useQuery('paypal_fee_percentage', { staleTime: 300000 });
  const { data: paypalFeeFixedStr } = trpc.admin.getSystemSetting.useQuery('paypal_fee_fixed', { staleTime: 300000 });
  
  const platformFee = parseFloat(platformFeeStr || "0.42");
  const paypalPercentage = parseFloat(paypalFeePercentageStr || "0.0249");
  const paypalFixed = parseFloat(paypalFeeFixedStr || "0.49");

  const paypalFee = method === "online" ? price * paypalPercentage + paypalFixed : 0;
  const totalFees = platformFee + paypalFee;
  const sellerReceives = price - totalFees;

  return (
    <div className="min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 py-12">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <BackButton href="/" label="Zurück zur Startseite" />
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-8 text-gray-900">Gebührenstruktur</h1>
          
          <div className="prose prose-lg max-w-none">
            <p className="text-lg text-gray-700 mb-8">
              Transparenz ist uns wichtig! Hier erfährst du genau, welche Gebühren auf deimudda anfallen 
              und wie sie berechnet werden.
            </p>

            {/* Übersicht */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">📊 Gebühren-Übersicht</h2>
              
              <div className="grid md:grid-cols-2 gap-6 not-prose">
                {/* Für Käufer */}
                <div className="bg-blue-50 p-6 rounded-lg border border-blue-200">
                  <h3 className="text-xl font-bold text-blue-900 mb-3">Für Käufer</h3>
                  <div className="space-y-2">
                    <div className="flex justify-between items-center">
                      <span className="text-blue-800">Registrierung:</span>
                      <span className="font-bold text-blue-900">Kostenlos</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-blue-800">Nutzung:</span>
                      <span className="font-bold text-blue-900">Kostenlos</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-blue-800">Kaufgebühr:</span>
                      <span className="font-bold text-blue-900">€0,00</span>
                    </div>
                  </div>
                  <p className="text-sm text-blue-700 mt-4">
                    Du zahlst nur den Produktpreis + ggf. Versandkosten. Keine versteckten Gebühren!
                  </p>
                </div>

                {/* Für Verkäufer */}
                <div className="bg-green-50 p-6 rounded-lg border border-green-200">
                  <h3 className="text-xl font-bold text-green-900 mb-3">Für Verkäufer</h3>
                  <div className="space-y-2">
                    <div className="flex justify-between items-center">
                      <span className="text-green-800">Registrierung:</span>
                      <span className="font-bold text-green-900">Kostenlos</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-green-800">Listing erstellen:</span>
                      <span className="font-bold text-green-900">Kostenlos</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-green-800">Plattformgebühr:</span>
                      <span className="font-bold text-green-900">€{platformFee.toFixed(2).replace('.', ',')} / Artikel</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-green-800">PayPal-Gebühr:</span>
                      <span className="font-bold text-green-900">~{(paypalPercentage * 100).toFixed(2)}% + €{paypalFixed.toFixed(2).replace('.', ',')}</span>
                    </div>
                  </div>
                  <p className="text-sm text-green-700 mt-4">
                    Gebühren fallen nur bei erfolgreichem Verkauf an. Keine monatlichen Kosten!
                  </p>
                </div>
              </div>
            </section>

            {/* Detaillierte Gebühren */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">💰 Detaillierte Gebühren für Verkäufer</h2>
              
              <div className="space-y-6">
                {/* Plattformgebühr */}
                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                  <h3 className="text-xl font-semibold text-gray-900 mb-3">1. Plattformgebühr</h3>
                  
                  <div className="flex items-center justify-between mb-4">
                    <span className="text-gray-700">Gebühr pro verkauftem Artikel:</span>
                    <span className="text-2xl font-bold text-green-600">€{platformFee.toFixed(2).replace('.', ',')}</span>
                  </div>

                  <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <p className="text-sm text-blue-800">
                      <Info className="inline h-4 w-4 mr-1" />
                      <strong>Was deckt die Plattformgebühr ab?</strong>
                    </p>
                    <ul className="list-disc pl-6 mt-2 space-y-1 text-sm text-blue-800">
                      <li>Hosting und Betrieb der Plattform</li>
                      <li>Zahlungsabwicklung</li>
                      <li>Sicherheit und Datenschutz</li>
                      <li>Support und Kundenservice</li>
                      <li>Weiterentwicklung der Plattform</li>
                    </ul>
                  </div>
                </div>

                {/* PayPal-Gebühr */}
                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                  <h3 className="text-xl font-semibold text-gray-900 mb-3">2. PayPal-Gebühr (bei Online-Zahlung)</h3>
                  
                  <div className="space-y-3">
                    <div className="flex items-center justify-between">
                      <span className="text-gray-700">Prozentuale Gebühr:</span>
                      <span className="text-xl font-bold text-gray-900">{(paypalPercentage * 100).toFixed(2)}%</span>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-gray-700">Fixe Gebühr:</span>
                      <span className="text-xl font-bold text-gray-900">+ €{paypalFixed.toFixed(2).replace('.', ',')}</span>
                    </div>
                  </div>

                  <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200 mt-4">
                    <p className="text-sm text-yellow-800">
                      <strong>Wichtig:</strong> Die PayPal-Gebühr fällt nur bei <strong>Online-Zahlung</strong> an. 
                      Bei <strong>Abholung mit Barzahlung</strong> entfällt diese Gebühr.
                    </p>
                  </div>

                  <p className="text-sm text-gray-600 mt-3">
                    Die PayPal-Gebühr wird direkt von PayPal erhoben, nicht von deimudda. 
                    Wir haben keinen Einfluss auf die Höhe dieser Gebühr.
                  </p>
                </div>
              </div>
            </section>

            {/* Gebühren-Rechner */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                <Calculator className="h-6 w-6" />
                Gebühren-Rechner
              </h2>
              
              <div className="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-lg border-2 border-green-200 not-prose">
                <p className="text-gray-700 mb-4">
                  Berechne, wie viel du nach Abzug der Gebühren erhältst:
                </p>

                <div className="space-y-4">
                  {/* Verkaufspreis */}
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                      Verkaufspreis (€)
                    </label>
                    <input
                      type="number"
                      value={price}
                      onChange={(e) => setPrice(parseFloat(e.target.value) || 0)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                      min="0"
                      step="0.01"
                    />
                  </div>

                  {/* Zahlungsmethode */}
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                      Zahlungsmethode
                    </label>
                    <div className="flex gap-4">
                      <button
                        onClick={() => setMethod("online")}
                        className={`flex-1 px-4 py-2 rounded-lg font-medium transition ${
                          method === "online"
                            ? "bg-green-600 text-white"
                            : "bg-gray-200 text-gray-700 hover:bg-gray-300"
                        }`}
                      >
                        Online (PayPal)
                      </button>
                      <button
                        onClick={() => setMethod("cash")}
                        className={`flex-1 px-4 py-2 rounded-lg font-medium transition ${
                          method === "cash"
                            ? "bg-green-600 text-white"
                            : "bg-gray-200 text-gray-700 hover:bg-gray-300"
                        }`}
                      >
                        Abholung (Bar)
                      </button>
                    </div>
                  </div>

                  {/* Berechnung */}
                  <div className="bg-white p-4 rounded-lg border border-gray-300 space-y-2">
                    <div className="flex justify-between items-center text-gray-700">
                      <span>Verkaufspreis:</span>
                      <span className="font-semibold">€{price.toFixed(2)}</span>
                    </div>
                    <div className="flex justify-between items-center text-gray-700">
                      <span>Plattformgebühr:</span>
                      <span className="font-semibold text-red-600">- €{platformFee.toFixed(2)}</span>
                    </div>
                    {method === "online" && (
                      <div className="flex justify-between items-center text-gray-700">
                        <span>PayPal-Gebühr:</span>
                        <span className="font-semibold text-red-600">- €{paypalFee.toFixed(2)}</span>
                      </div>
                    )}
                    <div className="border-t border-gray-300 pt-2 mt-2">
                      <div className="flex justify-between items-center">
                        <span className="font-bold text-gray-900">Du erhältst:</span>
                        <span className="text-2xl font-bold text-green-600">€{sellerReceives.toFixed(2)}</span>
                      </div>
                    </div>
                  </div>

                  <div className="bg-blue-50 p-3 rounded-lg border border-blue-200">
                    <p className="text-sm text-blue-800">
                      <Info className="inline h-4 w-4 mr-1" />
                      <strong>Tipp:</strong> Bei Abholung mit Barzahlung sparst du die PayPal-Gebühr!
                    </p>
                  </div>
                </div>
              </div>
            </section>

            {/* Beispielrechnungen */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">📈 Beispielrechnungen</h2>
              
              <div className="space-y-4 not-prose">
                {/* Beispiel 1 */}
                <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                  <h3 className="font-bold text-gray-900 mb-3">Beispiel 1: €10 Steckling (Online-Zahlung)</h3>
                  <div className="space-y-1 text-sm">
                    <div className="flex justify-between">
                      <span>Verkaufspreis:</span>
                      <span className="font-semibold">€10,00</span>
                    </div>
                    <div className="flex justify-between text-red-600">
                      <span>- Plattformgebühr:</span>
                      <span className="font-semibold">€{platformFee.toFixed(2).replace('.', ',')}</span>
                    </div>
                    <div className="flex justify-between text-red-600">
                      <span>- PayPal-Gebühr ({(paypalPercentage * 100).toFixed(2)}% + €{paypalFixed.toFixed(2).replace('.', ',')}):</span>
                      <span className="font-semibold">€{(15 * paypalPercentage + paypalFixed).toFixed(2).replace('.', ',')}</span>
                    </div>
                    <div className="flex justify-between border-t border-gray-300 pt-1 mt-1">
                      <span className="font-bold">Du erhältst:</span>
                      <span className="font-bold text-green-600">€8,70</span>
                    </div>
                  </div>
                </div>

                {/* Beispiel 2 */}
                <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                  <h3 className="font-bold text-gray-900 mb-3">Beispiel 2: €20 Steckling (Online-Zahlung)</h3>
                  <div className="space-y-1 text-sm">
                    <div className="flex justify-between">
                      <span>Verkaufspreis:</span>
                      <span className="font-semibold">€20,00</span>
                    </div>
                    <div className="flex justify-between text-red-600">
                      <span>- Plattformgebühr:</span>
                      <span className="font-semibold">€{platformFee.toFixed(2).replace('.', ',')}</span>
                    </div>
                    <div className="flex justify-between text-red-600">
                      <span>- PayPal-Gebühr ({(paypalPercentage * 100).toFixed(2)}% + €{paypalFixed.toFixed(2).replace('.', ',')}):</span>
                      <span className="font-semibold">€{(20 * paypalPercentage + paypalFixed).toFixed(2).replace('.', ',')}</span>
                    </div>
                    <div className="flex justify-between border-t border-gray-300 pt-1 mt-1">
                      <span className="font-bold">Du erhältst:</span>
                      <span className="font-bold text-green-600">€18,17</span>
                    </div>
                  </div>
                </div>

                {/* Beispiel 3 */}
                <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                  <h3 className="font-bold text-green-900 mb-3">Beispiel 3: €20 Steckling (Abholung, Barzahlung)</h3>
                  <div className="space-y-1 text-sm">
                    <div className="flex justify-between">
                      <span>Verkaufspreis:</span>
                      <span className="font-semibold">€20,00</span>
                    </div>
                    <div className="flex justify-between text-red-600">
                      <span>- Plattformgebühr:</span>
                      <span className="font-semibold">€{platformFee.toFixed(2).replace('.', ',')}</span>
                    </div>
                    <div className="flex justify-between text-gray-500">
                      <span>- PayPal-Gebühr:</span>
                      <span className="font-semibold">€0,00</span>
                    </div>
                    <div className="flex justify-between border-t border-green-300 pt-1 mt-1">
                      <span className="font-bold">Du erhältst:</span>
                      <span className="font-bold text-green-600">€19,58</span>
                    </div>
                  </div>
                  <p className="text-xs text-green-700 mt-2">
                    <TrendingUp className="inline h-3 w-3 mr-1" />
                    Ersparnis: €1,41 durch Barzahlung!
                  </p>
                </div>
              </div>
            </section>

            {/* Tipps zur Gebühren-Optimierung */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">💡 Tipps zur Gebühren-Optimierung</h2>
              
              <div className="space-y-3 not-prose">
                <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                  <h3 className="font-bold text-blue-900 mb-2">1. Abholung anbieten</h3>
                  <p className="text-sm text-blue-800">
                    Bei Barzahlung sparst du die PayPal-Gebühr. Das kann bei höheren Preisen einen großen Unterschied machen!
                  </p>
                </div>

                <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                  <h3 className="font-bold text-green-900 mb-2">2. Gebühren einkalkulieren</h3>
                  <p className="text-sm text-green-800">
                    Setze deinen Preis so, dass du nach Abzug der Gebühren den gewünschten Betrag erhältst. 
                    Nutze den Gebühren-Rechner oben!
                  </p>
                </div>

                <div className="bg-purple-50 p-4 rounded-lg border border-purple-200">
                  <h3 className="font-bold text-purple-900 mb-2">3. Mehrere Artikel verkaufen</h3>
                  <p className="text-sm text-purple-800">
                    Die Plattformgebühr (€{platformFee.toFixed(2).replace('.', ',')}) ist fix. Bei höheren Preisen fällt sie prozentual weniger ins Gewicht.
                  </p>
                </div>

                <div className="bg-orange-50 p-4 rounded-lg border border-orange-200">
                  <h3 className="font-bold text-orange-900 mb-2">4. Versandkosten separat berechnen</h3>
                  <p className="text-sm text-orange-800">
                    Versandkosten können separat angegeben werden und unterliegen nicht den Gebühren.
                  </p>
                </div>
              </div>
            </section>

            {/* Vergleich mit anderen Plattformen */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">🔍 Vergleich mit anderen Plattformen</h2>
              
              <div className="overflow-x-auto not-prose">
                <table className="w-full border-collapse border border-gray-300">
                  <thead className="bg-gray-100">
                    <tr>
                      <th className="border border-gray-300 px-4 py-2 text-left">Plattform</th>
                      <th className="border border-gray-300 px-4 py-2 text-left">Gebühren</th>
                      <th className="border border-gray-300 px-4 py-2 text-left">Bei €20 Verkauf</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr className="bg-green-50">
                      <td className="border border-gray-300 px-4 py-2 font-bold">deimudda</td>
                      <td className="border border-gray-300 px-4 py-2">€{platformFee.toFixed(2).replace('.', ',')} + PayPal (~{(paypalPercentage * 100).toFixed(1)}%)</td>
                      <td className="border border-gray-300 px-4 py-2 font-bold text-green-600">€18,17</td>
                    </tr>
                    <tr>
                      <td className="border border-gray-300 px-4 py-2">eBay</td>
                      <td className="border border-gray-300 px-4 py-2">~13% + PayPal</td>
                      <td className="border border-gray-300 px-4 py-2">~€15,50</td>
                    </tr>
                    <tr>
                      <td className="border border-gray-300 px-4 py-2">eBay Kleinanzeigen</td>
                      <td className="border border-gray-300 px-4 py-2">Kostenlos (keine Zahlung)</td>
                      <td className="border border-gray-300 px-4 py-2">€20,00 (bar)</td>
                    </tr>
                    <tr>
                      <td className="border border-gray-300 px-4 py-2">Etsy</td>
                      <td className="border border-gray-300 px-4 py-2">~8% + PayPal</td>
                      <td className="border border-gray-300 px-4 py-2">~€16,50</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <p className="text-sm text-gray-600 mt-3">
                <strong>Hinweis:</strong> deimudda bietet eine faire Gebührenstruktur speziell für Cannabis-Stecklinge. 
                Andere Plattformen erlauben Cannabis-Produkte oft gar nicht oder haben deutlich höhere Gebühren.
              </p>
            </section>

            {/* FAQ */}
            <section>
              <h2 className="text-2xl font-bold mb-4">❓ Häufige Fragen zu Gebühren</h2>
              
              <div className="space-y-4 not-prose">
                <div className="border border-gray-200 rounded-lg p-4">
                  <h3 className="font-bold text-gray-900 mb-2">Wann werden die Gebühren abgebucht?</h3>
                  <p className="text-sm text-gray-700">
                    Die PayPal-Gebühr wird sofort bei der Zahlung abgezogen. Die Plattformgebühr (€{platformFee.toFixed(2).replace('.', ',')}) wird 
                    nach Abschluss der Transaktion von deinem PayPal-Konto abgebucht.
                  </p>
                </div>

                <div className="border border-gray-200 rounded-lg p-4">
                  <h3 className="font-bold text-gray-900 mb-2">Gibt es versteckte Gebühren?</h3>
                  <p className="text-sm text-gray-700">
                    Nein! Die Gebührenstruktur ist vollständig transparent. Es gibt keine versteckten Kosten, 
                    monatlichen Gebühren oder Überraschungen.
                  </p>
                </div>

                <div className="border border-gray-200 rounded-lg p-4">
                  <h3 className="font-bold text-gray-900 mb-2">Kann ich die Gebühren an den Käufer weitergeben?</h3>
                  <p className="text-sm text-gray-700">
                    Ja, du kannst die Gebühren in deinen Verkaufspreis einkalkulieren. Nutze den Gebühren-Rechner 
                    oben, um den optimalen Preis zu berechnen.
                  </p>
                </div>

                <div className="border border-gray-200 rounded-lg p-4">
                  <h3 className="font-bold text-gray-900 mb-2">Was passiert bei Rückerstattungen?</h3>
                  <p className="text-sm text-gray-700">
                    Bei Rückerstattungen werden die PayPal-Gebühren zurückerstattet. Die Plattformgebühr (€{platformFee.toFixed(2).replace('.', ',')}) 
                    wird nicht zurückerstattet, da die Transaktion bereits abgewickelt wurde.
                  </p>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: Header.tsx

**`client/src/components/Header.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import { Button } from "@/components/ui/button";
import { APP_TITLE, getLoginUrl } from "@/const";
import { Link } from "wouter";
import { NotificationBell } from "@/components/NotificationBell";
import { MessageIcon } from "@/components/MessageIcon";

/**
 * Global navigation header component
 * Displays logo, user info, messages, notifications, dashboard link, and logout
 * Should be used on all main pages for consistent navigation
 */
export function Header() {
  const { user, isAuthenticated, logout } = useAuth();

  return (
    <nav className="bg-white shadow-sm sticky top-0 z-50">
      <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
        <Link href="/">
          <div className="flex items-center gap-2 cursor-pointer hover:opacity-80 transition">
            <img src="/seedling-logo.png" alt="deimudda Logo" className="h-10 w-10" />
            <h1 className="text-2xl font-bold text-green-700">{APP_TITLE}</h1>
          </div>
        </Link>
        <div className="flex items-center gap-4">
          {isAuthenticated ? (
            <>
              <span className="text-sm text-gray-600 hidden sm:inline">Hallo, {user?.name}</span>
              <MessageIcon />
              <NotificationBell />
              <Link href="/profile">
                <Button variant="outline" size="sm">
                  Dashboard
                </Button>
              </Link>
              <Button
                variant="ghost"
                size="sm"
                onClick={() => logout()}
              >
                Logout
              </Button>
            </>
          ) : (
            <Button
              size="sm"
              onClick={() => (window.location.href = getLoginUrl())}
            >
              Login / Registrieren
            </Button>
          )}
        </div>
      </div>
    </nav>
  );
}

```

#### Schritt 5.x: Home.tsx

**`client/src/components/Home.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { APP_LOGO, APP_TITLE, getLoginUrl } from "@/const";
import { Link } from "wouter";
import { trpc } from "@/lib/trpc";
import { ShoppingCart, Leaf, TrendingUp, Lock, Zap, Users, Search } from "lucide-react";
import { useState } from "react";
import type { Listing } from "@/../../shared/types";
import { useLocation } from "wouter";
import { NotificationBell } from "@/components/NotificationBell";
import { MessageIcon } from "@/components/MessageIcon";

export default function Home() {
  const { user, isAuthenticated, logout } = useAuth();
  const activeListings = trpc.listing.getActive.useQuery({ limit: 6 }, { staleTime: 60000 });
  const platformFee = trpc.admin.getSystemSetting.useQuery('platform_fee_fixed', { staleTime: 300000 });
  const paypalFeePercentage = trpc.admin.getSystemSetting.useQuery('paypal_fee_percentage', { staleTime: 300000 });
  const paypalFeeFixed = trpc.admin.getSystemSetting.useQuery('paypal_fee_fixed', { staleTime: 300000 });
  
  const PLATFORM_FEE = parseFloat(platformFee.data || "0.42");
  const PAYPAL_FEE_PERCENTAGE = parseFloat(paypalFeePercentage.data || "0.0249");
  const PAYPAL_FEE_FIXED = parseFloat(paypalFeeFixed.data || "0.49");
  const EXAMPLE_PAYPAL_FEE = (10 * PAYPAL_FEE_PERCENTAGE + PAYPAL_FEE_FIXED); // Example for €10
  const [searchQuery, setSearchQuery] = useState("");
  const [, setLocation] = useLocation();

  const handleSearch = (e: React.FormEvent) => {
    e.preventDefault();
    if (searchQuery.trim()) {
      setLocation(`/browse?search=${encodeURIComponent(searchQuery)}`);
    } else {
      setLocation('/browse');
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      {/* Navigation */}
      <nav className="bg-white shadow-sm sticky top-0 z-50">
        <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
          <div className="flex items-center gap-2">
            <img src="/seedling-logo.png" alt="deimudda Logo" className="h-10 w-10" />
            <h1 className="text-2xl font-bold text-green-700">{APP_TITLE}</h1>
          </div>
          <div className="flex items-center gap-4">
            {isAuthenticated ? (
              <>
                <span className="text-sm text-gray-600">Hallo, {user?.name}</span>
                <MessageIcon />
                <NotificationBell />
                <Link href="/profile">
                  <Button variant="outline" size="sm">
                    Dashboard
                  </Button>
                </Link>
                <Button
                  variant="ghost"
                  size="sm"
                  onClick={() => logout()}
                >
                  Logout
                </Button>
              </>
            ) : (
              <Button
                size="sm"
                onClick={() => (window.location.href = getLoginUrl())}
              >
                Login / Registrieren
              </Button>
            )}
          </div>
        </div>
      </nav>

      {/* Hero Section */}
      <section className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-20 text-center">
        {/* Seedling Logo */}
        <div className="flex justify-center mb-8">
          <img 
            src="/seedling-logo.png" 
            alt="Cannabis Stecklinge" 
            className="h-32 w-auto"
          />
        </div>
        <h2 className="text-5xl font-bold text-gray-900 mb-6">
          Cannabis-Stecklinge & Samen
        </h2>
        <p className="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
          Die erste legale Marktplattform für Cannabis-Vermehrungsmaterial in Deutschland.
          Kaufen und verkaufen Sie Stecklinge und Samen sicher und transparent.
        </p>
        {/* Search Bar */}
        <form onSubmit={handleSearch} className="max-w-2xl mx-auto mb-8">
          <div className="relative">
            <input
              type="text"
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              placeholder="Suche nach Strain, Typ, Verkäufer..."
              className="w-full px-6 py-4 pr-14 text-lg border-2 border-gray-300 rounded-full focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition"
            />
            <button
              type="submit"
              className="absolute right-2 top-1/2 -translate-y-1/2 bg-green-600 text-white p-3 rounded-full hover:bg-green-700 transition"
            >
              <Search className="w-5 h-5" />
            </button>
          </div>
        </form>

        <div className="flex gap-4 justify-center flex-wrap">
          <Link href="/profile">
            <Button size="lg" className="gap-2">
              <Leaf className="w-5 h-5" />
              {isAuthenticated ? "Zum Dashboard" : "Als Verkäufer starten"}
            </Button>
          </Link>
          <Link href="/browse">
            <Button variant="outline" size="lg" className="gap-2">
              <ShoppingCart className="w-5 h-5" />
              Stecklinge kaufen
            </Button>
          </Link>
        </div>
      </section>

      {/* Legal Disclaimer */}
      <section className="bg-red-50 border-l-4 border-red-500 py-8 px-6 mb-8">
        <div className="max-w-4xl mx-auto">
          <h2 className="text-lg font-bold text-red-900 mb-3">⚠️ Wichtiger Disclaimer</h2>
          <div className="text-sm text-red-800 space-y-2">
            <p>
              <strong>Rechtliche Rahmenbedingungen:</strong> Diese Plattform ist ausschließlich für den Handel mit Cannabis-Stecklingen und Samen gemäß des Konsumcannabisgesetzes (KCanG) bestimmt. Alle Nutzer verpflichten sich, die geltenden Gesetze einzuhalten.
            </p>
            <p>
              <strong>Zulässige Produkte:</strong> Es dürfen nur Stecklinge und Samen ohne Blütenstände, Fruchtstände oder andere Pflanzenteile mit Cannabinoid-Gehalt verkauft werden. Blüten, verarbeitete Produkte und andere illegale Waren sind streng verboten.
            </p>
            <p>
              <strong>Eigenverantwortung:</strong> Käufer und Verkäufer handeln in vollständiger Eigenverantwortung. deimudda übernimmt keine Haftung für illegale Nutzung oder Verstöße gegen das KCanG durch Nutzer.
            </p>
            <p>
              <strong>Altersangabe:</strong> Alle Nutzer bestätigen, dass sie mindestens 18 Jahre alt sind und die Nutzungsbedingungen akzeptieren.
            </p>
          </div>
        </div>
      </section>

      {/* Features Section */}
      <section className="bg-white py-16">
        <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
          <h3 className="text-3xl font-bold text-center mb-12">Warum deimudda?</h3>
          <div className="grid md:grid-cols-3 gap-8">
            <Card>
              <CardHeader>
                <Lock className="w-8 h-8 text-green-600 mb-2" />
                <CardTitle>100% Legal</CardTitle>
              </CardHeader>
              <CardContent>
                <p className="text-gray-600">
                  Stecklinge sind freiverkäufliches Vermehrungsmaterial und vollständig legal nach dem KCanG.
                </p>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <Zap className="w-8 h-8 text-green-600 mb-2" />
                <CardTitle>Einfach & Schnell</CardTitle>
              </CardHeader>
              <CardContent>
                <p className="text-gray-600">
                  Registrieren Sie sich, erstellen Sie ein Angebot und beginnen Sie zu verkaufen – in Minuten.
                </p>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <TrendingUp className="w-8 h-8 text-green-600 mb-2" />
                <CardTitle>Faire Gebühren</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-3">
                  <p className="text-gray-600 font-medium">
                    Transparente Gebührenstruktur:
                  </p>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between items-center">
                      <span className="text-gray-600">Plattformgebühr:</span>
                      <span className="font-semibold text-green-600">€{platformFee.data ? parseFloat(platformFee.data).toFixed(2).replace('.', ',') : '0,42'}</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-gray-600">PayPal-Gebühren:</span>
                      <span className="font-semibold text-blue-600">€{EXAMPLE_PAYPAL_FEE.toFixed(2).replace('.', ',')}</span>
                    </div>
                    <div className="border-t pt-2 mt-2">
                      <div className="flex justify-between items-center">
                        <span className="text-gray-700 font-medium">Bei Barzahlung:</span>
                        <span className="font-bold text-gray-800">€{PLATFORM_FEE.toFixed(2).replace('.', ',')}</span>
                      </div>
                      <div className="flex justify-between items-center mt-1">
                        <span className="text-gray-700 font-medium">Bei Online-Zahlung:</span>
                        <span className="font-bold text-gray-800">€{(PLATFORM_FEE + EXAMPLE_PAYPAL_FEE).toFixed(2).replace('.', ',')}</span>
                      </div>
                    </div>
                  </div>
                  <p className="text-xs text-gray-500 mt-2">
                    Keine versteckten Kosten. Alle Gebühren werden transparent angezeigt.
                  </p>
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <Users className="w-8 h-8 text-green-600 mb-2" />
                <CardTitle>Community</CardTitle>
              </CardHeader>
              <CardContent>
                <p className="text-gray-600">
                  Verbinden Sie sich mit anderen Züchtern und Liebhabern. Teilen Sie Ihr Wissen.
                </p>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <ShoppingCart className="w-8 h-8 text-green-600 mb-2" />
                <CardTitle>Auktionen & Festpreise</CardTitle>
              </CardHeader>
              <CardContent>
                <p className="text-gray-600">
                  Wählen Sie zwischen Festpreisen oder Auktionen. Maximale Flexibilität für Verkäufer.
                </p>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <Leaf className="w-8 h-8 text-green-600 mb-2" />
                <CardTitle>Vielfalt</CardTitle>
              </CardHeader>
              <CardContent>
                <p className="text-gray-600">
                  Tausende von Sorten und Züchtern. Finden Sie genau das, was Sie suchen.
                </p>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      {/* Active Listings Section */}
      <section className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <h3 className="text-3xl font-bold mb-8">Aktuelle Angebote</h3>
        {activeListings.isLoading ? (
          <p className="text-gray-500">Lädt...</p>
        ) : activeListings.data && activeListings.data.length > 0 ? (
          <div className="grid md:grid-cols-3 gap-6">
            {activeListings.data.map((listing) => (
              <Card key={listing.id} className="hover:shadow-lg transition-shadow">
                {listing.imageUrl && (
                  <img
                    src={listing.imageUrl}
                    alt={listing.strain}
                    className="w-full h-48 object-cover rounded-t-lg"
                  />
                )}
                <CardHeader>
                  <CardTitle className="text-lg">{listing.strain}</CardTitle>
                  <CardDescription>
                    {listing.type === "cutting" ? "Steckling" : "Samen"} • {listing.quantity} verfügbar
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <p className="text-gray-600 text-sm mb-4">{listing.description}</p>
                  <div className="flex justify-between items-center">
                    <span className="text-2xl font-bold text-green-600">
                      {listing.priceType === "fixed"
                        ? `€${parseFloat(listing.fixedPrice || "0").toFixed(2)}`
                        : `Ab €${parseFloat(listing.auctionStartPrice || "0").toFixed(2)}`}
                    </span>
                    <Button size="sm" onClick={() => window.location.href = `/listing/${listing.id}`}>
                      Details
                    </Button>
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        ) : (
          <p className="text-gray-500 text-center py-8">
            Noch keine Angebote vorhanden. Seien Sie der Erste!
          </p>
        )}
      </section>

      {/* CTA Section */}
      <section className="bg-green-600 text-white py-16">
        <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
          <h3 className="text-3xl font-bold mb-4">Bereit zu starten?</h3>
          <p className="text-lg mb-8 opacity-90">
            Werden Sie Teil der deimudda-Community und verdienen Sie mit Ihren Stecklingen.
          </p>
          {isAuthenticated ? (
            <Link href="/profile">
              <Button size="lg" variant="secondary">
                Zum Dashboard
              </Button>
            </Link>
          ) : (
            <Button
              size="lg"
              variant="secondary"
              onClick={() => (window.location.href = getLoginUrl())}
            >
              Jetzt registrieren
            </Button>
          )}
        </div>
      </section>

      {/* Footer */}
      <footer className="bg-gray-900 text-gray-400 py-8">
        <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="grid md:grid-cols-4 gap-8 mb-8">
            <div>
              <h4 className="text-white font-bold mb-4">deimudda</h4>
              <p className="text-sm">
                Die erste legale Marktplattform für Cannabis-Stecklinge und Samen in Deutschland.
              </p>
            </div>
            <div>
              <h4 className="font-semibold mb-4">Rechtliches</h4>
              <ul className="space-y-2 text-sm text-gray-400">
                <li><a href="/terms" className="hover:text-white">Nutzungsbedingungen</a></li>
                <li><a href="/datenschutz" className="hover:text-white">Datenschutz</a></li>
                <li><a href="/impressum" className="hover:text-white">Impressum</a></li>
              </ul>
            </div>
            <div>
              <h4 className="text-white font-bold mb-4">Plattform</h4>
              <ul className="text-sm space-y-2">
                <li><a href="/about" className="hover:text-white">Über uns</a></li>
                <li><a href="/contact" className="hover:text-white">Kontakt</a></li>
                <li><a href="/faq" className="hover:text-white">FAQ</a></li>
              </ul>
            </div>
            <div>
              <h4 className="text-white font-bold mb-4">Verkäufer</h4>
              <ul className="text-sm space-y-2">
                <li><a href="/seller-guidelines" className="hover:text-white">Verkäufer-Richtlinien</a></li>
                <li><a href="/fee-structure" className="hover:text-white">Gebührenstruktur</a></li>
                <li><a href="/support" className="hover:text-white">Support</a></li>
              </ul>
            </div>
          </div>
          <div className="border-t border-gray-800 pt-8 text-center text-sm">
            <p>&copy; 2025 deimudda. Alle Rechte vorbehalten.</p>
            <p className="mt-2 text-xs">
              Stecklinge sind legales Vermehrungsmaterial nach dem Konsumcannabisgesetz (KCanG).
            </p>
          </div>
        </div>
      </footer>
    </div>
  );
}

```

#### Schritt 5.x: ImageGallery.tsx

**`client/src/components/ImageGallery.tsx`**

```typescript
import { useState } from "react";
import { ChevronLeft, ChevronRight } from "lucide-react";

interface ImageGalleryProps {
  images: string[];
  altText?: string;
}

export function ImageGallery({ images, altText = "Bild" }: ImageGalleryProps) {
  const [currentIndex, setCurrentIndex] = useState(0);

  if (!images || images.length === 0) {
    return (
      <div className="w-full h-96 bg-gray-200 rounded-lg flex items-center justify-center">
        <span className="text-gray-500">Kein Bild</span>
      </div>
    );
  }

  const goToPrevious = () => {
    setCurrentIndex((prev) => (prev === 0 ? images.length - 1 : prev - 1));
  };

  const goToNext = () => {
    setCurrentIndex((prev) => (prev === images.length - 1 ? 0 : prev + 1));
  };

  return (
    <div className="space-y-4">
      {/* Main Image */}
      <div className="relative w-full h-96 bg-gray-100 rounded-lg overflow-hidden">
        <img
          src={images[currentIndex]}
          alt={`${altText} ${currentIndex + 1}`}
          className="w-full h-full object-contain"
        />

        {/* Navigation Arrows (only show if more than 1 image) */}
        {images.length > 1 && (
          <>
            <button
              onClick={goToPrevious}
              className="absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white rounded-full p-2 transition-colors"
            >
              <ChevronLeft className="h-6 w-6" />
            </button>
            <button
              onClick={goToNext}
              className="absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white rounded-full p-2 transition-colors"
            >
              <ChevronRight className="h-6 w-6" />
            </button>

            {/* Image Counter */}
            <div className="absolute bottom-4 right-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm">
              {currentIndex + 1} / {images.length}
            </div>
          </>
        )}
      </div>

      {/* Thumbnail Strip (only show if more than 1 image) */}
      {images.length > 1 && (
        <div className="flex gap-2 overflow-x-auto pb-2">
          {images.map((image, index) => (
            <button
              key={index}
              onClick={() => setCurrentIndex(index)}
              className={`flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden border-2 transition-all ${
                index === currentIndex
                  ? "border-blue-500 ring-2 ring-blue-200"
                  : "border-gray-300 hover:border-gray-400"
              }`}
            >
              <img
                src={image}
                alt={`Thumbnail ${index + 1}`}
                className="w-full h-full object-cover"
              />
            </button>
          ))}
        </div>
      )}
    </div>
  );
}

```

#### Schritt 5.x: ImageUpload.tsx

**`client/src/components/ImageUpload.tsx`**

```typescript
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { trpc } from "@/lib/trpc";
import { Upload, X } from "lucide-react";
import { useState, useEffect } from "react";
import { toast } from "sonner";

interface ImageUploadProps {
  label: string;
  currentImageUrl?: string;
  onImageUploaded: (url: string) => void;
  maxSizeMB?: number;
}

export default function ImageUpload({ label, currentImageUrl, onImageUploaded, maxSizeMB = 5 }: ImageUploadProps) {
  const [uploading, setUploading] = useState(false);
  const [previewUrl, setPreviewUrl] = useState<string | undefined>(currentImageUrl);

  // Update preview when currentImageUrl changes
  useEffect(() => {
    if (currentImageUrl) {
      setPreviewUrl(currentImageUrl);
    }
  }, [currentImageUrl]);

  const uploadImage = trpc.upload.image.useMutation({
    onSuccess: (data) => {
      setPreviewUrl(data.url);
      onImageUploaded(data.url);
      toast.success("Bild erfolgreich hochgeladen!");
      setUploading(false);
    },
    onError: (error: any) => {
      toast.error("Fehler beim Hochladen: " + error.message);
      setUploading(false);
    },
  });

  const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    // Check file size
    const fileSizeMB = file.size / (1024 * 1024);
    if (fileSizeMB > maxSizeMB) {
      toast.error(`Bild ist zu groß (max. ${maxSizeMB} MB)`);
      return;
    }
```

#### Schritt 5.x: Impressum.tsx

**`client/src/components/Impressum.tsx`**

```typescript
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";

export default function Impressum() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-8">
      <div className="max-w-4xl mx-auto">
        <Card>
          <CardHeader>
            <CardTitle className="text-3xl">Impressum</CardTitle>
          </CardHeader>
          <CardContent className="space-y-6">
            {/* Betreiber mit Logo */}
            <div>
              <h2 className="text-xl font-semibold mb-4">Angaben gemäß § 5 TMG</h2>
              <div className="flex items-center gap-6 mb-4">
                <img 
                  src="/vaperge-logo.png" 
                  alt="Vaperge Logo" 
                  className="h-32 w-auto"
                />
                <div>
                  <p className="text-gray-700">
                    <strong>Vaperge - Eau de Terpènes</strong><br />
                    Chris Rohleder<br />
                    Lessingstraße 11<br />
                    69254 Malsch<br />
                    Deutschland
                  </p>
                </div>
              </div>
            </div>

            {/* Kontakt */}
            <div>
              <h2 className="text-xl font-semibold mb-2">Kontakt</h2>
              <p className="text-gray-700">
                E-Mail: <a href="mailto:info@deimudda.de" className="text-blue-600 hover:underline">info@deimudda.de</a><br />
                Telefon: [Telefonnummer einfügen]
              </p>
            </div>

            {/* Umsatzsteuer-ID */}
            <div>
              <h2 className="text-xl font-semibold mb-2">Umsatzsteuer-ID</h2>
              <p className="text-gray-700">
                Umsatzsteuer-Identifikationsnummer gemäß § 27a UStG:<br />
                [USt-IdNr. einfügen, falls vorhanden]
              </p>
              <p className="text-sm text-gray-500 mt-1">
                Falls keine USt-IdNr. vorhanden, bitte diesen Abschnitt entfernen.
              </p>
            </div>

            {/* Kooperation */}
            <div>
              <h2 className="text-xl font-semibold mb-2">In Kooperation mit</h2>
              <div className="flex items-center gap-4">
                <img 
                  src="/kalidad-logo.png" 
                  alt="Kalidad Logo" 
                  className="h-20 w-auto bg-white p-2 rounded"
                />
                <div>
                  <p className="text-gray-700">
                    <strong>Kalidad - Grow- & Headshop</strong><br />
                    Kahlbachring 16<br />
                    69254 Malsch<br />
                    Deutschland
                  </p>
                  <p className="text-sm text-gray-500 mt-1">
                    Instagram: <a href="https://www.instagram.com/kalidad420/" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">@kalidad420</a>
                  </p>
                </div>
              </div>
            </div>

            {/* Verantwortlich für den Inhalt */}
            <div>
              <h2 className="text-xl font-semibold mb-2">Verantwortlich für den Inhalt nach § 18 Abs. 2 MStV</h2>
              <p className="text-gray-700">
                Chris Rohleder<br />
                Lessingstraße 11<br />
                69254 Malsch<br />
                Deutschland
              </p>
              <p className="text-sm text-gray-500 mt-2">
                Hinweis: § 55 Abs. 2 RStV wurde durch § 18 Abs. 2 MStV (Medienstaatsvertrag) ersetzt.
              </p>
            </div>

            {/* EU-Streitschlichtung */}
            <div>
              <h2 className="text-xl font-semibold mb-2">EU-Streitschlichtung</h2>
              <p className="text-gray-700 text-sm">
                Die Europäische Kommission stellt eine Plattform zur Online-Streitbeilegung (OS) bereit:<br />
                <a href="https://ec.europa.eu/consumers/odr/" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">
                  https://ec.europa.eu/consumers/odr/
                </a>
              </p>
              <p className="text-gray-700 text-sm mt-2">
                Unsere E-Mail-Adresse finden Sie oben im Impressum.
              </p>
            </div>

            {/* Verbraucherstreitbeilegung */}
            <div>
              <h2 className="text-xl font-semibold mb-2">Verbraucherstreitbeilegung / Universalschlichtungsstelle</h2>
              <p className="text-gray-700 text-sm">
                Wir sind nicht bereit oder verpflichtet, an Streitbeilegungsverfahren vor einer Verbraucherschlichtungsstelle teilzunehmen.
              </p>
              <p className="text-sm text-gray-500 mt-2">
                Hinweis: Falls Sie an Streitbeilegungsverfahren teilnehmen möchten, ändern Sie diese Formulierung entsprechend.
              </p>
            </div>

            {/* Marktplatz-Hinweis */}
            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
              <h2 className="text-xl font-semibold mb-2">deimudda ist ein Marktplatz</h2>
              <p className="text-gray-700 text-sm">
                <strong>Wichtiger Hinweis:</strong> deimudda ist ein Online-Marktplatz, der ausschließlich die Vermittlung zwischen Käufern und Verkäufern ermöglicht. 
                <strong> Wir sind nicht Vertragspartner</strong> der über die Plattform geschlossenen Kaufverträge.
              </p>
              <p className="text-gray-700 text-sm mt-2">
                Der Kaufvertrag kommt direkt zwischen dem Käufer und dem jeweiligen Verkäufer zustande. Der Verkäufer ist allein verantwortlich für:
              </p>
              <ul className="list-disc pl-6 text-sm text-gray-700 mt-2">
                <li>Die Qualität und Beschaffenheit der angebotenen Waren</li>
                <li>Die Erfüllung des Kaufvertrags (Versand, Lieferung)</li>
                <li>Die Einhaltung gesetzlicher Vorschriften (z.B. Widerrufsrecht, Gewährleistung)</li>
                <li>Die Bereitstellung eines eigenen Impressums (bei gewerblichen Verkäufern)</li>
                <li>Die Bereitstellung einer eigenen Datenschutzerklärung</li>
              </ul>
            </div>

            {/* Haftungsausschluss */}
            <div>
              <h2 className="text-xl font-semibold mb-2">Haftungsausschluss</h2>
              
              <h3 className="font-semibold mt-4 mb-2">Haftung für Inhalte (§ 7 TMG)</h3>
              <p className="text-gray-700 text-sm">
                Als Diensteanbieter sind wir gemäß § 7 Abs.1 TMG für eigene Inhalte auf diesen Seiten nach den allgemeinen Gesetzen verantwortlich. 
                Nach §§ 8 bis 10 TMG sind wir als Diensteanbieter jedoch nicht verpflichtet, übermittelte oder gespeicherte fremde Informationen zu überwachen 
                oder nach Umständen zu forschen, die auf eine rechtswidrige Tätigkeit hinweisen.
              </p>
              <p className="text-gray-700 text-sm mt-2">
                Verpflichtungen zur Entfernung oder Sperrung der Nutzung von Informationen nach den allgemeinen Gesetzen bleiben hiervon unberührt. 
                Eine diesbezügliche Haftung ist jedoch erst ab dem Zeitpunkt der Kenntnis einer konkreten Rechtsverletzung möglich. Bei Bekanntwerden 
                von entsprechenden Rechtsverletzungen werden wir diese Inhalte umgehend entfernen.
              </p>

              <h3 className="font-semibold mt-4 mb-2">Haftung für Verkäufer-Inhalte (§ 10 TMG - Speicherung von Informationen)</h3>
              <p className="text-gray-700 text-sm">
                Als Marktplatz-Betreiber speichern wir fremde Informationen (Listings, Produktbeschreibungen, Bilder) der Verkäufer. 
                Wir sind gemäß § 10 TMG nicht verpflichtet, diese Informationen zu überwachen oder nach Umständen zu forschen, die auf eine 
                rechtswidrige Tätigkeit hinweisen.
              </p>
              <p className="text-gray-700 text-sm mt-2">
                <strong>Bei Kenntnis von Rechtsverletzungen werden wir entsprechende Inhalte umgehend entfernen.</strong> Falls Sie rechtswidrige 
                Inhalte auf unserer Plattform feststellen, melden Sie diese bitte umgehend an: <a href="mailto:info@deimudda.de" className="text-blue-600 hover:underline">info@deimudda.de</a>
              </p>

              <h3 className="font-semibold mt-4 mb-2">Haftung für Links</h3>
              <p className="text-gray-700 text-sm">
                Unser Angebot enthält Links zu externen Webseiten Dritter, auf deren Inhalte wir keinen Einfluss haben. Deshalb können wir für 
                diese fremden Inhalte auch keine Gewähr übernehmen. Für die Inhalte der verlinkten Seiten ist stets der jeweilige Anbieter oder 
                Betreiber der Seiten verantwortlich. Die verlinkten Seiten wurden zum Zeitpunkt der Verlinkung auf mögliche Rechtsverstöße überprüft. 
                Rechtswidrige Inhalte waren zum Zeitpunkt der Verlinkung nicht erkennbar.
              </p>
              <p className="text-gray-700 text-sm mt-2">
                Eine permanente inhaltliche Kontrolle der verlinkten Seiten ist jedoch ohne konkrete Anhaltspunkte einer Rechtsverletzung nicht zumutbar. 
                Bei Bekanntwerden von Rechtsverletzungen werden wir derartige Links umgehend entfernen.
              </p>

              <h3 className="font-semibold mt-4 mb-2">Urheberrecht</h3>
              <p className="text-gray-700 text-sm">
                Die durch die Seitenbetreiber erstellten Inhalte und Werke auf diesen Seiten unterliegen dem deutschen Urheberrecht. Die Vervielfältigung, 
                Bearbeitung, Verbreitung und jede Art der Verwertung außerhalb der Grenzen des Urheberrechtes bedürfen der schriftlichen Zustimmung des 
                jeweiligen Autors bzw. Erstellers. Downloads und Kopien dieser Seite sind nur für den privaten, nicht kommerziellen Gebrauch gestattet.
              </p>
              <p className="text-gray-700 text-sm mt-2">
                Soweit die Inhalte auf dieser Seite nicht vom Betreiber erstellt wurden, werden die Urheberrechte Dritter beachtet. Insbesondere werden 
                Inhalte Dritter als solche gekennzeichnet. Sollten Sie trotzdem auf eine Urheberrechtsverletzung aufmerksam werden, bitten wir um einen 
                entsprechenden Hinweis. Bei Bekanntwerden von Rechtsverletzungen werden wir derartige Inhalte umgehend entfernen.
              </p>

              <h3 className="font-semibold mt-4 mb-2">Haftung für Qualität und Beschaffenheit der Waren</h3>
              <p className="text-gray-700 text-sm">
                deimudda haftet nicht für die Qualität, Beschaffenheit oder Rechtmäßigkeit der von Verkäufern angebotenen Waren. 
                Die Verkäufer sind allein verantwortlich für die Einhaltung gesetzlicher Vorschriften (z.B. Produktsicherheit, Gewährleistung, Widerrufsrecht).
              </p>
              <p className="text-gray-700 text-sm mt-2">
                Bei Problemen mit einem Kauf wenden Sie sich bitte direkt an den Verkäufer. Bei schwerwiegenden Verstößen gegen unsere 
                Nutzungsbedingungen können wir Maßnahmen gegen den Verkäufer ergreifen (z.B. Sperrung des Accounts).
              </p>
            </div>

            {/* Rechtliche Hinweise */}
            <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
              <h2 className="text-xl font-semibold mb-2">Rechtliche Hinweise zum Handel mit Cannabis-Stecklingen</h2>
              <p className="text-gray-700 text-sm mb-2">
                Diese Plattform dient ausschließlich dem Handel mit Cannabis-Stecklingen und Samen gemäß des <strong>Konsumcannabisgesetzes (KCanG)</strong>. 
                Alle Nutzer verpflichten sich, die geltenden Gesetze einzuhalten.
              </p>
              <p className="text-gray-700 text-sm mb-2">
                <strong>Wichtige Hinweise:</strong>
              </p>
              <ul className="list-disc pl-6 text-sm text-gray-700">
                <li>Nur Personen ab 18 Jahren dürfen Cannabis-Stecklinge und Samen erwerben</li>
                <li>Private Nutzer dürfen maximal 3 Pflanzen gleichzeitig besitzen (§ 3 Abs. 1 KCanG)</li>
                <li>Der Handel mit Blütenständen (Cannabis-Blüten) ist über diese Plattform nicht gestattet</li>
                <li>Die Nutzung der Plattform für illegale Zwecke ist strengstens untersagt</li>
              </ul>
              <p className="text-gray-700 text-sm mt-2">
                Der Plattformbetreiber übernimmt keine Haftung für illegale Nutzung oder Verstöße gegen das KCanG durch Nutzer. 
                Bei Verstößen gegen das KCanG oder unsere Nutzungsbedingungen behalten wir uns vor, Accounts zu sperren und 
                gegebenenfalls Strafverfolgungsbehörden zu informieren.
              </p>
            </div>

            {/* Bildnachweise */}
            <div>
              <h2 className="text-xl font-semibold mb-2">Bildnachweise</h2>
              <p className="text-gray-700 text-sm">
                Logos und Bilder auf dieser Seite sind Eigentum der jeweiligen Rechteinhaber:
              </p>
              <ul className="list-disc pl-6 text-sm text-gray-700 mt-2">
                <li>Vaperge Logo: © Vaperge - Eau de Terpènes</li>
                <li>Kalidad Logo: © Kalidad - Grow- & Headshop</li>
                <li>Produktbilder: © Jeweiliger Verkäufer (hochgeladen durch Verkäufer)</li>
              </ul>
            </div>

            {/* Technischer Betrieb */}
            <div>
              <h2 className="text-xl font-semibold mb-2">Technischer Betrieb</h2>
              <p className="text-gray-700 text-sm">
                Diese Website wird gehostet von: [Hosting-Provider einfügen]<br />
                Zahlungsabwicklung: PayPal (Europe) S.à.r.l. et Cie, S.C.A., 22-24 Boulevard Royal, L-2449 Luxembourg
              </p>
            </div>

            {/* Hinweis auf Plattform-Regeln */}
            <div className="bg-gray-50 border border-gray-200 rounded-lg p-4">
              <h2 className="text-xl font-semibold mb-2">Plattform-Regeln</h2>
              <p className="text-gray-700 text-sm">
                Alle Nutzer (Käufer und Verkäufer) sind verpflichtet, unsere <a href="/terms" className="text-blue-600 hover:underline">Nutzungsbedingungen</a> einzuhalten.
              </p>
              <p className="text-gray-700 text-sm mt-2">
                Verkäufer sind zusätzlich verpflichtet:
              </p>
              <ul className="list-disc pl-6 text-sm text-gray-700 mt-2">
                <li>Ein eigenes Impressum bereitzustellen (bei gewerblichem Verkauf)</li>
                <li>Eine eigene Datenschutzerklärung bereitzustellen</li>
                <li>Eine Widerrufsbelehrung bereitzustellen</li>
                <li>Die gesetzlichen Gewährleistungsrechte einzuhalten</li>
                <li>Nur legale Produkte gemäß KCanG anzubieten</li>
              </ul>
            </div>

            {/* Footer-Hinweis */}
            <div className="text-center text-sm text-gray-500 pt-4 border-t">
              <p>© 2025 deimudda. Alle Rechte vorbehalten.</p>
              <p className="mt-1">
                Stecklinge sind legales Vermehrungsmaterial nach dem Konsumcannabisgesetz (KCanG).
              </p>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: ListingDetail.tsx

**`client/src/components/ListingDetail.tsx`**

```typescript
import { Link, useParams } from "wouter";
import { useState } from "react";
import type { Listing } from "@/../../shared/types";
import { useAuth } from "@/_core/hooks/useAuth";
import { trpc } from "@/lib/trpc";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { AlertCircle, ShoppingCart, Gavel, MapPin, User, Star, MessageCircle } from "lucide-react";
import { ImageGallery } from "@/components/ImageGallery";
import { Alert, AlertDescription } from "@/components/ui/alert";
import NotFound from "./NotFound";
import { Breadcrumbs } from "@/components/Breadcrumbs";
import { Header } from "@/components/Header";

export default function ListingDetail() {
  const { id } = useParams<{ id: string }>();
  const { isAuthenticated } = useAuth();
  const listingId = parseInt(id || "0");
  const [showOfferDialog, setShowOfferDialog] = useState(false);
  const [offerAmount, setOfferAmount] = useState("");
  const [offerMessage, setOfferMessage] = useState("");
  const [offerError, setOfferError] = useState("");
  const [offerSuccess, setOfferSuccess] = useState(false);

  const createOffer = trpc.offer.create.useMutation({
    onSuccess: () => {
      setOfferSuccess(true);
      setTimeout(() => {
        setShowOfferDialog(false);
        setOfferSuccess(false);
        setOfferAmount("");
        setOfferMessage("");
      }, 2000);
    },
    onError: (error) => {
      setOfferError(error.message);
    },
  });

  const listing = trpc.listing.getById.useQuery(listingId, {
    enabled: !!id,
  });

  const sellerProfile = trpc.seller.getProfileById.useQuery(listing.data?.sellerId || 0, {
    enabled: !!listing.data?.sellerId,
  });

  const reviews = trpc.review.getBySellerId.useQuery(listing.data?.sellerId || 0, {
    enabled: !!listing.data?.sellerId,
  });

  if (listing.isLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <p className="text-gray-500">Lädt...</p>
      </div>
    );
  }

  if (!listing.data) {
    return <NotFound />;
  }

  const data = listing.data;

  // Parse images field (can be JSON string or array)
  const getImages = (): string[] => {
    if (data.images) {
      // If images is a string, try to parse it as JSON
      if (typeof data.images === 'string') {
        try {
          const parsed = JSON.parse(data.images);
          return Array.isArray(parsed) ? parsed : [];
        } catch {
          return [];
        }
      }
      // If images is already an array
      if (Array.isArray(data.images)) {
        return data.images;
      }
    }
    // Fallback to imageUrl if no images array
    return data.imageUrl ? [data.imageUrl] : [];
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      <Header />
      <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <Breadcrumbs 
          items={[
            { label: "Stecklinge & Samen", href: "/browse" },
            { label: data.strain }
          ]} 
        />
        {/* Back Button */}
        <a href="/" className="text-blue-600 hover:text-blue-800 mb-6 inline-block">
          ← Zurück
        </a>

        <div className="grid md:grid-cols-3 gap-8">
          {/* Main Content */}
          <div className="md:col-span-2">
            {/* Image Gallery */}
            <Card className="mb-6 overflow-hidden p-4">
              <ImageGallery 
                images={getImages()} 
                altText={data.strain}
              />
            </Card>

            {/* Details */}
            <Card>
              <CardHeader>
                <div className="flex justify-between items-start mb-4">
                  <div>
                    <CardTitle className="text-3xl">{data.strain}</CardTitle>
                    <CardDescription>
                      {data.type === "cutting" ? "Steckling" : "Samen"}
                    </CardDescription>
                  </div>
                  <Badge variant={data.status === "active" ? "default" : "secondary"}>
                    {data.status === "active" ? "Verfügbar" : "Nicht verfügbar"}
                  </Badge>
                </div>
              </CardHeader>
              <CardContent className="space-y-6">
                {/* Description */}
                {data.description && (
                  <div>
                    <h3 className="font-semibold mb-2">Beschreibung</h3>
                    <p className="text-gray-700">{data.description}</p>
                  </div>
                )}

                {/* Specs */}
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <p className="text-sm text-gray-600">Verfügbare Menge</p>
                    <p className="text-2xl font-bold">{data.quantity}</p>
                  </div>
                  <div>
                    <p className="text-sm text-gray-600">Preis</p>
                    <p className="text-2xl font-bold text-green-600">
                      {data.priceType === "fixed"
                        ? `€${parseFloat(data.fixedPrice || "0").toFixed(2)}`
                        : `Ab €${parseFloat(data.auctionStartPrice || "0").toFixed(2)}`}
                    </p>
                  </div>
                </div>

                {/* Additional Details */}
                {(data.genetics || data.seedBank || data.growMethod || data.seedType || data.thcContent || data.cbdContent || data.floweringTime || data.yieldInfo || data.flavorProfile || data.origin) && (
                  <div className="border-t pt-4 mt-4">
                    <h3 className="font-semibold mb-3">Zusätzliche Details</h3>
                    <div className="grid grid-cols-2 gap-4">
                      {data.genetics && (
                        <div>
                          <p className="text-sm text-gray-600">Genetik</p>
                          <p className="font-medium capitalize">{data.genetics}</p>
                        </div>
                      )}
                      {data.seedBank && (
                        <div>
                          <p className="text-sm text-gray-600">Samenbank/Breeder</p>
                          <p className="font-medium">{data.seedBank}</p>
                        </div>
                      )}
                      {data.growMethod && (
                        <div>
                          <p className="text-sm text-gray-600">Anbaumethode</p>
                          <p className="font-medium capitalize">{data.growMethod}</p>
                        </div>
                      )}
                      {data.seedType && (
                        <div>
                          <p className="text-sm text-gray-600">Samentyp</p>
                          <p className="font-medium capitalize">{data.seedType}</p>
                        </div>
                      )}
                      {data.thcContent && (
                        <div>
                          <p className="text-sm text-gray-600">THC-Gehalt</p>
                          <p className="font-medium">{data.thcContent}</p>
                        </div>
                      )}
                      {data.cbdContent && (
                        <div>
                          <p className="text-sm text-gray-600">CBD-Gehalt</p>
                          <p className="font-medium">{data.cbdContent}</p>
                        </div>
                      )}
                      {data.floweringTime && (
                        <div>
                          <p className="text-sm text-gray-600">Blütezeit</p>
                          <p className="font-medium">{data.floweringTime}</p>
                        </div>
                      )}
                      {data.yieldInfo && (
                        <div>
                          <p className="text-sm text-gray-600">Ertrag</p>
                          <p className="font-medium">{data.yieldInfo}</p>
                        </div>
                      )}
                      {data.origin && (
                        <div>
                          <p className="text-sm text-gray-600">Herkunft</p>
                          <p className="font-medium">{data.origin}</p>
                        </div>
                      )}
                      {data.flavorProfile && (
                        <div className="col-span-2">
                          <p className="text-sm text-gray-600">Geschmack/Aroma</p>
                          <p className="font-medium">{data.flavorProfile}</p>
                        </div>
                      )}
                    </div>
                  </div>
                )}

                {/* Auction Info */}
                {data.priceType === "auction" && data.auctionEndTime && (
                  <Alert>
                    <Gavel className="h-4 w-4" />
                    <AlertDescription>
                      Auktion endet am{" "}
                      {new Date(data.auctionEndTime).toLocaleDateString("de-DE", {
                        year: "numeric",
                        month: "long",
                        day: "numeric",
                        hour: "2-digit",
                        minute: "2-digit",
                      })}
                    </AlertDescription>
                  </Alert>
                )}

                {/* Legal Notice */}
                <Alert>
                  <AlertCircle className="h-4 w-4" />
                  <AlertDescription>
                    Stecklinge sind legales Vermehrungsmaterial nach dem Konsumcannabisgesetz (KCanG).
                    Sie dürfen keine Blüten oder Fruchtstände haben.
                  </AlertDescription>
                </Alert>
              </CardContent>
            </Card>
          </div>

          {/* Sidebar */}
          <div className="space-y-6">
            {/* Seller Info */}
            {sellerProfile.data && (
              <Card>
                <CardHeader>
                  <CardTitle className="text-lg">Verkäufer</CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center gap-3">
                    {sellerProfile.data.profileImageUrl ? (
                      <img
                        src={sellerProfile.data.profileImageUrl}
                        alt={sellerProfile.data.shopName}
                        className="w-12 h-12 rounded-full object-cover"
                      />
                    ) : (
                      <div className="w-12 h-12 rounded-full bg-gray-300 flex items-center justify-center">
                        <User className="w-6 h-6 text-gray-600" />
                      </div>
                    )}
                    <div className="flex-1">
                      <p className="font-semibold">{sellerProfile.data.shopName}</p>
                      <div className="flex items-center gap-1 text-sm">
                        <div className="flex items-center">
                          {[1, 2, 3, 4, 5].map((star) => (
                            <Star
                              key={star}
                              className={`w-4 h-4 ${
                                star <= Math.round(parseFloat(sellerProfile.data.rating || "0"))
                                  ? "fill-yellow-400 text-yellow-400"
                                  : "text-gray-300"
                              }`}
                            />
                          ))}
                        </div>
                        <span className="text-gray-600 ml-1">
                          {parseFloat(sellerProfile.data.rating || "0").toFixed(1)} ({sellerProfile.data.totalReviews})
                        </span>
                      </div>
                    </div>
                  </div>

                  {sellerProfile.data.location && (
                    <div className="flex items-center gap-2 text-sm text-gray-600">
                      <MapPin className="w-4 h-4" />
                      {sellerProfile.data.location}
                    </div>
                  )}

                  {sellerProfile.data.description && (
                    <p className="text-sm text-gray-700">{sellerProfile.data.description}</p>
                  )}

                  <Link href={`/seller/${data.sellerId}`}>
                    <Button variant="outline" className="w-full">
                      Zum Shop
                    </Button>
                  </Link>
                </CardContent>
              </Card>
            )}

            {/* Reviews */}
            {reviews.data && reviews.data.length > 0 && (
              <Card>
                <CardHeader>
                  <CardTitle className="text-lg">Bewertungen</CardTitle>
                  <CardDescription>
                    {reviews.data.length} Bewertung{reviews.data.length !== 1 ? 'en' : ''}
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  {reviews.data.map((review) => (
                    <div key={review.id} className="border-b last:border-b-0 pb-4 last:pb-0">
                      <div className="flex items-center gap-2 mb-2">
                        <div className="flex">
                          {[...Array(5)].map((_, i) => (
                            <span key={i} className={i < review.rating ? "text-yellow-400" : "text-gray-300"}>
                              ★
                            </span>
                          ))}
                        </div>
                        <span className="text-sm text-gray-600">
                          {review.buyerName || 'Anonym'}
                        </span>
                      </div>
                      {review.comment && (
                        <p className="text-sm text-gray-700">{review.comment}</p>
                      )}
                      <p className="text-xs text-gray-500 mt-2">
                        {new Date(review.createdAt).toLocaleDateString('de-DE')}
                      </p>
                    </div>
                  ))}
                </CardContent>
              </Card>
            )}

            {/* Purchase Card */}
            <Card>
              <CardHeader>
                <CardTitle>Kaufen</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                {!isAuthenticated ? (
                  <Alert>
                    <AlertCircle className="h-4 w-4" />
                    <AlertDescription>
                      Bitte melden Sie sich an, um zu kaufen.
                    </AlertDescription>
                  </Alert>
                ) : (
                  <>
                    {data.status === "active" ? (
                      <>
                        {/* Price Offer Button - Show if acceptsOffers is enabled */}
                        {data.acceptsOffers && (
                          <Button 
                            className="w-full gap-2 mb-3" 
                            size="lg" 
                            variant="secondary"
                            onClick={() => setShowOfferDialog(true)}
                          >
                            <Gavel className="w-5 h-5" />
                            Preisvorschlag senden
                          </Button>
                        )}
                        {data.priceType === "fixed" ? (
                          <a href={`/checkout/${data.id}`}>
                            <Button className="w-full gap-2" size="lg">
                              <ShoppingCart className="w-5 h-5" />
                              Jetzt kaufen
                            </Button>
                          </a>
                        ) : (
                          <Button className="w-full gap-2" size="lg" variant="outline">
                            <Gavel className="w-5 h-5" />
                            Bieten
                          </Button>
                        )}
                        <p className="text-xs text-gray-500 text-center">
                          Sichere Zahlung mit PayPal
                        </p>
                        
                        {/* Contact Seller Button */}
                        <div className="pt-3 border-t">
                          <a href={`/messages/new?listingId=${data.id}&sellerId=${data.sellerId}`}>
                            <Button className="w-full gap-2" size="lg" variant="outline">
                              <MessageCircle className="w-5 h-5" />
                              Verkäufer kontaktieren
                            </Button>
                          </a>
                        </div>
                      </>                   ) : (
                      <Alert>
                        <AlertCircle className="h-4 w-4" />
                        <AlertDescription>
                          Dieses Angebot ist nicht mehr verfügbar.
                        </AlertDescription>
                      </Alert>
                    )}
                  </>
                )}
              </CardContent>
            </Card>

            {/* Share Card */}
            <Card>
              <CardHeader>
                <CardTitle className="text-lg">Teilen</CardTitle>
              </CardHeader>
              <CardContent>
                <Button
                  variant="outline"
                  className="w-full"
                  onClick={() => {
                    navigator.share({
                      title: data.strain,
                      text: `Schauen Sie sich diese ${data.type === "cutting" ? "Steckling" : "Samen"} an!`,
                      url: window.location.href,
                    });
                  }}
                >
                  Teilen
                </Button>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>

      {/* Price Offer Dialog */}
      {showOfferDialog && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <Card className="w-full max-w-md">
            <CardHeader>
              <CardTitle>Preisvorschlag senden</CardTitle>
              <CardDescription>
                Machen Sie dem Verkäufer ein Angebot für {data.strain}
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              {offerSuccess && (
                <Alert className="bg-green-50 border-green-200">
                  <AlertCircle className="h-4 w-4 text-green-600" />
                  <AlertDescription className="text-green-800">
                    ✅ Ihr Angebot wurde erfolgreich gesendet!
                  </AlertDescription>
                </Alert>
              )}
              
              {offerError && (
                <Alert className="bg-red-50 border-red-200">
                  <AlertCircle className="h-4 w-4 text-red-600" />
                  <AlertDescription className="text-red-800">
                    {offerError}
                  </AlertDescription>
                </Alert>
              )}
              
              {data.offerMinPrice && (
                <Alert>
                  <AlertCircle className="h-4 w-4" />
                  <AlertDescription>
                    Mindestpreis: €{parseFloat(data.offerMinPrice).toFixed(2)}
                  </AlertDescription>
                </Alert>
              )}
              
              <div>
                <label className="block text-sm font-medium mb-2">
                  Ihr Angebot (€) *
                </label>
                <input
                  type="number"
                  step="0.01"
                  min={data.offerMinPrice || "0"}
                  value={offerAmount}
                  onChange={(e) => setOfferAmount(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="z.B. 12.50"
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">
                  Nachricht an Verkäufer (optional)
                </label>
                <textarea
                  value={offerMessage}
                  onChange={(e) => setOfferMessage(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  rows={3}
                  placeholder="z.B. Ich würde gerne mehrere Stecklinge kaufen..."
                />
              </div>

              <div className="flex gap-2">
                <Button
                  variant="outline"
                  className="flex-1"
                  onClick={() => {
                    setShowOfferDialog(false);
                    setOfferAmount("");
                    setOfferMessage("");
                  }}
                >
                  Abbrechen
                </Button>
                <Button
                  className="flex-1"
                  onClick={() => {
                    setOfferError("");
                    createOffer.mutate({
                      listingId,
                      offerAmount,
                      message: offerMessage || undefined,
                    });
                  }}
                  disabled={!offerAmount || parseFloat(offerAmount) <= 0 || createOffer.isPending}
                >
                  {createOffer.isPending ? "Wird gesendet..." : "Angebot senden"}
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      )}
    </div>
  );
}

```

#### Schritt 5.x: ListingSkeleton.tsx

**`client/src/components/ListingSkeleton.tsx`**

```typescript
import { Card, CardContent, CardHeader } from "@/components/ui/card";

export function ListingSkeleton() {
  return (
    <Card className="overflow-hidden animate-pulse">
      <CardHeader className="p-0">
        <div className="h-48 bg-gray-200" />
      </CardHeader>
      <CardContent className="p-4 space-y-3">
        <div className="h-6 bg-gray-200 rounded w-3/4" />
        <div className="h-4 bg-gray-200 rounded w-1/2" />
        <div className="h-4 bg-gray-200 rounded w-2/3" />
        <div className="flex justify-between items-center mt-4">
          <div className="h-8 bg-gray-200 rounded w-20" />
          <div className="h-10 bg-gray-200 rounded w-24" />
        </div>
      </CardContent>
    </Card>
  );
}

export function ListingSkeletonGrid({ count = 8 }: { count?: number }) {
  return (
    <div className="grid md:grid-cols-3 lg:grid-cols-4 gap-6">
      {Array.from({ length: count }).map((_, i) => (
        <ListingSkeleton key={i} />
      ))}
    </div>
  );
}

```

#### Schritt 5.x: Maintenance.tsx

**`client/src/components/Maintenance.tsx`**

```typescript
import { Construction, Shield } from "lucide-react";
import { Link } from "wouter";

export default function Maintenance() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4">
      <div className="max-w-2xl w-full bg-white rounded-2xl shadow-xl p-8 md:p-12 text-center">
        <div className="flex justify-center mb-6">
          <div className="bg-orange-100 p-6 rounded-full">
            <Construction className="w-16 h-16 text-orange-600" />
          </div>
        </div>
        
        <h1 className="text-4xl font-bold text-gray-900 mb-4">
          Wartungsarbeiten
        </h1>
        
        <p className="text-xl text-gray-600 mb-6">
          Wir führen gerade wichtige Wartungsarbeiten durch, um deimudda für Sie zu verbessern.
        </p>
        
        <div className="bg-orange-50 border border-orange-200 rounded-lg p-6 mb-8">
          <p className="text-gray-700 leading-relaxed">
            Die Plattform ist vorübergehend nicht verfügbar. Wir arbeiten daran, 
            so schnell wie möglich wieder online zu sein.
          </p>
        </div>
        
        <div className="space-y-3 text-sm text-gray-500">
          <p>
            <strong>Geschätzte Dauer:</strong> Die Wartungsarbeiten sollten in Kürze abgeschlossen sein.
          </p>
          <p>
            Bei Fragen kontaktieren Sie uns unter:{" "}
            <a 
              href="mailto:support@deimudda.de" 
              className="text-green-600 hover:text-green-700 underline"
            >
              support@deimudda.de
            </a>
          </p>
        </div>
        
        {/* Admin login link */}
        <div className="mt-8 pt-6 border-t border-gray-200">
          <Link href="/admin-login">
            <span className="inline-flex items-center gap-2 text-sm text-gray-500 hover:text-blue-600 transition-colors cursor-pointer">
              <Shield className="h-4 w-4" />
              Administrator-Zugang
            </span>
          </Link>
        </div>
        
        <div className="mt-4 pt-4 border-t border-gray-200">
          <p className="text-xs text-gray-400">
            © 2025 deimudda – Cannabis-Stecklingsbörse
          </p>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: ManusDialog.tsx

**`client/src/components/ManusDialog.tsx`**

```typescript
import { useEffect, useState } from "react";

import { Button } from "@/components/ui/button";
import { APP_TITLE } from "@/const";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogTitle,
} from "@/components/ui/dialog";

interface ManusDialogProps {
  title?: string;
  logo?: string;
  open?: boolean;
  onLogin: () => void;
  onOpenChange?: (open: boolean) => void;
  onClose?: () => void;
}

export function ManusDialog({
  title = APP_TITLE,
  logo = "/seedling-logo.png",
  open = false,
  onLogin,
  onOpenChange,
  onClose,
}: ManusDialogProps) {
  const [internalOpen, setInternalOpen] = useState(open);

  useEffect(() => {
    if (!onOpenChange) {
      setInternalOpen(open);
    }
  }, [open, onOpenChange]);

  const handleOpenChange = (nextOpen: boolean) => {
    if (onOpenChange) {
      onOpenChange(nextOpen);
    } else {
      setInternalOpen(nextOpen);
    }

    if (!nextOpen) {
      onClose?.();
    }
  };

  return (
    <Dialog
      open={onOpenChange ? open : internalOpen}
      onOpenChange={handleOpenChange}
    >
      <DialogContent className="py-5 bg-[#f8f8f7] rounded-[20px] w-[400px] shadow-[0px_4px_11px_0px_rgba(0,0,0,0.08)] border border-[rgba(0,0,0,0.08)] backdrop-blur-2xl p-0 gap-0 text-center">
        <div className="flex flex-col items-center gap-2 p-5 pt-12">
          <div className="w-16 h-16 bg-white rounded-xl border border-[rgba(0,0,0,0.08)] flex items-center justify-center">
            <img src={logo} alt="deimudda Logo" className="w-12 h-12" />
          </div>

          {/* Title and subtitle */}
          <DialogTitle className="text-xl font-semibold text-[#34322d] leading-[26px] tracking-[-0.44px]">
            {title}
          </DialogTitle>
          <DialogDescription className="text-sm text-[#858481] leading-5 tracking-[-0.154px]">
            Please login with Manus to continue
          </DialogDescription>
        </div>

        <DialogFooter className="px-5 py-5">
          {/* Login button */}
          <Button
            onClick={onLogin}
            className="w-full h-10 bg-[#1a1a19] hover:bg-[#1a1a19]/90 text-white rounded-[10px] text-sm font-medium leading-5 tracking-[-0.154px]"
          >
            Login with Manus
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
```

#### Schritt 5.x: MessageIcon.tsx

**`client/src/components/MessageIcon.tsx`**

```typescript
import { MessageCircle } from "lucide-react";
import { trpc } from "@/lib/trpc";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { useLocation } from "wouter";

export function MessageIcon() {
  const [, setLocation] = useLocation();

  // Get unread message count
  const { data: unreadCount = 0 } = trpc.chat.getUnreadCount.useQuery(undefined, {
    refetchInterval: 30000, // Refresh every 30 seconds
  });

  const handleClick = () => {
    setLocation("/messages");
  };

  return (
    <Button 
      variant="ghost" 
      size="icon" 
      className="relative" 
      onClick={handleClick}
      title="Nachrichten"
    >
      <MessageCircle className="h-5 w-5" />
      {unreadCount > 0 && (
        <Badge 
          variant="destructive" 
          className="absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs"
        >
          {unreadCount > 9 ? "9+" : unreadCount}
        </Badge>
      )}
    </Button>
  );
}

```

#### Schritt 5.x: Messages.tsx

**`client/src/components/Messages.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { trpc } from "@/lib/trpc";
import { Link, useLocation } from "wouter";
import { MessageCircle, Send, AlertCircle } from "lucide-react";
import { Header } from "@/components/Header";
import { formatDistanceToNow } from "date-fns";
import { de } from "date-fns/locale";

export default function Messages() {
  const { user, isAuthenticated } = useAuth();
  const [, setLocation] = useLocation();

  // Get all conversations
  const { data: conversations = [], isLoading } = trpc.chat.getConversations.useQuery(undefined, {
    refetchInterval: 10000, // Refresh every 10 seconds
  });

  if (!isAuthenticated) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center">
        <Card className="max-w-md">
          <CardHeader>
            <CardTitle>Zugriff verweigert</CardTitle>
            <CardDescription>
              Sie müssen eingeloggt sein, um Ihre Nachrichten zu sehen.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Link href="/">
              <Button>Zur Startseite</Button>
            </Link>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      <Header />
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        {/* Legal Disclaimer */}
        <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-6 rounded-r-lg">
          <div className="flex items-start gap-3">
            <AlertCircle className="h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5" />
            <div className="text-sm text-yellow-800">
              <p className="font-semibold mb-1">⚠️ Wichtige Hinweise zum Chat:</p>
              <ul className="list-disc pl-5 space-y-1">
                <li>Tauschen Sie <strong>keine illegalen Inhalte</strong> aus (Verkauf von Blütenständen ist verboten)</li>
                <li><strong>Geben Sie persönliche Daten</strong> (Telefonnummer, vollständige Adresse) <strong>erst nach Kaufabschluss</strong> weiter</li>
                <li>Der <strong>Standort des Verkäufers</strong> ist bereits auf der Plattform sichtbar</li>
                <li><strong>🔒 Empfehlung:</strong> Tauschen Sie sensible Daten (Adresse, Telefon) über <strong>verschlüsselte Messenger</strong> (Signal, Telegram, WhatsApp) aus - nicht über diese Plattform</li>
                <li>Alle Nachrichten können von Moderatoren eingesehen werden</li>
              </ul>
            </div>
          </div>
        </div>

        <Card>
          <CardHeader>
            <div className="flex items-center gap-3">
              <MessageCircle className="h-6 w-6 text-blue-600" />
              <div>
                <CardTitle>Nachrichten</CardTitle>
                <CardDescription>
                  Kommunizieren Sie mit Käufern und Verkäufern
                </CardDescription>
              </div>
            </div>
          </CardHeader>
          <CardContent>
            {isLoading ? (
              <div className="text-center py-12">
                <p className="text-muted-foreground">Lädt...</p>
              </div>
            ) : conversations.length === 0 ? (
              <div className="text-center py-12">
                <MessageCircle className="h-16 w-16 mx-auto mb-4 text-muted-foreground opacity-50" />
                <p className="text-lg font-medium text-muted-foreground">
                  Keine Nachrichten
                </p>
                <p className="text-sm text-muted-foreground mt-2">
                  Starten Sie eine Konversation, indem Sie auf "Verkäufer kontaktieren" bei einem Inserat klicken.
                </p>
              </div>
            ) : (
              <div className="space-y-3">
                {conversations.map((conversation: { id: number; otherUser: { name: string; avatarUrl?: string }; lastMessage?: { content: string; createdAt: Date }; unreadCount: number }) => {
                  const isUserBuyer = conversation.buyerId === user?.id;
                  const otherUserName = isUserBuyer ? conversation.sellerName : conversation.buyerName;
                  const role = isUserBuyer ? "Verkäufer" : "Käufer";

                  return (
                    <div
                      key={conversation.id}
                      className="p-4 rounded-lg border-2 border-gray-200 hover:border-blue-300 hover:shadow-md transition-all cursor-pointer bg-white"
                      onClick={() => setLocation(`/messages/${conversation.id}`)}
                    >
                      <div className="flex items-start gap-4">
                        {/* Listing Image */}
                        {conversation.listingImage && (
                          <img
                            src={conversation.listingImage}
                            alt={conversation.listingStrain}
                            className="w-16 h-16 rounded-lg object-cover flex-shrink-0"
                          />
                        )}

                        {/* Conversation Info */}
                        <div className="flex-1 min-w-0">
                          <div className="flex items-center gap-2 mb-1">
                            <h3 className="font-semibold text-base truncate">
                              {conversation.listingStrain}
                            </h3>
                            {conversation.unreadCount > 0 && (
                              <Badge variant="destructive" className="text-xs">
                                {conversation.unreadCount} neu
                              </Badge>
                            )}
                          </div>
                          <p className="text-sm text-muted-foreground mb-1">
                            {role}: {otherUserName}
                          </p>
                          <p className="text-xs text-muted-foreground">
                            Letzte Nachricht:{" "}
                            {formatDistanceToNow(new Date(conversation.lastMessageAt), {
                              addSuffix: true,
                              locale: de,
                            })}
                          </p>
                        </div>

                        {/* Action Button */}
                        <Button variant="outline" size="sm" className="flex-shrink-0">
                          <Send className="h-4 w-4 mr-2" />
                          Öffnen
                        </Button>
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: MultiImageUpload.tsx

**`client/src/components/MultiImageUpload.tsx`**

```typescript
import { Upload, X } from "lucide-react";
import { trpc } from "../lib/trpc";
import { toast } from "sonner";

interface MultiImageUploadProps {
  label: string;
  currentImages?: string[]; // Array of image URLs
  maxImages?: number;
  maxSizeMB?: number;
  onImagesChange: (imageUrls: string[]) => void;
}

export function MultiImageUpload({
  label,
  currentImages = [],
  maxImages = 5,
  maxSizeMB = 5,
  onImagesChange,
}: MultiImageUploadProps) {
  const [imageUrls, setImageUrls] = useState<string[]>(currentImages);
  const [uploading, setUploading] = useState(false);
  const uploadMutation = trpc.upload.image.useMutation();

  // Sync internal state with prop on mount only
  useEffect(() => {
    setImageUrls(currentImages);
  }, []); // Only run on mount

  // Update parent when images change (but not on initial render)
  useEffect(() => {
    // Only call onImagesChange if imageUrls is different from currentImages
    const isDifferent = JSON.stringify(imageUrls) !== JSON.stringify(currentImages);
    if (isDifferent) {
      onImagesChange(imageUrls);
    }
  }, [imageUrls]); // Remove onImagesChange from dependencies to prevent loop

  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const files = e.target.files;
    if (!files || files.length === 0) return;

    // Check if adding these files would exceed max images
    if (imageUrls.length + files.length > maxImages) {
      toast.error(`Sie können maximal ${maxImages} Bilder hochladen.`);
      return;
    }

    setUploading(true);
```

#### Schritt 5.x: NewMessage.tsx

**`client/src/components/NewMessage.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { trpc } from "@/lib/trpc";
import { Link, useLocation } from "wouter";
import { useEffect } from "react";
import { toast } from "sonner";

export default function NewMessage() {
  const { isAuthenticated } = useAuth();
  const [, setLocation] = useLocation();

  // Get query params
  const params = new URLSearchParams(window.location.search);
  const listingId = parseInt(params.get("listingId") || "0");
  const sellerId = parseInt(params.get("sellerId") || "0");

  // Create or get conversation
  const createConversationMutation = trpc.chat.getOrCreateConversation.useMutation({
    onSuccess: (conversation) => {
      // Redirect to chat window
      setLocation(`/messages/${conversation.id}`);
    },
    onError: (error) => {
      toast.error("Fehler beim Erstellen der Konversation: " + error.message);
    },
  });

  useEffect(() => {
    if (isAuthenticated && listingId > 0 && sellerId > 0) {
      // Automatically create conversation
      createConversationMutation.mutate({
        listingId,
        sellerId,
      });
    }
  }, [isAuthenticated, listingId, sellerId]);

  if (!isAuthenticated) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center">
        <Card className="max-w-md">
          <CardHeader>
            <CardTitle>Zugriff verweigert</CardTitle>
            <CardDescription>
              Sie müssen eingeloggt sein, um Nachrichten zu senden.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Link href="/">
              <Button>Zur Startseite</Button>
            </Link>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center">
      <Card className="max-w-md">
        <CardHeader>
          <CardTitle>Chat wird geöffnet...</CardTitle>
          <CardDescription>
            Bitte warten Sie einen Moment.
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="text-center">
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p className="text-gray-600">Konversation wird erstellt...</p>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: NotificationBell.tsx

**`client/src/components/NotificationBell.tsx`**

```typescript
import { Bell } from "lucide-react";
import type { Notification } from "@/../../shared/types";
import { useState } from "react";
import { trpc } from "@/lib/trpc";
import { Button } from "@/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { Badge } from "@/components/ui/badge";
import { ScrollArea } from "@/components/ui/scroll-area";
import { formatDistanceToNow } from "date-fns";
import { de } from "date-fns/locale";
import { toast } from "sonner";
import { useLocation } from "wouter";

export function NotificationBell() {
  const [open, setOpen] = useState(false);
  const [, setLocation] = useLocation();
  const utils = trpc.useUtils();

  // Get unread count
  const { data: unreadCount = 0 } = trpc.notifications.getUnreadCount.useQuery(undefined, {
    refetchInterval: 30000, // Refresh every 30 seconds
    staleTime: 10000, // 10s - Real-time: Unread count changes frequently
  });

  // Get all notifications
  const { data: notifications = [] } = trpc.notifications.getMyNotifications.useQuery(undefined, {
    enabled: open, // Only fetch when dropdown is open
    staleTime: 10000, // 10s - Real-time: Notifications change frequently
  });

  // Mark as read mutation
  const markAsReadMutation = trpc.notifications.markAsRead.useMutation({
    onSuccess: () => {
      utils.notifications.getUnreadCount.invalidate();
      utils.notifications.getMyNotifications.invalidate();
    },
  });

  // Mark all as read mutation
  const markAllAsReadMutation = trpc.notifications.markAllAsRead.useMutation({
    onSuccess: () => {
      utils.notifications.getUnreadCount.invalidate();
      utils.notifications.getMyNotifications.invalidate();
      toast.success("Alle Benachrichtigungen als gelesen markiert");
    },
  });

  // Delete notification mutation
  const deleteNotificationMutation = trpc.notifications.deleteNotification.useMutation({
    onSuccess: () => {
      utils.notifications.getUnreadCount.invalidate();
      utils.notifications.getMyNotifications.invalidate();
      toast.success("Benachrichtigung gelöscht");
    },
  });

  const handleNotificationClick = (notification: Notification) => {
    // Mark as read
    if (!notification.read) {
      markAsReadMutation.mutate(notification.id);
    }

    // Navigate to action URL if exists
    if (notification.actionUrl) {
      setOpen(false);
      setLocation(notification.actionUrl);
    }
  };

  const handleMarkAllAsRead = () => {
    markAllAsReadMutation.mutate();
  };

  const handleDeleteNotification = (e: React.MouseEvent, notificationId: number) => {
    e.stopPropagation();
    deleteNotificationMutation.mutate(notificationId);
  };

  return (
    <DropdownMenu open={open} onOpenChange={setOpen}>
      <DropdownMenuTrigger asChild>
        <Button variant="ghost" size="icon" className="relative">
          <Bell className="h-5 w-5" />
          {unreadCount > 0 && (
            <Badge 
              variant="destructive" 
              className="absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs"
            >
              {unreadCount > 9 ? "9+" : unreadCount}
            </Badge>
          )}
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end" className="w-80">
        <div className="flex items-center justify-between p-4 border-b">
          <h3 className="font-semibold">Benachrichtigungen</h3>
          {unreadCount > 0 && (
            <Button
              variant="ghost"
              size="sm"
              onClick={handleMarkAllAsRead}
              className="text-xs"
            >
              Alle als gelesen markieren
            </Button>
          )}
        </div>
        <ScrollArea className="h-[400px]">
          {notifications.length === 0 ? (
            <div className="p-8 text-center text-muted-foreground">
              <Bell className="h-12 w-12 mx-auto mb-2 opacity-50" />
              <p>Keine Benachrichtigungen</p>
            </div>
          ) : (
            <div className="divide-y">
              {notifications.map((notification: Notification) => (
                <div
                  key={notification.id}
                  className={`p-4 cursor-pointer hover:bg-muted/50 transition-colors ${
                    !notification.read ? "bg-muted/30" : ""
                  }`}
                  onClick={() => handleNotificationClick(notification)}
                >
                  <div className="flex items-start justify-between gap-2">
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 mb-1">
                        <p className="font-medium text-sm truncate">
                          {notification.title}
                        </p>
                        {!notification.read && (
                          <div className="h-2 w-2 rounded-full bg-blue-500 flex-shrink-0" />
                        )}
                      </div>
                      <p className="text-sm text-muted-foreground whitespace-pre-line line-clamp-2">
                        {notification.message}
                      </p>
                      <p className="text-xs text-muted-foreground mt-1">
                        {formatDistanceToNow(new Date(notification.createdAt), {
                          addSuffix: true,
                          locale: de,
                        })}
                      </p>
                    </div>
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={(e) => handleDeleteNotification(e, notification.id)}
                      className="flex-shrink-0"
                    >
                      ×
                    </Button>
                  </div>
                </div>
              ))}
            </div>
          )}
        </ScrollArea>
      </DropdownMenuContent>
    </DropdownMenu>
  );
}

```

#### Schritt 5.x: Notifications.tsx

**`client/src/components/Notifications.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import type { Notification } from "@/../../shared/types";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { trpc } from "@/lib/trpc";
import { Link, useLocation } from "wouter";
import { Bell, Trash2, CheckCheck, ArrowLeft } from "lucide-react";
import { formatDistanceToNow } from "date-fns";
import { de } from "date-fns/locale";
import { toast } from "sonner";
import { Header } from "@/components/Header";

export default function Notifications() {
  const { user, isAuthenticated } = useAuth();
  const [, setLocation] = useLocation();
  const utils = trpc.useUtils();

  // Get all notifications
  const { data: notifications = [], isLoading } = trpc.notifications.getMyNotifications.useQuery(undefined, { staleTime: 10000 });

  // Mark as read mutation
  const markAsReadMutation = trpc.notifications.markAsRead.useMutation({
    onSuccess: () => {
      utils.notifications.getMyNotifications.invalidate();
      utils.notifications.getUnreadCount.invalidate();
    },
  });

  // Mark all as read mutation
  const markAllAsReadMutation = trpc.notifications.markAllAsRead.useMutation({
    onSuccess: () => {
      utils.notifications.getMyNotifications.invalidate();
      utils.notifications.getUnreadCount.invalidate();
      toast.success("Alle Benachrichtigungen als gelesen markiert");
    },
  });

  // Delete notification mutation
  const deleteNotificationMutation = trpc.notifications.deleteNotification.useMutation({
    onSuccess: () => {
      utils.notifications.getMyNotifications.invalidate();
      utils.notifications.getUnreadCount.invalidate();
      toast.success("Benachrichtigung gelöscht");
    },
  });

  if (!isAuthenticated) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center">
        <Card className="max-w-md">
          <CardHeader>
            <CardTitle>Zugriff verweigert</CardTitle>
            <CardDescription>
              Sie müssen eingeloggt sein, um Ihre Benachrichtigungen zu sehen.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Link href="/">
              <Button>Zur Startseite</Button>
            </Link>
          </CardContent>
        </Card>
      </div>
    );
  }

  const handleNotificationClick = (notification: Notification) => {
    // Mark as read
    if (!notification.read) {
      markAsReadMutation.mutate(notification.id);
    }

    // Navigate to action URL if exists
    if (notification.actionUrl) {
      setLocation(notification.actionUrl);
    }
  };

  const handleDeleteNotification = (e: React.MouseEvent, notificationId: number) => {
    e.stopPropagation();
    deleteNotificationMutation.mutate(notificationId);
  };

  const handleMarkAllAsRead = () => {
    markAllAsReadMutation.mutate();
  };

  const getNotificationTypeColor = (type: string) => {
    switch (type) {
      case 'warning':
        return 'bg-yellow-100 text-yellow-800 border-yellow-300';
      case 'suspension':
        return 'bg-orange-100 text-orange-800 border-orange-300';
      case 'ban':
        return 'bg-red-100 text-red-800 border-red-300';
      case 'unban':
        return 'bg-green-100 text-green-800 border-green-300';
      case 'listing_approved':
        return 'bg-blue-100 text-blue-800 border-blue-300';
      case 'listing_rejected':
        return 'bg-gray-100 text-gray-800 border-gray-300';
      case 'offer_received':
        return 'bg-purple-100 text-purple-800 border-purple-300';
      case 'offer_accepted':
        return 'bg-green-100 text-green-800 border-green-300';
      case 'offer_rejected':
        return 'bg-gray-100 text-gray-800 border-gray-300';
      case 'message_received':
        return 'bg-indigo-100 text-indigo-800 border-indigo-300';
      case 'system':
        return 'bg-slate-100 text-slate-800 border-slate-300';
      default:
        return 'bg-gray-100 text-gray-800 border-gray-300';
    }
  };

  const getNotificationTypeLabel = (type: string) => {
    switch (type) {
      case 'warning':
        return 'Verwarnung';
      case 'suspension':
        return 'Sperrung';
      case 'ban':
        return 'Bann';
      case 'unban':
        return 'Entsperrung';
      case 'listing_approved':
        return 'Angebot genehmigt';
      case 'listing_rejected':
        return 'Angebot abgelehnt';
      case 'offer_received':
        return 'Angebot erhalten';
      case 'offer_accepted':
        return 'Angebot akzeptiert';
      case 'offer_rejected':
        return 'Angebot abgelehnt';
      case 'message_received':
        return 'Neue Nachricht';
      case 'system':
        return 'System';
      default:
        return type;
    }
  };

  const unreadCount = notifications.filter((n: Notification) => !n.read).length;

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      <Header />
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="mb-6">
          <Link href="/profile">
            <Button variant="outline" size="sm" className="hidden">
              <ArrowLeft className="h-4 w-4 mr-2" />
              Zurück zum Dashboard
            </Button>
          </Link>
        </div>

        <Card>
          <CardHeader>
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <Bell className="h-6 w-6 text-blue-600" />
                <div>
                  <CardTitle>Benachrichtigungen</CardTitle>
                  <CardDescription>
                    {unreadCount > 0
                      ? `${unreadCount} ungelesene Benachrichtigung${unreadCount > 1 ? 'en' : ''}`
                      : 'Alle Benachrichtigungen gelesen'}
                  </CardDescription>
                </div>
              </div>
              {unreadCount > 0 && (
                <Button
                  variant="outline"
                  size="sm"
                  onClick={handleMarkAllAsRead}
                  disabled={markAllAsReadMutation.isPending}
                >
                  <CheckCheck className="h-4 w-4 mr-2" />
                  Alle als gelesen markieren
                </Button>
              )}
            </div>
          </CardHeader>
          <CardContent>
            {isLoading ? (
              <div className="text-center py-12">
                <p className="text-muted-foreground">Lädt...</p>
              </div>
            ) : notifications.length === 0 ? (
              <div className="text-center py-12">
                <Bell className="h-16 w-16 mx-auto mb-4 text-muted-foreground opacity-50" />
                <p className="text-lg font-medium text-muted-foreground">
                  Keine Benachrichtigungen
                </p>
                <p className="text-sm text-muted-foreground mt-2">
                  Sie haben noch keine Benachrichtigungen erhalten.
                </p>
              </div>
            ) : (
              <div className="space-y-3">
                {notifications.map((notification: Notification) => (
                  <div
                    key={notification.id}
                    className={`p-4 rounded-lg border-2 cursor-pointer hover:shadow-md transition-all ${
                      !notification.read
                        ? 'bg-blue-50/50 border-blue-200'
                        : 'bg-white border-gray-200'
                    }`}
                    onClick={() => handleNotificationClick(notification)}
                  >
                    <div className="flex items-start justify-between gap-4">
                      <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-2 mb-2">
                          <Badge
                            variant="outline"
                            className={`${getNotificationTypeColor(notification.type)} text-xs`}
                          >
                            {getNotificationTypeLabel(notification.type)}
                          </Badge>
                          {!notification.read && (
                            <div className="h-2 w-2 rounded-full bg-blue-500 flex-shrink-0" />
                          )}
                          <span className="text-xs text-muted-foreground">
                            {formatDistanceToNow(new Date(notification.createdAt), {
                              addSuffix: true,
                              locale: de,
                            })}
                          </span>
                        </div>
                        <h3 className="font-semibold text-base mb-1">
                          {notification.title}
                        </h3>
                        <p className="text-sm text-muted-foreground whitespace-pre-line">
                          {notification.message}
                        </p>
                      </div>
                      <Button
                        variant="ghost"
                        size="sm"
                        onClick={(e) => handleDeleteNotification(e, notification.id)}
                        disabled={deleteNotificationMutation.isPending}
                        className="flex-shrink-0"
                      >
                        <Trash2 className="h-4 w-4 text-red-500" />
                      </Button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: OfferManagement.tsx

**`client/src/components/OfferManagement.tsx`**

```typescript
                            <p className="text-sm text-gray-700 italic">"{offer.message}"</p>
                          </div>
                        )}
                      </div>
                      <div className="flex gap-2 ml-4">
                        <Button
                          size="sm"
                          className="bg-green-600 hover:bg-green-700"
                          onClick={() => {
                            if (confirm(`Möchten Sie das Angebot von €${parseFloat(offer.offerAmount).toFixed(2)} annehmen?`)) {
                              acceptOffer.mutate(offer.id);
                            }
                          }}
                          disabled={acceptOffer.isPending}
                        >
                          <Check className="w-4 h-4 mr-1" />
                          Annehmen
                        </Button>
                        <Button
                          size="sm"
                          variant="destructive"
                          onClick={() => {
                            if (confirm("Möchten Sie dieses Angebot ablehnen?")) {
                              declineOffer.mutate(offer.id);
                            }
                          }}
                          disabled={declineOffer.isPending}
                        >
                          <X className="w-4 h-4 mr-1" />
                          Ablehnen
                        </Button>
                      </div>
                    </div>
                  </CardContent>
                </Card>```

#### Schritt 5.x: PayPalButton.tsx

**`client/src/components/PayPalButton.tsx`**

```typescript
import { PayPalButtons, PayPalScriptProvider } from "@paypal/react-paypal-js";
import { trpc } from "@/lib/trpc";
import { toast } from "sonner";
import { useState } from "react";

interface PayPalButtonProps {
  listingId: number;
  quantity: number;
  onSuccess: (transactionId: number) => void;
  onError?: (error: Error) => void;
  disabled?: boolean;
}

export default function PayPalButton({ 
  listingId,
  quantity,
  onSuccess, 
  onError,
  disabled = false,
}: PayPalButtonProps) {
  const [transactionId, setTransactionId] = useState<number | null>(null);
  const createOrderMutation = trpc.paypal.createOrder.useMutation();
  const captureOrderMutation = trpc.paypal.captureOrder.useMutation();

  const initialOptions = {
    clientId: import.meta.env.VITE_PAYPAL_CLIENT_ID || "",
    currency: "EUR",
    intent: "capture",
  };

  if (!import.meta.env.VITE_PAYPAL_CLIENT_ID) {
    return (
      <div className="text-red-600 text-sm">
        PayPal Client ID nicht konfiguriert. Bitte kontaktieren Sie den Support.
      </div>
    );
  }

  return (
    <PayPalScriptProvider options={initialOptions}>
      <div className={disabled ? "opacity-50 pointer-events-none" : ""}>
        <PayPalButtons
          style={{
            layout: "vertical",
            color: "gold",
            shape: "rect",
            label: "paypal",
          }}
          disabled={disabled}
          createOrder={async () => {
            try {
              const result = await createOrderMutation.mutateAsync({
                listingId,
                quantity,
              });
              setTransactionId(result.transactionId);
              return result.orderId;
            } catch (error) {
              console.error("[PayPal] Error creating order:", error);
              toast.error("Fehler beim Erstellen der Bestellung");
              throw error;
            }
          }}
          onApprove={async (data) => {
            try {
              if (!transactionId) {
                throw new Error("Transaction ID not found");
              }

              await captureOrderMutation.mutateAsync({
                orderId: data.orderID,
                transactionId,
              });
              
              toast.success("Zahlung erfolgreich!");
              onSuccess(transactionId);
            } catch (error) {
              console.error("[PayPal] Error capturing order:", error);
              toast.error("Fehler beim Abschließen der Zahlung");
              if (onError) {
                onError(error as Error);
              }
            }
          }}
          onError={(err) => {
            console.error("[PayPal] Button error:", err);
            toast.error("PayPal-Fehler aufgetreten");
            if (onError) {
              onError(err as Error);
            }
          }}
        />
      </div>
    </PayPalScriptProvider>
  );
}

```

#### Schritt 5.x: Privacy.tsx

**`client/src/components/Privacy.tsx`**

```typescript
import { trpc } from "@/lib/trpc";

export default function Privacy() {
  // Load dynamic platform fee from system settings
  const { data: platformFeeStr } = trpc.admin.getSystemSetting.useQuery('platform_fee_fixed', { staleTime: 300000 });
  const PLATFORM_FEE = parseFloat(platformFeeStr || "0.42");
  
  return (
    <div className="min-h-screen bg-gray-50 py-12">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-8 text-gray-900">Datenschutzerklärung</h1>
          
          <div className="prose prose-lg max-w-none">
            <p className="text-sm text-gray-600 mb-8">Stand: 24. Oktober 2025</p>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-6 mb-8">
              <h3 className="text-lg font-bold text-blue-900 mb-2">deimudda ist ein Marktplatz</h3>
              <p className="text-blue-800">
                <strong>Wichtig:</strong> deimudda vermittelt nur zwischen Käufern und Verkäufern. Wir sind kein Händler. 
                Der Kaufvertrag kommt direkt zwischen Ihnen und dem jeweiligen Verkäufer zustande.
              </p>
              <p className="text-blue-800 mt-2">
                Diese Datenschutzerklärung gilt für die Datenverarbeitung durch <strong>deimudda als Plattformbetreiber</strong>. 
                Für die Datenverarbeitung im Rahmen der Kaufabwicklung (Versand, Rechnungsstellung) ist der jeweilige 
                <strong> Verkäufer eigenständig verantwortlich</strong>. Bitte beachten Sie auch die Datenschutzerklärung 
                des Verkäufers.
              </p>
            </div>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">1. Datenschutz auf einen Blick</h2>
              
              <h3 className="text-xl font-semibold mb-3">Allgemeine Hinweise</h3>
              <p className="mb-4">
                Die folgenden Hinweise geben einen einfachen Überblick darüber, was mit Ihren personenbezogenen Daten 
                passiert, wenn Sie diese Website besuchen. Personenbezogene Daten sind alle Daten, mit denen Sie 
                persönlich identifiziert werden können.
              </p>

              <h3 className="text-xl font-semibold mb-3">Wer ist verantwortlich für die Datenverarbeitung?</h3>
              <p className="mb-4">
                <strong>Für die Plattform deimudda:</strong> Der Betreiber von deimudda (siehe Impressum) ist verantwortlich 
                für die Verarbeitung Ihrer Daten im Zusammenhang mit der Nutzung der Plattform (Registrierung, Profil, 
                Bewertungen, etc.).
              </p>
              <p className="mb-4">
                <strong>Für die Kaufabwicklung:</strong> Der jeweilige Verkäufer ist verantwortlich für die Verarbeitung 
                Ihrer Daten im Zusammenhang mit dem Kaufvertrag (Versand, Rechnungsstellung, Gewährleistung, etc.).
              </p>

              <h3 className="text-xl font-semibold mb-3">Welche Daten erheben wir?</h3>
              <p className="mb-4">
                <strong>deimudda erhebt folgende Daten:</strong>
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Bei Registrierung: Open ID (eindeutige Nutzer-ID vom OAuth-Provider), optional Name und E-Mail</li>
                <li>Bei Profil-Erstellung: Nickname, Standort (optional), Profilbild (optional)</li>
                <li>Bei Verkäufer-Aktivierung: Shop-Name, Beschreibung, Standort</li>
                <li>Bei Listing-Erstellung: Produktdaten (Strain, Beschreibung, Preis, Bilder)</li>
                <li>Bei Transaktionen: PayPal-Transaktions-ID, Kaufbetrag, Gebühren</li>
                <li>Bei Bewertungen: Rating, Kommentar, Zeitstempel</li>
                <li>Bei Preisvorschlägen: Angebotspreis, Nachricht, Status</li>
                <li>Technische Daten: IP-Adresse, Browser-Typ, Zugriffszeiten (Server-Logs)</li>
              </ul>

              <h3 className="text-xl font-semibold mb-3">Wofür nutzen wir Ihre Daten?</h3>
              <p className="mb-4">
                Wir nutzen Ihre Daten ausschließlich zur Bereitstellung und Verbesserung der Plattform deimudda:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Bereitstellung der Plattform-Funktionen (Registrierung, Profil, Listings, Transaktionen)</li>
                <li>Vermittlung zwischen Käufern und Verkäufern</li>
                <li>Abwicklung von Zahlungen über PayPal</li>
                <li>Bewertungs- und Reputationssystem</li>
                <li>Technische Sicherheit und Fehleranalyse</li>
              </ul>

              <h3 className="text-xl font-semibold mb-3">Welche Rechte haben Sie?</h3>
              <p className="mb-4">
                Sie haben jederzeit das Recht auf:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Auskunft über Ihre gespeicherten Daten</li>
                <li>Berichtigung unrichtiger Daten</li>
                <li>Löschung Ihrer Daten (soweit keine Aufbewahrungspflichten bestehen)</li>
                <li>Einschränkung der Verarbeitung</li>
                <li>Datenübertragbarkeit</li>
                <li>Widerruf Ihrer Einwilligung</li>
                <li>Beschwerde bei einer Aufsichtsbehörde</li>
              </ul>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">2. Verantwortliche Stellen</h2>
              
              <h3 className="text-xl font-semibold mb-3">deimudda als Plattformbetreiber</h3>
              <p className="mb-4">
                Verantwortlich für die Datenverarbeitung auf der Plattform deimudda:
              </p>
              <p className="mb-4 font-mono text-sm bg-gray-100 p-4 rounded">
                [Betreibername]<br />
                [Straße und Hausnummer]<br />
                [PLZ und Ort]<br />
                <br />
                E-Mail: [E-Mail-Adresse]<br />
                Telefon: [Telefonnummer]
              </p>

              <h3 className="text-xl font-semibold mb-3">Verkäufer als eigenständige Verantwortliche</h3>
              <p className="mb-4">
                Wenn Sie einen Kauf tätigen, werden Ihre Daten (Name, Adresse, Kontaktdaten) an den Verkäufer übermittelt, 
                damit dieser den Kaufvertrag erfüllen kann. <strong>Der Verkäufer ist eigenständiger Datenverantwortlicher</strong> 
                für diese Daten und muss Ihnen eine eigene Datenschutzerklärung bereitstellen.
              </p>
              <p className="mb-4">
                Die Kontaktdaten des Verkäufers finden Sie auf der Produktseite und in Ihrer Bestellbestätigung.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">3. Datenerfassung auf deimudda</h2>
              
              <h3 className="text-xl font-semibold mb-3">3.1 Registrierung und Authentifizierung (OAuth)</h3>
              <p className="mb-4">
                Zur Nutzung von deimudda ist eine Registrierung erforderlich. Wir nutzen <strong>OAuth</strong> für die 
                Authentifizierung. Bei der Anmeldung über OAuth werden Sie zu einem externen Authentifizierungsdienst 
                weitergeleitet.
              </p>
              <p className="mb-4">
                <strong>Erhobene Daten:</strong>
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Open ID (eindeutige Nutzer-ID)</li>
                <li>Optional: Name, E-Mail-Adresse (falls vom OAuth-Provider bereitgestellt und von Ihnen freigegeben)</li>
              </ul>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragserfüllung) und Art. 6 Abs. 1 lit. a DSGVO (Einwilligung)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> Bis zur Löschung Ihres Accounts
              </p>

              <h3 className="text-xl font-semibold mb-3">3.2 Profil-Daten</h3>
              <p className="mb-4">
                Sie können Ihr Profil mit folgenden Daten anreichern:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Nickname / Anzeigename (Pflicht)</li>
                <li>Standort (optional)</li>
                <li>Profilbild (optional, wird auf S3 gespeichert)</li>
              </ul>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragserfüllung)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> Bis zur Löschung durch Sie oder Löschung Ihres Accounts
              </p>

              <h3 className="text-xl font-semibold mb-3">3.3 Verkäufer-Daten</h3>
              <p className="mb-4">
                Wenn Sie als Verkäufer aktiv werden, erheben wir zusätzlich:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Shop-Name</li>
                <li>Shop-Beschreibung</li>
                <li>Standort</li>
                <li>Shop-Logo (optional, wird auf S3 gespeichert)</li>
              </ul>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragserfüllung)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> Bis zur Deaktivierung des Verkäufer-Status oder Löschung des Accounts
              </p>

              <h3 className="text-xl font-semibold mb-3">3.4 Listings (Produktangebote)</h3>
              <p className="mb-4">
                Verkäufer können Listings erstellen mit folgenden Daten:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Strain-Name (Sorte)</li>
                <li>Produkttyp (Steckling oder Samen)</li>
                <li>Beschreibung</li>
                <li>Preis (Festpreis oder Preisvorschlag)</li>
                <li>Menge</li>
                <li>Bilder (werden auf S3 gespeichert)</li>
                <li>Versandoptionen (Versand, Abholung)</li>
              </ul>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragserfüllung)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> Bis zur Löschung durch den Verkäufer
              </p>

              <h3 className="text-xl font-semibold mb-3">3.5 Transaktionen und Zahlungen</h3>
              <p className="mb-4">
                Bei Käufen über deimudda werden folgende Daten gespeichert:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Transaktions-ID</li>
                <li>Käufer-ID und Verkäufer-ID</li>
                <li>Listing-ID (Produkt)</li>
                <li>Kaufbetrag</li>
                <li>Plattformgebühr (€{PLATFORM_FEE.toFixed(2).replace('.', ',')} pro Artikel)</li>
                <li>PayPal-Gebühr (bei Online-Zahlung)</li>
                <li>PayPal-Transaktions-ID</li>
                <li>Zahlungsstatus</li>
                <li>Zeitstempel</li>
              </ul>
              <p className="mb-4">
                <strong>Zahlungsabwicklung über PayPal:</strong> Die Zahlung erfolgt über PayPal. Dabei werden Ihre 
                Zahlungsdaten direkt an PayPal übermittelt. deimudda erhält nur die Transaktions-ID und den Zahlungsstatus.
              </p>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragserfüllung) und Art. 6 Abs. 1 lit. c DSGVO (rechtliche Verpflichtung)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> 10 Jahre (steuerrechtliche Aufbewahrungspflicht gemäß § 147 AO)
              </p>

              <h3 className="text-xl font-semibold mb-3">3.6 Bewertungen</h3>
              <p className="mb-4">
                Käufer können Verkäufer bewerten:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Rating (1-5 Sterne)</li>
                <li>Kommentar (optional)</li>
                <li>Zeitstempel</li>
                <li>Käufer-ID (wird nicht öffentlich angezeigt)</li>
              </ul>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. a DSGVO (Einwilligung) und Art. 6 Abs. 1 lit. f DSGVO (berechtigtes Interesse an Transparenz)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> Bis zur Löschung durch Sie oder bei Account-Löschung
              </p>

              <h3 className="text-xl font-semibold mb-3">3.7 Preisvorschläge</h3>
              <p className="mb-4">
                Bei Listings mit Preisvorschlag-Option können Käufer Angebote abgeben:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Angebotspreis</li>
                <li>Nachricht (optional)</li>
                <li>Status (ausstehend, angenommen, abgelehnt)</li>
                <li>Zeitstempel</li>
              </ul>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragsanbahnung)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> 2 Jahre nach letzter Aktivität
              </p>

              <h3 className="text-xl font-semibold mb-3">3.8 Cookies</h3>
              <p className="mb-4">
                Wir verwenden nur <strong>technisch notwendige Cookies</strong>, um die Funktionalität der Website zu gewährleisten:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Session-Cookie (für Login-Status)</li>
                <li>Cookie-Consent-Cookie (speichert Ihre Cookie-Einstellung)</li>
              </ul>
              <p className="mb-4">
                Diese Cookies sind für den Betrieb der Seite erforderlich und können nicht deaktiviert werden.
              </p>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. f DSGVO (berechtigtes Interesse an technisch fehlerfreier Bereitstellung)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> Session-Cookies bis zum Schließen des Browsers, Cookie-Consent-Cookie 1 Jahr
              </p>

              <h3 className="text-xl font-semibold mb-3">3.9 Server-Log-Dateien</h3>
              <p className="mb-4">
                Unser Hosting-Provider erhebt automatisch folgende Daten:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>IP-Adresse</li>
                <li>Browsertyp und Browserversion</li>
                <li>Betriebssystem</li>
                <li>Referrer URL (vorherige Seite)</li>
                <li>Hostname des zugreifenden Rechners</li>
                <li>Uhrzeit der Serveranfrage</li>
              </ul>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. f DSGVO (berechtigtes Interesse an technischer Sicherheit und Fehleranalyse)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> 7 Tage, dann automatische Löschung
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">4. Weitergabe von Daten an Dritte</h2>
              
              <h3 className="text-xl font-semibold mb-3">4.1 Verkäufer</h3>
              <p className="mb-4">
                Wenn Sie einen Kauf tätigen, werden Ihre Kontaktdaten (Name, E-Mail, ggf. Adresse) an den Verkäufer 
                übermittelt, damit dieser den Kaufvertrag erfüllen kann (Versand, Rechnungsstellung).
              </p>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragserfüllung)
              </p>

              <h3 className="text-xl font-semibold mb-3">4.2 PayPal (Zahlungsdienstleister)</h3>
              <p className="mb-4">
                Bei Zahlung über PayPal werden Ihre Zahlungsdaten direkt an PayPal (Europe) S.à.r.l. et Cie, S.C.A., 
                22-24 Boulevard Royal, L-2449 Luxembourg übermittelt.
              </p>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragserfüllung)
              </p>
              <p className="mb-4">
                Weitere Informationen: <a href="https://www.paypal.com/de/webapps/mpp/ua/privacy-full" target="_blank" className="text-blue-600 hover:underline">PayPal Datenschutzerklärung</a>
              </p>

              <h3 className="text-xl font-semibold mb-3">4.3 S3 / Cloud-Storage (Bild-Hosting)</h3>
              <p className="mb-4">
                Hochgeladene Bilder (Profilbilder, Produktbilder) werden auf einem S3-kompatiblen Cloud-Storage gespeichert.
              </p>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. f DSGVO (berechtigtes Interesse an effizienter Bereitstellung)
              </p>

              <h3 className="text-xl font-semibold mb-3">4.4 Hosting-Provider</h3>
              <p className="mb-4">
                Diese Website wird extern gehostet. Die personenbezogenen Daten, die auf dieser Website erfasst werden, 
                werden auf den Servern des Hosters gespeichert.
              </p>
              <p className="mb-4">
                Das externe Hosting erfolgt zum Zwecke der Vertragserfüllung gegenüber unseren potenziellen und 
                bestehenden Kunden (Art. 6 Abs. 1 lit. b DSGVO) und im Interesse einer sicheren, schnellen und 
                effizienten Bereitstellung unseres Online-Angebots durch einen professionellen Anbieter (Art. 6 Abs. 1 lit. f DSGVO).
              </p>
              <p className="mb-4">
                Unser Hoster verarbeitet Ihre Daten nur insoweit, wie dies zur Erfüllung seiner Leistungspflichten 
                erforderlich ist und befolgt unsere Weisungen (Auftragsverarbeitung gemäß Art. 28 DSGVO).
              </p>

              <h3 className="text-xl font-semibold mb-3">4.5 Keine Weitergabe an sonstige Dritte</h3>
              <p className="mb-4">
                Eine Weitergabe Ihrer Daten an sonstige Dritte erfolgt nicht, es sei denn:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Sie haben ausdrücklich eingewilligt (Art. 6 Abs. 1 lit. a DSGVO)</li>
                <li>Die Weitergabe ist zur Erfüllung einer rechtlichen Verpflichtung erforderlich (Art. 6 Abs. 1 lit. c DSGVO)</li>
                <li>Die Weitergabe ist zur Geltendmachung, Ausübung oder Verteidigung von Rechtsansprüchen erforderlich (Art. 6 Abs. 1 lit. f DSGVO)</li>
              </ul>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">5. Ihre Rechte</h2>
              
              <p className="mb-4">
                Sie haben folgende Rechte bezüglich Ihrer personenbezogenen Daten:
              </p>

              <h3 className="text-xl font-semibold mb-3">Recht auf Auskunft (Art. 15 DSGVO)</h3>
              <p className="mb-4">
                Sie können Auskunft über Ihre von uns verarbeiteten personenbezogenen Daten verlangen.
              </p>

              <h3 className="text-xl font-semibold mb-3">Recht auf Berichtigung (Art. 16 DSGVO)</h3>
              <p className="mb-4">
                Sie können die Berichtigung unrichtiger oder die Vervollständigung Ihrer bei uns gespeicherten 
                personenbezogenen Daten verlangen. Dies können Sie direkt in Ihrem Profil vornehmen.
              </p>

              <h3 className="text-xl font-semibold mb-3">Recht auf Löschung (Art. 17 DSGVO)</h3>
              <p className="mb-4">
                Sie können die Löschung Ihrer bei uns gespeicherten personenbezogenen Daten verlangen, soweit nicht 
                die Verarbeitung zur Erfüllung einer rechtlichen Verpflichtung (z.B. steuerrechtliche Aufbewahrungsfristen) 
                erforderlich ist.
              </p>
              <p className="mb-4">
                <strong>Account löschen:</strong> Sie können Ihren Account jederzeit in den Profil-Einstellungen löschen. 
                Bitte beachten Sie, dass Transaktionsdaten aus steuerrechtlichen Gründen 10 Jahre aufbewahrt werden müssen 
                (anonymisiert nach Account-Löschung).
              </p>

              <h3 className="text-xl font-semibold mb-3">Recht auf Einschränkung (Art. 18 DSGVO)</h3>
              <p className="mb-4">
                Sie haben das Recht, die Einschränkung der Verarbeitung Ihrer personenbezogenen Daten zu verlangen.
              </p>

              <h3 className="text-xl font-semibold mb-3">Recht auf Datenübertragbarkeit (Art. 20 DSGVO)</h3>
              <p className="mb-4">
                Sie haben das Recht, Ihre personenbezogenen Daten in einem strukturierten, gängigen und maschinenlesbaren 
                Format zu erhalten.
              </p>
              <p className="mb-4">
                <strong>Daten exportieren:</strong> Sie können Ihre Daten jederzeit in den Profil-Einstellungen exportieren.
              </p>

              <h3 className="text-xl font-semibold mb-3">Widerspruchsrecht (Art. 21 DSGVO)</h3>
              <p className="mb-4">
                Sie haben das Recht, aus Gründen, die sich aus Ihrer besonderen Situation ergeben, jederzeit gegen die 
                Verarbeitung Sie betreffender personenbezogener Daten Widerspruch einzulegen.
              </p>

              <h3 className="text-xl font-semibold mb-3">Beschwerderecht (Art. 77 DSGVO)</h3>
              <p className="mb-4">
                Sie haben das Recht, sich bei einer Aufsichtsbehörde zu beschweren, wenn Sie der Ansicht sind, dass die 
                Verarbeitung Ihrer personenbezogenen Daten gegen die DSGVO verstößt.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">6. Datensicherheit</h2>
              
              <p className="mb-4">
                Wir verwenden geeignete technische und organisatorische Sicherheitsmaßnahmen, um Ihre Daten gegen 
                zufällige oder vorsätzliche Manipulationen, Verlust, Zerstörung oder den Zugriff unberechtigter Personen zu schützen:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>SSL/TLS-Verschlüsselung für alle Datenübertragungen</li>
                <li>Sichere Passwort-Speicherung (OAuth)</li>
                <li>Regelmäßige Sicherheits-Updates</li>
                <li>Zugriffsbeschränkungen auf Datenbanken</li>
                <li>Regelmäßige Backups</li>
              </ul>
              <p className="mb-4">
                Wir weisen darauf hin, dass die Datenübertragung im Internet (z.B. bei der Kommunikation per E-Mail) 
                Sicherheitslücken aufweisen kann. Ein lückenloser Schutz der Daten vor dem Zugriff durch Dritte ist nicht möglich.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">7. Kontakt</h2>
              
              <p className="mb-4">
                Bei Fragen zum Datenschutz oder zur Ausübung Ihrer Rechte können Sie uns jederzeit kontaktieren:
              </p>

              <p className="mb-4 font-mono text-sm bg-gray-100 p-4 rounded">
                E-Mail: [Datenschutz-E-Mail]<br />
                Telefon: [Telefonnummer]<br />
                Post: [Adresse aus Impressum]
              </p>
            </section>

            <p className="text-sm text-gray-600 mt-8">
              Diese Datenschutzerklärung wurde speziell für das Marktplatz-Modell von deimudda erstellt und 
              berücksichtigt die DSGVO sowie das Konsumcannabisgesetz (KCanG).
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: Profile.tsx

**`client/src/components/Profile.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import ImageUpload from "@/components/ImageUpload";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from "@/components/ui/dialog";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { trpc } from "@/lib/trpc";
import { useState, useEffect } from "react";
import { toast } from "sonner";
import { useLocation } from "wouter";
import { Header } from "@/components/Header";

export default function Profile() {
  const { user, loading } = useAuth();
  const [, setLocation] = useLocation();
  const utils = trpc.useUtils();

  const [formData, setFormData] = useState({
    nickname: "",
    location: "",
    profileImageUrl: "",
  });

  // Load user data when available
  useEffect(() => {
    if (user) {
      setFormData({
        nickname: user.nickname || "",
        location: user.location || "",
        profileImageUrl: user.profileImageUrl || "",
      });
    }
  }, [user]);

  const [sellerFormData, setSellerFormData] = useState({
    shopName: "",
    description: "",
  });

  const updateProfile = trpc.profile.update.useMutation({
    onSuccess: () => {
      toast.success("Profil erfolgreich aktualisiert!");
      utils.auth.me.invalidate(); // Refresh session without page reload
    },
    onError: (error) => {
      console.error("[Profile] Update profile error:", error);
      toast.error("Fehler beim Aktualisieren: " + error.message);
    },
  });

  const activateSeller = trpc.profile.activateSeller.useMutation({
    onSuccess: () => {
      toast.success("Verkäufer-Modus aktiviert!");
      utils.auth.me.invalidate(); // Refresh session without page reload
    },
    onError: (error) => {
      console.error("[Profile] Activate seller error:", error);
      toast.error("Fehler beim Aktivieren: " + error.message);
    },
  });

  const deactivateSeller = trpc.profile.deactivateSeller.useMutation({
    onSuccess: () => {
      toast.success("Verkäufer-Modus deaktiviert!");
      utils.auth.me.invalidate(); // Refresh session without page reload
    },
    onError: (error) => {
      console.error("[Profile] Deactivate seller error:", error);
      toast.error("Fehler beim Deaktivieren: " + error.message);
    },
  });

  const deleteAccount = trpc.profile.deleteAccount.useMutation({
    onSuccess: () => {
      toast.success("Account erfolgreich gelöscht!");
      setTimeout(() => {
        window.location.href = "/";
      }, 1500);
    },
    onError: (error) => {
      console.error("[Profile] Delete account error:", error);
      toast.error("Fehler beim L\u00f6schen: " + error.message);
    },
  });

  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);

  const handleUpdateProfile = (e: React.FormEvent) => {
    e.preventDefault();
    updateProfile.mutate(formData);
  };

  const handleActivateSeller = (e: React.FormEvent) => {
    e.preventDefault();
    if (!sellerFormData.shopName) {
      toast.error("Shop-Name ist erforderlich");
      return;
    }
    activateSeller.mutate(sellerFormData);
  };

  // Redirect to home if not logged in
  useEffect(() => {
    if (!loading && !user) {
      setLocation("/");
    }
  }, [loading, user, setLocation]);

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p className="text-gray-600">Lade Profil...</p>
        </div>
      </div>
    );
  }

  if (!user) {
    return null; // Will redirect via useEffect
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <Header />
      <div className="container max-w-4xl py-8">
        <h1 className="text-3xl font-bold mb-8">Mein Profil</h1>

        {/* Basic Profile */}
        <Card className="mb-6">
          <CardHeader>
            <CardTitle>Profil-Informationen</CardTitle>
            <CardDescription>Verwalten Sie Ihre persönlichen Informationen</CardDescription>
          </CardHeader>
          <CardContent>
            <form onSubmit={handleUpdateProfile} className="space-y-4">
              <div>
                <Label htmlFor="nickname">Nickname / Anzeigename</Label>
                <Input
                  id="nickname"
                  value={formData.nickname}
                  onChange={(e) => setFormData({ ...formData, nickname: e.target.value })}
                  placeholder="z.B. GreenThumb420"
                />
              </div>

              <div>
                <Label htmlFor="location">Standort (optional)</Label>
                <Input
                  id="location"
                  value={formData.location}
                  onChange={(e) => setFormData({ ...formData, location: e.target.value })}
                  placeholder="z.B. Berlin, Deutschland"
                />
              </div>

              <ImageUpload
                label="Profilbild (optional)"
                currentImageUrl={formData.profileImageUrl}
                onImageUploaded={(url) => setFormData({ ...formData, profileImageUrl: url })}
                maxSizeMB={2}
              />

              <Button type="submit" disabled={updateProfile.isPending}>
                {updateProfile.isPending ? "Wird gespeichert..." : "Profil aktualisieren"}
              </Button>
            </form>
          </CardContent>
        </Card>

        {/* Buyer Dashboard */}
        <Card className="mb-6">
          <CardHeader>
            <CardTitle>Meine Käufe</CardTitle>
            <CardDescription>
              Verwalten Sie Ihre Bestellungen und geben Sie Bewertungen ab
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button onClick={() => setLocation("/buyer/dashboard")} variant="default">
              Zu meinen Käufen
            </Button>
          </CardContent>
        </Card>

        {/* Notifications */}
        <Card className="mb-6">
          <CardHeader>
            <CardTitle>Benachrichtigungen</CardTitle>
            <CardDescription>
              Verwalten Sie Ihre Benachrichtigungen und Mitteilungen
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button onClick={() => setLocation("/notifications")} variant="default">
              Zu meinen Benachrichtigungen
            </Button>
          </CardContent>
        </Card>

        {/* Messages */}
        <Card className="mb-6">
          <CardHeader>
            <CardTitle>Nachrichten</CardTitle>
            <CardDescription>
              Kommunizieren Sie mit Käufern und Verkäufern
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button onClick={() => setLocation("/messages")} variant="default">
              Zu meinen Nachrichten
            </Button>
          </CardContent>
        </Card>

        {/* Admin Dashboard - Only visible for admins */}
        {(user.role === 'admin' || user.role === 'super_admin') && (
          <Card className="mb-6 border-purple-200 bg-purple-50">
            <CardHeader>
              <CardTitle className="text-purple-800">Admin-Dashboard</CardTitle>
              <CardDescription className="text-purple-600">
                Sie haben Admin-Rechte und können die Plattform verwalten
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-4">
                <div className="bg-purple-100 border border-purple-300 rounded-lg p-4">
                  <p className="text-purple-900 font-medium">✓ {user.role === 'super_admin' ? 'Super Admin' : 'Admin'}</p>
                  <p className="text-purple-700 text-sm mt-1">
                    Zugriff auf Nutzer-Verwaltung, Transaktionen, Listing-Moderation und mehr
                  </p>
                </div>

                <Button 
                  onClick={() => setLocation("/admin")} 
                  variant="default"
                  className="bg-purple-600 hover:bg-purple-700"
                >
                  Zum Admin-Dashboard
                </Button>
              </div>
            </CardContent>
          </Card>
        )}

        {/* Seller Mode */}
        <Card>
          <CardHeader>
            <CardTitle>Verkäufer-Modus</CardTitle>
            <CardDescription>
              {user.isSellerActive
                ? "Sie sind als Verkäufer aktiv und können Stecklinge anbieten"
                : "Aktivieren Sie den Verkäufer-Modus, um Stecklinge anzubieten"}
            </CardDescription>
          </CardHeader>
          <CardContent>
            {user.isSellerActive ? (
              <div className="space-y-4">
                <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                  <p className="text-green-800 font-medium">✓ Verkäufer-Modus ist aktiv</p>
                  <p className="text-green-600 text-sm mt-1">
                    Sie können jetzt Angebote erstellen und verwalten
                  </p>
                </div>

                <div className="flex gap-4">
                  <Button onClick={() => setLocation("/seller/dashboard")} variant="default">
                    Zum Verkäufer-Dashboard
                  </Button>
                  <Button
                    onClick={() => deactivateSeller.mutate()}
                    variant="outline"
                    disabled={deactivateSeller.isPending}
                  >
                    {deactivateSeller.isPending ? "Wird deaktiviert..." : "Verkäufer-Modus deaktivieren"}
                  </Button>
                </div>
              </div>
            ) : (
              <form onSubmit={handleActivateSeller} className="space-y-4">
                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                  <p className="text-blue-800 font-medium">Verkäufer werden</p>
                  <p className="text-blue-600 text-sm mt-1">
                    Erstellen Sie einen Shop-Namen und beginnen Sie, Stecklinge anzubieten
                  </p>
                </div>

                <div>
                  <Label htmlFor="shopName">Shop-Name *</Label>
                  <Input
                    id="shopName"
                    value={sellerFormData.shopName}
                    onChange={(e) => setSellerFormData({ ...sellerFormData, shopName: e.target.value })}
                    placeholder="z.B. German Kali"
                    required
                  />
                </div>

                <div>
                  <Label htmlFor="description">Shop-Beschreibung (optional)</Label>
                  <Textarea
                    id="description"
                    value={sellerFormData.description}
                    onChange={(e) => setSellerFormData({ ...sellerFormData, description: e.target.value })}
                    placeholder="Beschreiben Sie Ihren Shop und Ihre Spezialitäten..."
                    rows={4}
                  />
                </div>

                <Button type="submit" disabled={activateSeller.isPending}>
                  {activateSeller.isPending ? "Wird aktiviert..." : "Verkäufer-Modus aktivieren"}
                </Button>
              </form>
            )}
          </CardContent>
        </Card>

        {/* Account Deletion */}
        <Card className="border-red-200">
          <CardHeader>
            <CardTitle className="text-red-600">Gefahrenzone</CardTitle>
            <CardDescription>
              Account unwiderruflich löschen (DSGVO-konform)
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
              <p className="text-red-800 font-medium">⚠️ Warnung: Diese Aktion kann nicht rückgängig gemacht werden!</p>
              <p className="text-red-600 text-sm mt-2">
                Alle Ihre Daten werden permanent gelöscht:
              </p>
              <ul className="text-red-600 text-sm mt-2 ml-4 list-disc">
                <li>Profil und Verkäufer-Informationen</li>
                <li>Alle Listings und Angebote</li>
                <li>Transaktionen und Bewertungen</li>
                <li>Nachrichten und Benachrichtigungen</li>
                <li>Verwarnungen und Admin-Logs</li>
              </ul>
            </div>

            <Dialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>
              <DialogTrigger asChild>
                <Button variant="destructive">
                  Account löschen
                </Button>
              </DialogTrigger>
              <DialogContent>
                <DialogHeader>
                  <DialogTitle>Account wirklich löschen?</DialogTitle>
                  <DialogDescription>
                    Diese Aktion kann nicht rückgängig gemacht werden. Alle Ihre Daten werden permanent aus unserer Datenbank entfernt.
                  </DialogDescription>
                </DialogHeader>
                <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 my-4">
                  <p className="text-yellow-800 text-sm">
                    ⚠️ Bitte bestätigen Sie, dass Sie verstehen:
                  </p>
                  <ul className="text-yellow-700 text-sm mt-2 ml-4 list-disc">
                    <li>Ihr Account wird sofort gelöscht</li>
                    <li>Sie werden ausgeloggt</li>
                    <li>Alle Daten sind unwiederbringlich verloren</li>
                    <li>Laufende Transaktionen werden abgebrochen</li>
                  </ul>
                </div>
                <DialogFooter>
                  <Button
                    variant="outline"
                    onClick={() => setIsDeleteDialogOpen(false)}
                  >
                    Abbrechen
                  </Button>
                  <Button
                    variant="destructive"
                    onClick={() => {
                      deleteAccount.mutate();
                      setIsDeleteDialogOpen(false);
                    }}
                    disabled={deleteAccount.isPending}
                  >
                    {deleteAccount.isPending ? "Lösche..." : "Ja, Account löschen"}
                  </Button>
                </DialogFooter>
              </DialogContent>
            </Dialog>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: QueryError.tsx

**`client/src/components/QueryError.tsx`**

```typescript
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";

interface QueryErrorProps {
  title?: string;
  message?: string;
  error?: Error | null;
  onRetry?: () => void;
  showDetails?: boolean;
}

export default function QueryError({
  title = "Fehler beim Laden",
  message = "Die Daten konnten nicht geladen werden. Bitte versuchen Sie es erneut.",
  error,
  onRetry,
  showDetails = false,
}: QueryErrorProps) {
  return (
    <div className="flex items-center justify-center min-h-[400px] p-4">
      <Card className="max-w-md w-full border-red-200">
        <CardHeader>
          <CardTitle className="text-red-600 flex items-center gap-2">
            <span className="text-xl">⚠️</span>
            {title}
          </CardTitle>
          <CardDescription>{message}</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {showDetails && error && (
            <div className="bg-red-50 border border-red-200 rounded-lg p-3">
              <p className="text-red-800 font-medium text-sm mb-1">Fehlerdetails:</p>
              <p className="text-red-600 text-xs font-mono break-all">
                {error.message}
              </p>
            </div>
          )}

          {onRetry && (
            <Button onClick={onRetry} variant="default" className="w-full">
              Erneut versuchen
            </Button>
          )}

          <Button
            onClick={() => (window.location.href = "/")}
            variant="outline"
            className="w-full"
          >
            Zur Startseite
          </Button>
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: SellerDashboard.tsx

**`client/src/components/SellerDashboard.tsx`**

```typescript
import { useState } from "react";
import type { Listing, ListingType, PriceType, Genetics, GrowMethod, SeedType } from "@/../../shared/types";
import { Link } from "wouter";
import { useAuth } from "@/_core/hooks/useAuth";
import { trpc } from "@/lib/trpc";
import ImageUpload from "@/components/ImageUpload";
import { MultiImageUpload } from "@/components/MultiImageUpload";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from "@/components/ui/dialog";
import { Badge } from "@/components/ui/badge";
import { AlertCircle, Plus, Edit2, Trash2, MessageSquare, MessageCircle, User, ExternalLink, Euro } from "lucide-react";
import { Alert, AlertDescription } from "@/components/ui/alert";
import { toast } from "sonner";
import { Header } from "@/components/Header";
import QueryError from "@/components/QueryError";

export default function SellerDashboard() {
  const { user, isAuthenticated } = useAuth();
  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);
  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);
  const [editingListing, setEditingListing] = useState<Listing | null>(null);

  // Queries
  const sellerProfile = trpc.seller.getProfile.useQuery(undefined, {
    enabled: isAuthenticated,
    staleTime: 300000, // 5min - Static: Profile changes rarely
  });

  const myListings = trpc.listing.getMine.useQuery(undefined, {
    enabled: isAuthenticated,
    staleTime: 60000, // 1min - Semi-static: Listings change occasionally
  });

  const { data: unreadMessageCount = 0 } = trpc.chat.getUnreadCount.useQuery(undefined, {
    enabled: isAuthenticated,
    refetchInterval: 30000, // Refresh every 30 seconds
    staleTime: 10000, // 10s - Real-time: Unread count changes frequently
  });

  // Fetch max listing images from system settings
  const { data: maxListingImages } = trpc.admin.getSystemSetting.useQuery('max_listing_images', { staleTime: 300000 }); // 5min - Static
  const maxImages = maxListingImages ? parseInt(maxListingImages) : 10; // Default to 10 if not set

  // Mutations
  const createProfile = trpc.seller.createProfile.useMutation({
    onSuccess: () => {
      toast.success("Verkaufer-Profil erfolgreich erstellt!");
      sellerProfile.refetch();
    },
    onError: (error) => {
      console.error("[SellerDashboard] Create profile error:", error);
      toast.error("Fehler beim Erstellen des Profils: " + error.message);
    },
  });

  const createListing = trpc.listing.create.useMutation({
    onSuccess: () => {
      toast.success("Angebot erfolgreich erstellt!");
      myListings.refetch();
      setIsCreateDialogOpen(false);
      setFormData(initialFormData);
    },
    onError: (error) => {
      console.error("[SellerDashboard] Create listing error:", error);
      toast.error("Fehler beim Erstellen des Angebots: " + error.message);
    },
  });

  const updateListing = trpc.listing.update.useMutation({
    onSuccess: () => {
      myListings.refetch();
    },
  });

  const deleteListing = trpc.listing.delete.useMutation({
    onSuccess: () => {
      toast.success("Angebot erfolgreich geloscht!");
      myListings.refetch();
    },
    onError: (error) => {
      console.error("[SellerDashboard] Delete listing error:", error);
      toast.error("Fehler beim L\u00f6schen: " + error.message);
    },
  });

  // Form state
  const initialFormData = {
    type: "cutting" as const,
    strain: "",
    listingDescription: "",
    quantity: 1,
    priceType: "fixed" as const,
    fixedPrice: 0,
    auctionStartPrice: 0,
    acceptsOffers: false,
    offerMinPrice: 0,
    imageUrl: "",
    images: [] as string[],
    shippingVerified: true,
    shippingPickup: false,
    // Additional optional fields
    genetics: "" as "sativa" | "indica" | "hybrid" | "",
    seedBank: "",
    growMethod: "" as "hydro" | "bio" | "soil" | "",
    seedType: "" as "feminized" | "regular" | "autoflower" | "",
    thcContent: "",
    cbdContent: "",
    floweringTime: "",
    yieldInfo: "",
    flavorProfile: "",
    origin: "",
  };

  const [formData, setFormData] = useState(initialFormData);
  const [profileFormData, setProfileFormData] = useState({
    shopName: "",
    description: "",
    location: "",
  });
  const [ageVerifiedSeller, setAgeVerifiedSeller] = useState(false);

  // Handle edit button click - open edit dialog
  const handleEditClick = (listing: Listing) => {
    setEditingListing(listing);
    
    // Parse images array if it's a JSON string
    let imagesArray: string[] = [];
    if (listing.images) {
      try {
        imagesArray = typeof listing.images === 'string' ? JSON.parse(listing.images) : listing.images;
      } catch (e) {
        imagesArray = [];
      }
    }
    
    setFormData({
      ...formData,
      type: listing.type,
      strain: listing.strain,
      listingDescription: listing.description,
      quantity: listing.quantity,
      priceType: listing.priceType,
      fixedPrice: listing.priceType === 'fixed' ? parseFloat(listing.fixedPrice) : 0,
      auctionStartPrice: listing.priceType === 'auction' && listing.auctionStartPrice ? parseFloat(listing.auctionStartPrice) : 0,
      imageUrl: listing.imageUrl || "",
      images: imagesArray,
      shippingVerified: listing.shippingVerified ?? true,
      shippingPickup: listing.shippingPickup ?? false,
      acceptsOffers: listing.acceptsOffers ?? false,
      offerMinPrice: listing.offerMinPrice ? parseFloat(listing.offerMinPrice) : 0,
      // Additional fields
      genetics: listing.genetics || "",
      seedBank: listing.seedBank || "",
      growMethod: listing.growMethod || "",
      seedType: listing.seedType || "",
      thcContent: listing.thcContent || "",
      cbdContent: listing.cbdContent || "",
      floweringTime: listing.floweringTime || "",
      yieldInfo: listing.yieldInfo || "",
      origin: listing.origin || "",
      flavorProfile: listing.flavorProfile || "",
    });
    setIsEditDialogOpen(true);
  };

  if (!isAuthenticated) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <Card className="w-full max-w-md">
          <CardHeader>
            <CardTitle>Zugriff verweigert</CardTitle>
            <CardDescription>Bitte melden Sie sich an, um auf das Seller-Dashboard zuzugreifen.</CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  // Show error state
  if (sellerProfile.isError) {
    return (
      <QueryError
        title="Fehler beim Laden des Verk\u00e4ufer-Profils"
        message="Das Verk\u00e4ufer-Profil konnte nicht geladen werden. Bitte versuchen Sie es erneut."
        error={sellerProfile.error}
        onRetry={() => sellerProfile.refetch()}
        showDetails={process.env.NODE_ENV === 'development'}
      />
    );
  }

  // Show loading state
  if (sellerProfile.isLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p className="text-gray-600">Lade Profil...</p>
        </div>
      </div>
    );
  }

  // Show profile creation if user doesn't have a seller profile
  if (!sellerProfile.data) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-8">
        <div className="max-w-2xl mx-auto">
          <Card>
            <CardHeader>
              <CardTitle>Verkäufer-Profil erstellen</CardTitle>
              <CardDescription>
                Erstellen Sie Ihr Verkäufer-Profil, um Stecklinge und Samen anzubieten.
              </CardDescription>
            </CardHeader>
            <CardContent>
              <form
                onSubmit={(e) => {
                  e.preventDefault();
                  if (!profileFormData.shopName.trim()) {
                    alert('Bitte geben Sie einen Shop-Namen ein');
                    return;
                  }
                  createProfile.mutate(profileFormData);
                }}
                className="space-y-4"
              >
                <div>
                  <label className="text-sm font-medium">Shop-Name *</label>
                  <Input
                    placeholder="z.B. Meine Cannabis-Stecklinge"
                    value={profileFormData.shopName}
                    onChange={(e) =>
                      setProfileFormData({ ...profileFormData, shopName: e.target.value })
                    }
                    required
                  />
                </div>

                <div>
                  <label className="text-sm font-medium">Beschreibung</label>
                  <Textarea
                    placeholder="Beschreiben Sie Ihren Shop und Ihre Spezialitäten..."
                    value={profileFormData.description}
                    onChange={(e) =>
                      setProfileFormData({ ...profileFormData, description: e.target.value })
                    }
                  />
                </div>

                <div>
                  <label className="text-sm font-medium">Standort</label>
                  <Input
                    placeholder="z.B. Berlin, Deutschland"
                    value={profileFormData.location}
                    onChange={(e) =>
                      setProfileFormData({ ...profileFormData, location: e.target.value })
                    }
                  />
                </div>

                <Alert>
                  <AlertCircle className="h-4 w-4" />
                  <AlertDescription>
                    Indem Sie ein Verkäufer-Profil erstellen, erklären Sie sich damit einverstanden, dass Ihre Stecklinge und Samen den Anforderungen des Konsumcannabisgesetzes (KCanG) entsprechen und keine Blüten oder Fruchtstände haben.
                  </AlertDescription>
                </Alert>

                {createProfile.error && (
                  <Alert variant="destructive">
                    <AlertCircle className="h-4 w-4" />
                    <AlertDescription>{createProfile.error?.message || 'Fehler beim Erstellen des Profils'}</AlertDescription>
                  </Alert>
                )}

                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                  <label className="flex items-start gap-3 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={ageVerifiedSeller}
                      onChange={(e) => setAgeVerifiedSeller(e.target.checked)}
                      className="mt-1"
                    />
                    <span className="text-sm text-blue-900">
                      <strong>Altersbestaetigung:</strong> Ich bestaettige, dass ich mindestens 18 Jahre alt bin und dass alle Stecklinge und Samen, die ich anbiete, den Anforderungen des Konsumcannabisgesetzes (KCanG) entsprechen und keine Blueten, Fruchtstande oder verarbeitete Produkte sind.
                    </span>
                  </label>
                </div>

                <Button
                  type="submit"
                  disabled={createProfile.isPending || !profileFormData.shopName.trim() || !ageVerifiedSeller}
                  className="w-full"
                >
                  {createProfile.isPending ? "Wird erstellt..." : "Profil erstellen"}
                </Button>
              </form>
            </CardContent>
          </Card>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      <Header />
      <div className="max-w-6xl mx-auto p-8">
        {/* Header */}
        <div className="mb-8">
          <h1 className="text-3xl font-bold mb-2">Seller Dashboard</h1>
          <p className="text-gray-600">
            Verwalten Sie Ihre Stecklinge und Samen auf der deimudda-Plattform.
          </p>
        </div>

        {/* Profile Card */}
        {sellerProfile.data && (
          <Card className="mb-8">
            <CardContent className="p-6">
              <div className="flex items-start gap-6">
                {/* Profile Image */}
                <div className="flex-shrink-0">
                  {sellerProfile.data.profileImageUrl ? (
                    <img
                      src={sellerProfile.data.profileImageUrl}
                      alt={sellerProfile.data.shopName}
                      className="w-24 h-24 rounded-full object-cover border-4 border-green-100"
                    />
                  ) : (
                    <div className="w-24 h-24 rounded-full bg-gray-300 flex items-center justify-center border-4 border-green-100">
                      <User className="w-12 h-12 text-gray-600" />
                    </div>
                  )}
                </div>

                {/* Profile Info */}
                <div className="flex-1">
                  <h2 className="text-2xl font-bold mb-1">{sellerProfile.data.shopName}</h2>
                  <p className="text-gray-600 mb-4">{sellerProfile.data.location}</p>

                  <div className="grid grid-cols-2 gap-4 mb-4">
                    <div>
                      <p className="text-sm text-gray-600">Bewertung</p>
                      <p className="text-2xl font-bold">
                        {parseFloat(sellerProfile.data.rating || "0").toFixed(1)} ⭐
                      </p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-600">Bewertungen</p>
                      <p className="text-2xl font-bold">{sellerProfile.data.totalReviews}</p>
                    </div>
                  </div>

                  {sellerProfile.data.description && (
                    <p className="text-gray-700 mb-4">{sellerProfile.data.description}</p>
                  )}

                  <div className="flex items-center gap-3">
                    <Badge variant={sellerProfile.data.verificationStatus === "verified" ? "default" : "outline"}>
                      {sellerProfile.data.verificationStatus === "verified" ? "✓ Verifiziert" : "Ausstehend"}
                    </Badge>
                    
                    {user && (
                      <Link to={`/seller/${user.id}`}>
                        <Button variant="outline" size="sm" className="gap-2">
                          <ExternalLink className="w-4 h-4" />
                          Mein Shop ansehen
                        </Button>
                      </Link>
                    )}
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>
        )}

        {/* Create Listing Button */}
        <div className="mb-8">
          <div className="flex gap-3">
            <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>
              <DialogTrigger asChild>
                <Button size="lg" className="gap-2">
                  <Plus className="w-5 h-5" />
                  Neues Angebot erstellen
                </Button>
              </DialogTrigger>
            </Dialog>
            <Link href="/seller/transactions">
              <Button size="lg" variant="outline" className="gap-2">
                <Euro className="w-5 h-5" />
                Verkäufe & Gebühren
              </Button>
            </Link>
            <Link href="/seller/offers">
              <Button size="lg" variant="outline" className="gap-2">
                <MessageSquare className="w-5 h-5" />
                Preisvorschläge verwalten
              </Button>
            </Link>
            <Link href="/messages">
              <Button size="lg" variant="outline" className="gap-2 relative">
                <MessageCircle className="w-5 h-5" />
                Nachrichten
                {unreadMessageCount > 0 && (
                  <Badge 
                    variant="destructive" 
                    className="absolute -top-2 -right-2 h-6 w-6 flex items-center justify-center p-0 text-xs"
                  >
                    {unreadMessageCount > 9 ? "9+" : unreadMessageCount}
                  </Badge>
                )}
              </Button>
            </Link>
          </div>
          <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>
            <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
              <DialogHeader>
                <DialogTitle>Neues Angebot erstellen</DialogTitle>
                <DialogDescription>
                  Erstellen Sie ein neues Angebot für Stecklinge oder Samen.
                </DialogDescription>
              </DialogHeader>

              {/* RED WARNING BANNER */}
              <div className="bg-red-50 border-l-4 border-red-600 p-4 rounded-r-lg mb-4">
                <div className="flex items-start gap-3">
                  <AlertCircle className="h-5 w-5 text-red-600 flex-shrink-0 mt-0.5" />
                  <div className="text-sm text-red-800">
                    <p className="font-bold mb-1">⚠️ ACHTUNG: Verkauf von Blütenständen ist VERBOTEN!</p>
                    <p className="mb-2">Der Verkauf von Cannabis-Blüten, Haschisch, Öl oder anderen Cannabisprodukten führt zur <strong>sofortigen Account-Sperrung</strong> und kann strafrechtlich verfolgt werden.</p>
                    <p className="text-xs"><strong>🔒 Datenschutz:</strong> Speichern Sie <strong>keine privaten Kontaktdaten</strong> in der Produktbeschreibung. Nutzen Sie das Chat-System und verschlüsselte Messenger (Signal, Telegram) für den Austausch sensibler Daten.</p>
                  </div>
                </div>
              </div>

              <form
                onSubmit={(e) => {
                  e.preventDefault();
                  
                  // Validation
                  if (!formData.strain.trim()) {
                    toast.error("Bitte geben Sie eine Sorte ein");
                    return;
                  }
                  if (formData.quantity <= 0) {
                    toast.error("Menge muss grosser als 0 sein");
                    return;
                  }
                  if (String(formData.priceType) === "fixed" && formData.fixedPrice <= 0) {
                    toast.error("Preis muss grosser als 0 sein");
                    return;
                  }
                  if (String(formData.priceType) === "auction" && formData.auctionStartPrice <= 0) {
                    toast.error("Startgebot muss grosser als 0 sein");
                    return;
                  }

                  createListing.mutate({
                    type: formData.type as ListingType,
                    strain: formData.strain,
                    description: formData.listingDescription,
                    quantity: formData.quantity,
                    priceType: formData.priceType as PriceType,
                    fixedPrice: formData.fixedPrice || undefined,
                    auctionStartPrice: formData.auctionStartPrice || undefined,
                    imageUrl: formData.imageUrl || undefined,
                    images: formData.images || undefined,
                    shippingVerified: formData.shippingVerified,
                    shippingPickup: formData.shippingPickup,
                    acceptsOffers: formData.acceptsOffers,
                    offerMinPrice: formData.offerMinPrice || undefined,
                    // Additional optional fields
                    genetics: formData.genetics || undefined,
                    seedBank: formData.seedBank || undefined,
                    growMethod: formData.growMethod || undefined,
                    seedType: formData.seedType || undefined,
                    thcContent: formData.thcContent || undefined,
                    cbdContent: formData.cbdContent || undefined,
                    floweringTime: formData.floweringTime || undefined,
                    yieldInfo: formData.yieldInfo || undefined,
                    flavorProfile: formData.flavorProfile || undefined,
                    origin: formData.origin || undefined,
                  });
                }}
                className="space-y-4"
              >
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="text-sm font-medium">Typ *</label>
                    <Select value={formData.type} onValueChange={(value: ListingType) => setFormData({ ...formData, type: value })}>
                      <SelectTrigger>
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="cutting">Steckling</SelectItem>
                        <SelectItem value="seed">Samen</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>

                  <div>
                    <label className="text-sm font-medium">Sorte *</label>
                    <Input
                      placeholder="z.B. Blue Dream"
                      value={formData.strain}
                      onChange={(e) => setFormData({ ...formData, strain: e.target.value })}
                      required
                    />
                  </div>
                </div>

                <div>
                  <label className="text-sm font-medium">Beschreibung</label>
                  <Textarea
                    placeholder="Beschreiben Sie Ihre Stecklinge/Samen..."
                    value={formData.listingDescription}
                    onChange={(e) => setFormData({ ...formData, listingDescription: e.target.value })}
                  />
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="text-sm font-medium">Menge *</label>
                    <Input
                      type="number"
                      min="1"
                      value={formData.quantity}
                      onChange={(e) => setFormData({ ...formData, quantity: parseInt(e.target.value) })}
                      required
                    />
                  </div>

                  <div>
                    <label className="text-sm font-medium">Verkaufstyp *</label>
                    <Select value={formData.priceType} onValueChange={(value: PriceType) => setFormData({ ...formData, priceType: value })}>
                      <SelectTrigger>
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="fixed">Festpreis</SelectItem>
                        <SelectItem value="auction">Auktion</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {String(formData.priceType) === "fixed" && (
                  <div>
                    <label className="text-sm font-medium">Preis pro Stück (€) *</label>
                    <Input
                      type="number"
                      step="0.01"
                      min="0"
                      value={formData.fixedPrice}
                      onChange={(e) => setFormData({ ...formData, fixedPrice: parseFloat(e.target.value) })}
                      required
                    />
                  </div>
                )}

                {String(formData.priceType) === "auction" && (
                  <div>
                    <label className="text-sm font-medium">Startgebot (€) *</label>
                    <Input
                      type="number"
                      step="0.01"
                      min="0"
                      value={formData.auctionStartPrice}
                      onChange={(e) => setFormData({ ...formData, auctionStartPrice: parseFloat(e.target.value) })}
                      required
                    />
                  </div>
                )}

                {/* Price Offer Section */}
                <div className="border rounded-lg p-4 bg-blue-50">
                  <div className="flex items-start gap-3">
                    <input
                      type="checkbox"
                      id="acceptsOffers"
                      checked={formData.acceptsOffers}
                      onChange={(e) => setFormData({ ...formData, acceptsOffers: e.target.checked })}
                      className="mt-1"
                    />
                    <div className="flex-1">
                      <label htmlFor="acceptsOffers" className="text-sm font-medium cursor-pointer">
                        Preisvorschläge akzeptieren
                      </label>
                      <p className="text-xs text-gray-600 mt-1">
                        Käufer können Ihnen Preisvorschläge senden, die Sie annehmen oder ablehnen können.
                      </p>
                    </div>
                  </div>

                  {formData.acceptsOffers && (
                    <div className="mt-3">
                      <label className="text-sm font-medium">Mindestpreis (€) (optional)</label>
                      <Input
                        type="number"
                        step="0.01"
                        min="0"
                        value={formData.offerMinPrice}
                        onChange={(e) => setFormData({ ...formData, offerMinPrice: parseFloat(e.target.value) })}
                        placeholder="z.B. 10.00"
                      />
                      <p className="text-xs text-gray-500 mt-1">
                        Angebote unter diesem Preis werden automatisch abgelehnt.
                      </p>
                    </div>
                  )}
                </div>

                {/* Additional Optional Fields */}
                <div className="border-t pt-4 mt-4">
                  <h4 className="text-sm font-semibold mb-3">Zusätzliche Details (optional)</h4>
                  
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="text-sm font-medium">Genetik</label>
                      <Select value={formData.genetics} onValueChange={(value: Genetics) => setFormData({ ...formData, genetics: value })}>
                        <SelectTrigger>
                          <SelectValue placeholder="Wählen..." />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="sativa">Sativa</SelectItem>
                          <SelectItem value="indica">Indica</SelectItem>
                          <SelectItem value="hybrid">Hybrid</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div>
                      <label className="text-sm font-medium">Samenbank/Breeder</label>
                      <Input
                        value={formData.seedBank}
                        onChange={(e) => setFormData({ ...formData, seedBank: e.target.value })}
                        placeholder="z.B. Dutch Passion"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Anbaumethode</label>
                      <Select value={formData.growMethod} onValueChange={(value: GrowMethod) => setFormData({ ...formData, growMethod: value })}>
                        <SelectTrigger>
                          <SelectValue placeholder="Wählen..." />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="hydro">Hydro</SelectItem>
                          <SelectItem value="bio">Bio</SelectItem>
                          <SelectItem value="soil">Soil</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div>
                      <label className="text-sm font-medium">Samentyp</label>
                      <Select value={formData.seedType} onValueChange={(value: SeedType) => setFormData({ ...formData, seedType: value })}>
                        <SelectTrigger>
                          <SelectValue placeholder="Wählen..." />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="feminized">Feminisiert</SelectItem>
                          <SelectItem value="regular">Regular</SelectItem>
                          <SelectItem value="autoflower">Autoflower</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div>
                      <label className="text-sm font-medium">THC-Gehalt</label>
                      <Input
                        value={formData.thcContent}
                        onChange={(e) => setFormData({ ...formData, thcContent: e.target.value })}
                        placeholder="z.B. 15-20%"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">CBD-Gehalt</label>
                      <Input
                        value={formData.cbdContent}
                        onChange={(e) => setFormData({ ...formData, cbdContent: e.target.value })}
                        placeholder="z.B. < 1%"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Blütezeit</label>
                      <Input
                        value={formData.floweringTime}
                        onChange={(e) => setFormData({ ...formData, floweringTime: e.target.value })}
                        placeholder="z.B. 8-9 Wochen"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Ertrag</label>
                      <Input
                        value={formData.yieldInfo}
                        onChange={(e) => setFormData({ ...formData, yieldInfo: e.target.value })}
                        placeholder="z.B. 400-500g/m²"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Herkunft</label>
                      <Input
                        value={formData.origin}
                        onChange={(e) => setFormData({ ...formData, origin: e.target.value })}
                        placeholder="z.B. Kalifornien, USA"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Geschmack/Aroma</label>
                      <Input
                        value={formData.flavorProfile}
                        onChange={(e) => setFormData({ ...formData, flavorProfile: e.target.value })}
                        placeholder="z.B. Zitrus, Diesel, Erdig"
                      />
                    </div>
                  </div>
                </div>

                <MultiImageUpload
                  label="Produktbilder (optional)"
                  currentImages={formData.images}
                  maxImages={maxImages}
                  maxSizeMB={5}
                  onImagesChange={(urls) => setFormData({ ...formData, images: urls, imageUrl: urls[0] || "" })}
                />

                <div className="space-y-3">
                  <label className="text-sm font-medium">Versandarten * (mindestens eine auswählen)</label>
                  <div className="space-y-2">
                    <label className="flex items-center space-x-2 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={formData.shippingVerified}
                        onChange={(e) => setFormData({ ...formData, shippingVerified: e.target.checked })}
                        className="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"
                      />
                      <span className="text-sm">Versand mit Altersverifikation (DHL/DPD/Hermes)</span>
                    </label>
                    <label className="flex items-center space-x-2 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={formData.shippingPickup}
                        onChange={(e) => setFormData({ ...formData, shippingPickup: e.target.checked })}
                        className="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"
                      />
                      <span className="text-sm">Persönliche Abholung (lokal)</span>
                    </label>
                  </div>
                  <p className="text-xs text-gray-500">Sie können beide Optionen anbieten. Altersverifikation schützt Sie rechtlich und ist empfohlen.</p>
                </div>

                <Alert>
                  <AlertCircle className="h-4 w-4" />
                  <AlertDescription>
                    Stellen Sie sicher, dass Ihre Stecklinge/Samen den KCanG-Anforderungen entsprechen (keine Blueten oder Fruchtstande).
                  </AlertDescription>
                </Alert>

                <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                  <label className="flex items-start gap-3 cursor-pointer">
                    <input
                      type="checkbox"
                      required
                      className="mt-1"
                    />
                    <span className="text-sm text-green-900">
                      <strong>Bestaetigung:</strong> Ich bestaettige, dass diese Stecklinge/Samen den KCanG-Anforderungen entsprechen und keine Blueten, Fruchtstande oder verarbeitete Produkte enthalten.
                    </span>
                  </label>
                </div>

                <Button type="submit" disabled={createListing.isPending} className="w-full">
                  {createListing.isPending ? "Wird erstellt..." : "Angebot erstellen"}
                </Button>
              </form>
            </DialogContent>
          </Dialog>

          {/* Edit Dialog */}
          <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>
            <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
              <DialogHeader>
                <DialogTitle>Angebot bearbeiten</DialogTitle>
                <DialogDescription>Aktualisieren Sie die Details Ihres Angebots</DialogDescription>
              </DialogHeader>
              <form
                onSubmit={(e) => {
                  e.preventDefault();
                  if (editingListing) {
                    updateListing.mutate({
                      listingId: editingListing.id,
                      strain: formData.strain,
                      description: formData.listingDescription,
                      quantity: formData.quantity,
                      fixedPrice: formData.priceType === 'fixed' ? formData.fixedPrice : undefined,
                      imageUrl: formData.imageUrl || undefined,
                      images: formData.images && formData.images.length > 0 ? formData.images : undefined,
                      // Professional fields
                      genetics: formData.genetics || undefined,
                      seedBank: formData.seedBank || undefined,
                      growMethod: formData.growMethod || undefined,
                      seedType: formData.seedType || undefined,
                      thcContent: formData.thcContent || undefined,
                      cbdContent: formData.cbdContent || undefined,
                      floweringTime: formData.floweringTime || undefined,
                      yieldInfo: formData.yieldInfo || undefined,
                      flavorProfile: formData.flavorProfile || undefined,
                      origin: formData.origin || undefined,
                      shippingVerified: formData.shippingVerified,
                      shippingPickup: formData.shippingPickup,
                      acceptsOffers: formData.acceptsOffers,
                      offerMinPrice: formData.acceptsOffers ? formData.offerMinPrice : undefined,
                    });
                  }
                }}
                className="space-y-4"
              >
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="text-sm font-medium">Typ *</label>
                    <Select value={formData.type} onValueChange={(value: ListingType) => setFormData({ ...formData, type: value })} disabled>
                      <SelectTrigger>
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="cutting">Steckling</SelectItem>
                        <SelectItem value="seed">Samen</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <label className="text-sm font-medium">Sorte *</label>
                    <Input
                      value={formData.strain}
                      onChange={(e) => setFormData({ ...formData, strain: e.target.value })}
                      placeholder="z.B. Blue Dream"
                      required
                    />
                  </div>
                </div>

                <div>
                  <label className="text-sm font-medium">Beschreibung</label>
                  <Textarea
                    value={formData.listingDescription}
                    onChange={(e) => setFormData({ ...formData, listingDescription: e.target.value })}
                    placeholder="Beschreiben Sie Ihr Angebot..."
                    rows={3}
                  />
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="text-sm font-medium">Menge *</label>
                    <Input
                      type="number"
                      min="1"
                      value={formData.quantity}
                      onChange={(e) => setFormData({ ...formData, quantity: parseInt(e.target.value) })}
                      required
                    />
                  </div>
                  <div>
                    <label className="text-sm font-medium">Verkaufstyp *</label>
                    <Select value={formData.priceType} onValueChange={(value: PriceType) => setFormData({ ...formData, priceType: value })}>
                      <SelectTrigger>
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="fixed">Festpreis</SelectItem>
                        <SelectItem value="auction">Auktion</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {String(formData.priceType) === "fixed" && (
                  <div>
                    <label className="text-sm font-medium">Preis pro Stück (€) *</label>
                    <Input
                      type="number"
                      step="0.01"
                      min="0"
                      value={formData.fixedPrice}
                      onChange={(e) => setFormData({ ...formData, fixedPrice: parseFloat(e.target.value) })}
                      required
                    />
                  </div>
                )}

                {String(formData.priceType) === "auction" && (
                  <div>
                    <label className="text-sm font-medium">Startgebot (€) *</label>
                    <Input
                      type="number"
                      step="0.01"
                      min="0"
                      value={formData.auctionStartPrice}
                      onChange={(e) => setFormData({ ...formData, auctionStartPrice: parseFloat(e.target.value) })}
                      required
                    />
                  </div>
                )}

                {/* Price Offer Section */}
                <div className="border rounded-lg p-4 bg-blue-50">
                  <div className="flex items-start gap-3">
                    <input
                      type="checkbox"
                      id="acceptsOffers"
                      checked={formData.acceptsOffers}
                      onChange={(e) => setFormData({ ...formData, acceptsOffers: e.target.checked })}
                      className="mt-1"
                    />
                    <div className="flex-1">
                      <label htmlFor="acceptsOffers" className="text-sm font-medium cursor-pointer">
                        Preisvorschläge akzeptieren
                      </label>
                      <p className="text-xs text-gray-600 mt-1">
                        Käufer können Ihnen Preisvorschläge senden, die Sie annehmen oder ablehnen können.
                      </p>
                    </div>
                  </div>

                  {formData.acceptsOffers && (
                    <div className="mt-3">
                      <label className="text-sm font-medium">Mindestpreis (€) (optional)</label>
                      <Input
                        type="number"
                        step="0.01"
                        min="0"
                        value={formData.offerMinPrice}
                        onChange={(e) => setFormData({ ...formData, offerMinPrice: parseFloat(e.target.value) })}
                        placeholder="z.B. 10.00"
                      />
                      <p className="text-xs text-gray-500 mt-1">
                        Angebote unter diesem Preis werden automatisch abgelehnt.
                      </p>
                    </div>
                  )}
                </div>

                {/* Additional Optional Fields */}
                <div className="border-t pt-4 mt-4">
                  <h4 className="text-sm font-semibold mb-3">Zusätzliche Details (optional)</h4>
                  
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="text-sm font-medium">Genetik</label>
                      <Select value={formData.genetics} onValueChange={(value: Genetics) => setFormData({ ...formData, genetics: value })}>
                        <SelectTrigger>
                          <SelectValue placeholder="Wählen..." />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="sativa">Sativa</SelectItem>
                          <SelectItem value="indica">Indica</SelectItem>
                          <SelectItem value="hybrid">Hybrid</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div>
                      <label className="text-sm font-medium">Samenbank/Breeder</label>
                      <Input
                        value={formData.seedBank}
                        onChange={(e) => setFormData({ ...formData, seedBank: e.target.value })}
                        placeholder="z.B. Dutch Passion"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Anbaumethode</label>
                      <Select value={formData.growMethod} onValueChange={(value: GrowMethod) => setFormData({ ...formData, growMethod: value })}>
                        <SelectTrigger>
                          <SelectValue placeholder="Wählen..." />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="hydro">Hydro</SelectItem>
                          <SelectItem value="bio">Bio</SelectItem>
                          <SelectItem value="soil">Soil</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div>
                      <label className="text-sm font-medium">Samentyp</label>
                      <Select value={formData.seedType} onValueChange={(value: SeedType) => setFormData({ ...formData, seedType: value })}>
                        <SelectTrigger>
                          <SelectValue placeholder="Wählen..." />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="feminized">Feminisiert</SelectItem>
                          <SelectItem value="regular">Regular</SelectItem>
                          <SelectItem value="autoflower">Autoflower</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div>
                      <label className="text-sm font-medium">THC-Gehalt</label>
                      <Input
                        value={formData.thcContent}
                        onChange={(e) => setFormData({ ...formData, thcContent: e.target.value })}
                        placeholder="z.B. 15-20%"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">CBD-Gehalt</label>
                      <Input
                        value={formData.cbdContent}
                        onChange={(e) => setFormData({ ...formData, cbdContent: e.target.value })}
                        placeholder="z.B. < 1%"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Blütezeit</label>
                      <Input
                        value={formData.floweringTime}
                        onChange={(e) => setFormData({ ...formData, floweringTime: e.target.value })}
                        placeholder="z.B. 8-9 Wochen"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Ertrag</label>
                      <Input
                        value={formData.yieldInfo}
                        onChange={(e) => setFormData({ ...formData, yieldInfo: e.target.value })}
                        placeholder="z.B. 400-500g/m²"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Herkunft</label>
                      <Input
                        value={formData.origin}
                        onChange={(e) => setFormData({ ...formData, origin: e.target.value })}
                        placeholder="z.B. Kalifornien, USA"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Geschmack/Aroma</label>
                      <Input
                        value={formData.flavorProfile}
                        onChange={(e) => setFormData({ ...formData, flavorProfile: e.target.value })}
                        placeholder="z.B. Zitrus, Diesel, Erdig"
                      />
                    </div>
                  </div>
                </div>

                <MultiImageUpload
                  label="Produktbilder (optional)"
                  currentImages={formData.images}
                  maxImages={maxImages}
                  maxSizeMB={5}
                  onImagesChange={(urls) => setFormData({ ...formData, images: urls, imageUrl: urls[0] || "" })}
                />

                <div className="space-y-3">
                  <label className="text-sm font-medium">Versandarten * (mindestens eine auswählen)</label>
                  <div className="space-y-2">
                    <label className="flex items-center space-x-2 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={formData.shippingVerified}
                        onChange={(e) => setFormData({ ...formData, shippingVerified: e.target.checked })}
                        className="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"
                      />
                      <span className="text-sm">Versand mit Altersverifikation (DHL/DPD/Hermes)</span>
                    </label>
                    <label className="flex items-center space-x-2 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={formData.shippingPickup}
                        onChange={(e) => setFormData({ ...formData, shippingPickup: e.target.checked })}
                        className="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"
                      />
                      <span className="text-sm">Persönliche Abholung (lokal)</span>
                    </label>
                  </div>
                  <p className="text-xs text-gray-500">Sie können beide Optionen anbieten. Altersverifikation schützt Sie rechtlich und ist empfohlen.</p>
                </div>

                <Alert>
                  <AlertCircle className="h-4 w-4" />
                  <AlertDescription>
                    Stellen Sie sicher, dass Ihre Stecklinge/Samen den KCanG-Anforderungen entsprechen (keine Blueten oder Fruchtstande).
                  </AlertDescription>
                </Alert>

                <Button type="submit" disabled={updateListing.isPending} className="w-full">
                  {updateListing.isPending ? "Wird aktualisiert..." : "Angebot aktualisieren"}
                </Button>
              </form>
            </DialogContent>
          </Dialog>

        </div>

        {/* Listings Table */}
        <Card>
          <CardHeader>
            <CardTitle>Meine Angebote</CardTitle>
            <CardDescription>
              {myListings.data?.length || 0} Angebot{(myListings.data?.length || 0) !== 1 ? "e" : ""}
            </CardDescription>
          </CardHeader>
          <CardContent>
            {myListings.isLoading ? (
              <div className="space-y-3">
                <div className="h-12 bg-gray-200 rounded animate-pulse"></div>
                <div className="h-12 bg-gray-200 rounded animate-pulse"></div>
                <div className="h-12 bg-gray-200 rounded animate-pulse"></div>
              </div>
            ) : myListings.data?.length === 0 ? (
              <p className="text-gray-500">Keine Angebote vorhanden. Erstellen Sie Ihr erstes Angebot!</p>
            ) : (
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead className="border-b">
                    <tr>
                      <th className="text-left py-2 px-4">Sorte</th>
                      <th className="text-left py-2 px-4">Typ</th>
                      <th className="text-left py-2 px-4">Menge</th>
                      <th className="text-left py-2 px-4">Preis</th>
                      <th className="text-left py-2 px-4">Status</th>
                      <th className="text-right py-2 px-4">Aktionen</th>
                    </tr>
                  </thead>
                  <tbody>
                    {myListings.data?.map((listing) => (
                      <tr key={listing.id} className="border-b hover:bg-slate-50">
                        <td className="py-2 px-4 font-medium">{listing.strain}</td>
                        <td className="py-2 px-4">
                          {listing.type === "cutting" ? "Steckling" : "Samen"}
                        </td>
                        <td className="py-2 px-4">{listing.quantity}</td>
                        <td className="py-2 px-4">
                          {String(listing.priceType) === "fixed"
                            ? `€${parseFloat(listing.fixedPrice || "0").toFixed(2)}`
                            : `Ab €${parseFloat(listing.auctionStartPrice || "0").toFixed(2)}`}
                        </td>
                        <td className="py-2 px-4">
                          <Badge variant={listing.status === "active" ? "default" : "secondary"}>
                            {listing.status === "active" ? "Aktiv" : listing.status === "sold" ? "Verkauft" : "Beendet"}
                          </Badge>
                        </td>
                        <td className="py-2 px-4 text-right space-x-2">
                          <Button
                            variant="ghost"
                            size="sm"
                            disabled={updateListing.isPending}
                            onClick={() => handleEditClick(listing)}
                          >
                            <Edit2 className="w-4 h-4" />
                          </Button>
                          <Button
                            variant="ghost"
                            size="sm"
                            disabled={deleteListing.isPending}
                            onClick={() => deleteListing.mutate(listing.id)}
                          >
                            <Trash2 className="w-4 h-4" />
                          </Button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: SellerGuidelines.tsx

**`client/src/components/SellerGuidelines.tsx`**

```typescript
import BackButton from "@/components/BackButton";
import { CheckCircle, AlertTriangle, XCircle, Info } from "lucide-react";
import { trpc } from "@/lib/trpc";

export default function SellerGuidelines() {
  // Load dynamic fees from system settings
  const { data: platformFeeStr } = trpc.admin.getSystemSetting.useQuery('platform_fee_fixed', { staleTime: 300000 });
  const { data: paypalFeePercentageStr } = trpc.admin.getSystemSetting.useQuery('paypal_fee_percentage', { staleTime: 300000 });
  const { data: paypalFeeFixedStr } = trpc.admin.getSystemSetting.useQuery('paypal_fee_fixed', { staleTime: 300000 });
  
  const PLATFORM_FEE = parseFloat(platformFeeStr || "0.42");
  const PAYPAL_FEE_PERCENTAGE = parseFloat(paypalFeePercentageStr || "0.0249");
  const PAYPAL_FEE_FIXED = parseFloat(paypalFeeFixedStr || "0.49");
  const EXAMPLE_TOTAL_FEES_20 = (PLATFORM_FEE + 20 * PAYPAL_FEE_PERCENTAGE + PAYPAL_FEE_FIXED).toFixed(2);
  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 py-12">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <BackButton href="/" label="Zurück zur Startseite" />
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-8 text-gray-900">Verkäufer-Richtlinien</h1>
          
          <div className="prose prose-lg max-w-none">
            <p className="text-lg text-gray-700 mb-8">
              Als Verkäufer auf deimudda trägst du Verantwortung für deine Listings und die Abwicklung deiner Verkäufe. 
              Diese Richtlinien helfen dir, erfolgreich und rechtskonform zu verkaufen.
            </p>

            {/* Grundregeln */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                <CheckCircle className="h-6 w-6 text-green-600" />
                Grundregeln für Verkäufer
              </h2>
              
              <div className="space-y-4">
                <div className="bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg">
                  <h3 className="font-bold text-green-900 mb-2">✅ Erlaubt</h3>
                  <ul className="list-disc pl-6 space-y-1 text-green-800">
                    <li>Verkauf von <strong>Cannabis-Stecklingen</strong> (lebende Pflanzen)</li>
                    <li>Verkauf von <strong>Cannabis-Samen</strong></li>
                    <li>Verkauf von <strong>eigenem Vermehrungsmaterial</strong></li>
                    <li>Verkauf als <strong>Privatperson</strong> oder <strong>Gewerbetreibender</strong></li>
                    <li><strong>Preisvorschlag-Funktion</strong> nutzen</li>
                    <li><strong>Versand</strong> oder <strong>Abholung</strong> anbieten</li>
                  </ul>
                </div>

                <div className="bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg">
                  <h3 className="font-bold text-red-900 mb-2">❌ Verboten</h3>
                  <ul className="list-disc pl-6 space-y-1 text-red-800">
                    <li>Verkauf von <strong>Cannabis-Blüten</strong> (Ernteprodukte)</li>
                    <li>Verkauf von <strong>Haschisch, Öl oder anderen Cannabisprodukten</strong></li>
                    <li>Verkauf an <strong>Minderjährige</strong> (unter 18 Jahren)</li>
                    <li><strong>Falsche oder irreführende Produktbeschreibungen</strong></li>
                    <li><strong>Gestohlene oder illegal erworbene Pflanzen</strong></li>
                    <li><strong>Kranke oder befallene Pflanzen</strong> ohne Hinweis</li>
                    <li><strong>Spam oder Werbung</strong> in Produktbeschreibungen</li>
                  </ul>
                </div>
              </div>
            </section>

            {/* Listing-Qualität */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">📸 Listing-Qualität</h2>
              
              <div className="space-y-4">
                <h3 className="text-xl font-semibold">Produktbilder</h3>
                <ul className="list-disc pl-6 space-y-2 text-gray-700">
                  <li><strong>Mindestens 1 Bild</strong> ist Pflicht</li>
                  <li>Bilder sollten <strong>klar und gut beleuchtet</strong> sein</li>
                  <li>Zeige die <strong>tatsächliche Pflanze</strong>, die verkauft wird</li>
                  <li>Keine <strong>Stock-Fotos</strong> oder fremde Bilder verwenden</li>
                  <li>Mehrere Bilder aus verschiedenen Winkeln sind empfohlen</li>
                </ul>

                <h3 className="text-xl font-semibold mt-4">Produktbeschreibung</h3>
                <ul className="list-disc pl-6 space-y-2 text-gray-700">
                  <li><strong>Strain-Name</strong> (Sorte) korrekt angeben</li>
                  <li><strong>Produkttyp</strong>: Steckling oder Samen</li>
                  <li><strong>Größe/Alter</strong> der Pflanze (bei Stecklingen)</li>
                  <li><strong>Gesundheitszustand</strong>: Sind die Pflanzen gesund?</li>
                  <li><strong>Besonderheiten</strong>: z.B. Terpenen-Profil, Wuchsform, etc.</li>
                  <li><strong>Versandbedingungen</strong>: Wie werden die Pflanzen verpackt?</li>
                </ul>

                <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                  <p className="text-blue-800 text-sm">
                    <Info className="inline h-4 w-4 mr-1" />
                    <strong>Tipp:</strong> Je detaillierter deine Beschreibung, desto weniger Rückfragen und desto zufriedener die Käufer!
                  </p>
                </div>
              </div>
            </section>

            {/* Preisgestaltung */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">💰 Preisgestaltung</h2>
              
              <div className="space-y-4">
                <h3 className="text-xl font-semibold">Faire Preise</h3>
                <p className="text-gray-700">
                  Setze <strong>realistische Preise</strong>, die den Wert deiner Pflanzen widerspiegeln. 
                  Berücksichtige dabei:
                </p>
                <ul className="list-disc pl-6 space-y-1 text-gray-700">
                  <li>Qualität und Gesundheit der Pflanzen</li>
                  <li>Seltenheit der Sorte</li>
                  <li>Größe/Alter der Stecklinge</li>
                  <li>Marktpreise für vergleichbare Angebote</li>
                </ul>

                <h3 className="text-xl font-semibold mt-4">Gebühren einkalkulieren</h3>
                <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                  <p className="text-yellow-800 mb-2">
                    <strong>Wichtig:</strong> Kalkuliere die Gebühren in deinen Preis ein!
                  </p>
                  <ul className="list-disc pl-6 space-y-1 text-yellow-800 text-sm">
                    <li><strong>Plattformgebühr:</strong> €{PLATFORM_FEE.toFixed(2).replace('.', ',')} pro Artikel</li>
                    <li><strong>PayPal-Gebühr (bei Online-Zahlung):</strong> ca. {(PAYPAL_FEE_PERCENTAGE * 100).toFixed(2)}% + €{PAYPAL_FEE_FIXED.toFixed(2).replace('.', ',')}</li>
                    <li><strong>Beispiel:</strong> Bei €20 Verkaufspreis → €{EXAMPLE_TOTAL_FEES_20.replace('.', ',')} Gebühren gesamt</li>
                  </ul>
                </div>

                <h3 className="text-xl font-semibold mt-4">Preisvorschläge</h3>
                <p className="text-gray-700">
                  Du kannst die <strong>Preisvorschlag-Funktion</strong> aktivieren, um Verhandlungen zu ermöglichen. 
                  Das kann die Verkaufschancen erhöhen, besonders bei höherpreisigen Artikeln.
                </p>
              </div>
            </section>

            {/* Versand & Abholung */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">📦 Versand & Abholung</h2>
              
              <div className="space-y-4">
                <h3 className="text-xl font-semibold">Versand</h3>
                <ul className="list-disc pl-6 space-y-2 text-gray-700">
                  <li><strong>Sichere Verpackung:</strong> Pflanzen müssen sicher verpackt sein (Schutz vor Kälte, Hitze, Beschädigung)</li>
                  <li><strong>Schneller Versand:</strong> Stecklinge sollten innerhalb von 1-2 Tagen versandt werden</li>
                  <li><strong>Tracking:</strong> Nutze Versandmethoden mit Sendungsverfolgung (empfohlen)</li>
                  <li><strong>Versandkosten:</strong> Gib die Versandkosten klar an (oder biete kostenlosen Versand an)</li>
                </ul>

                <h3 className="text-xl font-semibold mt-4">Abholung</h3>
                <ul className="list-disc pl-6 space-y-2 text-gray-700">
                  <li><strong>Standort angeben:</strong> Gib deinen Standort im Verkäufer-Profil an</li>
                  <li><strong>Terminvereinbarung:</strong> Vereinbare einen konkreten Termin mit dem Käufer</li>
                  <li><strong>Barzahlung:</strong> Bei Abholung ist Barzahlung üblich</li>
                  <li><strong>Sicherheit:</strong> Treffe dich an einem öffentlichen Ort (z.B. Parkplatz)</li>
                </ul>

                <div className="bg-amber-50 p-4 rounded-lg border border-amber-200">
                  <p className="text-amber-800 text-sm">
                    <AlertTriangle className="inline h-4 w-4 mr-1" />
                    <strong>Wichtig:</strong> Lebende Pflanzen sind empfindlich! Achte auf sorgfältige Verpackung und schnellen Versand.
                  </p>
                </div>
              </div>
            </section>

            {/* Kommunikation */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">💬 Kommunikation mit Käufern</h2>
              
              <ul className="list-disc pl-6 space-y-2 text-gray-700">
                <li><strong>Schnelle Antworten:</strong> Antworte auf Anfragen innerhalb von 24 Stunden</li>
                <li><strong>Höflich und professionell:</strong> Auch bei schwierigen Käufern</li>
                <li><strong>Transparenz:</strong> Informiere über Versandstatus und Lieferzeiten</li>
                <li><strong>Probleme lösen:</strong> Bei Problemen (z.B. beschädigte Pflanzen) biete Lösungen an</li>
                <li><strong>Kontaktdaten bereitstellen:</strong> Stelle sicher, dass Käufer dich erreichen können</li>
              </ul>
            </section>

            {/* Rechtliche Pflichten */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">⚖️ Rechtliche Pflichten</h2>
              
              <div className="space-y-4">
                <h3 className="text-xl font-semibold">Für alle Verkäufer</h3>
                <ul className="list-disc pl-6 space-y-2 text-gray-700">
                  <li><strong>Widerrufsrecht:</strong> Du bist verantwortlich für die Abwicklung von Widerrufen (nicht deimudda)</li>
                  <li><strong>Gewährleistung:</strong> Du haftest für Mängel an deinen Produkten (§ 437 BGB)</li>
                  <li><strong>Keine Blüten verkaufen:</strong> Nur Stecklinge und Samen sind erlaubt</li>
                  <li><strong>Keine Verkäufe an Minderjährige:</strong> Nur an Personen ab 18 Jahren</li>
                </ul>

                <h3 className="text-xl font-semibold mt-4">Für gewerbliche Verkäufer</h3>
                <div className="bg-red-50 p-4 rounded-lg border border-red-200">
                  <p className="text-red-800 mb-2">
                    <strong>Zusätzliche Pflichten:</strong>
                  </p>
                  <ul className="list-disc pl-6 space-y-1 text-red-800 text-sm">
                    <li><strong>Impressumspflicht:</strong> Du musst ein eigenes Impressum bereitstellen (§ 5 TMG)</li>
                    <li><strong>Datenschutzerklärung:</strong> Du musst eine eigene Datenschutzerklärung bereitstellen (DSGVO)</li>
                    <li><strong>Widerrufsbelehrung:</strong> Du musst eine Widerrufsbelehrung bereitstellen</li>
                    <li><strong>Gewerbeanmeldung:</strong> Du musst ein Gewerbe angemeldet haben</li>
                    <li><strong>Steuerpflicht:</strong> Du musst Einnahmen versteuern</li>
                  </ul>
                </div>

                <p className="text-sm text-gray-600 mt-3">
                  <strong>Wann bin ich gewerblich?</strong> Wenn du regelmäßig und mit Gewinnabsicht verkaufst. 
                  Bei Unsicherheit konsultiere einen Steuerberater oder Rechtsanwalt.
                </p>
              </div>
            </section>

            {/* Bewertungen */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">⭐ Bewertungen</h2>
              
              <p className="text-gray-700 mb-4">
                Bewertungen sind das Herzstück deines Erfolgs auf deimudda. Gute Bewertungen führen zu mehr Verkäufen!
              </p>

              <h3 className="text-xl font-semibold mb-2">Wie bekomme ich gute Bewertungen?</h3>
              <ul className="list-disc pl-6 space-y-2 text-gray-700">
                <li><strong>Qualität:</strong> Verkaufe nur gesunde, hochwertige Pflanzen</li>
                <li><strong>Ehrlichkeit:</strong> Beschreibe deine Produkte wahrheitsgemäß</li>
                <li><strong>Schnelligkeit:</strong> Versende schnell und kommuniziere proaktiv</li>
                <li><strong>Service:</strong> Sei hilfsbereit und lösungsorientiert bei Problemen</li>
                <li><strong>Verpackung:</strong> Verpacke sorgfältig, damit die Pflanzen heil ankommen</li>
              </ul>

              <div className="bg-green-50 p-4 rounded-lg border border-green-200 mt-4">
                <p className="text-green-800 text-sm">
                  <CheckCircle className="inline h-4 w-4 mr-1" />
                  <strong>Tipp:</strong> Bitte zufriedene Käufer um eine Bewertung! Das erhöht deine Sichtbarkeit.
                </p>
              </div>
            </section>

            {/* Verstöße */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                <XCircle className="h-6 w-6 text-red-600" />
                Verstöße und Konsequenzen
              </h2>
              
              <p className="text-gray-700 mb-4">
                Verstöße gegen diese Richtlinien oder unsere Nutzungsbedingungen können zu folgenden Maßnahmen führen:
              </p>

              <div className="space-y-3">
                <div className="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                  <p className="font-semibold text-yellow-900">⚠️ Verwarnung</p>
                  <p className="text-sm text-yellow-800">Bei leichten Verstößen (z.B. unvollständige Produktbeschreibung)</p>
                </div>

                <div className="bg-orange-50 p-3 rounded-lg border border-orange-200">
                  <p className="font-semibold text-orange-900">🚫 Listing-Löschung</p>
                  <p className="text-sm text-orange-800">Bei Verstößen gegen Listing-Richtlinien (z.B. falsche Bilder)</p>
                </div>

                <div className="bg-red-50 p-3 rounded-lg border border-red-200">
                  <p className="font-semibold text-red-900">❌ Account-Sperrung</p>
                  <p className="text-sm text-red-800">Bei schwerwiegenden Verstößen (z.B. Verkauf von Blüten, Betrug)</p>
                </div>

                <div className="bg-gray-900 text-white p-3 rounded-lg">
                  <p className="font-semibold">🚨 Strafanzeige</p>
                  <p className="text-sm">Bei illegalen Aktivitäten (z.B. Verkauf an Minderjährige, illegale Produkte)</p>
                </div>
              </div>
            </section>

            {/* Best Practices */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">✨ Best Practices</h2>
              
              <div className="grid md:grid-cols-2 gap-4">
                <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                  <h3 className="font-bold text-blue-900 mb-2">📸 Professionelle Fotos</h3>
                  <p className="text-sm text-blue-800">
                    Nutze natürliches Licht und einen neutralen Hintergrund. Zeige die Pflanze aus mehreren Winkeln.
                  </p>
                </div>

                <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                  <h3 className="font-bold text-green-900 mb-2">💬 Schnelle Kommunikation</h3>
                  <p className="text-sm text-green-800">
                    Antworte innerhalb von 24 Stunden auf Anfragen. Das zeigt Professionalität und erhöht das Vertrauen.
                  </p>
                </div>

                <div className="bg-purple-50 p-4 rounded-lg border border-purple-200">
                  <h3 className="font-bold text-purple-900 mb-2">📦 Sichere Verpackung</h3>
                  <p className="text-sm text-purple-800">
                    Investiere in gute Verpackungsmaterialien. Beschädigte Pflanzen führen zu schlechten Bewertungen.
                  </p>
                </div>

                <div className="bg-orange-50 p-4 rounded-lg border border-orange-200">
                  <h3 className="font-bold text-orange-900 mb-2">⭐ Exzellenter Service</h3>
                  <p className="text-sm text-orange-800">
                    Gehe die Extra-Meile: Lege Pflegehinweise bei, biete Hilfe an, sei freundlich. Das zahlt sich aus!
                  </p>
                </div>
              </div>
            </section>

            {/* Support */}
            <section>
              <h2 className="text-2xl font-bold mb-4">❓ Fragen?</h2>
              
              <p className="text-gray-700 mb-4">
                Bei Fragen zu den Verkäufer-Richtlinien oder Problemen beim Verkaufen kontaktiere uns:
              </p>

              <div className="flex gap-4">
                <a
                  href="/contact"
                  className="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition"
                >
                  Kontakt aufnehmen
                </a>
                <a
                  href="/faq"
                  className="bg-gray-200 text-gray-800 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300 transition"
                >
                  FAQ lesen
                </a>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: SellerShop.tsx

**`client/src/components/SellerShop.tsx`**

```typescript
import { trpc } from "../lib/trpc";
import { Card, CardContent, CardHeader, CardTitle } from "../components/ui/card";
import { Button } from "../components/ui/button";
import { MapPin, Star, User, ArrowLeft } from "lucide-react";

export default function SellerShop() {
  const { sellerId } = useParams<{ sellerId: string }>();
  const sellerIdNum = parseInt(sellerId || "0", 10);

  const sellerProfile = trpc.seller.getProfileById.useQuery(sellerIdNum);
  const listings = trpc.listing.getBySellerID.useQuery(sellerIdNum);

  if (sellerProfile.isLoading || listings.isLoading) {
    return (
      <div className="container mx-auto px-4 py-8">
        <p className="text-center text-gray-600">Laden...</p>
      </div>
    );
  }

  if (sellerProfile.isError || !sellerProfile.data) {
    return (
      <div className="container mx-auto px-4 py-8">
        <p className="text-center text-red-600">Verkäufer nicht gefunden</p>
      </div>
    );
  }

  const seller = sellerProfile.data;
  const activeListings = listings.data?.filter((l) => l.status === "active") || [];

  return (
    <div className="container mx-auto px-4 py-8">
      {/* Back Button */}
      <Link to="/" className="inline-flex items-center gap-2 text-green-600 hover:text-green-700 mb-6">
        <ArrowLeft className="w-4 h-4" />
        Zurück zur Startseite
      </Link>

      {/* Seller Profile Header */}
      <Card className="mb-8">
        <CardContent className="p-6">
          <div className="flex items-start gap-6">
            {/* Profile Image */}
            <div className="flex-shrink-0">
              {seller.profileImageUrl ? (
                <img
                  src={seller.profileImageUrl}
                  alt={seller.shopName}
                  className="w-24 h-24 rounded-full object-cover border-4 border-green-100"
                />
              ) : (
                <div className="w-24 h-24 rounded-full bg-gray-300 flex items-center justify-center border-4 border-green-100">
                  <User className="w-12 h-12 text-gray-600" />
                </div>
              )}
            </div>

            {/* Profile Info */}
            <div className="flex-1">
              <h1 className="text-3xl font-bold mb-2">{seller.shopName}</h1>
              
              <div className="flex items-center gap-4 mb-4">
                <div className="flex items-center gap-1">
                  <Star className="w-5 h-5 text-yellow-500 fill-yellow-500" />
                  <span className="font-semibold">{parseFloat(seller.rating || "0").toFixed(1)}</span>
                  <span className="text-gray-600">({seller.totalReviews || 0} Bewertungen)</span>
                </div>
                
                {seller.location && (
                  <div className="flex items-center gap-1 text-gray-600">
                    <MapPin className="w-4 h-4" />
                    <span>{seller.location}</span>
                  </div>
                )}
              </div>

              {seller.description && (
                <p className="text-gray-700 whitespace-pre-wrap">{seller.description}</p>
              )}
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Listings Section */}
      <div className="mb-6">
        <h2 className="text-2xl font-bold mb-4">
          Angebote ({activeListings.length})
        </h2>
      </div>

      {activeListings.length === 0 ? (
        <Card>
          <CardContent className="p-8 text-center text-gray-600">
            <p>Dieser Verkäufer hat derzeit keine aktiven Angebote.</p>
          </CardContent>
        </Card>
      ) : (```

#### Schritt 5.x: SellerTransactions.tsx

**`client/src/components/SellerTransactions.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import type { Transaction } from "@/../../shared/types";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Header } from "@/components/Header";
import BackButton from "@/components/BackButton";
import { Euro, TrendingUp, ShoppingBag, AlertCircle } from "lucide-react";
import { Alert, AlertDescription } from "@/components/ui/alert";

export default function SellerTransactions() {
  const { user } = useAuth();
  const { data: transactions, isLoading, error } = trpc.transaction.getSellerTransactions.useQuery(undefined, { staleTime: 60000 });
  const { data: platformFeeStr } = trpc.admin.getSystemSetting.useQuery('platform_fee_fixed', { staleTime: 300000 }); // 5min cache
  const PLATFORM_FEE = parseFloat(platformFeeStr || "0.42");

  // Calculate statistics
  const totalSales = transactions?.length || 0;
  const totalRevenue = transactions?.reduce((sum, t) => sum + t.totalPrice, 0) || 0;
  const totalPlatformFees = totalSales * PLATFORM_FEE;
  const totalPaymentFees = transactions?.reduce((sum, t) => sum + (parseFloat(t.paymentFee || "0")), 0) || 0;
  const totalFees = totalPlatformFees + totalPaymentFees;
  const netRevenue = totalRevenue - totalFees;

  const getStatusBadge = (status: string) => {
    switch (status) {
      case "completed":
        return <Badge className="bg-green-500">Abgeschlossen</Badge>;
      case "pending":
        return <Badge className="bg-yellow-500">Ausstehend</Badge>;
      case "cancelled":
        return <Badge className="bg-red-500">Storniert</Badge>;
      default:
        return <Badge>{status}</Badge>;
    }
  };

  return (
    <>
      <Header />
      <div className="container mx-auto px-4 py-8">
        <BackButton href="/seller/dashboard" label="Zurück zum Verkäufer-Dashboard" />
        
        <h1 className="text-3xl font-bold mb-6">Meine Verkäufe & Gebühren</h1>

        {/* Statistics Cards */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Gesamt-Verkäufe</CardTitle>
              <ShoppingBag className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">{totalSales}</div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Gesamt-Umsatz</CardTitle>
              <TrendingUp className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">€{totalRevenue.toFixed(2)}</div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Gesamt-Gebühren</CardTitle>
              <Euro className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold text-red-600">-€{totalFees.toFixed(2)}</div>
              <p className="text-xs text-muted-foreground mt-1">
                PayPal: -€{totalPaymentFees.toFixed(2)} | Plattform: -€{totalPlatformFees.toFixed(2)}
              </p>
            </CardContent>
          </Card>

          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Netto-Einnahmen</CardTitle>
              <TrendingUp className="h-4 w-4 text-green-600" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold text-green-600">€{netRevenue.toFixed(2)}</div>
            </CardContent>
          </Card>
        </div>

        {/* Info Alert */}
        <Alert className="mb-6">
          <AlertCircle className="h-4 w-4" />
          <AlertDescription>
            <strong>Gebühren-Struktur:</strong> PayPal-Gebühren (2,49% + €0.49) + Plattform-Gebühr (€{PLATFORM_FEE.toFixed(2)}) werden automatisch bei Online-Zahlungen abgezogen. 
            Bei Offline-Zahlungen wird die Plattform-Gebühr monatlich abgerechnet.
          </AlertDescription>
        </Alert>

        {/* Transactions Table */}
        <Card>
          <CardHeader>
            <CardTitle>Alle Verkäufe</CardTitle>
            <CardDescription>
              Übersicht über alle Ihre abgeschlossenen und ausstehenden Verkäufe
            </CardDescription>
          </CardHeader>
          <CardContent>
            {isLoading && (
              <div className="text-center py-8">
                <p className="text-muted-foreground">Lade Transaktionen...</p>
              </div>
            )}

            {error && (
              <Alert variant="destructive">
                <AlertCircle className="h-4 w-4" />
                <AlertDescription>
                  Fehler beim Laden der Transaktionen: {error.message}
                </AlertDescription>
              </Alert>
            )}

            {!isLoading && !error && transactions && transactions.length === 0 && (
              <div className="text-center py-8">
                <p className="text-muted-foreground">Sie haben noch keine Verkäufe getätigt.</p>
              </div>
            )}

            {!isLoading && !error && transactions && transactions.length > 0 && (
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead>
                    <tr className="border-b">
                      <th className="text-left py-3 px-4">Datum</th>
                      <th className="text-left py-3 px-4">Käufer</th>
                      <th className="text-left py-3 px-4">Artikel</th>
                      <th className="text-right py-3 px-4">Brutto</th>
                      <th className="text-right py-3 px-4">PayPal</th>
                      <th className="text-right py-3 px-4">Plattform</th>
                      <th className="text-right py-3 px-4">Netto</th>
                      <th className="text-center py-3 px-4">Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    {transactions.map((transaction: Transaction) => {
                      const paymentFee = parseFloat(transaction.paymentFee || "0");
                      const netAmount = transaction.totalPrice - paymentFee - PLATFORM_FEE;
                      
                      return (
                        <tr key={transaction.id} className="border-b hover:bg-muted/50">
                          <td className="py-3 px-4">
                            {new Date(transaction.createdAt).toLocaleDateString('de-DE')}
                          </td>
                          <td className="py-3 px-4">
                            {transaction.buyer?.name || 'Unbekannt'}
                          </td>
                          <td className="py-3 px-4">
                            {transaction.listing?.strain || 'Gelöscht'}
                          </td>
                          <td className="text-right py-3 px-4">
                            €{transaction.totalPrice.toFixed(2)}
                          </td>
                          <td className="text-right py-3 px-4 text-red-600">
                            -€{paymentFee.toFixed(2)}
                          </td>
                          <td className="text-right py-3 px-4 text-red-600">
                            -€{PLATFORM_FEE.toFixed(2)}
                          </td>
                          <td className="text-right py-3 px-4 font-semibold text-green-600">
                            €{netAmount.toFixed(2)}
                          </td>
                          <td className="text-center py-3 px-4">
                            {getStatusBadge(transaction.status)}
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </>
  );
}

```

#### Schritt 5.x: Support.tsx

**`client/src/components/Support.tsx`**

```typescript
import { Mail, MessageCircle, Book, HelpCircle, AlertCircle } from "lucide-react";

export default function Support() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50 py-12">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-8 text-gray-900">Support & Hilfe</h1>
          
          <div className="prose prose-lg max-w-none">
            <p className="text-lg text-gray-700 mb-8">
              Brauchst du Hilfe? Wir sind für dich da! Hier findest du verschiedene Wege, um Unterstützung zu erhalten.
            </p>

            {/* Schnellhilfe */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">🚀 Schnellhilfe</h2>
              
              <div className="grid md:grid-cols-2 gap-4 not-prose">
                <a
                  href="/faq"
                  className="bg-blue-50 p-6 rounded-lg border border-blue-200 hover:bg-blue-100 transition group"
                >
                  <div className="flex items-center gap-3 mb-3">
                    <Book className="h-6 w-6 text-blue-600" />
                    <h3 className="text-xl font-bold text-blue-900">FAQ</h3>
                  </div>
                  <p className="text-sm text-blue-800">
                    Die meisten Fragen werden bereits in unseren FAQ beantwortet. Schau dort zuerst nach!
                  </p>
                  <p className="text-sm text-blue-600 mt-2 group-hover:underline">
                    → Zu den FAQ
                  </p>
                </a>

                <a
                  href="/contact"
                  className="bg-green-50 p-6 rounded-lg border border-green-200 hover:bg-green-100 transition group"
                >
                  <div className="flex items-center gap-3 mb-3">
                    <Mail className="h-6 w-6 text-green-600" />
                    <h3 className="text-xl font-bold text-green-900">Kontakt</h3>
                  </div>
                  <p className="text-sm text-green-800">
                    Kontaktiere uns direkt per E-Mail. Wir antworten innerhalb von 24-48 Stunden.
                  </p>
                  <p className="text-sm text-green-600 mt-2 group-hover:underline">
                    → Kontakt aufnehmen
                  </p>
                </a>
              </div>
            </section>

            {/* Support-Bereiche */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">📋 Support-Bereiche</h2>
              
              <div className="space-y-4 not-prose">
                {/* Technischer Support */}
                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                  <div className="flex items-start gap-4">
                    <div className="flex-shrink-0">
                      <div className="bg-red-100 p-3 rounded-lg">
                        <AlertCircle className="h-6 w-6 text-red-600" />
                      </div>
                    </div>
                    <div className="flex-1">
                      <h3 className="text-xl font-bold text-gray-900 mb-2">Technischer Support</h3>
                      <p className="text-gray-700 mb-3">
                        Probleme mit der Website, Bugs, Fehler beim Login oder Zahlungsprobleme?
                      </p>
                      <div className="space-y-2 text-sm">
                        <p className="text-gray-600">
                          <strong>E-Mail:</strong> <a href="mailto:support@deimudda.de" className="text-blue-600 hover:underline">support@deimudda.de</a>
                        </p>
                        <p className="text-gray-600">
                          <strong>Antwortzeit:</strong> Innerhalb von 48 Stunden
                        </p>
                      </div>
                      <div className="bg-yellow-50 p-3 rounded mt-3 border border-yellow-200">
                        <p className="text-sm text-yellow-800">
                          <strong>Bitte gib an:</strong> Was ist passiert? Welcher Browser? Screenshots (falls möglich)
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Verkäufer-Support */}
                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                  <div className="flex items-start gap-4">
                    <div className="flex-shrink-0">
                      <div className="bg-purple-100 p-3 rounded-lg">
                        <MessageCircle className="h-6 w-6 text-purple-600" />
                      </div>
                    </div>
                    <div className="flex-1">
                      <h3 className="text-xl font-bold text-gray-900 mb-2">Verkäufer-Support</h3>
                      <p className="text-gray-700 mb-3">
                        Fragen zum Verkaufen, Listings, Gebühren, Auszahlungen oder Verkäufer-Richtlinien?
                      </p>
                      <div className="space-y-2 text-sm">
                        <p className="text-gray-600">
                          <strong>E-Mail:</strong> <a href="mailto:seller@deimudda.de" className="text-blue-600 hover:underline">seller@deimudda.de</a>
                        </p>
                        <p className="text-gray-600">
                          <strong>Antwortzeit:</strong> Innerhalb von 24-48 Stunden
                        </p>
                      </div>
                      <div className="bg-blue-50 p-3 rounded mt-3 border border-blue-200">
                        <p className="text-sm text-blue-800">
                          <strong>Tipp:</strong> Schau auch in die <a href="/seller-guidelines" className="underline">Verkäufer-Richtlinien</a> 
                          und <a href="/fee-structure" className="underline">Gebührenstruktur</a>!
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Käufer-Support */}
                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                  <div className="flex items-start gap-4">
                    <div className="flex-shrink-0">
                      <div className="bg-green-100 p-3 rounded-lg">
                        <HelpCircle className="h-6 w-6 text-green-600" />
                      </div>
                    </div>
                    <div className="flex-1">
                      <h3 className="text-xl font-bold text-gray-900 mb-2">Käufer-Support</h3>
                      <p className="text-gray-700 mb-3">
                        Fragen zum Kaufen, Zahlungen, Versand oder Problemen mit einem Verkäufer?
                      </p>
                      <div className="space-y-2 text-sm">
                        <p className="text-gray-600">
                          <strong>E-Mail:</strong> <a href="mailto:info@deimudda.de" className="text-blue-600 hover:underline">info@deimudda.de</a>
                        </p>
                        <p className="text-gray-600">
                          <strong>Antwortzeit:</strong> Innerhalb von 24-48 Stunden
                        </p>
                      </div>
                      <div className="bg-amber-50 p-3 rounded mt-3 border border-amber-200">
                        <p className="text-sm text-amber-800">
                          <strong>Wichtig:</strong> Bei Problemen mit einem Verkäufer kontaktiere bitte zuerst den Verkäufer direkt 
                          (Kontaktdaten auf der Produktseite). Wir helfen gerne bei der Vermittlung, wenn keine Lösung gefunden wird.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Datenschutz */}
                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                  <div className="flex items-start gap-4">
                    <div className="flex-shrink-0">
                      <div className="bg-blue-100 p-3 rounded-lg">
                        <Mail className="h-6 w-6 text-blue-600" />
                      </div>
                    </div>
                    <div className="flex-1">
                      <h3 className="text-xl font-bold text-gray-900 mb-2">Datenschutz-Anfragen</h3>
                      <p className="text-gray-700 mb-3">
                        Fragen zu deinen Daten, Account-Löschung, Daten-Export oder DSGVO-Anfragen?
                      </p>
                      <div className="space-y-2 text-sm">
                        <p className="text-gray-600">
                          <strong>E-Mail:</strong> <a href="mailto:datenschutz@deimudda.de" className="text-blue-600 hover:underline">datenschutz@deimudda.de</a>
                        </p>
                        <p className="text-gray-600">
                          <strong>Antwortzeit:</strong> Innerhalb von 30 Tagen (gesetzliche Frist)
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Meldungen */}
                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                  <div className="flex items-start gap-4">
                    <div className="flex-shrink-0">
                      <div className="bg-red-100 p-3 rounded-lg">
                        <AlertCircle className="h-6 w-6 text-red-600" />
                      </div>
                    </div>
                    <div className="flex-1">
                      <h3 className="text-xl font-bold text-gray-900 mb-2">Meldungen</h3>
                      <p className="text-gray-700 mb-3">
                        Rechtswidrige Inhalte, Verstöße gegen Nutzungsbedingungen oder verdächtige Aktivitäten melden?
                      </p>
                      <div className="space-y-2 text-sm">
                        <p className="text-gray-600">
                          <strong>E-Mail:</strong> <a href="mailto:report@deimudda.de" className="text-blue-600 hover:underline">report@deimudda.de</a>
                        </p>
                        <p className="text-gray-600">
                          <strong>Antwortzeit:</strong> Innerhalb von 24 Stunden
                        </p>
                      </div>
                      <div className="bg-red-50 p-3 rounded mt-3 border border-red-200">
                        <p className="text-sm text-red-800">
                          <strong>Wichtig:</strong> Bitte gib so viele Details wie möglich an (Link zum Listing, Username, 
                          Beschreibung des Verstoßes). Wir nehmen alle Meldungen ernst!
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            {/* Häufige Support-Anfragen */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">🔍 Häufige Support-Anfragen</h2>
              
              <div className="space-y-3 not-prose">
                <details className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                  <summary className="font-semibold text-gray-900 cursor-pointer">
                    Ich kann mich nicht einloggen
                  </summary>
                  <div className="mt-3 text-sm text-gray-700 space-y-2">
                    <p><strong>Lösung:</strong></p>
                    <ol className="list-decimal pl-6 space-y-1">
                      <li>Stelle sicher, dass du den richtigen OAuth-Provider verwendest (z.B. Google, GitHub)</li>
                      <li>Lösche Cookies und Cache in deinem Browser</li>
                      <li>Versuche es mit einem anderen Browser</li>
                      <li>Wenn das Problem weiterhin besteht: <a href="mailto:support@deimudda.de" className="text-blue-600 hover:underline">support@deimudda.de</a></li>
                    </ol>
                  </div>
                </details>

                <details className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                  <summary className="font-semibold text-gray-900 cursor-pointer">
                    Die Zahlung funktioniert nicht
                  </summary>
                  <div className="mt-3 text-sm text-gray-700 space-y-2">
                    <p><strong>Lösung:</strong></p>
                    <ol className="list-decimal pl-6 space-y-1">
                      <li>Stelle sicher, dass dein PayPal-Konto ausreichend Guthaben hat</li>
                      <li>Prüfe, ob deine Zahlungsmethode bei PayPal verifiziert ist</li>
                      <li>Versuche es mit einem anderen Browser oder Gerät</li>
                      <li>Kontaktiere PayPal-Support bei PayPal-spezifischen Problemen</li>
                      <li>Wenn das Problem weiterhin besteht: <a href="mailto:support@deimudda.de" className="text-blue-600 hover:underline">support@deimudda.de</a></li>
                    </ol>
                  </div>
                </details>

                <details className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                  <summary className="font-semibold text-gray-900 cursor-pointer">
                    Ich habe ein Problem mit einem Verkäufer
                  </summary>
                  <div className="mt-3 text-sm text-gray-700 space-y-2">
                    <p><strong>Lösung:</strong></p>
                    <ol className="list-decimal pl-6 space-y-1">
                      <li><strong>Erst:</strong> Kontaktiere den Verkäufer direkt (Kontaktdaten auf Produktseite)</li>
                      <li><strong>Dann:</strong> Versuche eine einvernehmliche Lösung zu finden</li>
                      <li><strong>Falls keine Lösung:</strong> Kontaktiere uns unter <a href="mailto:info@deimudda.de" className="text-blue-600 hover:underline">info@deimudda.de</a></li>
                      <li>Wir helfen bei der Vermittlung und können bei schwerwiegenden Verstößen Maßnahmen ergreifen</li>
                    </ol>
                  </div>
                </details>

                <details className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                  <summary className="font-semibold text-gray-900 cursor-pointer">
                    Mein Listing wird nicht angezeigt
                  </summary>
                  <div className="mt-3 text-sm text-gray-700 space-y-2">
                    <p><strong>Lösung:</strong></p>
                    <ol className="list-decimal pl-6 space-y-1">
                      <li>Prüfe, ob du alle Pflichtfelder ausgefüllt hast</li>
                      <li>Stelle sicher, dass dein Listing nicht gegen unsere Richtlinien verstößt</li>
                      <li>Warte 5-10 Minuten, manchmal dauert die Veröffentlichung etwas</li>
                      <li>Wenn das Problem weiterhin besteht: <a href="mailto:seller@deimudda.de" className="text-blue-600 hover:underline">seller@deimudda.de</a></li>
                    </ol>
                  </div>
                </details>

                <details className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                  <summary className="font-semibold text-gray-900 cursor-pointer">
                    Wie lösche ich meinen Account?
                  </summary>
                  <div className="mt-3 text-sm text-gray-700 space-y-2">
                    <p><strong>Lösung:</strong></p>
                    <ol className="list-decimal pl-6 space-y-1">
                      <li>Gehe zu <strong>Dashboard → Profil-Einstellungen</strong></li>
                      <li>Scrolle nach unten zu "Account löschen"</li>
                      <li>Bestätige die Löschung</li>
                      <li>Deine Daten werden gelöscht (Transaktionsdaten werden anonymisiert und 10 Jahre aufbewahrt)</li>
                    </ol>
                    <p className="mt-2">
                      <strong>Hinweis:</strong> Die Account-Löschung ist endgültig und kann nicht rückgängig gemacht werden!
                    </p>
                  </div>
                </details>
              </div>
            </section>

            {/* Hilfreiche Ressourcen */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">📚 Hilfreiche Ressourcen</h2>
              
              <div className="grid md:grid-cols-2 gap-4 not-prose">
                <a
                  href="/seller-guidelines"
                  className="bg-purple-50 p-4 rounded-lg border border-purple-200 hover:bg-purple-100 transition"
                >
                  <h3 className="font-bold text-purple-900 mb-2">Verkäufer-Richtlinien</h3>
                  <p className="text-sm text-purple-800">
                    Alles, was du als Verkäufer wissen musst: Regeln, Best Practices und Tipps.
                  </p>
                </a>

                <a
                  href="/fee-structure"
                  className="bg-green-50 p-4 rounded-lg border border-green-200 hover:bg-green-100 transition"
                >
                  <h3 className="font-bold text-green-900 mb-2">Gebührenstruktur</h3>
                  <p className="text-sm text-green-800">
                    Transparente Übersicht über alle Gebühren mit Gebühren-Rechner.
                  </p>
                </a>

                <a
                  href="/datenschutz"
                  className="bg-blue-50 p-4 rounded-lg border border-blue-200 hover:bg-blue-100 transition"
                >
                  <h3 className="font-bold text-blue-900 mb-2">Datenschutzerklärung</h3>
                  <p className="text-sm text-blue-800">
                    Wie wir mit deinen Daten umgehen und welche Rechte du hast.
                  </p>
                </a>

                <a
                  href="/widerruf"
                  className="bg-orange-50 p-4 rounded-lg border border-orange-200 hover:bg-orange-100 transition"
                >
                  <h3 className="font-bold text-orange-900 mb-2">Widerrufsbelehrung</h3>
                  <p className="text-sm text-orange-800">
                    Informationen zu deinem Widerrufsrecht und wie du es ausübst.
                  </p>
                </a>
              </div>
            </section>

            {/* Feedback */}
            <section>
              <h2 className="text-2xl font-bold mb-4">💬 Feedback & Verbesserungsvorschläge</h2>
              
              <p className="text-gray-700 mb-4">
                Wir sind ständig dabei, deimudda zu verbessern. Dein Feedback ist uns wichtig!
              </p>

              <div className="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-lg border border-green-200 not-prose">
                <p className="text-gray-700 mb-4">
                  Hast du Ideen, wie wir deimudda besser machen können? Fehlt dir ein Feature? 
                  Hast du Verbesserungsvorschläge?
                </p>
                <a
                  href="mailto:feedback@deimudda.de"
                  className="inline-block bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition"
                >
                  Feedback senden
                </a>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: Terms.tsx

**`client/src/components/Terms.tsx`**

```typescript
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";

export default function Terms() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 py-8">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <a href="/" className="text-blue-600 hover:text-blue-800 mb-6 inline-block">
          ← Zurück
        </a>

        <h1 className="text-4xl font-bold mb-8">Nutzungsbedingungen & Rechtliche Hinweise</h1>

        <div className="space-y-6">
          {/* Disclaimer */}
          <Card className="border-l-4 border-red-500">
            <CardHeader>
              <CardTitle className="text-red-700">⚠️ Wichtiger Disclaimer</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <p>
                Diese Plattform ist <strong>ausschließlich</strong> für den Handel mit Cannabis-Stecklingen und Samen gemäß des Konsumcannabisgesetzes (KCanG) bestimmt.
              </p>
              <p>
                Alle Nutzer verpflichten sich, die geltenden deutschen Gesetze einzuhalten. deimudda übernimmt <strong>keine Haftung</strong> für illegale Nutzung oder Verstöße gegen das KCanG durch Nutzer.
              </p>
            </CardContent>
          </Card>

          {/* Zulässige Produkte */}
          <Card>
            <CardHeader>
              <CardTitle>1. Zulässige Produkte</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <p className="font-semibold">Erlaubt:</p>
              <ul className="list-disc pl-6 space-y-2">
                <li>Cannabis-Stecklinge <strong>ohne Blütenstände</strong></li>
                <li>Cannabis-Samen</li>
                <li>Junge Pflanzen (Setzlinge) <strong>ohne Blütenentwicklung</strong></li>
              </ul>

              <p className="font-semibold mt-4">Nicht erlaubt:</p>
              <ul className="list-disc pl-6 space-y-2">
                <li>Blüten oder Blütenstände</li>
                <li>Fruchtstände</li>
                <li>Verarbeitete Produkte (Öle, Extrakte, etc.)</li>
                <li>Getrocknete oder verarbeitete Pflanzenteile</li>
                <li>Alle anderen illegalen Waren</li>
              </ul>
            </CardContent>
          </Card>

          {/* Rechtliche Rahmenbedingungen */}
          <Card>
            <CardHeader>
              <CardTitle>2. Rechtliche Rahmenbedingungen (KCanG)</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <p>
                Das Konsumcannabisgesetz (KCanG) regelt den Anbau und Konsum von Cannabis in Deutschland. Diese Plattform operiert im Rahmen dieser Gesetze.
              </p>
              <p>
                <strong>Wichtig:</strong> Stecklinge und Samen sind gemäß aktueller Rechtsprechung <strong>nicht als Cannabis definiert</strong> und sind daher freiverkäuflich, solange sie keine Blütenstände aufweisen.
              </p>
              <p>
                Alle Nutzer sind selbst verantwortlich für die Einhaltung lokaler und regionaler Gesetze.
              </p>
            </CardContent>
          </Card>

          {/* Eigenverantwortung */}
          <Card>
            <CardHeader>
              <CardTitle>3. Eigenverantwortung der Nutzer</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <p>
                <strong>Käufer und Verkäufer handeln in vollständiger Eigenverantwortung.</strong>
              </p>
              <p>
                Jeder Nutzer erklärt sich damit einverstanden, dass:
              </p>
              <ul className="list-disc pl-6 space-y-2">
                <li>Er/Sie die Gesetze einhält und nur legale Produkte kauft/verkauft</li>
                <li>Er/Sie die Produkte nur für legale Zwecke nutzt</li>
                <li>Er/Sie mindestens 18 Jahre alt ist</li>
                <li>deimudda nicht verantwortlich für illegale Nutzung ist</li>
              </ul>
            </CardContent>
          </Card>

          {/* Altersbestätigung */}
          <Card>
            <CardHeader>
              <CardTitle>4. Altersbestätigung</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <p>
                Durch die Nutzung dieser Plattform bestätigen Sie, dass Sie <strong>mindestens 18 Jahre alt</strong> sind.
              </p>
              <p>
                deimudda behält sich das Recht vor, Nutzer zu sperren, die gegen diese Bedingung verstoßen.
              </p>
            </CardContent>
          </Card>

          {/* Haftungsausschluss */}
          <Card>
            <CardHeader>
              <CardTitle>5. Haftungsausschluss</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <p>
                <strong>deimudda übernimmt KEINE Haftung für:</strong>
              </p>
              <ul className="list-disc pl-6 space-y-2">
                <li>Illegale Nutzung von Produkten durch Käufer</li>
                <li>Verstöße gegen das KCanG oder andere Gesetze</li>
                <li>Qualität oder Authentizität der angebotenen Produkte</li>
                <li>Lieferverzögerungen oder Versandprobleme</li>
                <li>Schäden durch unsachgemäße Lagerung oder Handhabung</li>
              </ul>
            </CardContent>
          </Card>

          {/* Kontakt */}
          <Card>
            <CardHeader>
              <CardTitle>6. Kontakt & Support</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <p>
                Bei Fragen zu den Nutzungsbedingungen oder rechtlichen Aspekten kontaktieren Sie uns über:
              </p>
              <p>
                <strong>E-Mail:</strong> support@deimudda.de
              </p>
              <p>
                <strong>Hinweis:</strong> Dies ist keine Rechtsberatung. Bei Fragen zu Ihrer spezifischen Situation konsultieren Sie bitte einen Rechtsanwalt.
              </p>
            </CardContent>
          </Card>

          {/* Last Updated */}
          <div className="text-xs text-gray-500 text-center py-4">
            <p>Zuletzt aktualisiert: Oktober 2025</p>
            <p>Diese Nutzungsbedingungen können jederzeit geändert werden.</p>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: Widerruf.tsx

**`client/src/components/Widerruf.tsx`**

```typescript
export default function Widerruf() {
  return (
    <div className="min-h-screen bg-gray-50 py-12">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-8 text-gray-900">Widerrufsbelehrung</h1>
          
          <div className="prose prose-lg max-w-none">
            <p className="text-sm text-gray-600 mb-8">Stand: 24. Oktober 2025</p>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-6 mb-8">
              <h3 className="text-lg font-bold text-blue-900 mb-2">Wichtiger Hinweis</h3>
              <p className="text-blue-800">
                <strong>deimudda ist ein Marktplatz.</strong> Wir vermitteln nur zwischen Käufern und Verkäufern. 
                Der Kaufvertrag kommt direkt zwischen Ihnen und dem jeweiligen Verkäufer zustande. 
                <strong> Der Verkäufer ist Ihr Vertragspartner</strong>, nicht deimudda.
              </p>
              <p className="text-blue-800 mt-2">
                Für Widerrufe, Rücksendungen und Reklamationen wenden Sie sich bitte direkt an den Verkäufer. 
                Die Kontaktdaten des Verkäufers finden Sie auf der Produktseite und in Ihrer Bestellbestätigung.
              </p>
            </div>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Widerrufsrecht bei Fernabsatzverträgen</h2>
              
              <p className="mb-4">
                Als Verbraucher haben Sie bei Käufen im Fernabsatz (Online-Kauf) grundsätzlich ein gesetzliches 
                Widerrufsrecht gemäß § 312g BGB.
              </p>

              <h3 className="text-xl font-semibold mb-3">Widerrufsfrist</h3>
              <p className="mb-4">
                Sie haben das Recht, binnen vierzehn Tagen ohne Angabe von Gründen den Vertrag mit dem Verkäufer zu widerrufen.
              </p>

              <p className="mb-4">
                Die Widerrufsfrist beträgt vierzehn Tage ab dem Tag, an dem Sie oder ein von Ihnen benannter Dritter, 
                der nicht der Beförderer ist, die Waren in Besitz genommen haben bzw. hat.
              </p>

              <h3 className="text-xl font-semibold mb-3">Ausübung des Widerrufsrechts</h3>
              <p className="mb-4">
                Um Ihr Widerrufsrecht auszuüben, müssen Sie <strong>den Verkäufer</strong> (nicht deimudda) mittels 
                einer eindeutigen Erklärung (z.B. ein mit der Post versandter Brief oder E-Mail) über Ihren Entschluss, 
                den Vertrag zu widerrufen, informieren.
              </p>

              <div className="bg-gray-100 p-4 rounded-lg mb-4">
                <p className="font-semibold mb-2">Die Kontaktdaten des Verkäufers finden Sie:</p>
                <ul className="list-disc pl-6">
                  <li>Auf der Produktseite unter "Verkäufer-Informationen"</li>
                  <li>In Ihrer Bestellbestätigung</li>
                  <li>Im Verkäufer-Profil (klicken Sie auf den Verkäufer-Namen)</li>
                </ul>
              </div>

              <p className="mb-4">
                Sie können dafür das unten stehende Muster-Widerrufsformular verwenden, das jedoch nicht vorgeschrieben ist.
              </p>

              <p className="mb-4">
                Zur Wahrung der Widerrufsfrist reicht es aus, dass Sie die Mitteilung über die Ausübung des 
                Widerrufsrechts vor Ablauf der Widerrufsfrist an den Verkäufer absenden.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Folgen des Widerrufs</h2>
              
              <p className="mb-4">
                Wenn Sie den Vertrag widerrufen, hat der Verkäufer Ihnen alle Zahlungen, die er von Ihnen erhalten hat, 
                einschließlich der Lieferkosten (mit Ausnahme der zusätzlichen Kosten, die sich daraus ergeben, dass 
                Sie eine andere Art der Lieferung als die vom Verkäufer angebotene, günstigste Standardlieferung gewählt haben), 
                unverzüglich und spätestens binnen vierzehn Tagen ab dem Tag zurückzuzahlen, an dem die Mitteilung über 
                Ihren Widerruf beim Verkäufer eingegangen ist.
              </p>

              <p className="mb-4">
                Für diese Rückzahlung verwendet der Verkäufer dasselbe Zahlungsmittel, das Sie bei der ursprünglichen 
                Transaktion eingesetzt haben, es sei denn, mit Ihnen wurde ausdrücklich etwas anderes vereinbart; in 
                keinem Fall werden Ihnen wegen dieser Rückzahlung Entgelte berechnet.
              </p>

              <p className="mb-4">
                Der Verkäufer kann die Rückzahlung verweigern, bis er die Waren wieder zurückerhalten hat oder bis Sie 
                den Nachweis erbracht haben, dass Sie die Waren zurückgesandt haben, je nachdem, welches der frühere Zeitpunkt ist.
              </p>

              <p className="mb-4">
                Sie haben die Waren unverzüglich und in jedem Fall spätestens binnen vierzehn Tagen ab dem Tag, an dem 
                Sie den Verkäufer über den Widerruf unterrichten, an den Verkäufer zurückzusenden oder zu übergeben. 
                Die Frist ist gewahrt, wenn Sie die Waren vor Ablauf der Frist von vierzehn Tagen absenden.
              </p>

              <p className="mb-4">
                <strong>Rücksendekosten:</strong> Sie tragen die unmittelbaren Kosten der Rücksendung der Waren, sofern 
                der Verkäufer nicht zugesagt hat, diese Kosten zu übernehmen.
              </p>

              <p className="mb-4">
                Sie müssen für einen etwaigen Wertverlust der Waren nur aufkommen, wenn dieser Wertverlust auf einen 
                zur Prüfung der Beschaffenheit, Eigenschaften und Funktionsweise der Waren nicht notwendigen Umgang 
                mit ihnen zurückzuführen ist.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Besonderheit bei Cannabis-Stecklingen</h2>
              
              <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                <p className="text-yellow-800">
                  <strong>Wichtiger Hinweis:</strong> Das Widerrufsrecht kann bei lebenden Pflanzen unter bestimmten 
                  Umständen ausgeschlossen sein.
                </p>
              </div>

              <p className="mb-4">
                Gemäß § 312g Abs. 2 Nr. 2 BGB besteht kein Widerrufsrecht bei Verträgen zur Lieferung von Waren, die 
                schnell verderben können oder deren Verfallsdatum schnell überschritten würde.
              </p>

              <p className="mb-4">
                Da Cannabis-Stecklinge <strong>lebende Pflanzen</strong> sind, die besonderer Pflege bedürfen und schnell 
                verderben können, kann das Widerrufsrecht in bestimmten Fällen ausgeschlossen sein. Dies gilt insbesondere, wenn:
              </p>

              <ul className="list-disc pl-6 mb-4">
                <li className="mb-2">Die Stecklinge bereits in Empfang genommen und die Verpackung geöffnet wurde</li>
                <li className="mb-2">Die Stecklinge sichtbare Schäden aufweisen, die auf unsachgemäße Behandlung durch den Käufer zurückzuführen sind</li>
                <li className="mb-2">Der Verkäufer in seiner Produktbeschreibung ausdrücklich auf den Ausschluss des Widerrufsrechts hingewiesen hat</li>
              </ul>

              <p className="mb-4">
                <strong>Mängelrechte bleiben unberührt:</strong> Auch wenn das Widerrufsrecht ausgeschlossen ist, haben 
                Sie bei mangelhaften Stecklingen (z.B. kranke Pflanzen, falsche Sorte) weiterhin Anspruch auf Gewährleistung 
                gegenüber dem Verkäufer (§ 437 BGB).
              </p>

              <p className="mb-4">
                Bitte beachten Sie, dass Sie bei Erhalt der Ware diese unverzüglich auf Mängel überprüfen sollten. 
                Sollten Sie Mängel feststellen, kontaktieren Sie bitte umgehend den Verkäufer und dokumentieren Sie 
                die Mängel mit Fotos.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Muster-Widerrufsformular</h2>
              
              <div className="bg-gray-100 p-6 rounded-lg">
                <p className="mb-4 text-sm">
                  (Wenn Sie den Vertrag widerrufen wollen, dann füllen Sie bitte dieses Formular aus und senden Sie es 
                  an den Verkäufer zurück. Die Kontaktdaten des Verkäufers finden Sie auf der Produktseite oder in Ihrer Bestellbestätigung.)
                </p>

                <div className="space-y-4 text-sm">
                  <p className="font-semibold">An den Verkäufer:</p>
                  <div className="bg-white p-4 rounded space-y-2">
                    <p>[Name des Verkäufers]</p>
                    <p>[Anschrift des Verkäufers]</p>
                    <p>[E-Mail-Adresse des Verkäufers]</p>
                    <p className="text-xs text-gray-500 mt-2">
                      (Diese Informationen finden Sie auf der Produktseite unter "Verkäufer-Informationen")
                    </p>
                  </div>

                  <p className="font-semibold mt-4">Hiermit widerrufe(n) ich/wir (*) den von mir/uns (*) abgeschlossenen Vertrag über den Kauf der folgenden Waren (*):</p>
                  
                  <div className="bg-white p-4 rounded space-y-2">
                    <p>_____________________________________________</p>
                    <p className="text-xs text-gray-500">(Bezeichnung der Ware, z.B. "Purple Kush Steckling")</p>
                  </div>

                  <div className="bg-white p-4 rounded space-y-2">
                    <p>Bestellt am (*) / erhalten am (*): _____________________________________________</p>
                  </div>

                  <div className="bg-white p-4 rounded space-y-2">
                    <p>Bestellnummer / Transaktions-ID: _____________________________________________</p>
                  </div>

                  <div className="bg-white p-4 rounded space-y-2">
                    <p>Name des/der Verbraucher(s): _____________________________________________</p>
                  </div>

                  <div className="bg-white p-4 rounded space-y-2">
                    <p>Anschrift des/der Verbraucher(s): _____________________________________________</p>
                  </div>

                  <div className="bg-white p-4 rounded space-y-2">
                    <p>E-Mail-Adresse: _____________________________________________</p>
                  </div>

                  <div className="bg-white p-4 rounded space-y-2">
                    <p>Unterschrift des/der Verbraucher(s) (nur bei Mitteilung auf Papier): _____________________________________________</p>
                  </div>

                  <div className="bg-white p-4 rounded space-y-2">
                    <p>Datum: _____________________________________________</p>
                  </div>

                  <p className="text-xs text-gray-500 mt-4">(*) Unzutreffendes streichen.</p>
                </div>
              </div>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Ausschluss des Widerrufsrechts</h2>
              
              <p className="mb-4">
                Das Widerrufsrecht besteht gemäß § 312g Abs. 2 BGB nicht bei folgenden Verträgen:
              </p>

              <ul className="list-disc pl-6 mb-4">
                <li className="mb-2">
                  Verträge zur Lieferung von Waren, die nicht vorgefertigt sind und für deren Herstellung eine 
                  individuelle Auswahl oder Bestimmung durch den Verbraucher maßgeblich ist oder die eindeutig auf 
                  die persönlichen Bedürfnisse des Verbrauchers zugeschnitten sind
                </li>
                <li className="mb-2">
                  <strong>Verträge zur Lieferung von Waren, die schnell verderben können oder deren Verfallsdatum schnell 
                  überschritten würde</strong> (betrifft lebende Pflanzen wie Cannabis-Stecklinge)
                </li>
                <li className="mb-2">
                  Verträge zur Lieferung versiegelter Waren, die aus Gründen des Gesundheitsschutzes oder der Hygiene 
                  nicht zur Rückgabe geeignet sind, wenn ihre Versiegelung nach der Lieferung entfernt wurde
                </li>
              </ul>

              <p className="mb-4">
                Bitte beachten Sie die Produktbeschreibung des jeweiligen Verkäufers, ob das Widerrufsrecht für das 
                konkrete Produkt ausgeschlossen ist.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Rolle von deimudda</h2>
              
              <p className="mb-4">
                <strong>deimudda ist ausschließlich Vermittler</strong> und nicht Vertragspartner des Kaufvertrags. 
                Wir stellen lediglich die Plattform bereit, auf der Käufer und Verkäufer zusammenfinden können.
              </p>

              <p className="mb-4">
                <strong>Für Widerrufe, Rücksendungen, Reklamationen und Gewährleistungsansprüche ist ausschließlich 
                der Verkäufer zuständig.</strong> deimudda haftet nicht für die Abwicklung von Widerrufen oder die 
                Qualität der verkauften Waren.
              </p>

              <p className="mb-4">
                Bei Problemen mit einem Verkäufer können Sie sich jedoch gerne an unseren Support wenden. Wir helfen 
                Ihnen bei der Vermittlung und können bei schwerwiegenden Verstößen gegen unsere Nutzungsbedingungen 
                Maßnahmen gegen den Verkäufer ergreifen.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Kontakt bei Fragen</h2>
              
              <p className="mb-4">
                <strong>Bei Fragen zum Widerruf eines konkreten Kaufs:</strong><br />
                Wenden Sie sich bitte direkt an den Verkäufer (Kontaktdaten auf der Produktseite).
              </p>

              <p className="mb-4">
                <strong>Bei allgemeinen Fragen zur Plattform oder Problemen mit einem Verkäufer:</strong><br />
                Kontaktieren Sie den deimudda-Support über das Kontaktformular oder per E-Mail.
              </p>
            </section>

            <p className="text-sm text-gray-600 mt-8">
              Quelle: Erstellt unter Berücksichtigung von § 312g BGB (Widerrufsrecht bei Fernabsatzverträgen) 
              und angepasst für das Marktplatz-Modell von deimudda.
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: About.tsx

**`client/src/components/About.tsx`**

```typescript
import BackButton from "@/components/BackButton";

export default function About() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 py-12">
      <div className="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
        <BackButton href="/" label="Zurück zur Startseite" />
        <div className="bg-white rounded-lg shadow-lg overflow-hidden">
          {/* Hero Section */}
          <div className="bg-gradient-to-r from-green-600 to-emerald-600 p-8 text-white">
            <h1 className="text-4xl font-bold mb-4">Über uns</h1>
            <p className="text-xl text-green-50">
              Mit Herz und Seele für biologischen Cannabis-Anbau
            </p>
          </div>

          <div className="p-8 space-y-8">
            {/* Logos */}
            <div className="flex flex-wrap items-center justify-center gap-8 py-6 border-b">
              <img 
                src="/vaperge-logo.png" 
                alt="Vaperge Logo" 
                className="h-24 w-auto"
              />
              <img 
                src="/kalidad-logo.png" 
                alt="Kalidad Logo" 
                className="h-20 w-auto bg-white p-2 rounded"
              />
            </div>

            {/* Mission Statement */}
            <div className="bg-green-50 border-l-4 border-green-500 p-6 rounded-r-lg">
              <h2 className="text-2xl font-bold text-green-900 mb-3">Unsere Mission</h2>
              <p className="text-lg text-green-800 leading-relaxed">
                Wir möchten jedem ermöglichen, Cannabis in <strong>Kali-Qualität</strong> zu produzieren – 
                unabhängig von der Genetik. Denn Spitzenqualität ist keine Frage der Sorte, sondern eine Frage 
                der <strong>richtigen Anbau-Methodik</strong>.
              </p>
            </div>

            {/* Die Geschichte */}
            <section>
              <h2 className="text-3xl font-bold text-gray-900 mb-4">Die Geschichte von deimudda</h2>
              
              <div className="prose prose-lg max-w-none text-gray-700 space-y-4">
                <p>
                  <strong>deimudda</strong> ist mehr als nur eine Plattform – es ist das Ergebnis jahrelanger 
                  Leidenschaft, Forschung und Hingabe zum biologischen Cannabis-Anbau. Hinter deimudda steht 
                  <strong> Vaperge - Eau de Terpènes</strong>, gegründet von Chris Rohleder, in enger Kooperation 
                  mit <strong>Kalidad - Grow- & Headshop</strong> in Malsch.
                </p>

                <p>
                  Was als Neugier und Experimentierfreude begann, entwickelte sich über die Jahre zu einer echten 
                  Expertise: Wir haben uns intensiv damit beschäftigt, wie man Cannabis <strong>biologisch</strong>, 
                  <strong>nachhaltig</strong> und in <strong>höchster Qualität</strong> anbauen kann – ohne auf 
                  synthetische Dünger oder aggressive Chemie zurückzugreifen.
                </p>
              </div>
            </section>

            {/* Der Cannabis-Foliant */}
            <section className="bg-amber-50 p-6 rounded-lg border border-amber-200">
              <h2 className="text-2xl font-bold text-amber-900 mb-4">📖 Der Cannabis-Foliant</h2>
              
              <div className="space-y-3 text-gray-700">
                <p>
                  Aus unserer jahrelangen Forschung und unzähligen Anbau-Experimenten entstand der 
                  <strong> Cannabis-Foliant</strong> – ein umfassendes Handbuch, das unser gesamtes Wissen 
                  über biologischen Cannabis-Anbau bündelt.
                </p>

                <p>
                  Der Foliant dokumentiert nicht nur Theorie, sondern <strong>praxiserprobte Methoden</strong>:
                </p>

                <ul className="list-disc pl-6 space-y-2">
                  <li>Biologische Dünge-Schemata für verschiedene Wachstumsphasen</li>
                  <li>Natürliche Schädlingsbekämpfung ohne Chemie</li>
                  <li>Optimierung von Boden, Mikrobiologie und Nährstoffkreisläufen</li>
                  <li>Terpenen-Entwicklung und Aromaprofil-Optimierung</li>
                  <li>Ernte, Trocknung und Fermentation für maximale Qualität</li>
                </ul>

                <p className="text-sm text-amber-800 italic mt-4">
                  Der Foliant ist das Herzstück unserer Philosophie: Wissen teilen, damit jeder Grower 
                  sein volles Potenzial entfalten kann.
                </p>
              </div>
            </section>

            {/* Das Dünge-Schema */}
            <section>
              <h2 className="text-2xl font-bold text-gray-900 mb-4">🌱 Das ganzheitliche Grow-Konzept: Der Schlüssel zur Qualität</h2>
              
              <div className="space-y-4 text-gray-700">
                <p>
                  Aus dem Cannabis-Folianten heraus haben wir ein <strong>ganzheitliches Grow-Konzept</strong> entwickelt, 
                  das auf rein <strong>biologischen Prinzipien</strong> basiert. Dieses Konzept ist das Ergebnis von 
                  Jahren des Experimentierens, Testens und Verfeinerns.
                </p>

                <div className="bg-green-50 p-5 rounded-lg border-l-4 border-green-500">
                  <h3 className="font-bold text-green-900 mb-2">Die Philosophie dahinter:</h3>
                  <p className="text-green-800">
                    Spitzenqualität entsteht nicht durch teure Genetik oder High-Tech-Equipment, sondern durch 
                    <strong> Verständnis der biologischen Prozesse</strong>. Unser Grow-Konzept arbeitet mit der 
                    Natur, nicht gegen sie – und ermöglicht es jedem Grower, Premium-Qualität zu 
                    produzieren, egal welche Sorte angebaut wird.
                  </p>
                </div>

                <p>
                  Das Konzept umfasst:
                </p>

                <ul className="list-disc pl-6 space-y-2">
                  <li><strong>Bodenbiologie:</strong> Aufbau eines gesunden Mikrobioms</li>
                  <li><strong>Nährstoff-Timing:</strong> Die richtige Düngung zur richtigen Zeit</li>
                  <li><strong>Organische Materialien:</strong> Kompost, Wurmhumus, Pflanzenjauchen</li>
                  <li><strong>Mineralien:</strong> Gesteinsmehl, Kalk, Spurenelemente</li>
                  <li><strong>Mikroorganismen:</strong> Mykorrhiza, Bakterien, Pilze</li>
                </ul>

                <p className="font-semibold text-green-700">
                  Das Ergebnis? Pflanzen, die nicht nur gesund wachsen, sondern <strong>Terpenen-Profile</strong> 
                  entwickeln, die höchste Qualitätsansprüche erfüllen – unabhängig von der Ausgangssorte.
                </p>
              </div>
            </section>

            {/* German Kali */}
            <section className="bg-purple-50 p-6 rounded-lg border border-purple-200">
              <h2 className="text-2xl font-bold text-purple-900 mb-4">🌿 German Kali</h2>
              
              <div className="space-y-3 text-gray-700">
                <p>
                  <strong>German Kali</strong> steht für <strong>Qualität</strong> – echte, ehrliche, 
                  biologisch produzierte Qualität. Keine Abkürzungen, keine Chemie, keine Tricks. 
                  Nur <strong>ganzheitliches Grow-Konzept</strong>, das auf Verständnis der Natur basiert.
                </p>

                <p>
                  Unser Ansatz ist simpel: Mit der <strong>richtigen Methodik</strong> – biologischem Anbau, 
                  effektiven Mikroorganismen (EMs), einem durchdachten Nährstoff-Management und tiefem Verständnis 
                  der Bodenbiologie – wird aus <strong>jeder Genetik</strong> ein Premium-Produkt.
                </p>

                <p>
                  <strong>German Kali</strong> ist unsere Art zu zeigen: Man braucht keine überteuerten 
                  "Hype-Strains" oder synthetische Wundermittel. Was zählt, ist <strong>Methodik</strong>, 
                  <strong>Geduld</strong> und <strong>Respekt vor der Pflanze</strong>.
                </p>

                <div className="bg-purple-100 p-4 rounded mt-4">
                  <p className="text-purple-900 font-semibold">
                    💡 Kurz gesagt: <strong>German Kali</strong> bedeutet Spitzenqualität durch Methodik, 
                    nicht durch Genetik. Selbst aus einfachen Sorten wird mit unserem ganzheitlichen Grow-Konzept 
                    erstklassiges Cannabis.
                  </p>
                </div>
              </div>
            </section>

            {/* Die Vision */}
            <section>
              <h2 className="text-2xl font-bold text-gray-900 mb-4">🎯 Unsere Vision: Wissen teilen, Qualität demokratisieren</h2>
              
              <div className="space-y-4 text-gray-700">
                <p>
                  Mit <strong>deimudda</strong> wollen wir nicht nur Stecklinge und Samen vermitteln – wir wollen 
                  eine <strong>Community</strong> aufbauen, in der Wissen geteilt, Erfahrungen ausgetauscht und 
                  gemeinsam gelernt wird.
                </p>

                <div className="grid md:grid-cols-3 gap-4 my-6">
                  <div className="bg-blue-50 p-4 rounded-lg text-center">
                    <div className="text-3xl mb-2">🌱</div>
                    <h3 className="font-bold text-blue-900 mb-2">Biologisch</h3>
                    <p className="text-sm text-blue-800">
                      Nur natürliche Methoden, keine synthetischen Chemikalien
                    </p>
                  </div>

                  <div className="bg-green-50 p-4 rounded-lg text-center">
                    <div className="text-3xl mb-2">🤝</div>
                    <h3 className="font-bold text-green-900 mb-2">Community</h3>
                    <p className="text-sm text-green-800">
                      Wissen teilen, voneinander lernen, gemeinsam wachsen
                    </p>
                  </div>

                  <div className="bg-purple-50 p-4 rounded-lg text-center">
                    <div className="text-3xl mb-2">⭐</div>
                    <h3 className="font-bold text-purple-900 mb-2">Qualität</h3>
                    <p className="text-sm text-purple-800">
                      Kali-Standard für jeden – unabhängig von Budget oder Erfahrung
                    </p>
                  </div>
                </div>

                <p>
                  Wir glauben daran, dass <strong>jeder Grower</strong> – ob Anfänger oder Profi – in der Lage sein sollte, 
                  Cannabis in höchster Qualität zu produzieren. Dafür braucht es keine teuren Anlagen oder geheime Tricks, 
                  sondern nur das <strong>richtige Wissen</strong> und die <strong>richtige Methode</strong>.
                </p>

                <p className="font-semibold text-lg text-green-700">
                  Genau das bieten wir: <strong>Stecklinge</strong>, <strong>Wissen</strong> und eine 
                  <strong> Community</strong>, die mit Herz und Seele dabei ist.
                </p>
              </div>
            </section>

            {/* Das Team */}
            <section className="bg-gray-50 p-6 rounded-lg">
              <h2 className="text-2xl font-bold text-gray-900 mb-4">👥 Das Team</h2>
              
              <div className="space-y-4">
                <div className="flex items-start gap-4">
                  <div className="flex-shrink-0">
                    <img 
                      src="/vaperge-logo.png" 
                      alt="Vaperge" 
                      className="h-16 w-auto"
                    />
                  </div>
                  <div>
                    <h3 className="font-bold text-lg text-gray-900">Vaperge - Eau de Terpènes</h3>
                    <p className="text-gray-600">
                      Gegründet von Chris Rohleder. Spezialisiert auf Terpenen-Forschung, biologischen Anbau 
                      und die Entwicklung von Dünge-Schemata. Vaperge ist die treibende Kraft hinter dem 
                      Cannabis-Folianten und dem deimudda-Projekt.
                    </p>
                  </div>
                </div>

                <div className="flex items-start gap-4">
                  <div className="flex-shrink-0">
                    <img 
                      src="/kalidad-logo.png" 
                      alt="Kalidad" 
                      className="h-16 w-auto bg-white p-2 rounded"
                    />
                  </div>
                  <div>
                    <h3 className="font-bold text-lg text-gray-900">Kalidad - Grow- & Headshop</h3>
                    <p className="text-gray-600">
                      Unser Partner in Malsch. Kalidad bringt jahrelange Erfahrung im Grow-Bereich mit und 
                      unterstützt die Community mit Fachwissen, Equipment und Beratung. Gemeinsam bilden wir 
                      ein starkes Team für biologischen Cannabis-Anbau.
                    </p>
                    <p className="text-sm text-gray-500 mt-2">
                      Instagram: <a href="https://www.instagram.com/kalidad420/" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">@kalidad420</a>
                    </p>
                  </div>
                </div>
              </div>
            </section>

            {/* Warum deimudda? */}
            <section>
              <h2 className="text-2xl font-bold text-gray-900 mb-4">❓ Warum "deimudda"?</h2>
              
              <div className="space-y-3 text-gray-700">
                <p>
                  Der Name <strong>deimudda</strong> ist eine liebevolle Anspielung auf die <strong>Mutterpflanzen</strong> 
                  (engl. "mother plants"), von denen Stecklinge geschnitten werden. Im Pfälzischen Dialekt wird daraus 
                  "dei Mudda" – deine Mutter.
                </p>

                <p>
                  Es ist ein Augenzwinkern, aber auch ein Statement: <strong>Respekt vor der Natur</strong>, 
                  <strong>Respekt vor der Pflanze</strong> und <strong>Respekt vor dem Handwerk</strong> des Anbaus.
                </p>

                <div className="bg-green-100 p-4 rounded-lg border-l-4 border-green-500">
                  <p className="text-green-900 italic">
                    "Bei uns geht's nicht um schnelles Geld oder Massenproduktion. Bei uns geht's um Leidenschaft, 
                    Qualität und die Liebe zur Pflanze. Deimudda – weil jede gute Ernte mit einer guten Mutter beginnt." 
                    <span className="block mt-2 text-right font-semibold">– Das deimudda-Team</span>
                  </p>
                </div>
              </div>
            </section>

            {/* Call to Action */}
            <section className="bg-gradient-to-r from-green-600 to-emerald-600 p-8 rounded-lg text-white text-center">
              <h2 className="text-3xl font-bold mb-4">Werde Teil der Community!</h2>
              <p className="text-lg text-green-50 mb-6">
                Entdecke hochwertige Stecklinge, tausche dich mit Gleichgesinnten aus und lerne, 
                wie du Cannabis in Kali-Qualität produzierst.
              </p>
              <div className="flex flex-wrap gap-4 justify-center">
                <a 
                  href="/browse" 
                  className="bg-white text-green-600 px-6 py-3 rounded-lg font-semibold hover:bg-green-50 transition"
                >
                  Stecklinge entdecken
                </a>
                <a 
                  href="/register" 
                  className="bg-green-700 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-800 transition border-2 border-white"
                >
                  Jetzt registrieren
                </a>
              </div>
            </section>

            {/* Kontakt */}
            <section className="text-center text-gray-600">
              <p className="mb-2">Fragen? Anregungen? Feedback?</p>
              <p>
                Schreib uns: <a href="mailto:info@deimudda.de" className="text-green-600 hover:underline font-semibold">info@deimudda.de</a>
              </p>
            </section>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: AdminDashboard.tsx

**`client/src/components/AdminDashboard.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { 
  Users, 
  Package, 
  DollarSign, 
  TrendingUp, 
  AlertTriangle,
  Shield,
  BarChart3,
  FileText,
  Settings
} from "lucide-react";
import { Link } from "wouter";
import BackButton from "@/components/BackButton";

export default function AdminDashboard() {
  const { user } = useAuth();
  const { data: stats } = trpc.admin.getStats.useQuery(undefined, { staleTime: 300000 });

  // Check if user is admin or super_admin
  if (!user || (user.role !== 'admin' && user.role !== 'super_admin')) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf das Admin-Dashboard zuzugreifen.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/profile" label="Zurück zum Profil" />
      {/* Header */}
      <div className="mb-8">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Admin-Dashboard</h1>
            <p className="text-gray-600 mt-2">
              Willkommen, {user.name}
              {user.role === 'super_admin' ? (
                <Badge className="ml-2 bg-purple-600">Super Admin</Badge>
              ) : user.role === 'admin' ? (
                <Badge className="ml-2 bg-blue-600">Admin</Badge>
              ) : null}
            </p>
          </div>
          <Shield className="h-12 w-12 text-purple-600" />
        </div>
      </div>

      {/* Quick Stats */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Gesamtumsatz</CardTitle>
            <DollarSign className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">
              €{stats?.totalRevenue?.toFixed(2) || '0.00'}
            </div>
            <p className="text-xs text-muted-foreground">
              Plattformgebühren: €{stats?.platformFees?.toFixed(2) || '0.00'}
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Transaktionen</CardTitle>
            <TrendingUp className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats?.totalTransactions || 0}</div>
            <p className="text-xs text-muted-foreground">
              Heute: {stats?.transactionsToday || 0}
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Nutzer</CardTitle>
            <Users className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats?.totalUsers || 0}</div>
            <p className="text-xs text-muted-foreground">
              Verkäufer: {stats?.totalSellers || 0}
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Aktive Listings</CardTitle>
            <Package className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats?.activeListings || 0}</div>
            <p className="text-xs text-muted-foreground">
              Gesamt: {stats?.totalListings || 0}
            </p>
          </CardContent>
        </Card>
      </div>

      {/* Warnings & Reports */}
      {stats && (stats.pendingReports > 0 || stats.warnedUsers > 0 || stats.suspendedUsers > 0) && (
        <Card className="mb-8 border-yellow-200 bg-yellow-50">
          <CardHeader>
            <CardTitle className="flex items-center text-yellow-800">
              <AlertTriangle className="h-5 w-5 mr-2" />
              Aktionen erforderlich
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-2">
              {stats.pendingReports > 0 && (
                <p className="text-yellow-700">
                  • {stats.pendingReports} offene Report(s) warten auf Bearbeitung
                </p>
              )}
              {stats.warnedUsers > 0 && (
                <p className="text-yellow-700">
                  • {stats.warnedUsers} verwarnte Nutzer
                </p>
              )}
              {stats.suspendedUsers > 0 && (
                <p className="text-yellow-700">
                  • {stats.suspendedUsers} gesperrte Nutzer
                </p>
              )}
            </div>
          </CardContent>
        </Card>
      )}

      {/* Navigation Cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <Link href="/admin/users">
          <Card className="cursor-pointer hover:shadow-lg transition-shadow">
            <CardHeader>
              <CardTitle className="flex items-center">
                <Users className="h-5 w-5 mr-2" />
                Nutzer-Verwaltung
              </CardTitle>
              <CardDescription>
                Nutzer verwalten, verwarnen, sperren oder bannen
              </CardDescription>
            </CardHeader>
          </Card>
        </Link>

        <Link href="/admin/transactions">
          <Card className="cursor-pointer hover:shadow-lg transition-shadow">
            <CardHeader>
              <CardTitle className="flex items-center">
                <DollarSign className="h-5 w-5 mr-2" />
                Transaktionen
              </CardTitle>
              <CardDescription>
                Alle Plattform-Transaktionen und Gebühren einsehen
              </CardDescription>
            </CardHeader>
          </Card>
        </Link>

        <Link href="/admin/listings">
          <Card className="cursor-pointer hover:shadow-lg transition-shadow">
            <CardHeader>
              <CardTitle className="flex items-center">
                <Package className="h-5 w-5 mr-2" />
                Listing-Moderation
              </CardTitle>
              <CardDescription>
                Listings prüfen, deaktivieren oder löschen
              </CardDescription>
            </CardHeader>
          </Card>
        </Link>

        <Link href="/admin/reports">
          <Card className="cursor-pointer hover:shadow-lg transition-shadow">
            <CardHeader>
              <CardTitle className="flex items-center">
                <AlertTriangle className="h-5 w-5 mr-2" />
                Reports
              </CardTitle>
              <CardDescription>
                Meldungen von Nutzern bearbeiten
              </CardDescription>
            </CardHeader>
          </Card>
        </Link>

        <Link href="/admin/stats">
          <Card className="cursor-pointer hover:shadow-lg transition-shadow">
            <CardHeader>
              <CardTitle className="flex items-center">
                <BarChart3 className="h-5 w-5 mr-2" />
                Statistiken
              </CardTitle>
              <CardDescription>
                Detaillierte Plattform-Statistiken und Charts
              </CardDescription>
            </CardHeader>
          </Card>
        </Link>

        <Link href="/admin/logs">
          <Card className="cursor-pointer hover:shadow-lg transition-shadow">
            <CardHeader>
              <CardTitle className="flex items-center">
                <FileText className="h-5 w-5 mr-2" />
                Admin-Logs
              </CardTitle>
              <CardDescription>
                Alle Admin-Aktionen einsehen (Audit Trail)
              </CardDescription>
            </CardHeader>
          </Card>
        </Link>

        <Link href="/admin/security">
          <Card className="cursor-pointer hover:shadow-lg transition-shadow">
            <CardHeader>
              <CardTitle className="flex items-center">
                <Shield className="h-5 w-5 mr-2" />
                Sicherheit & IPs
              </CardTitle>
              <CardDescription>
                IP-Blocking und Login-Sicherheit verwalten
              </CardDescription>
            </CardHeader>
          </Card>
        </Link>
      </div>

      {/* Super Admin Only Section */}
      {user.role === 'super_admin' && (
        <div className="mt-8">
          <Card className="border-purple-200 bg-purple-50">
            <CardHeader>
              <CardTitle className="text-purple-800">Super Admin Funktionen</CardTitle>
              <CardDescription className="text-purple-600">
                Nur für Super Admins verfügbar
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-2">
                <Link href="/admin/manage">
                  <Button variant="outline" className="w-full justify-start">
                    <Shield className="h-4 w-4 mr-2" />
                    Admins ernennen/entfernen
                  </Button>
                </Link>
                <Link href="/admin/admins">
                  <Button variant="outline" className="w-full justify-start">
                    <Users className="h-4 w-4 mr-2" />
                    Admin-Verwaltung
                  </Button>
                </Link>
                <Link href="/admin/settings">
                  <Button variant="outline" className="w-full justify-start">
                    <BarChart3 className="h-4 w-4 mr-2" />
                    System-Einstellungen
                  </Button>
                </Link>

              </div>
            </CardContent>
          </Card>
        </div>
      )}
    </div>
  );
}

```

#### Schritt 5.x: AdminListings.tsx

**`client/src/components/AdminListings.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import type { Listing } from "@/../../shared/types";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from "@/components/ui/dialog";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { Package, Search, Filter, Ban, CheckCircle, Trash2, Eye } from "lucide-react";
import BackButton from "@/components/BackButton";
import { toast } from "sonner";

export default function AdminListings() {
  const { user } = useAuth();
  const { data: listings, refetch } = trpc.listing.getAll.useQuery(undefined, { staleTime: 60000 });
  
  // Mutations
  const blockListingMutation = trpc.admin.blockListing.useMutation({
    onSuccess: () => {
      toast.success("Listing erfolgreich gesperrt");
      refetch();
      setBlockDialogOpen(false);
    },
    onError: (error) => {
      toast.error(`Fehler: ${error.message}`);
    },
  });
  
  const unblockListingMutation = trpc.admin.unblockListing.useMutation({
    onSuccess: () => {
      toast.success("Listing-Sperrung aufgehoben");
      refetch();
    },
    onError: (error) => {
      toast.error(`Fehler: ${error.message}`);
    },
  });
  
  const deleteListingMutation = trpc.admin.deleteListing.useMutation({
    onSuccess: () => {
      toast.success("Listing erfolgreich gelöscht");
      refetch();
      setDeleteDialogOpen(false);
    },
    onError: (error) => {
      toast.error(`Fehler: ${error.message}`);
    },
  });
  
  const [searchQuery, setSearchQuery] = useState("");
  const [statusFilter, setStatusFilter] = useState<string>("all");
  const [typeFilter, setTypeFilter] = useState<string>("all");
  
  const [blockDialogOpen, setBlockDialogOpen] = useState(false);
  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);
  const [selectedListing, setSelectedListing] = useState<any>(null);
  const [reason, setReason] = useState("");

  // Check if user is admin
  if (!user || (user.role !== 'admin' && user.role !== 'super_admin')) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf die Listing-Moderation zuzugreifen.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  // Filter listings
  const filteredListings = listings?.filter((listing: Listing) => {
    const matchesSearch = searchQuery === "" || 
      listing.strain?.toLowerCase().includes(searchQuery.toLowerCase()) ||
      listing.description?.toLowerCase().includes(searchQuery.toLowerCase());
    
    const matchesStatus = statusFilter === "all" || listing.status === statusFilter;
    const matchesType = typeFilter === "all" || listing.priceType === typeFilter;
    
    return matchesSearch && matchesStatus && matchesType;
  });

  const getStatusBadge = (status: string) => {
    const badges: Record<string, { label: string; className: string }> = {
      active: { label: "Aktiv", className: "bg-green-100 text-green-800" },
      sold: { label: "Verkauft", className: "bg-blue-100 text-blue-800" },
      blocked: { label: "Gesperrt", className: "bg-red-100 text-red-800" },
      deleted: { label: "Gelöscht", className: "bg-gray-100 text-gray-800" },
    };
    
    const badge = badges[status] || { label: status, className: "bg-gray-100 text-gray-800" };
    return <Badge className={badge.className}>{badge.label}</Badge>;
  };

  const getPriceTypeBadge = (type: string) => {
    const badges: Record<string, { label: string; className: string }> = {
      fixed: { label: "Festpreis", className: "bg-blue-100 text-blue-800" },
      auction: { label: "Auktion", className: "bg-purple-100 text-purple-800" },
      offer: { label: "Preisvorschlag", className: "bg-green-100 text-green-800" },
    };
    
    const badge = badges[type] || { label: type, className: "bg-gray-100 text-gray-800" };
    return <Badge variant="outline" className={badge.className}>{badge.label}</Badge>;
  };

  const handleBlockListing = (listing: Listing) => {
    setSelectedListing(listing);
    setReason("");
    setBlockDialogOpen(true);
  };

  const handleDeleteListing = (listing: Listing) => {
    setSelectedListing(listing);
    setReason("");
    setDeleteDialogOpen(true);
  };

  const submitBlock = () => {
    if (!reason.trim()) {
      toast.error("Bitte geben Sie einen Grund an");
      return;
    }
    
    if (!selectedListing) return;
    
    blockListingMutation.mutate({
      listingId: selectedListing.id,
      reason: reason,
    });
  };

  const submitDelete = () => {
    if (!reason.trim()) {
      toast.error("Bitte geben Sie einen Grund an");
      return;
    }
    
    if (!selectedListing) return;
    
    deleteListingMutation.mutate({
      listingId: selectedListing.id,
      reason: reason,
    });
  };

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/admin" label="Zurück zum Dashboard" />
      
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-4">
          <Package className="h-8 w-8 text-yellow-600" />
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Listing-Moderation</h1>
            <p className="text-gray-600">Überwachen und moderieren Sie alle Listings</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Gesamt</CardDescription>
            <CardTitle className="text-2xl">{listings?.length || 0}</CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Aktiv</CardDescription>
            <CardTitle className="text-2xl text-green-600">
              {listings?.filter((l: Listing) => l.status === 'active').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Verkauft</CardDescription>
            <CardTitle className="text-2xl text-blue-600">
              {listings?.filter((l: Listing) => l.status === 'sold').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Entwurf</CardDescription>
            <CardTitle className="text-2xl text-gray-600">
              {listings?.filter((l: Listing) => l.status === 'draft').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
      </div>

      {/* Filters */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Filter className="h-5 w-5" />
            Filter & Suche
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label className="text-sm font-medium mb-2 block">Suche</label>
              <div className="relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" />
                <Input
                  placeholder="Titel, Strain..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className="pl-10"
                />
              </div>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Status</label>
              <Select value={statusFilter} onValueChange={setStatusFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle Status</SelectItem>
                  <SelectItem value="active">Aktiv</SelectItem>
                  <SelectItem value="sold">Verkauft</SelectItem>
                  <SelectItem value="blocked">Gesperrt</SelectItem>
                  <SelectItem value="deleted">Gelöscht</SelectItem>
                </SelectContent>
              </Select>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Preistyp</label>
              <Select value={typeFilter} onValueChange={setTypeFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle Typen</SelectItem>
                  <SelectItem value="fixed">Festpreis</SelectItem>
                  <SelectItem value="auction">Auktion</SelectItem>
                  <SelectItem value="offer">Preisvorschlag</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
          
          <div className="mt-4 flex gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={() => {
                setSearchQuery("");
                setStatusFilter("all");
                setTypeFilter("all");
              }}
            >
              Zurücksetzen
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Listings List */}
      <div className="space-y-4">
        {filteredListings && filteredListings.length > 0 ? (
          filteredListings.map((listing: Listing) => (
            <Card key={listing.id}>
              <CardContent className="pt-6">
                <div className="flex items-start gap-4">
                  {listing.imageUrl && (
                    <img 
                      src={listing.imageUrl} 
                      alt={listing.strain}
                      className="w-24 h-24 object-cover rounded-lg"
                    />
                  )}
                  
                  <div className="flex-1">
                    <div className="flex items-start justify-between mb-2">
                      <div>
                        <div className="flex items-center gap-2 mb-1">
                          <h3 className="text-lg font-semibold">{listing.strain}</h3>
                          {getStatusBadge(listing.status)}
                          {getPriceTypeBadge(listing.priceType)}
                        </div>
                        <p className="text-sm text-gray-600">{listing.type === 'cutting' ? 'Steckling' : 'Samen'}</p>
                      </div>
                      <div className="text-right">
                        <p className="text-lg font-bold text-green-600">
                          {listing.priceType === 'fixed' && listing.fixedPrice ? `€${Number(listing.fixedPrice).toFixed(2)}` : 
                           listing.priceType === 'auction' && listing.auctionStartPrice ? `Start: €${Number(listing.auctionStartPrice).toFixed(2)}` : 'N/A'}
                        </p>
                      </div>
                    </div>
                    
                    <p className="text-sm text-gray-700 mb-3 line-clamp-2">
                      {listing.description}
                    </p>
                    
                    <div className="flex items-center justify-between">
                      <div className="text-sm text-gray-500">
                        <span>ID: {listing.id}</span>
                        <span className="mx-2">•</span>
                        <span>Verkäufer-ID: {listing.sellerId}</span>
                        <span className="mx-2">•</span>
                        <span>Erstellt: {new Date(listing.createdAt).toLocaleDateString('de-DE')}</span>
                      </div>
                      
                      <div className="flex gap-2">
                        <Button
                          size="sm"
                          variant="outline"
                          onClick={() => window.open(`/listing/${listing.id}`, '_blank')}
                        >
                          <Eye className="h-4 w-4 mr-1" />
                          Ansehen
                        </Button>
                        
                        {listing.status === 'active' && (
                          <Button
                            size="sm"
                            variant="outline"
                            onClick={() => handleBlockListing(listing)}
                            className="text-orange-600 border-orange-600 hover:bg-orange-50"
                          >
                            <Ban className="h-4 w-4 mr-1" />
                            Sperren
                          </Button>
                        )}
                        

                        {user.role === 'super_admin' && (
                          <Button
                            size="sm"
                            variant="outline"
                            onClick={() => handleDeleteListing(listing)}
                            className="text-red-600 border-red-600 hover:bg-red-50"
                          >
                            <Trash2 className="h-4 w-4 mr-1" />
                            Löschen
                          </Button>
                        )}
                      </div>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          ))
        ) : (
          <Card>
            <CardContent className="py-8">
              <p className="text-gray-500 text-center">Keine Listings gefunden</p>
            </CardContent>
          </Card>
        )}
      </div>

      {/* Block Dialog */}
      <Dialog open={blockDialogOpen} onOpenChange={setBlockDialogOpen}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Listing sperren</DialogTitle>
            <DialogDescription>
              Sperren Sie "{selectedListing?.title}" wegen Verstoß gegen die Richtlinien
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4">
            <div>
              <Label>Grund für Sperrung</Label>
              <Textarea
                placeholder="Erklären Sie, warum dieses Listing gesperrt wird..."
                value={reason}
                onChange={(e) => setReason(e.target.value)}
                rows={4}
              />
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setBlockDialogOpen(false)}>
              Abbrechen
            </Button>
            <Button onClick={submitBlock} className="bg-orange-600 hover:bg-orange-700">
              Listing sperren
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Delete Dialog */}
      <Dialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Listing löschen</DialogTitle>
            <DialogDescription>
              Löschen Sie "{selectedListing?.title}" permanent. Diese Aktion kann nicht rückgängig gemacht werden.
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4">
            <div>
              <Label>Grund für Löschung</Label>
              <Textarea
                placeholder="Erklären Sie, warum dieses Listing gelöscht wird..."
                value={reason}
                onChange={(e) => setReason(e.target.value)}
                rows={4}
              />
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setDeleteDialogOpen(false)}>
              Abbrechen
            </Button>
            <Button onClick={submitDelete} className="bg-red-600 hover:bg-red-700">
              Listing löschen
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  );
}

```

#### Schritt 5.x: AdminLogin.tsx

**`client/src/components/AdminLogin.tsx`**

```typescript
import { useEffect } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import { useLocation } from "wouter";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Shield, AlertTriangle } from "lucide-react";
import { getLoginUrl } from "@/const";

export default function AdminLogin() {
  const { user } = useAuth();
  const [, setLocation] = useLocation();

  // Redirect to admin dashboard if already logged in as super_admin
  useEffect(() => {
    if (user?.role === "super_admin") {
      setLocation("/admin");
    }
  }, [user, setLocation]);

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4">
      <Card className="w-full max-w-md">
        <CardHeader className="text-center">
          <div className="flex justify-center mb-4">
            <Shield className="h-16 w-16 text-blue-600" />
          </div>
          <CardTitle className="text-2xl font-bold">Administrator-Zugang</CardTitle>
          <CardDescription>
            Dieser Bereich ist nur für Super-Administratoren zugänglich
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          {/* Warning for maintenance mode */}
          <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
            <div className="flex items-start gap-3">
              <AlertTriangle className="h-5 w-5 text-yellow-600 mt-0.5 flex-shrink-0" />
              <div className="text-sm text-yellow-800">
                <p className="font-semibold mb-1">Wartungsmodus aktiv</p>
                <p>
                  Die Plattform befindet sich im Wartungsmodus. 
                  Nur Super-Administratoren können sich anmelden und auf das System zugreifen.
                </p>
              </div>
            </div>
          </div>

          {/* Login button */}
          <div className="space-y-4">
            {user ? (
              user.role === "super_admin" ? (
                <div className="text-center">
                  <p className="text-sm text-gray-600 mb-4">
                    Sie sind als Super-Administrator angemeldet.
                  </p>
                  <Button
                    onClick={() => setLocation("/admin")}
                    className="w-full"
                    size="lg"
                  >
                    Zum Admin-Dashboard
                  </Button>
                </div>
              ) : (
                <div className="text-center">
                  <p className="text-sm text-red-600 mb-4">
                    Sie sind als <strong>{user.name}</strong> angemeldet, haben aber keine Super-Administrator-Rechte.
                  </p>
                  <Button
                    onClick={() => setLocation("/maintenance")}
                    variant="outline"
                    className="w-full"
                  >
                    Zurück zur Wartungsseite
                  </Button>
                </div>
              )
            ) : (
              <Button
                onClick={() => window.location.href = getLoginUrl()}
                className="w-full"
                size="lg"
              >
                <Shield className="h-5 w-5 mr-2" />
                Als Administrator anmelden
              </Button>
            )}
          </div>

          {/* Info text */}
          <div className="text-center text-sm text-gray-500">
            <p>
              Nach erfolgreicher Anmeldung werden Sie automatisch zum Admin-Dashboard weitergeleitet.
            </p>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: AdminLogs.tsx

**`client/src/components/AdminLogs.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import type { AdminLog } from "@/../../shared/types";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { FileText, Search, Filter } from "lucide-react";
import BackButton from "@/components/BackButton";

export default function AdminLogs() {
  const { user } = useAuth();
  const { data: logs } = trpc.admin.getAdminLogs.useQuery(undefined, { staleTime: 60000 });
  
  const [searchQuery, setSearchQuery] = useState("");
  const [actionFilter, setActionFilter] = useState<string>("all");
  const [dateFilter, setDateFilter] = useState<string>("all");

  // Check if user is admin
  if (!user || (user.role !== 'admin' && user.role !== 'super_admin')) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf die Admin-Logs zuzugreifen.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  // Filter logs
  const filteredLogs = logs?.filter((log) => {
    // Search filter
    const matchesSearch = searchQuery === "" || 
      log.details?.toLowerCase().includes(searchQuery.toLowerCase()) ||
      log.adminName?.toLowerCase().includes(searchQuery.toLowerCase());
    
    // Action filter
    const matchesAction = actionFilter === "all" || log.action === actionFilter;
    
    // Date filter
    let matchesDate = true;
    if (dateFilter !== "all") {
      const logDate = new Date(log.createdAt);
      const now = new Date();
      const daysDiff = Math.floor((now.getTime() - logDate.getTime()) / (1000 * 60 * 60 * 24));
      
      switch (dateFilter) {
        case "today":
          matchesDate = daysDiff === 0;
          break;
        case "week":
          matchesDate = daysDiff <= 7;
          break;
        case "month":
          matchesDate = daysDiff <= 30;
          break;
      }
    }
    
    return matchesSearch && matchesAction && matchesDate;
  });

  const getActionBadge = (action: string) => {
    const badges: Record<string, { label: string; className: string }> = {
      warn_user: { label: "Verwarnung", className: "bg-yellow-100 text-yellow-800" },
      suspend_user: { label: "Sperrung", className: "bg-orange-100 text-orange-800" },
      ban_user: { label: "Bann", className: "bg-red-100 text-red-800" },
      remove_warning: { label: "Verwarnung aufgehoben", className: "bg-green-100 text-green-800" },
      promote_admin: { label: "Admin ernannt", className: "bg-purple-100 text-purple-800" },
      demote_admin: { label: "Admin entzogen", className: "bg-gray-100 text-gray-800" },
    };
    
    const badge = badges[action] || { label: action, className: "bg-gray-100 text-gray-800" };
    return <Badge className={badge.className}>{badge.label}</Badge>;
  };

  const getTargetTypeBadge = (type: string) => {
    const badges: Record<string, { label: string; className: string }> = {
      user: { label: "Nutzer", className: "bg-blue-100 text-blue-800" },
      listing: { label: "Listing", className: "bg-green-100 text-green-800" },
      transaction: { label: "Transaktion", className: "bg-purple-100 text-purple-800" },
    };
    
    const badge = badges[type] || { label: type, className: "bg-gray-100 text-gray-800" };
    return <Badge variant="outline" className={badge.className}>{badge.label}</Badge>;
  };

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/admin" label="Zurück zum Dashboard" />
      
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-4">
          <FileText className="h-8 w-8 text-pink-600" />
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Admin-Logs</h1>
            <p className="text-gray-600">Audit Trail aller Admin-Aktionen</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Gesamt</CardDescription>
            <CardTitle className="text-2xl">{logs?.length || 0}</CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Heute</CardDescription>
            <CardTitle className="text-2xl">
              {logs?.filter((l: AdminLog) => {
                const logDate = new Date(l.createdAt);
                const today = new Date();
                return logDate.toDateString() === today.toDateString();
              }).length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Diese Woche</CardDescription>
            <CardTitle className="text-2xl">
              {logs?.filter((l: AdminLog) => {
                const logDate = new Date(l.createdAt);
                const now = new Date();
                const daysDiff = Math.floor((now.getTime() - logDate.getTime()) / (1000 * 60 * 60 * 24));
                return daysDiff <= 7;
              }).length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Dieser Monat</CardDescription>
            <CardTitle className="text-2xl">
              {logs?.filter((l: AdminLog) => {
                const logDate = new Date(l.createdAt);
                const now = new Date();
                const daysDiff = Math.floor((now.getTime() - logDate.getTime()) / (1000 * 60 * 60 * 24));
                return daysDiff <= 30;
              }).length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
      </div>

      {/* Filters */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Filter className="h-5 w-5" />
            Filter & Suche
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label className="text-sm font-medium mb-2 block">Suche</label>
              <div className="relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" />
                <Input
                  placeholder="Details, Admin-Name..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className="pl-10"
                />
              </div>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Aktion</label>
              <Select value={actionFilter} onValueChange={setActionFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle Aktionen</SelectItem>
                  <SelectItem value="warn_user">Verwarnung</SelectItem>
                  <SelectItem value="suspend_user">Sperrung</SelectItem>
                  <SelectItem value="ban_user">Bann</SelectItem>
                  <SelectItem value="remove_warning">Verwarnung aufgehoben</SelectItem>
                  <SelectItem value="promote_admin">Admin ernannt</SelectItem>
                  <SelectItem value="demote_admin">Admin entzogen</SelectItem>
                </SelectContent>
              </Select>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Zeitraum</label>
              <Select value={dateFilter} onValueChange={setDateFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle</SelectItem>
                  <SelectItem value="today">Heute</SelectItem>
                  <SelectItem value="week">Diese Woche</SelectItem>
                  <SelectItem value="month">Dieser Monat</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
          
          <div className="mt-4 flex gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={() => {
                setSearchQuery("");
                setActionFilter("all");
                setDateFilter("all");
              }}
            >
              Zurücksetzen
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Logs List */}
      <Card>
        <CardHeader>
          <CardTitle>Aktivitäts-Log ({filteredLogs?.length || 0})</CardTitle>
        </CardHeader>
        <CardContent>
          {filteredLogs && filteredLogs.length > 0 ? (
            <div className="space-y-4">
              {filteredLogs.map((log: AdminLog) => (
                <div key={log.id} className="border rounded-lg p-4 hover:bg-gray-50 transition">
                  <div className="flex items-start justify-between">
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-2">
                        {getActionBadge(log.action)}
                        {getTargetTypeBadge(log.targetType)}
                        <span className="text-sm text-gray-500">
                          {new Date(log.createdAt).toLocaleDateString('de-DE', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                          })}
                        </span>
                      </div>
                      <p className="text-sm text-gray-700 mb-1">{log.details}</p>
                      <div className="flex items-center gap-4 text-xs text-gray-500">
                        <span>Admin: {log.adminName || 'Unbekannt'}</span>
                        <span>Ziel-ID: {log.targetId}</span>
                        <span>Log-ID: {log.id}</span>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <p className="text-gray-500 text-center py-8">Keine Logs gefunden</p>
          )}
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: AdminManage.tsx

**`client/src/components/AdminManage.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import type { User } from "@/../../shared/types";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Shield, UserPlus, UserMinus, Crown } from "lucide-react";
import BackButton from "@/components/BackButton";
import { toast } from "sonner";

export default function AdminManage() {
  const { user } = useAuth();
  const utils = trpc.useUtils();
  const { data: allUsers } = trpc.admin.getAllUsers.useQuery(undefined, { staleTime: 60000 });
  const { data: admins, refetch: refetchAdmins } = trpc.admin.getAllAdmins.useQuery(undefined, { staleTime: 60000 });
  
  // Mutations
  const promoteToAdminMutation = trpc.admin.promoteToAdmin.useMutation({
    onSuccess: () => {
      toast.success("Nutzer erfolgreich zum Admin ernannt");
      refetchAdmins();
      utils.auth.me.invalidate(); // Refresh session for affected user
    },
    onError: (error) => {
      toast.error(`Fehler: ${error.message}`);
    },
  });
  
  const demoteFromAdminMutation = trpc.admin.demoteFromAdmin.useMutation({
    onSuccess: () => {
      toast.success("Admin-Rechte erfolgreich entzogen");
      refetchAdmins();
      utils.auth.me.invalidate(); // Refresh session for affected user
    },
    onError: (error) => {
      toast.error(`Fehler: ${error.message}`);
    },
  });

  // Check if user is super admin
  if (!user || user.role !== 'super_admin') {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf die Admin-Verwaltung zuzugreifen. Nur Super-Admins können Admins ernennen oder entfernen.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  const getRoleBadge = (role: string) => {
    if (role === 'super_admin') {
      return <Badge className="bg-purple-100 text-purple-800"><Crown className="h-3 w-3 mr-1 inline" />Super Admin</Badge>;
    }
    if (role === 'admin') {
      return <Badge className="bg-blue-100 text-blue-800"><Shield className="h-3 w-3 mr-1 inline" />Admin</Badge>;
    }
    return <Badge variant="outline">User</Badge>;
  };

  const handlePromote = (userId: number) => {
    if (confirm("Möchten Sie diesen Nutzer wirklich zum Admin ernennen?")) {
      promoteToAdminMutation.mutate(userId);
    }
  };

  const handleDemote = (userId: number) => {
    if (confirm("Möchten Sie diesem Nutzer wirklich die Admin-Rechte entziehen?")) {
      demoteFromAdminMutation.mutate(userId);
    }
  };

  // Get regular users (for promotion)
  const regularUsers = allUsers?.filter((u: User) => u.role === 'user') || [];

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/admin" label="Zurück zum Dashboard" />
      
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-4">
          <Shield className="h-8 w-8 text-purple-600" />
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Admin-Verwaltung</h1>
            <p className="text-gray-600">Verwalten Sie Admin-Rechte (nur Super Admin)</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Super Admins</CardDescription>
            <CardTitle className="text-2xl text-purple-600">
              {admins?.filter((a: User) => a.role === 'super_admin').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Admins</CardDescription>
            <CardTitle className="text-2xl text-blue-600">
              {admins?.filter((a: User) => a.role === 'admin').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Gesamt</CardDescription>
            <CardTitle className="text-2xl">
              {admins?.length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
      </div>

      {/* Current Admins */}
      <Card className="mb-8">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Shield className="h-5 w-5" />
            Aktuelle Admins
          </CardTitle>
          <CardDescription>Alle Nutzer mit Admin- oder Super-Admin-Rechten</CardDescription>
        </CardHeader>
        <CardContent>
          {admins && admins.length > 0 ? (
            <div className="space-y-4">
              {admins.map((admin) => (
                <div key={admin.id} className="flex items-center justify-between p-4 border rounded-lg">
                  <div className="flex-1">
                    <div className="flex items-center gap-3 mb-2">
                      <h3 className="text-lg font-semibold">{admin.name || 'Unbekannt'}</h3>
                      {getRoleBadge(admin.role)}
                    </div>
                    <div className="space-y-1 text-sm text-gray-600">
                      <p><span className="font-medium">ID:</span> {admin.id}</p>
                      <p><span className="font-medium">Email:</span> {admin.email || 'Keine Email'}</p>
                      <p><span className="font-medium">Erstellt:</span> {new Date(admin.createdAt).toLocaleDateString('de-DE')}</p>
                      <p><span className="font-medium">Letzter Login:</span> {new Date(admin.lastSignedIn).toLocaleDateString('de-DE')}</p>
                    </div>
                  </div>
                  
                  <div className="flex flex-col gap-2">
                    {admin.role === 'admin' && admin.id !== user.id && (
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() => handleDemote(admin.id)}
                        className="text-red-600 border-red-600 hover:bg-red-50"
                      >
                        <UserMinus className="h-4 w-4 mr-1" />
                        Rechte entziehen
                      </Button>
                    )}
                    
                    {admin.role === 'super_admin' && (
                      <Badge className="bg-purple-100 text-purple-800">
                        Kann nicht geändert werden
                      </Badge>
                    )}
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <p className="text-gray-500 text-center py-4">Keine Admins gefunden</p>
          )}
        </CardContent>
      </Card>

      {/* Promote Users */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <UserPlus className="h-5 w-5" />
            Nutzer zu Admin ernennen
          </CardTitle>
          <CardDescription>Wählen Sie einen Nutzer aus, um ihn zum Admin zu ernennen</CardDescription>
        </CardHeader>
        <CardContent>
          {regularUsers.length > 0 ? (
            <div className="space-y-3 max-h-96 overflow-y-auto">
              {regularUsers.map((u: User) => (
                <div key={u.id} className="flex items-center justify-between p-3 border rounded-lg">
                  <div>
                    <p className="font-medium">{u.name || 'Unbekannt'}</p>
                    <p className="text-sm text-gray-600">ID: {u.id} • {u.email || 'Keine Email'}</p>
                  </div>
                  <Button
                    size="sm"
                    onClick={() => handlePromote(u.id)}
                    className="bg-blue-600 hover:bg-blue-700"
                  >
                    <UserPlus className="h-4 w-4 mr-1" />
                    Zum Admin ernennen
                  </Button>
                </div>
              ))}
            </div>
          ) : (
            <p className="text-gray-500 text-center py-4">Keine Nutzer zum Ernennen verfügbar</p>
          )}
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: AdminManagement.tsx

**`client/src/components/AdminManagement.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import type { User } from "@/../../shared/types";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { trpc } from "@/lib/trpc";
import { Link } from "wouter";
import { ArrowLeft, UserPlus, UserMinus, Shield, Users } from "lucide-react";
import { toast } from "sonner";
import BackButton from "@/components/BackButton";
import { formatDistanceToNow } from "date-fns";
import { de } from "date-fns/locale";

export default function AdminManagement() {
  const { user, isAuthenticated } = useAuth();
  const utils = trpc.useUtils();

  const { data: admins = [], isLoading } = trpc.admin.getAllAdmins.useQuery();

  const promoteToAdmin = trpc.admin.promoteToAdmin.useMutation({
    onSuccess: () => {
      toast.success("Benutzer wurde zum Admin befördert!");
      utils.admin.getAllAdmins.invalidate();
    },
    onError: (error) => {
      console.error("[AdminManagement] Promote error:", error);
      toast.error("Fehler: " + error.message);
    },
  });

  const demoteAdmin = trpc.admin.demoteFromAdmin.useMutation({
    onSuccess: () => {
      toast.success("Admin-Rechte entzogen!");
      utils.admin.getAllAdmins.invalidate();
    },
    onError: (error) => {
      console.error("[AdminManagement] Demote error:", error);
      toast.error("Fehler: " + error.message);
    },
  });

  if (!isAuthenticated || (user?.role !== "superadmin" && user?.role !== "super_admin")) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center">
        <Card className="max-w-md">
          <CardHeader>
            <CardTitle>Zugriff verweigert</CardTitle>
            <CardDescription>Nur Super-Admins haben Zugriff.</CardDescription>
          </CardHeader>
          <CardContent>
            <Link href="/"><Button>Zur Startseite</Button></Link>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <BackButton href="/admin" label="Zurück zum Dashboard" />
        <div className="mb-8">
          <div className="flex items-center gap-3 mb-2">
            <Shield className="h-8 w-8 text-purple-600" />
            <h1 className="text-3xl font-bold">Admin-Verwaltung</h1>
          </div>
          <p className="text-gray-600">Verwalten Sie Administrator-Rechte.</p>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Gesamt Admins</CardTitle>
              <Users className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">{admins.length}</div>
            </CardContent>
          </Card>
          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Super Admins</CardTitle>
              <Shield className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">{admins.filter(a => a.role === "superadmin" || a.role === "super_admin").length}</div>
            </CardContent>
          </Card>
          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Reguläre Admins</CardTitle>
              <UserPlus className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">{admins.filter(a => a.role === "admin").length}</div>
            </CardContent>
          </Card>
        </div>

        <Card>
          <CardHeader>
            <CardTitle>Alle Administratoren</CardTitle>
            <CardDescription>Liste aller Benutzer mit Admin-Rechten</CardDescription>
          </CardHeader>
          <CardContent>
            {isLoading ? (
              <div className="text-center py-12"><p className="text-muted-foreground">Lädt...</p></div>
            ) : admins.length === 0 ? (
              <div className="text-center py-12"><p className="text-muted-foreground">Keine Admins gefunden.</p></div>
            ) : (
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead>
                    <tr className="border-b">
                      <th className="text-left py-3 px-4">Benutzer</th>
                      <th className="text-left py-3 px-4">Rolle</th>
                      <th className="text-left py-3 px-4">Status</th>
                      <th className="text-left py-3 px-4">Letzter Login</th>
                      <th className="text-right py-3 px-4">Aktionen</th>
                    </tr>
                  </thead>
                  <tbody>
                    {admins.map((admin) => (
                      <tr key={admin.id} className="border-b hover:bg-gray-50">
                        <td className="py-4 px-4">
                          <div>
                            <p className="font-medium">{admin.nickname || admin.name || "Unbekannt"}</p>
                            <p className="text-sm text-gray-500">{admin.email}</p>
                          </div>
                        </td>
                        <td className="py-4 px-4">
                          {admin.role === "superadmin" || admin.role === "super_admin" ? (
                            <Badge className="bg-purple-600"><Shield className="h-3 w-3 mr-1" />Super Admin</Badge>
                          ) : (
                            <Badge variant="secondary"><UserPlus className="h-3 w-3 mr-1" />Admin</Badge>
                          )}
                        </td>
                        <td className="py-4 px-4">
                          {admin.status === "active" ? (
                            <Badge variant="outline" className="bg-green-50 text-green-700">Aktiv</Badge>
                          ) : admin.status === "warned" ? (
                            <Badge variant="outline" className="bg-yellow-50 text-yellow-700">Verwarnt</Badge>
                          ) : admin.status === "suspended" ? (
                            <Badge variant="outline" className="bg-orange-50 text-orange-700">Gesperrt</Badge>
                          ) : (
                            <Badge variant="outline" className="bg-red-50 text-red-700">Gebannt</Badge>
                          )}
                        </td>
                        <td className="py-4 px-4 text-sm text-gray-600">
                          {admin.lastSignedIn ? formatDistanceToNow(new Date(admin.lastSignedIn), { addSuffix: true, locale: de }) : "Nie"}
                        </td>
                        <td className="py-4 px-4 text-right">
                          {admin.role === "superadmin" || admin.role === "super_admin" ? (
                            <span className="text-sm text-gray-400">Keine Aktionen</span>
                          ) : (
                            <Button size="sm" variant="destructive" onClick={() => {
                              if (confirm("Admin-Rechte entziehen?")) demoteAdmin.mutate(admin.id);
                            }} disabled={demoteAdmin.isPending}>
                              <UserMinus className="h-4 w-4 mr-1" />Degradieren
                            </Button>
                          )}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
```

#### Schritt 5.x: AdminReports.tsx

**`client/src/components/AdminReports.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import type { Report } from "@/../../shared/types";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { AlertTriangle, Search, Filter, Eye, CheckCircle, XCircle } from "lucide-react";
import BackButton from "@/components/BackButton";
import { toast } from "sonner";

export default function AdminReports() {
  const { user } = useAuth();
  const { data: reports, refetch } = trpc.admin.getAllReports.useQuery(undefined, { staleTime: 60000 });
  
  const [searchQuery, setSearchQuery] = useState("");
  const [statusFilter, setStatusFilter] = useState<string>("all");
  const [typeFilter, setTypeFilter] = useState<string>("all");
  
  // Mutations
  const updateStatusMutation = trpc.admin.updateReportStatus.useMutation({
    onSuccess: () => {
      toast.success("Report-Status aktualisiert");
      refetch();
    },
    onError: (error) => {
      toast.error(`Fehler: ${error.message}`);
    },
  });

  // Check if user is admin
  if (!user || (user.role !== 'admin' && user.role !== 'super_admin')) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf die Report-Verwaltung zuzugreifen.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  // Filter reports
  const filteredReports = reports?.filter((report) => {
    const matchesSearch = searchQuery === "" || 
      report.reporterName?.toLowerCase().includes(searchQuery.toLowerCase()) ||
      report.description?.toLowerCase().includes(searchQuery.toLowerCase());
    
    const matchesStatus = statusFilter === "all" || report.status === statusFilter;
    const matchesType = typeFilter === "all" || report.targetType === typeFilter;
    
    return matchesSearch && matchesStatus && matchesType;
  });

  const getStatusBadge = (status: string) => {
    const badges: Record<string, { label: string; className: string }> = {
      pending: { label: "Ausstehend", className: "bg-yellow-100 text-yellow-800" },
      reviewing: { label: "In Bearbeitung", className: "bg-blue-100 text-blue-800" },
      resolved: { label: "Gelöst", className: "bg-green-100 text-green-800" },
      dismissed: { label: "Abgelehnt", className: "bg-gray-100 text-gray-800" },
    };
    
    const badge = badges[status] || { label: status, className: "bg-gray-100 text-gray-800" };
    return <Badge className={badge.className}>{badge.label}</Badge>;
  };

  const getTypeBadge = (type: string) => {
    const badges: Record<string, { label: string; className: string }> = {
      user: { label: "Nutzer", className: "bg-purple-100 text-purple-800" },
      listing: { label: "Listing", className: "bg-blue-100 text-blue-800" },
      review: { label: "Bewertung", className: "bg-green-100 text-green-800" },
    };
    
    const badge = badges[type] || { label: type, className: "bg-gray-100 text-gray-800" };
    return <Badge variant="outline" className={badge.className}>{badge.label}</Badge>;
  };

  const getReasonLabel = (reason: string) => {
    const reasons: Record<string, string> = {
      spam: "Spam",
      inappropriate: "Unangemessener Inhalt",
      fraud: "Betrug",
      harassment: "Belästigung",
      fake: "Fake/Falsch",
      illegal: "Illegal",
      other: "Sonstiges",
    };
    return reasons[reason] || reason;
  };

  const handleStatusChange = (reportId: number, newStatus: 'pending' | 'reviewing' | 'resolved' | 'dismissed') => {
    updateStatusMutation.mutate({
      reportId,
      status: newStatus,
    });
  };

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/admin" label="Zurück zum Dashboard" />
      
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-4">
          <AlertTriangle className="h-8 w-8 text-purple-600" />
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Report-Verwaltung</h1>
            <p className="text-gray-600">Bearbeiten Sie Nutzer-Meldungen</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Gesamt</CardDescription>
            <CardTitle className="text-2xl">{reports?.length || 0}</CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Ausstehend</CardDescription>
            <CardTitle className="text-2xl text-yellow-600">
              {reports?.filter((r: Report) => r.status === 'pending').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>In Bearbeitung</CardDescription>
            <CardTitle className="text-2xl text-blue-600">
              {reports?.filter((r: Report) => r.status === 'reviewing').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Gelöst</CardDescription>
            <CardTitle className="text-2xl text-green-600">
              {reports?.filter((r: Report) => r.status === 'resolved').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
      </div>

      {/* Filters */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Filter className="h-5 w-5" />
            Filter & Suche
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label className="text-sm font-medium mb-2 block">Suche</label>
              <div className="relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" />
                <Input
                  placeholder="Reporter, Beschreibung..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className="pl-10"
                />
              </div>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Status</label>
              <Select value={statusFilter} onValueChange={setStatusFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle Status</SelectItem>
                  <SelectItem value="pending">Ausstehend</SelectItem>
                  <SelectItem value="reviewing">In Bearbeitung</SelectItem>
                  <SelectItem value="resolved">Gelöst</SelectItem>
                  <SelectItem value="dismissed">Abgelehnt</SelectItem>
                </SelectContent>
              </Select>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Typ</label>
              <Select value={typeFilter} onValueChange={setTypeFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle Typen</SelectItem>
                  <SelectItem value="user">Nutzer</SelectItem>
                  <SelectItem value="listing">Listing</SelectItem>
                  <SelectItem value="review">Bewertung</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
          
          <div className="mt-4 flex gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={() => {
                setSearchQuery("");
                setStatusFilter("all");
                setTypeFilter("all");
              }}
            >
              Zurücksetzen
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Reports List */}
      <div className="space-y-4">
        {filteredReports && filteredReports.length > 0 ? (
          filteredReports.map((report: Report) => (
            <Card key={report.id}>
              <CardContent className="pt-6">
                <div className="flex items-start justify-between mb-4">
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-2">
                      <h3 className="text-lg font-semibold">
                        Report #{report.id}
                      </h3>
                      {getStatusBadge(report.status)}
                    </div>
                    
                    <div className="space-y-2 text-sm text-gray-700">
                      <p><span className="font-medium">Grund:</span> {getReasonLabel(report.reason)}</p>
                      <p><span className="font-medium">Nachricht:</span> {report.message || 'Keine Nachricht'}</p>
                      <p><span className="font-medium">Reporter:</span> ID: {report.reporterId}</p>
                      <p><span className="font-medium">Ziel:</span> {report.reportedType} ID: {report.reportedId}</p>
                      <p><span className="font-medium">Erstellt:</span> {new Date(report.createdAt).toLocaleDateString('de-DE', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                      })}</p>
                      {report.reviewedAt && (
                        <p><span className="font-medium">Bearbeitet:</span> {new Date(report.reviewedAt).toLocaleDateString('de-DE', {
                          day: '2-digit',
                          month: '2-digit',
                          year: 'numeric',
                          hour: '2-digit',
                          minute: '2-digit'
                        })}</p>
                      )}
                    </div>
                  </div>
                  
                  <div className="flex flex-col gap-2">
                    {report.status === 'pending' && (
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() => handleStatusChange(report.id, 'reviewing')}
                        className="text-blue-600 border-blue-600 hover:bg-blue-50"
                      >
                        <Eye className="h-4 w-4 mr-1" />
                        Bearbeiten
                      </Button>
                    )}
                    
                    {report.status === 'pending' && (
                      <>
                        <Button
                          size="sm"
                          variant="outline"
                          onClick={() => handleStatusChange(report.id, 'resolved')}
                          className="text-green-600 border-green-600 hover:bg-green-50"
                        >
                          <CheckCircle className="h-4 w-4 mr-1" />
                          Lösen
                        </Button>
                        <Button
                          size="sm"
                          variant="outline"
                          onClick={() => handleStatusChange(report.id, 'dismissed')}
                          className="text-gray-600 border-gray-600 hover:bg-gray-50"
                        >
                          <XCircle className="h-4 w-4 mr-1" />
                          Ablehnen
                        </Button>
                      </>
                    )}
                    
                    {report.reportedType === 'listing' && (
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() => window.open(`/listing/${report.reportedId}`, '_blank')}
                      >
                        <Eye className="h-4 w-4 mr-1" />
                        Ansehen
                      </Button>
                    )}
                  </div>
                </div>
              </CardContent>
            </Card>
          ))
        ) : (
          <Card>
            <CardContent className="py-8">
              <p className="text-gray-500 text-center">Keine Reports gefunden</p>
            </CardContent>
          </Card>
        )}
      </div>
    </div>
  );
}

```

#### Schritt 5.x: AdminSecurity.tsx

**`client/src/components/AdminSecurity.tsx`**

```typescript
import { useState } from "react";
import { trpc } from "../lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "../components/ui/card";
import { Button } from "../components/ui/button";
import { Input } from "../components/ui/input";
import { Label } from "../components/ui/label";
import { Textarea } from "../components/ui/textarea";
import { Shield, Ban, CheckCircle, AlertTriangle } from "lucide-react";
import { useAuth } from "../_core/hooks/useAuth";

export default function AdminSecurity() {
  const { user } = useAuth();
  const [ipToBlock, setIpToBlock] = useState("");
  const [blockReason, setBlockReason] = useState("");

  // Queries
  const { data: suspiciousIPs, isLoading: loadingSuspicious, refetch: refetchSuspicious } = 
    trpc.admin.getSuspiciousIPs.useQuery();
  
  const { data: blockedIPs, isLoading: loadingBlocked, refetch: refetchBlocked } = 
    trpc.admin.getBlockedIPs.useQuery();

  // Mutations
  const blockIPMutation = trpc.admin.blockIP.useMutation({
    onSuccess: () => {
      alert("IP erfolgreich blockiert!");
      setIpToBlock("");
      setBlockReason("");
      refetchBlocked();
      refetchSuspicious();
    },
    onError: (error) => {
      alert(`Fehler beim Blockieren: ${error.message}`);
    },
  });

  const unblockIPMutation = trpc.admin.unblockIP.useMutation({
    onSuccess: () => {
      alert("IP erfolgreich entsperrt!");
      refetchBlocked();
    },
    onError: (error) => {
      alert(`Fehler beim Entsperren: ${error.message}`);
    },
  });

  const handleBlockIP = (ip: string, reason?: string) => {
    if (!confirm(`Möchten Sie die IP ${ip} wirklich blockieren?`)) return;
    blockIPMutation.mutate({ ipAddress: ip, reason: reason || blockReason });
  };

  const handleUnblockIP = (ip: string) => {
    if (!confirm(`Möchten Sie die IP ${ip} wirklich entsperren?`)) return;
    unblockIPMutation.mutate({ ipAddress: ip });
  };

  // Check if user is super admin
  if (!user || user.role !== 'super_admin') {
    return (
      <div className="container mx-auto py-8">
        <Card>
          <CardContent className="pt-6">
            <p className="text-red-600">Zugriff verweigert. Nur Super-Admins können diese Seite sehen.</p>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="container mx-auto py-8 space-y-6">
      <h1 className="text-3xl font-bold flex items-center gap-2">
        <Shield className="h-8 w-8" />
        Sicherheit & IP-Verwaltung
      </h1>

      {/* Manual IP Blocking */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Ban className="h-5 w-5" />
            IP manuell blockieren
          </CardTitle>
          <CardDescription>Blockiere eine IP-Adresse manuell</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <Label htmlFor="ipToBlock">IP-Adresse</Label>
            <Input
              id="ipToBlock"
              type="text"
              value={ipToBlock}
              onChange={(e) => setIpToBlock(e.target.value)}
              placeholder="192.168.1.1"
            />
          </div>
          <div>
            <Label htmlFor="blockReason">Grund (optional)</Label>
            <Textarea
              id="blockReason"
              value={blockReason}
              onChange={(e) => setBlockReason(e.target.value)}
              placeholder="Zu viele Login-Versuche, Spam, etc."
              rows={3}
            />
          </div>
          <Button
            onClick={() => handleBlockIP(ipToBlock)}
            disabled={!ipToBlock || blockIPMutation.isPending}
            variant="destructive"
          >
            <Ban className="h-4 w-4 mr-1" />
            IP blockieren
          </Button>
        </CardContent>
      </Card>

      {/* Suspicious IPs */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <AlertTriangle className="h-5 w-5 text-yellow-600" />
            Verdächtige IPs (letzte 24 Stunden)
          </CardTitle>
          <CardDescription>IPs mit vielen Login-Versuchen</CardDescription>
        </CardHeader>
        <CardContent>
          {loadingSuspicious ? (
            <p>Lade Daten...</p>
          ) : !suspiciousIPs || suspiciousIPs.length === 0 ? (
            <p className="text-gray-600">Keine verdächtigen IPs gefunden.</p>
          ) : (
            <div className="space-y-4">
              {suspiciousIPs.map((item) => (
                <div
                  key={item.ipAddress}
                  className="flex items-center justify-between p-4 border rounded-lg"
                >
                  <div>
                    <p className="font-semibold">{item.ipAddress}</p>
                    <p className="text-sm text-gray-600">
                      {item.attemptCount} Versuche | Letzter Versuch: {new Date(item.lastAttempt).toLocaleString('de-DE')}
                    </p>
                  </div>
                  <Button
                    onClick={() => handleBlockIP(item.ipAddress, `Zu viele Login-Versuche (${item.attemptCount})`)}
                    disabled={blockIPMutation.isPending}
                    variant="destructive"
                    size="sm"
                  >
                    <Ban className="h-4 w-4 mr-1" />
                    Blockieren
                  </Button>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>

      {/* Blocked IPs */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Ban className="h-5 w-5 text-red-600" />
            Blockierte IPs
          </CardTitle>
          <CardDescription>Aktuell gesperrte IP-Adressen</CardDescription>
        </CardHeader>
        <CardContent>
          {loadingBlocked ? (
            <p>Lade Daten...</p>
          ) : !blockedIPs || blockedIPs.length === 0 ? (
            <p className="text-gray-600">Keine blockierten IPs vorhanden.</p>
          ) : (
            <div className="space-y-4">
              {blockedIPs.map((item) => (
                <div
                  key={item.id}
                  className="flex items-center justify-between p-4 border rounded-lg"
                >
                  <div>
                    <p className="font-semibold">{item.ipAddress}</p>
                    <p className="text-sm text-gray-600">
                      Blockiert am: {new Date(item.blockedAt).toLocaleString('de-DE')}
                    </p>
                    {item.reason && (
                      <p className="text-sm text-gray-600 mt-1">
                        Grund: {item.reason}
                      </p>
                    )}
                  </div>
                  <Button
                    onClick={() => handleUnblockIP(item.ipAddress)}
                    disabled={unblockIPMutation.isPending}
                    variant="outline"
                    size="sm"
                    className="text-green-600 border-green-600 hover:bg-green-50"
                  >
                    <CheckCircle className="h-4 w-4 mr-1" />
                    Entsperren
                  </Button>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: AdminSettings.tsx

**`client/src/components/AdminSettings.tsx`**

```typescript
import { useState, useEffect } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Settings, Save, DollarSign, Image, TrendingUp, AlertTriangle } from "lucide-react";
import BackButton from "@/components/BackButton";
import { toast } from "sonner";

export default function AdminSettings() {
  const { user } = useAuth();
  const { data: settings, refetch } = trpc.admin.getSystemSettings.useQuery(undefined, { staleTime: 300000 });
  
  // All useState initialized with empty strings - values loaded from database
  const [platformFee, setPlatformFee] = useState("");
  const [maxImages, setMaxImages] = useState("");
  const [maxPrice, setMaxPrice] = useState("");
  const [maintenanceMode, setMaintenanceMode] = useState("");
  
  // New critical settings
  const [minPrice, setMinPrice] = useState("");
  const [maxActiveListings, setMaxActiveListings] = useState("");
  const [imageMaxSize, setImageMaxSize] = useState("");
  const [minAge, setMinAge] = useState("");
  const [reviewWindow, setReviewWindow] = useState("");
  const [warningThreshold, setWarningThreshold] = useState("");
  const [suspensionMaxDays, setSuspensionMaxDays] = useState("");
  const [registrationEnabled, setRegistrationEnabled] = useState("");
  
  // Rate limiting settings
  const [maxLoginAttemptsPerIP, setMaxLoginAttemptsPerIP] = useState("");
  const [maxLoginAttemptsPerUser, setMaxLoginAttemptsPerUser] = useState("");
  const [loginLockoutDuration, setLoginLockoutDuration] = useState("");
  const [loginRateLimitWindow, setLoginRateLimitWindow] = useState("");
  
  // Update mutation
  const updateSettingMutation = trpc.admin.updateSystemSetting.useMutation({
    onSuccess: () => {
      toast.success("Einstellung erfolgreich aktualisiert");
      refetch();
    },
    onError: (error) => {
      toast.error(`Fehler: ${error.message}`);
    },
  });

  // Load settings from database
  useEffect(() => {
    if (settings) {
      settings.forEach((setting: { key: string; value: string }) => {
        switch (setting.key) {
          case 'platform_fee_fixed':
            setPlatformFee(setting.value);
            break;
          case 'max_listing_images':
            setMaxImages(setting.value);
            break;
          case 'max_listing_price':
            setMaxPrice(setting.value);
            break;
          case 'maintenance_mode':
            setMaintenanceMode(setting.value);
            break;
          case 'min_listing_price':
            setMinPrice(setting.value);
            break;
          case 'max_active_listings_per_user':
            setMaxActiveListings(setting.value);
            break;
          case 'image_max_size_mb':
            setImageMaxSize(setting.value);
            break;
          case 'min_age_requirement':
            setMinAge(setting.value);
            break;
          case 'review_window_days':
            setReviewWindow(setting.value);
            break;
          case 'warning_threshold':
            setWarningThreshold(setting.value);
            break;
          case 'suspension_max_days':
            setSuspensionMaxDays(setting.value);
            break;
          case 'registration_enabled':
            setRegistrationEnabled(setting.value);
            break;
          case 'max_login_attempts_per_ip':
            setMaxLoginAttemptsPerIP(setting.value);
            break;
          case 'max_login_attempts_per_user':
            setMaxLoginAttemptsPerUser(setting.value);
            break;
          case 'login_lockout_duration_minutes':
            setLoginLockoutDuration(setting.value);
            break;
          case 'login_rate_limit_window_minutes':
            setLoginRateLimitWindow(setting.value);
            break;
        }
      });
    }
  }, [settings]);

  // Check if user is super admin
  if (!user || user.role !== 'super_admin') {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf die System-Einstellungen zuzugreifen. Nur Super-Admins können System-Einstellungen ändern.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  const handleSaveSetting = (key: string, value: string) => {
    updateSettingMutation.mutate({ key, value });
  };

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/admin" label="Zurück zum Dashboard" />
      
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-4">
          <Settings className="h-8 w-8 text-gray-600" />
          <div>
            <h1 className="text-3xl font-bold text-gray-900">System-Einstellungen</h1>
            <p className="text-gray-600">Konfigurieren Sie plattformweite Einstellungen (nur Super Admin)</p>
          </div>
        </div>
      </div>

      {/* Warning */}
      <Card className="mb-6 border-yellow-200 bg-yellow-50">
        <CardContent className="pt-6">
          <div className="flex items-start gap-3">
            <AlertTriangle className="h-5 w-5 text-yellow-600 mt-0.5" />
            <div>
              <h3 className="font-semibold text-yellow-800 mb-1">Vorsicht bei Änderungen</h3>
              <p className="text-sm text-yellow-700">
                Änderungen an diesen Einstellungen wirken sich auf die gesamte Plattform aus. 
                Bitte überprüfen Sie alle Werte sorgfältig, bevor Sie sie speichern.
              </p>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Platform Fees */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <DollarSign className="h-5 w-5" />
            Plattformgebühren
          </CardTitle>
          <CardDescription>Konfigurieren Sie die Gebührenstruktur</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <Label htmlFor="platformFee">Plattformgebühr (€)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="platformFee"
                type="number"
                step="0.01"
                min="0"
                max="1000"
                value={platformFee}
                onChange={(e) => setPlatformFee(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('platform_fee_fixed', platformFee)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: €{parseFloat(platformFee).toFixed(2)} feste Gebühr pro Transaktion
            </p>
          </div>
        </CardContent>
      </Card>

      {/* Listing Limits */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <TrendingUp className="h-5 w-5" />
            Listing-Limits
          </CardTitle>
          <CardDescription>Maximale Werte für Listings</CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          <div>
            <Label htmlFor="maxImages">Maximale Anzahl Bilder pro Listing</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="maxImages"
                type="number"
                min="1"
                max="50"
                value={maxImages}
                onChange={(e) => setMaxImages(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('max_listing_images', maxImages)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: {maxImages} Bilder
            </p>
          </div>

          <div>
            <Label htmlFor="minPrice">Minimaler Listing-Preis (€)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="minPrice"
                type="number"
                step="0.01"
                min="0"
                max="1000"
                value={minPrice}
                onChange={(e) => setMinPrice(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('min_listing_price', minPrice)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: €{parseFloat(minPrice).toFixed(2)} (verhindert Spam-Listings)
            </p>
          </div>

          <div>
            <Label htmlFor="maxPrice">Maximaler Listing-Preis (€)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="maxPrice"
                type="number"
                min="1"
                max="100000"
                value={maxPrice}
                onChange={(e) => setMaxPrice(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('max_listing_price', maxPrice)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: €{maxPrice}
            </p>
          </div>

          <div>
            <Label htmlFor="maxActiveListings">Max. aktive Listings pro Nutzer</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="maxActiveListings"
                type="number"
                min="1"
                max="1000"
                value={maxActiveListings}
                onChange={(e) => setMaxActiveListings(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('max_active_listings_per_user', maxActiveListings)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: {maxActiveListings} Listings (Spam-Schutz & Performance)
            </p>
          </div>
        </CardContent>
      </Card>

      {/* System Settings */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Settings className="h-5 w-5" />
            System-Einstellungen
          </CardTitle>
          <CardDescription>Technische Limits und Moderation</CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          <div>
            <Label htmlFor="imageMaxSize">Max. Bildgröße (MB)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="imageMaxSize"
                type="number"
                min="1"
                max="50"
                value={imageMaxSize}
                onChange={(e) => setImageMaxSize(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('image_max_size_mb', imageMaxSize)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: {imageMaxSize} MB (Performance & Storage)
            </p>
          </div>

          <div>
            <Label htmlFor="warningThreshold">Verwarnungs-Schwelle</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="warningThreshold"
                type="number"
                min="1"
                max="10"
                value={warningThreshold}
                onChange={(e) => setWarningThreshold(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('warning_threshold', warningThreshold)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: {warningThreshold} Verwarnungen vor automatischer Sperrung
            </p>
          </div>

          <div>
            <Label htmlFor="suspensionMaxDays">Max. Sperrdauer (Tage)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="suspensionMaxDays"
                type="number"
                min="1"
                max="3650"
                value={suspensionMaxDays}
                onChange={(e) => setSuspensionMaxDays(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('suspension_max_days', suspensionMaxDays)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: {suspensionMaxDays} Tage maximale Sperrung
            </p>
          </div>
        </CardContent>
      </Card>

      {/* Legal & Business Settings */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <AlertTriangle className="h-5 w-5" />
            Rechtliche & Geschäfts-Einstellungen
          </CardTitle>
          <CardDescription>Altersbeschränkungen und Bewertungsfenster</CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          <div>
            <Label htmlFor="minAge">Mindestalter</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="minAge"
                type="number"
                min="16"
                max="21"
                value={minAge}
                onChange={(e) => setMinAge(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('min_age_requirement', minAge)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: {minAge} Jahre (gesetzliche Anforderung)
            </p>
          </div>

          <div>
            <Label htmlFor="reviewWindow">Bewertungsfenster (Tage)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="reviewWindow"
                type="number"
                min="1"
                max="365"
                value={reviewWindow}
                onChange={(e) => setReviewWindow(e.target.value)}
                className="max-w-xs"
              />
              <Button
                onClick={() => handleSaveSetting('review_window_days', reviewWindow)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-2">
              Aktuell: {reviewWindow} Tage nach Kauf können Bewertungen abgegeben werden
            </p>
          </div>
        </CardContent>
      </Card>

      {/* Feature Toggles */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Settings className="h-5 w-5" />
            Feature-Toggles
          </CardTitle>
          <CardDescription>Aktivieren oder deaktivieren Sie Plattform-Features</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="flex items-center justify-between p-4 border rounded-lg">
            <div>
              <h3 className="font-semibold mb-1">Registrierung</h3>
              <p className="text-sm text-gray-600">
                Status: <span className={registrationEnabled === 'true' ? 'text-green-600 font-semibold' : 'text-red-600 font-semibold'}>
                  {registrationEnabled === 'true' ? 'Aktiv' : 'Deaktiviert'}
                </span>
              </p>
            </div>
            <div className="flex gap-2">
              {registrationEnabled === 'true' ? (
                <Button
                  variant="destructive"
                  onClick={() => {
                    if (confirm("Möchten Sie neue Registrierungen wirklich deaktivieren?")) {
                      handleSaveSetting('registration_enabled', 'false');
                      setRegistrationEnabled('false');
                    }
                  }}
                  disabled={updateSettingMutation.isPending}
                >
                  <AlertTriangle className="h-4 w-4 mr-1" />
                  Deaktivieren
                </Button>
              ) : (
                <Button
                  variant="outline"
                  onClick={() => {
                    handleSaveSetting('registration_enabled', 'true');
                    setRegistrationEnabled('true');
                  }}
                  disabled={updateSettingMutation.isPending}
                  className="text-green-600 border-green-600 hover:bg-green-50"
                >
                  <Save className="h-4 w-4 mr-1" />
                  Aktivieren
                </Button>
              )}
            </div>
          </div>
          <p className="text-sm text-gray-600 mt-4">
            <strong>Hinweis:</strong> Wenn deaktiviert, können sich keine neuen Nutzer registrieren. 
            Bestehende Nutzer können sich weiterhin anmelden.
          </p>
        </CardContent>
      </Card>

      {/* Rate Limiting / Login Security */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Settings className="h-5 w-5" />
            Login-Sicherheit & Rate Limiting
          </CardTitle>
          <CardDescription>Schutz vor Brute-Force-Angriffen und zu vielen Login-Versuchen</CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          {/* Max Login Attempts per IP */}
          <div>
            <Label htmlFor="maxLoginAttemptsPerIP">Max. Login-Versuche pro IP</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="maxLoginAttemptsPerIP"
                type="number"
                value={maxLoginAttemptsPerIP}
                onChange={(e) => setMaxLoginAttemptsPerIP(e.target.value)}
                placeholder="10"
              />
              <Button
                onClick={() => handleSaveSetting('max_login_attempts_per_ip', maxLoginAttemptsPerIP)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-1">
              Maximale Anzahl an Login-Versuchen von derselben IP-Adresse im Zeitfenster. Empfohlen: 10
            </p>
          </div>

          {/* Max Login Attempts per User */}
          <div>
            <Label htmlFor="maxLoginAttemptsPerUser">Max. Login-Versuche pro User</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="maxLoginAttemptsPerUser"
                type="number"
                value={maxLoginAttemptsPerUser}
                onChange={(e) => setMaxLoginAttemptsPerUser(e.target.value)}
                placeholder="5"
              />
              <Button
                onClick={() => handleSaveSetting('max_login_attempts_per_user', maxLoginAttemptsPerUser)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-1">
              Maximale Anzahl an Login-Versuchen pro User im Zeitfenster. Empfohlen: 5
            </p>
          </div>

          {/* Lockout Duration */}
          <div>
            <Label htmlFor="loginLockoutDuration">Sperrdauer (Minuten)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="loginLockoutDuration"
                type="number"
                value={loginLockoutDuration}
                onChange={(e) => setLoginLockoutDuration(e.target.value)}
                placeholder="30"
              />
              <Button
                onClick={() => handleSaveSetting('login_lockout_duration_minutes', loginLockoutDuration)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-1">
              Dauer der temporären Sperrung nach Überschreitung der Limits. Empfohlen: 30 Minuten
            </p>
          </div>

          {/* Rate Limit Window */}
          <div>
            <Label htmlFor="loginRateLimitWindow">Zeitfenster (Minuten)</Label>
            <div className="flex gap-2 mt-2">
              <Input
                id="loginRateLimitWindow"
                type="number"
                value={loginRateLimitWindow}
                onChange={(e) => setLoginRateLimitWindow(e.target.value)}
                placeholder="15"
              />
              <Button
                onClick={() => handleSaveSetting('login_rate_limit_window_minutes', loginRateLimitWindow)}
                disabled={updateSettingMutation.isPending}
              >
                <Save className="h-4 w-4 mr-1" />
                Speichern
              </Button>
            </div>
            <p className="text-sm text-gray-600 mt-1">
              Zeitfenster für die Zählung der Login-Versuche. Empfohlen: 15 Minuten
            </p>
          </div>

          <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4">
            <p className="text-sm text-blue-800">
              <strong>Beispiel:</strong> Mit den Standardwerten (10/5/30/15) wird eine IP nach 10 Login-Versuchen in 15 Minuten 
              für 30 Minuten gesperrt. Ein User wird nach 5 Versuchen in 15 Minuten für 30 Minuten gesperrt.
            </p>
          </div>
        </CardContent>
      </Card>

      {/* Maintenance Mode */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <AlertTriangle className="h-5 w-5" />
            Wartungsmodus
          </CardTitle>
          <CardDescription>Plattform für Wartungsarbeiten deaktivieren</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="flex items-center justify-between p-4 border rounded-lg">
            <div>
              <h3 className="font-semibold mb-1">Wartungsmodus</h3>
              <p className="text-sm text-gray-600">
                Status: <span className={maintenanceMode === 'true' ? 'text-red-600 font-semibold' : 'text-green-600 font-semibold'}>
                  {maintenanceMode === 'true' ? 'AKTIV' : 'Inaktiv'}
                </span>
              </p>
            </div>
            <div className="flex gap-2">
              {maintenanceMode === 'false' ? (
                <Button
                  variant="destructive"
                  onClick={() => {
                    if (confirm("Möchten Sie den Wartungsmodus wirklich aktivieren? Die Plattform wird für normale Nutzer nicht mehr zugänglich sein.")) {
                      handleSaveSetting('maintenance_mode', 'true');
                      setMaintenanceMode('true');
                    }
                  }}
                  disabled={updateSettingMutation.isPending}
                >
                  <AlertTriangle className="h-4 w-4 mr-1" />
                  Aktivieren
                </Button>
              ) : (
                <Button
                  variant="outline"
                  onClick={() => {
                    handleSaveSetting('maintenance_mode', 'false');
                    setMaintenanceMode('false');
                  }}
                  disabled={updateSettingMutation.isPending}
                  className="text-green-600 border-green-600 hover:bg-green-50"
                >
                  <Save className="h-4 w-4 mr-1" />
                  Deaktivieren
                </Button>
              )}
            </div>
          </div>
          <p className="text-sm text-gray-600 mt-4">
            <strong>Hinweis:</strong> Im Wartungsmodus können nur Super-Admins auf die Plattform zugreifen. 
            Alle anderen Nutzer sehen eine Wartungsseite.
          </p>
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: AdminStats.tsx

**`client/src/components/AdminStats.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import { trpc } from "@/lib/trpc";
import type { Listing, Transaction } from "@/../../shared/types";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { BarChart3, TrendingUp, Users, Package, DollarSign, Star } from "lucide-react";
import BackButton from "@/components/BackButton";

export default function AdminStats() {
  const { user } = useAuth();
  const { data: listings } = trpc.listing.getAll.useQuery(undefined, { staleTime: 60000 });
  const { data: transactions } = trpc.transaction.getAll.useQuery(undefined, { staleTime: 60000 });
  
  const [timeRange, setTimeRange] = useState<string>("month");

  // Check if user is admin
  if (!user || (user.role !== 'admin' && user.role !== 'super_admin')) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf die Statistiken zuzugreifen.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  // Calculate stats
  const totalRevenue = transactions?.reduce((sum: number, tx: Transaction) => 
    tx.status === 'completed' ? sum + (Number(tx.totalAmount) || 0) : sum, 0) || 0;
  
  const totalFees = transactions?.reduce((sum: number, tx: Transaction) => 
    tx.status === 'completed' ? sum + (Number(tx.platformFee) || 0) : sum, 0) || 0;

  const activeListings = listings?.filter((l: Listing) => l.status === 'active').length || 0;
  const soldListings = listings?.filter((l: Listing) => l.status === 'sold').length || 0;

  // Calculate conversion rate
  const conversionRate = listings && listings.length > 0 
    ? ((soldListings / listings.length) * 100).toFixed(1) 
    : '0.0';

  // Get top strains
  const strainCounts: Record<string, number> = {};
  listings?.forEach((listing: Listing) => {
    if (listing.strain) {
      strainCounts[listing.strain] = (strainCounts[listing.strain] || 0) + 1;
    }
  });
  const topStrains = Object.entries(strainCounts)
    .sort(([, a], [, b]) => b - a)
    .slice(0, 10);

  // Get top price types
  const priceTypeCounts: Record<string, number> = {
    fixed: 0,
    auction: 0,
    offer: 0,
  };
  listings?.forEach((listing: Listing) => {
    if (listing.priceType) {
      priceTypeCounts[listing.priceType]++;
    }
  });

  // Calculate average listing price
  const avgPrice = listings && listings.length > 0
    ? (listings.reduce((sum: number, l: Listing) => sum + (parseFloat(l.fixedPrice || l.auctionStartPrice || "0")), 0) / listings.length).toFixed(2)
    : '0.00';

  // Get recent transactions (last 30 days)
  const thirtyDaysAgo = new Date();
  thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
  const recentTransactions = transactions?.filter((tx: Transaction) => 
    new Date(tx.createdAt) > thirtyDaysAgo
  ) || [];

  const recentRevenue = recentTransactions.reduce((sum: number, tx: Transaction) => 
    tx.status === 'completed' ? sum + (Number(tx.totalAmount) || 0) : sum, 0);

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/admin" label="Zurück zum Dashboard" />
      
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div className="flex items-center gap-3">
            <BarChart3 className="h-8 w-8 text-cyan-600" />
            <div>
              <h1 className="text-3xl font-bold text-gray-900">Statistiken & Analytics</h1>
              <p className="text-gray-600">Detaillierte Plattform-Statistiken</p>
            </div>
          </div>
          
          <Select value={timeRange} onValueChange={setTimeRange}>
            <SelectTrigger className="w-[180px]">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="week">Diese Woche</SelectItem>
              <SelectItem value="month">Dieser Monat</SelectItem>
              <SelectItem value="year">Dieses Jahr</SelectItem>
              <SelectItem value="all">Gesamt</SelectItem>
            </SelectContent>
          </Select>
        </div>
      </div>

      {/* Revenue Stats */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <Card>
          <CardHeader className="pb-3">
            <CardDescription className="flex items-center gap-1">
              <DollarSign className="h-4 w-4" />
              Gesamtumsatz
            </CardDescription>
            <CardTitle className="text-2xl text-green-600">
              €{totalRevenue.toFixed(2)}
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-xs text-gray-600">
              Letzte 30 Tage: €{recentRevenue.toFixed(2)}
            </p>
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader className="pb-3">
            <CardDescription className="flex items-center gap-1">
              <TrendingUp className="h-4 w-4" />
              Plattformgebühren
            </CardDescription>
            <CardTitle className="text-2xl text-blue-600">
              €{totalFees.toFixed(2)}
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-xs text-gray-600">
              {totalRevenue > 0 ? ((totalFees / totalRevenue) * 100).toFixed(1) : '0'}% vom Umsatz
            </p>
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader className="pb-3">
            <CardDescription className="flex items-center gap-1">
              <Package className="h-4 w-4" />
              Conversion Rate
            </CardDescription>
            <CardTitle className="text-2xl text-purple-600">
              {conversionRate}%
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-xs text-gray-600">
              {soldListings} von {listings?.length || 0} verkauft
            </p>
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader className="pb-3">
            <CardDescription className="flex items-center gap-1">
              <Star className="h-4 w-4" />
              Ø Listing-Preis
            </CardDescription>
            <CardTitle className="text-2xl text-orange-600">
              €{avgPrice}
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-xs text-gray-600">
              Über alle Listings
            </p>
          </CardContent>
        </Card>
      </div>

      {/* Listing Stats */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Package className="h-5 w-5" />
              Listing-Statistiken
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              <div className="flex items-center justify-between">
                <span className="text-sm font-medium">Aktive Listings</span>
                <span className="text-lg font-bold text-green-600">{activeListings}</span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-sm font-medium">Verkaufte Listings</span>
                <span className="text-lg font-bold text-blue-600">{soldListings}</span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-sm font-medium">Entwurf</span>
                <span className="text-lg font-bold text-gray-600">
                  {listings?.filter((l: Listing) => l.status === 'draft').length || 0}
                </span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-sm font-medium">Gesamt</span>
                <span className="text-lg font-bold">{listings?.length || 0}</span>
              </div>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <TrendingUp className="h-5 w-5" />
              Preistyp-Verteilung
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              <div className="flex items-center justify-between">
                <span className="text-sm font-medium">Festpreis</span>
                <span className="text-lg font-bold text-blue-600">{priceTypeCounts.fixed}</span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-sm font-medium">Auktionen</span>
                <span className="text-lg font-bold text-purple-600">{priceTypeCounts.auction}</span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-sm font-medium">Preisvorschläge</span>
                <span className="text-lg font-bold text-green-600">{priceTypeCounts.offer}</span>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Top Strains */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Star className="h-5 w-5" />
            Top 10 Strains
          </CardTitle>
          <CardDescription>Beliebteste Strains nach Anzahl der Listings</CardDescription>
        </CardHeader>
        <CardContent>
          {topStrains.length > 0 ? (
            <div className="space-y-3">
              {topStrains.map(([strain, count], index) => (
                <div key={strain} className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <span className="text-lg font-bold text-gray-400 w-6">#{index + 1}</span>
                    <span className="font-medium">{strain}</span>
                  </div>
                  <span className="text-sm text-gray-600">{count} Listings</span>
                </div>
              ))}
            </div>
          ) : (
            <p className="text-gray-500 text-center py-4">Keine Daten verfügbar</p>
          )}
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: AdminTransactions.tsx

**`client/src/components/AdminTransactions.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import type { Transaction } from "@/../../shared/types";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { CreditCard, Search, Filter, TrendingUp, DollarSign } from "lucide-react";
import BackButton from "@/components/BackButton";

export default function AdminTransactions() {
  const { user } = useAuth();
  const { data: transactions } = trpc.transaction.getAll.useQuery(undefined, { staleTime: 60000 });
  
  const [searchQuery, setSearchQuery] = useState("");
  const [statusFilter, setStatusFilter] = useState<string>("all");
  const [dateFilter, setDateFilter] = useState<string>("all");

  // Check if user is admin
  if (!user || (user.role !== 'admin' && user.role !== 'super_admin')) {
    return (
      <div className="container mx-auto px-4 py-8">
        <Card className="border-red-200 bg-red-50">
          <CardHeader>
            <CardTitle className="text-red-800">Zugriff verweigert</CardTitle>
            <CardDescription className="text-red-600">
              Sie haben keine Berechtigung, auf die Transaktions-Überwachung zuzugreifen.
            </CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  // Filter transactions
  const filteredTransactions = transactions?.filter((tx: Transaction) => {
    const matchesSearch = searchQuery === "" || 
      tx.id.toString().includes(searchQuery) ||
      tx.listingId.toString().includes(searchQuery);
    
    const matchesStatus = statusFilter === "all" || tx.status === statusFilter;
    
    let matchesDate = true;
    if (dateFilter !== "all") {
      const txDate = new Date(tx.createdAt);
      const now = new Date();
      const daysDiff = Math.floor((now.getTime() - txDate.getTime()) / (1000 * 60 * 60 * 24));
      
      switch (dateFilter) {
        case "today":
          matchesDate = daysDiff === 0;
          break;
        case "week":
          matchesDate = daysDiff <= 7;
          break;
        case "month":
          matchesDate = daysDiff <= 30;
          break;
      }
    }
    
    return matchesSearch && matchesStatus && matchesDate;
  });

  // Calculate stats
  const totalRevenue = transactions?.reduce((sum: number, tx: Transaction) => 
    tx.status === 'completed' ? sum + (Number(tx.totalAmount) || 0) : sum, 0) || 0;
  
  const totalFees = transactions?.reduce((sum: number, tx: Transaction) => 
    tx.status === 'completed' ? sum + (Number(tx.platformFee) || 0) : sum, 0) || 0;

  const getStatusBadge = (status: string) => {
    const badges: Record<string, { label: string; className: string }> = {
      pending: { label: "Ausstehend", className: "bg-yellow-100 text-yellow-800" },
      completed: { label: "Abgeschlossen", className: "bg-green-100 text-green-800" },
      cancelled: { label: "Storniert", className: "bg-gray-100 text-gray-800" },
      refunded: { label: "Erstattet", className: "bg-blue-100 text-blue-800" },
    };
    
    const badge = badges[status] || { label: status, className: "bg-gray-100 text-gray-800" };
    return <Badge className={badge.className}>{badge.label}</Badge>;
  };

  return (
    <div className="container mx-auto px-4 py-8">
      <BackButton href="/admin" label="Zurück zum Dashboard" />
      
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-4">
          <CreditCard className="h-8 w-8 text-blue-600" />
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Transaktions-Überwachung</h1>
            <p className="text-gray-600">Überwachen Sie alle Zahlungen und Gebühren</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <Card>
          <CardHeader className="pb-3">
            <CardDescription className="flex items-center gap-1">
              <DollarSign className="h-4 w-4" />
              Gesamtumsatz
            </CardDescription>
            <CardTitle className="text-2xl text-green-600">
              €{totalRevenue.toFixed(2)}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription className="flex items-center gap-1">
              <TrendingUp className="h-4 w-4" />
              Plattformgebühren
            </CardDescription>
            <CardTitle className="text-2xl text-blue-600">
              €{totalFees.toFixed(2)}
            </CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Transaktionen</CardDescription>
            <CardTitle className="text-2xl">{transactions?.length || 0}</CardTitle>
          </CardHeader>
        </Card>
        <Card>
          <CardHeader className="pb-3">
            <CardDescription>Abgeschlossen</CardDescription>
            <CardTitle className="text-2xl text-green-600">
              {transactions?.filter((t: Transaction) => t.status === 'completed').length || 0}
            </CardTitle>
          </CardHeader>
        </Card>
      </div>

      {/* Filters */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Filter className="h-5 w-5" />
            Filter & Suche
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label className="text-sm font-medium mb-2 block">Suche</label>
              <div className="relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" />
                <Input
                  placeholder="Transaktions-ID, Listing..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className="pl-10"
                />
              </div>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Status</label>
              <Select value={statusFilter} onValueChange={setStatusFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle Status</SelectItem>
                  <SelectItem value="pending">Ausstehend</SelectItem>
                  <SelectItem value="completed">Abgeschlossen</SelectItem>
                  <SelectItem value="cancelled">Storniert</SelectItem>
                  <SelectItem value="refunded">Erstattet</SelectItem>
                </SelectContent>
              </Select>
            </div>
            
            <div>
              <label className="text-sm font-medium mb-2 block">Zeitraum</label>
              <Select value={dateFilter} onValueChange={setDateFilter}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Alle</SelectItem>
                  <SelectItem value="today">Heute</SelectItem>
                  <SelectItem value="week">Diese Woche</SelectItem>
                  <SelectItem value="month">Dieser Monat</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
          
          <div className="mt-4 flex gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={() => {
                setSearchQuery("");
                setStatusFilter("all");
                setDateFilter("all");
              }}
            >
              Zurücksetzen
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Transactions List */}
      <Card>
        <CardHeader>
          <CardTitle>Transaktionen ({filteredTransactions?.length || 0})</CardTitle>
        </CardHeader>
        <CardContent>
          {filteredTransactions && filteredTransactions.length > 0 ? (
            <div className="space-y-4">
              {filteredTransactions.map((tx: Transaction) => (
                <div key={tx.id} className="border rounded-lg p-4 hover:bg-gray-50 transition">
                  <div className="flex items-start justify-between mb-3">
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-2">
                        <h3 className="font-semibold">{tx.listingTitle || 'Unbekanntes Listing'}</h3>
                        {getStatusBadge(tx.status)}
                      </div>
                      <div className="text-sm text-gray-600 space-y-1">
                        <p>Transaktions-ID: {tx.id}</p>
                        <p>Käufer-ID: {tx.buyerId} | Verkäufer-ID: {tx.sellerId}</p>
                        <p>Listing-ID: {tx.listingId}</p>
                        <p>Datum: {new Date(tx.createdAt).toLocaleDateString('de-DE', {
                          day: '2-digit',
                          month: '2-digit',
                          year: 'numeric',
                          hour: '2-digit',
                          minute: '2-digit'
                        })}</p>
                      </div>
                    </div>
                    
                    <div className="text-right">
                      <div className="mb-2">
                        <p className="text-sm text-gray-600">Gesamtbetrag</p>
                        <p className="text-lg font-bold text-gray-900">
                          €{(tx.totalAmount || 0).toFixed(2)}
                        </p>
                      </div>
                      <div className="text-sm text-gray-600 space-y-1">
                        <p>Artikel: €{(tx.itemPrice || 0).toFixed(2)}</p>
                        <p>Versand: €{(tx.shippingCost || 0).toFixed(2)}</p>
                        <p className="text-blue-600 font-medium">
                          Gebühr: €{(tx.platformFee || 0).toFixed(2)}
                        </p>
                        <p className="text-green-600 font-medium">
                          Verkäufer: €{((tx.totalAmount || 0) - (tx.platformFee || 0)).toFixed(2)}
                        </p>
                      </div>
                    </div>
                  </div>
                  
                  {tx.paypalOrderId && (
                    <div className="text-xs text-gray-500 border-t pt-2">
                      PayPal Order ID: {tx.paypalOrderId}
                    </div>
                  )}
                </div>
              ))}
            </div>
          ) : (
            <p className="text-gray-500 text-center py-8">Keine Transaktionen gefunden</p>
          )}
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: AdminUsers.tsx

**`client/src/components/AdminUsers.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import type { User, Warning, WarningReason } from "@/../../shared/types";
import { trpc } from "@/lib/trpc";
import { toast } from "sonner";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { 
  Users, 
  Search,
  AlertTriangle,
  Ban,
  UserX,
  Shield,
  CheckCircle,
  Clock
} from "lucide-react";
import { Link } from "wouter";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";

export default function AdminUsers() {
  const { user } = useAuth();
  const utils = trpc.useUtils();
  const { data: users, refetch } = trpc.admin.getAllUsers.useQuery(undefined, { staleTime: 60000 });
  
  const [selectedUserId, setSelectedUserId] = useState<number | null>(null);
  const { data: userWarnings, refetch: refetchWarnings } = trpc.admin.getUserWarnings.useQuery(
    selectedUserId!,
    { enabled: selectedUserId !== null }
  );
  
  const [searchQuery, setSearchQuery] = useState("");
  const [roleFilter, setRoleFilter] = useState<string>("all");
  const [statusFilter, setStatusFilter] = useState<string>("all");
  
  // Dialog states
  const [warnDialogOpen, setWarnDialogOpen] = useState(false);
  const [suspendDialogOpen, setSuspendDialogOpen] = useState(false);
  const [banDialogOpen, setBanDialogOpen] = useState(false);
  const [promoteDialogOpen, setPromoteDialogOpen] = useState(false);
  const [warningsDialogOpen, setWarningsDialogOpen] = useState(false);
  const [selectedUser, setSelectedUser] = useState<any>(null);
  
  // Form states
  const [warnReason, setWarnReason] = useState("tos_violation");
  const [warnMessage, setWarnMessage] = useState("");
  const [suspendReason, setSuspendReason] = useState("");
  const [suspendDays, setSuspendDays] = useState("7");
  const [banReason, setBanReason] = useState("");

  // Mutations
  const warnUserMutation = trpc.admin.warnUser.useMutation({
    onSuccess: () => {
      toast.success("Nutzer wurde erfolgreich verwarnt");
      refetch();
      setWarnDialogOpen(false);
      setWarnMessage("");
    },
    onError: (error) => {
      toast.error(`Fehler beim Verwarnen: ${error.message}`);
      console.error("Warn user error:", error);
    },
  });

  const suspendUserMutation = trpc.admin.suspendUser.useMutation({
    onSuccess: () => {
      toast.success("Nutzer wurde erfolgreich gesperrt");
      refetch();
      setSuspendDialogOpen(false);
      setSuspendReason("");
    },
    onError: (error) => {
      toast.error(`Fehler beim Sperren: ${error.message}`);
    },
  });

  const banUserMutation = trpc.admin.banUser.useMutation({
    onSuccess: () => {
      toast.success("Nutzer wurde erfolgreich gebannt");
      refetch();
      setBanDialogOpen(false);
      setBanReason("");
    },
    onError: (error) => {
      toast.error(`Fehler beim Bannen: ${error.message}`);
    },
  });
```

#### Schritt 5.x: BackButton.tsx

**`client/src/components/BackButton.tsx`**

```typescript
import { ArrowLeft } from "lucide-react";
import { Link } from "wouter";

interface BackButtonProps {
  href?: string;
  label?: string;
  className?: string;
  useHistory?: boolean; // If true, uses browser history instead of href
}

/**
 * Standardisierter Zurücklink für alle Seiten
 * Verwendet konsistente Farben, Icons und Styling
 * 
 * @param href - Target URL (default: "/")
 * @param label - Button text (default: "Zurück")
 * @param useHistory - If true, uses window.history.back() instead of href
 */
export default function BackButton({ 
  href = "/", 
  label = "Zurück",
  className = "",
  useHistory = false
}: BackButtonProps) {
  if (useHistory) {
    return (
      <button
        onClick={() => window.history.back()}
        className={`inline-flex items-center gap-2 text-blue-600 hover:text-blue-800 mb-6 transition-colors ${className}`}
      >
        <ArrowLeft className="w-4 h-4" />
        {label}
      </button>
    );
  }

  return (
    <Link 
      href={href} 
      className={`inline-flex items-center gap-2 text-blue-600 hover:text-blue-800 mb-6 transition-colors ${className}`}
    >
      <ArrowLeft className="w-4 h-4" />
      {label}
    </Link>
  );
}

```

#### Schritt 5.x: Breadcrumbs.tsx

**`client/src/components/Breadcrumbs.tsx`**

```typescript
import { ChevronRight, Home } from "lucide-react";
import { Link } from "wouter";

interface BreadcrumbItem {
  label: string;
  href?: string;
}

interface BreadcrumbsProps {
  items: BreadcrumbItem[];
}

export function Breadcrumbs({ items }: BreadcrumbsProps) {
  return (
    <nav className="flex items-center gap-2 text-sm text-gray-600 mb-6">
      <Link href="/" className="hover:text-green-600 transition flex items-center gap-1">
        <Home className="w-4 h-4" />
        <span>Start</span>
      </Link>
      
      {items.map((item, index) => (
        <div key={index} className="flex items-center gap-2">
          <ChevronRight className="w-4 h-4" />
          {item.href && index < items.length - 1 ? (
            <Link href={item.href} className="hover:text-green-600 transition">
              {item.label}
            </Link>
          ) : (
            <span className="text-gray-900 font-medium">{item.label}</span>
          )}
        </div>
      ))}
    </nav>
  );
}

```

#### Schritt 5.x: BrowseListings.tsx

**`client/src/components/BrowseListings.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import { useState } from "react";
import type { Listing, PriceType } from "@/../../shared/types";
import { Link } from "wouter";
import { trpc } from "@/lib/trpc";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Badge } from "@/components/ui/badge";
import { Search, Filter, Package } from "lucide-react";
import { ListingSkeletonGrid } from "@/components/ListingSkeleton";
import { Breadcrumbs } from "@/components/Breadcrumbs";
import { Header } from "@/components/Header";

export default function BrowseListings() {
  // Get search query from URL
  const urlParams = new URLSearchParams(window.location.search);
  const urlSearch = urlParams.get('search') || '';
  
  const [limit] = useState(50);
  const [offset, setOffset] = useState(0);
  const [filterType, setFilterType] = useState<"all" | "cutting" | "seed">("all");
  const [searchQuery, setSearchQuery] = useState(urlSearch);
  const [sortBy, setSortBy] = useState<"newest" | "price-low" | "price-high">("newest");
  const [minPrice, setMinPrice] = useState<string>("");
  const [maxPrice, setMaxPrice] = useState<string>("");

  const listings = trpc.listing.getActive.useQuery({ limit, offset });

  // Filter and sort listings
  const filteredListings = listings.data
    ?.filter((listing) => {
      // Type filter
      if (filterType !== "all" && listing.type !== filterType) return false;
      
      // Search filter
      if (searchQuery && !listing.strain.toLowerCase().includes(searchQuery.toLowerCase())) {
        return false;
      }
      
      // Price filter
      const price = listing.priceType === "fixed" ? parseFloat(listing.fixedPrice || "0") : parseFloat(listing.auctionStartPrice || "0");
      if (minPrice && price < parseFloat(minPrice)) return false;
      if (maxPrice && price > parseFloat(maxPrice)) return false;
      
      return true;
    })
    .sort((a, b) => {
      if (sortBy === "newest") {
        return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();
      }
      if (sortBy === "price-low") {
        const priceA = a.priceType === "fixed" ? parseFloat(a.fixedPrice || "0") : parseFloat(a.auctionStartPrice || "0");
        const priceB = b.priceType === "fixed" ? parseFloat(b.fixedPrice || "0") : parseFloat(b.auctionStartPrice || "0");
        return priceA - priceB;
      }
      if (sortBy === "price-high") {
        const priceA = a.priceType === "fixed" ? parseFloat(a.fixedPrice || "0") : parseFloat(a.auctionStartPrice || "0");
        const priceB = b.priceType === "fixed" ? parseFloat(b.fixedPrice || "0") : parseFloat(b.auctionStartPrice || "0");
        return priceB - priceA;
      }
      return 0;
    }) || [];

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      <Header />
      <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <Breadcrumbs items={[{ label: "Stecklinge & Samen" }]} />
        
        {/* Header */}
        <div className="mb-8">
          <h1 className="text-3xl font-bold mb-2">Stecklinge & Samen durchsuchen</h1>
          <p className="text-gray-600">
            {filteredListings.length} Angebot{filteredListings.length !== 1 ? "e" : ""} verfügbar
          </p>
        </div>

        {/* Filters */}
        <Card className="mb-8">
          <CardHeader>
            <CardTitle className="text-lg flex items-center gap-2">
              <Filter className="w-5 h-5" />
              Filter & Suche
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="grid md:grid-cols-2 lg:grid-cols-5 gap-4">
              {/* Search */}
              <div>
                <label className="text-sm font-medium">Sorte suchen</label>
                <div className="relative mt-2">
                  <Search className="absolute left-3 top-3 w-4 h-4 text-gray-400" />
                  <Input
                    placeholder="z.B. Blue Dream"
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    className="pl-10"
                  />
                </div>
              </div>

              {/* Type Filter */}
              <div>
                <label className="text-sm font-medium">Typ</label>
                <Select value={filterType} onValueChange={(value: "all" | "cutting" | "seed") => setFilterType(value)}>
                  <SelectTrigger className="mt-2">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="all">Alle</SelectItem>
                    <SelectItem value="cutting">Stecklinge</SelectItem>
                    <SelectItem value="seed">Samen</SelectItem>
                  </SelectContent>
                </Select>
              </div>

              {/* Price Min */}
              <div>
                <label className="text-sm font-medium">Preis min (€)</label>
                <Input
                  type="number"
                  placeholder="z.B. 5"
                  value={minPrice}
                  onChange={(e) => setMinPrice(e.target.value)}
                  className="mt-2"
                  min="0"
                  step="0.01"
                />
              </div>

              {/* Price Max */}
              <div>
                <label className="text-sm font-medium">Preis max (€)</label>
                <Input
                  type="number"
                  placeholder="z.B. 50"
                  value={maxPrice}
                  onChange={(e) => setMaxPrice(e.target.value)}
                  className="mt-2"
                  min="0"
                  step="0.01"
                />
              </div>

              {/* Sort */}
              <div>
                <label className="text-sm font-medium">Sortieren nach</label>
                <Select value={sortBy} onValueChange={(value: "newest" | "price-low" | "price-high") => setSortBy(value)}>
                  <SelectTrigger className="mt-2">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="newest">Neueste zuerst</SelectItem>
                    <SelectItem value="price-low">Preis: Niedrig zu Hoch</SelectItem>
                    <SelectItem value="price-high">Preis: Hoch zu Niedrig</SelectItem>
                  </SelectContent>
                </Select>
              </div>

              {/* Reset */}
              <div className="flex items-end">
                <Button
                  variant="outline"
                  className="w-full"
                  onClick={() => {
                    setSearchQuery("");
                    setFilterType("all");
                    setSortBy("newest");
                    setMinPrice("");
                    setMaxPrice("");
                  }}
                >
                  Zurücksetzen
                </Button>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Listings Grid */}
        {listings.isLoading ? (
          <ListingSkeletonGrid count={8} />
        ) : filteredListings.length === 0 ? (
          <Card>
            <CardContent className="py-16 text-center">
              <div className="flex flex-col items-center gap-4">
                <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center">
                  <Package className="w-8 h-8 text-gray-400" />
                </div>
                <div>
                  <h3 className="text-lg font-semibold text-gray-900 mb-2">
                    Keine Angebote gefunden
                  </h3>
                  <p className="text-gray-500 mb-4">
                    {searchQuery || minPrice || maxPrice || filterType !== "all"
                      ? "Versuche es mit anderen Filtereinstellungen"
                      : "Aktuell sind keine Angebote verfügbar"}
                  </p>
                </div>
                <Button
                  variant="outline"
                  onClick={() => {
                    setSearchQuery("");
                    setFilterType("all");
                    setMinPrice("");
                    setMaxPrice("");
                    setSortBy("newest");
                  }}
                >
                  Alle Filter zurücksetzen
                </Button>
              </div>
            </CardContent>
          </Card>
        ) : (
          <div className="grid md:grid-cols-3 lg:grid-cols-4 gap-6">
            {filteredListings.map((listing) => (
              <Link key={listing.id} href={`/listing/${listing.id}`}>
                <Card className="h-full hover:shadow-lg transition-shadow cursor-pointer overflow-hidden">
                  {/* Image */}
                  {listing.imageUrl ? (
                    <img
                      src={listing.imageUrl}
                      alt={listing.strain}
                      className="w-full h-40 object-cover"
                    />
                  ) : (
                    <div className="w-full h-40 bg-gray-200 flex items-center justify-center">
                      <p className="text-gray-500 text-sm">Kein Bild</p>
                    </div>
                  )}

                  <CardHeader className="pb-3">
                    <CardTitle className="text-base line-clamp-2">{listing.strain}</CardTitle>
                    <CardDescription>
                      {listing.type === "cutting" ? "Steckling" : "Samen"}
                    </CardDescription>
                  </CardHeader>

                  <CardContent className="space-y-3">
                    {/* Description */}
                    {listing.description && (
                      <p className="text-sm text-gray-600 line-clamp-2">{listing.description}</p>
                    )}

                    {/* Quantity */}
                    <div className="flex justify-between items-center text-sm">
                      <span className="text-gray-600">Verfügbar:</span>
                      <Badge variant="outline">{listing.quantity}</Badge>
                    </div>

                    {/* Price */}
                    <div className="pt-2 border-t">
                      <p className="text-lg font-bold text-green-600">
                        {listing.priceType === "fixed"
                          ? `€${parseFloat(listing.fixedPrice || "0").toFixed(2)}`
                          : listing.auctionStartPrice
                          ? `Ab €${parseFloat(listing.auctionStartPrice || "0").toFixed(2)}`
                          : "Auktion"}
                      </p>
                      <p className="text-xs text-gray-500">
                        {listing.priceType === "fixed" ? "Festpreis" : "Auktion"}
                      </p>
                    </div>

                    {/* CTA */}
                    <Button className="w-full mt-2" size="sm">
                      Details anschauen
                    </Button>
                  </CardContent>
                </Card>
              </Link>
            ))}
          </div>
        )}

        {/* Pagination */}
        {filteredListings.length > 0 && (
          <div className="flex justify-center gap-4 mt-8">
            <Button
              variant="outline"
              disabled={offset === 0}
              onClick={() => setOffset(Math.max(0, offset - limit))}
            >
              Zurück
            </Button>
            <span className="flex items-center text-gray-600">
              Seite {Math.floor(offset / limit) + 1}
            </span>
            <Button
              variant="outline"
              disabled={filteredListings.length < limit}
              onClick={() => setOffset(offset + limit)}
            >
              Weiter
            </Button>
          </div>
        )}
      </div>
    </div>
  );
}

```

#### Schritt 5.x: BuyerDashboard.tsx

**`client/src/components/BuyerDashboard.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import type { Transaction, Offer } from "@/../../shared/types";
import { trpc } from "../lib/trpc";
import { Star, MessageSquare, Check, X } from "lucide-react";
import { useLocation } from "wouter";
import { Header } from "@/components/Header";

export default function BuyerDashboard() {
  const [reviewDialogOpen, setReviewDialogOpen] = useState(false);
  const [selectedTransaction, setSelectedTransaction] = useState<number | null>(null);
  const [rating, setRating] = useState(0);
  const [hoverRating, setHoverRating] = useState(0);
  const [comment, setComment] = useState("");

  const transactions = trpc.transaction.getBuyerTransactions.useQuery(undefined, { staleTime: 60000 });
  const myOffers = trpc.offer.getMyOffers.useQuery(undefined, { staleTime: 60000 });
  const [, setLocation] = useLocation();
  const createReviewMutation = trpc.review.create.useMutation({
    onSuccess: () => {
      setReviewDialogOpen(false);
      setSelectedTransaction(null);
      setRating(0);
      setComment("");
      transactions.refetch();
    },
  });

  const handleReviewClick = (transactionId: number) => {
    setSelectedTransaction(transactionId);
    setReviewDialogOpen(true);
  };

  const handleSubmitReview = () => {
    if (!selectedTransaction || rating === 0) return;

    const transaction = transactions.data?.find((t) => t.id === selectedTransaction);
    if (!transaction) return;

    createReviewMutation.mutate({
      transactionId: selectedTransaction,
      sellerId: transaction.sellerId,
      rating,
      comment: comment || undefined,
    });
  };

  const canReview = (transaction: Transaction) => {
    const daysSincePurchase = Math.floor(
      (Date.now() - new Date(transaction.createdAt).getTime()) / (1000 * 60 * 60 * 24)
    );
    return daysSincePurchase <= 90 && transaction.status === "completed";
  };

  if (transactions.isLoading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-gray-600">Lädt...</div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <Header />
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-gray-900">Käufer-Dashboard</h1>
          <p className="mt-2 text-gray-600">
            Übersicht über deine Preisvorschläge, Bestellungen und Bewertungsmöglichkeiten
          </p>
        </div>

        {/* Offers Section */}
        {myOffers.data && myOffers.data.length > 0 && (
          <div className="mb-8">
            <h2 className="text-2xl font-bold text-gray-900 mb-4">Meine Preisvorschläge</h2>
            <div className="space-y-3">
              {myOffers.data.map((offer: Offer) => {
                const getStatusBadge = () => {
                  switch (offer.status) {
                    case "pending":
                      return <span className="px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">Ausstehend</span>;
                    case "accepted":
                      return <span className="px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">Angenommen</span>;
                    case "rejected":
                      return <span className="px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">Abgelehnt</span>;
                    default:
                      return <span className="px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800">{offer.status}</span>;
                  }
                };

                return (
                  <div key={offer.id} className="bg-white rounded-lg shadow p-4">
                    <div className="flex items-center justify-between">
                      <div className="flex-1">
                        <div className="flex items-center gap-3 mb-2">
                          <h3 className="text-lg font-semibold text-gray-900">{offer.listingStrain}</h3>
                          {getStatusBadge()}
                        </div>
                        <div className="text-sm text-gray-600">
                          <p>Angebot: <span className="font-bold text-green-600">€{parseFloat(offer.offerAmount).toFixed(2)}</span></p>
                          <p>Verkäufer: {offer.sellerNickname || "Unbekannt"}</p>
                          <p className="text-xs text-gray-500">
                            {new Date(offer.createdAt).toLocaleDateString("de-DE", {
                              day: "2-digit",
                              month: "2-digit",
                              year: "numeric",
                              hour: "2-digit",
                              minute: "2-digit",
                            })}
                          </p>
                          {offer.message && (
                            <div className="mt-2 flex items-start gap-2">
                              <MessageSquare className="w-4 h-4 text-gray-400 mt-0.5" />
                              <p className="text-sm italic">"{ offer.message}"</p>
                            </div>
                          )}
                        </div>
                      </div>
                      {offer.status === "accepted" && (
                        <div className="ml-4">
                          <button
                            onClick={() => setLocation(`/listing/${offer.listingId}`)}
                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                          >
                            Zur Zahlung
                          </button>
                        </div>
                      )}
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        )}

        {/* Transactions Section */}
        <h2 className="text-2xl font-bold text-gray-900 mb-4">Meine Käufe</h2>

        {transactions.data?.length === 0 ? (
          <div className="bg-white rounded-lg shadow p-8 text-center">
            <p className="text-gray-600">Du hast noch keine Käufe getätigt.</p>
          </div>
        ) : (
          <div className="space-y-4">
            {transactions.data?.map((transaction) => {
              const daysLeft = 90 - Math.floor(
                (Date.now() - new Date(transaction.createdAt).getTime()) / (1000 * 60 * 60 * 24)
              );

              return (
                <div key={transaction.id} className="bg-white rounded-lg shadow p-6">
                  <div className="flex justify-between items-start">
                    <div className="flex-1">
                      <div className="flex items-center gap-3 mb-2">
                        <h3 className="text-lg font-semibold text-gray-900">
                          Bestellung #{transaction.id}
                        </h3>
                        <span
                          className={`px-3 py-1 rounded-full text-sm font-medium ${
                            transaction.status === "completed"
                              ? "bg-green-100 text-green-800"
                              : transaction.status === "pending"
                              ? "bg-yellow-100 text-yellow-800"
                              : "bg-gray-100 text-gray-800"
                          }`}
                        >
                          {transaction.status === "completed"
                            ? "Abgeschlossen"
                            : transaction.status === "pending"
                            ? "Ausstehend"
                            : transaction.status}
                        </span>
                      </div>

                      <div className="grid grid-cols-2 gap-4 text-sm text-gray-600 mb-4">
                        <div>
                          <span className="font-medium">Datum:</span>{" "}
                          {new Date(transaction.createdAt).toLocaleDateString("de-DE")}
                        </div>
                        <div>
                          <span className="font-medium">Betrag:</span> €
                          {parseFloat(transaction.totalAmount).toFixed(2)}
                        </div>
                        <div>
                          <span className="font-medium">Menge:</span> {transaction.quantity}
                        </div>
                        <div>
                          <span className="font-medium">Plattformgebühr:</span> €
                          {parseFloat(transaction.platformFee).toFixed(2)}
                        </div>
                      </div>

                      {canReview(transaction) && (
                        <div className="mt-4 p-3 bg-blue-50 rounded-lg">
                          <p className="text-sm text-blue-800">
                            ✨ Du kannst diese Transaktion noch {daysLeft} Tage lang bewerten
                          </p>
                        </div>
                      )}

                      {!canReview(transaction) && daysLeft < 0 && (
                        <div className="mt-4 p-3 bg-gray-50 rounded-lg">
                          <p className="text-sm text-gray-600">
                            ⏰ Bewertungszeitraum abgelaufen (90 Tage)
                          </p>
                        </div>
                      )}
                    </div>

                    {canReview(transaction) && (
                      <button
                        onClick={() => handleReviewClick(transaction.id)}
                        className="ml-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                      >
                        Bewerten
                      </button>
                    )}
                  </div>
                </div>
              );
            })}
          </div>
        )}

        {/* Review Dialog */}
        {reviewDialogOpen && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div className="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
              <h2 className="text-2xl font-bold text-gray-900 mb-4">Bewertung abgeben</h2>

              <div className="mb-6">
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Wie zufrieden warst du mit diesem Kauf?
                </label>
                <div className="flex gap-2">
                  {[1, 2, 3, 4, 5].map((star) => (
                    <button
                      key={star}
                      type="button"
                      onClick={() => setRating(star)}
                      onMouseEnter={() => setHoverRating(star)}
                      onMouseLeave={() => setHoverRating(0)}
                      className="focus:outline-none transition-transform hover:scale-110"
                    >
                      <Star
                        className={`w-10 h-10 ${
                          star <= (hoverRating || rating)
                            ? "fill-yellow-400 text-yellow-400"
                            : "text-gray-300"
                        }`}
                      />
                    </button>
                  ))}
                </div>
                {rating > 0 && (
                  <p className="mt-2 text-sm text-gray-600">
                    {rating === 1 && "Sehr unzufrieden"}
                    {rating === 2 && "Unzufrieden"}
                    {rating === 3 && "Neutral"}
                    {rating === 4 && "Zufrieden"}
                    {rating === 5 && "Sehr zufrieden"}
                  </p>
                )}
              </div>

              <div className="mb-6">
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Kommentar (optional)
                </label>
                <textarea
                  value={comment}
                  onChange={(e) => setComment(e.target.value)}
                  rows={4}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                  placeholder="Teile deine Erfahrungen mit anderen Käufern..."
                />
              </div>

              <div className="flex gap-3">
                <button
                  onClick={() => {
                    setReviewDialogOpen(false);
                    setSelectedTransaction(null);
                    setRating(0);
                    setComment("");
                  }}
                  className="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                >
                  Abbrechen
                </button>
                <button
                  onClick={handleSubmitReview}
                  disabled={rating === 0 || createReviewMutation.isPending}
                  className="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
                >
                  {createReviewMutation.isPending ? "Wird gesendet..." : "Bewertung abschicken"}
                </button>
              </div>

              {createReviewMutation.error && (
                <div className="mt-4 p-3 bg-red-50 text-red-800 rounded-lg text-sm">
                  {createReviewMutation.error.message}
                </div>
              )}
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

```

#### Schritt 5.x: ChatWindow.tsx

**`client/src/components/ChatWindow.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import type { Message } from "@/../../shared/types";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { trpc } from "@/lib/trpc";
import { Link, useParams } from "wouter";
import { ArrowLeft, Send, AlertCircle } from "lucide-react";
import { formatDistanceToNow } from "date-fns";
import { de } from "date-fns/locale";
import { useState, useEffect, useRef } from "react";
import { toast } from "sonner";
import { Header } from "@/components/Header";

export default function ChatWindow() {
  const { user, isAuthenticated } = useAuth();
  const params = useParams<{ id: string }>();
  const conversationId = parseInt(params.id || "0");
  const [messageText, setMessageText] = useState("");
  const messagesEndRef = useRef<HTMLDivElement>(null);
  const utils = trpc.useUtils();

  // Get messages
  const { data: messages = [], isLoading } = trpc.chat.getMessages.useQuery(conversationId, {
    refetchInterval: 5000, // Refresh every 5 seconds
    staleTime: 10000, // 10s - Real-time
    enabled: conversationId > 0,
  });

  // Send message mutation
  const sendMessageMutation = trpc.chat.sendMessage.useMutation({
    onSuccess: () => {
      setMessageText("");
      utils.chat.getMessages.invalidate();
      utils.chat.getConversations.invalidate();
      utils.chat.getUnreadCount.invalidate();
    },
    onError: (error) => {
      toast.error("Fehler beim Senden: " + error.message);
    },
  });

  // Scroll to bottom when messages change
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [messages]);

  const handleSendMessage = (e: React.FormEvent) => {
    e.preventDefault();
    if (!messageText.trim()) return;

    sendMessageMutation.mutate({
      conversationId,
      message: messageText.trim(),
    });
  };

  if (!isAuthenticated) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center">
        <Card className="max-w-md">
          <CardHeader>
            <CardTitle>Zugriff verweigert</CardTitle>
            <CardDescription>
              Sie müssen eingeloggt sein, um Nachrichten zu sehen.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Link href="/">
              <Button>Zur Startseite</Button>
            </Link>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      <Header />
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="mb-6">
          <Link href="/messages">
            <Button variant="outline" size="sm" className="hidden">
              <ArrowLeft className="h-4 w-4 mr-2" />
              Zurück zu Nachrichten
            </Button>
          </Link>
        </div>

        {/* Legal Disclaimer */}
        <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-6 rounded-r-lg">
          <div className="flex items-start gap-3">
            <AlertCircle className="h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5" />
            <div className="text-sm text-yellow-800">
              <p className="font-semibold mb-1">⚠️ Datenschutz-Hinweis:</p>
              <p className="mb-2">Geben Sie <strong>persönliche Daten</strong> (Telefonnummer, vollständige Adresse) <strong>erst nach Kaufabschluss</strong> weiter. Der Standort des Verkäufers ist bereits auf der Plattform sichtbar.</p>
              <p className="text-xs"><strong>🔒 Empfehlung:</strong> Nutzen Sie <strong>verschlüsselte Messenger</strong> (Signal, Telegram, WhatsApp) für den Austausch sensibler Daten außerhalb dieser Plattform.</p>
            </div>
          </div>
        </div>

        <Card className="h-[600px] flex flex-col">
          <CardHeader className="border-b">
            <CardTitle>Chat</CardTitle>
            <CardDescription>
              {messages.length > 0 && `${messages.length} Nachricht${messages.length > 1 ? "en" : ""}`}
            </CardDescription>
          </CardHeader>

          {/* Messages Area */}
          <CardContent className="flex-1 overflow-y-auto p-6">
            {isLoading ? (
              <div className="text-center py-12">
                <p className="text-muted-foreground">Lädt...</p>
              </div>
            ) : messages.length === 0 ? (
              <div className="text-center py-12">
                <p className="text-muted-foreground">
                  Noch keine Nachrichten. Schreiben Sie die erste Nachricht!
                </p>
              </div>
            ) : (
              <div className="space-y-4">
                {messages.map((message: Message) => {
                  const isOwnMessage = message.senderId === user?.id;

                  return (
                    <div
                      key={message.id}
                      className={`flex ${isOwnMessage ? "justify-end" : "justify-start"}`}
                    >
                      <div
                        className={`max-w-[70%] rounded-lg p-3 ${
                          isOwnMessage
                            ? "bg-blue-600 text-white"
                            : "bg-gray-200 text-gray-900"
                        }`}
                      >
                        <div className="flex items-center gap-2 mb-1">
                          <p className={`text-xs font-semibold ${isOwnMessage ? "text-blue-100" : "text-gray-600"}`}>
                            {isOwnMessage ? "Sie" : message.senderName}
                          </p>
                          <p className={`text-xs ${isOwnMessage ? "text-blue-100" : "text-gray-500"}`}>
                            {formatDistanceToNow(new Date(message.createdAt), {
                              addSuffix: true,
                              locale: de,
                            })}
                          </p>
                        </div>
                        <p className="text-sm whitespace-pre-line break-words">
                          {message.message}
                        </p>
                      </div>
                    </div>
                  );
                })}
                <div ref={messagesEndRef} />
              </div>
            )}
          </CardContent>

          {/* Message Input */}
          <div className="border-t p-4">
            <form onSubmit={handleSendMessage} className="flex gap-2">
              <Input
                value={messageText}
                onChange={(e) => setMessageText(e.target.value)}
                placeholder="Nachricht schreiben..."
                maxLength={5000}
                disabled={sendMessageMutation.isPending}
                className="flex-1"
              />
              <Button
                type="submit"
                disabled={!messageText.trim() || sendMessageMutation.isPending}
              >
                <Send className="h-4 w-4 mr-2" />
                Senden
              </Button>
            </form>
          </div>
        </Card>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: Checkout.tsx

**`client/src/components/Checkout.tsx`**

```typescript
import { useParams, useLocation } from "wouter";
import { useAuth } from "@/_core/hooks/useAuth";
import { trpc } from "@/lib/trpc";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Badge } from "@/components/ui/badge";
import { AlertCircle, Loader2 } from "lucide-react";
import { Alert, AlertDescription } from "@/components/ui/alert";

// PayPal SDK types
interface PayPalOrderData {
  orderID: string;
}

interface PayPalError {
  message: string;
}

declare global {
  interface Window {
    paypal?: {
      Buttons: (config: {
        createOrder: () => Promise<string>;
        onApprove: (data: PayPalOrderData) => Promise<void>;
        onError: (err: PayPalError) => void;
      }) => {
        render: (selector: string) => void;
      };
    };
  }
}

export default function Checkout() {
  const { id } = useParams<{ id: string }>();
  const [, navigate] = useLocation();
  const { user, isAuthenticated } = useAuth();
  const [quantity, setQuantity] = useState(1);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [ageVerified, setAgeVerified] = useState(false);
  const [termsAccepted, setTermsAccepted] = useState(false);
  const [paymentMethod, setPaymentMethod] = useState<'paypal' | 'cash'>('paypal');

  const listingId = parseInt(id || "0");
  const listing = trpc.listing.getById.useQuery(listingId, { enabled: !!id });
  const sellerProfile = trpc.seller.getProfileById.useQuery(listing.data?.sellerId || 0, {
    enabled: !!listing.data?.sellerId,
  });```

#### Schritt 5.x: CheckoutNew.tsx

**`client/src/components/CheckoutNew.tsx`**

```typescript
import { useState, useEffect } from "react";
import { useParams, useLocation } from "wouter";
import { useAuth } from "@/_core/hooks/useAuth";
import { trpc } from "@/lib/trpc";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Badge } from "@/components/ui/badge";
import { AlertCircle, Loader2, ShoppingCart, Package, CreditCard } from "lucide-react";
import { Alert, AlertDescription } from "@/components/ui/alert";
import PayPalButton from "@/components/PayPalButton";

export default function Checkout() {
  const { id } = useParams<{ id: string }>();
  const [, navigate] = useLocation();
  const { user, isAuthenticated } = useAuth();
  const [quantity, setQuantity] = useState(1);
  const [ageVerified, setAgeVerified] = useState(false);
  const [termsAccepted, setTermsAccepted] = useState(false);
  const [paymentMethod, setPaymentMethod] = useState<'paypal' | 'cash'>('paypal');

  const listingId = parseInt(id || "0");
  const listing = trpc.listing.getById.useQuery(listingId, { enabled: !!id });
  const sellerProfile = trpc.seller.getProfileById.useQuery(listing.data?.sellerId || 0, {
    enabled: !!listing.data?.sellerId,
  });

  // Get dynamic fees from system settings
  const platformFee = trpc.system.getSettings.useQuery();
  const platformFeeFixed = platformFee.data?.find(s => s.key === 'platform_fee_fixed')?.value || '0.42';
  const paypalFeePercentage = platformFee.data?.find(s => s.key === 'paypal_fee_percentage')?.value || '2.49';
  const paypalFeeFixed = platformFee.data?.find(s => s.key === 'paypal_fee_fixed')?.value || '0.49';

  // Calculate totals
  const calculateTotals = () => {
    if (!listing.data) return { subtotal: 0, platformFee: 0, paypalFee: 0, total: 0 };

    const unitPrice =
      listing.data.priceType === "fixed"
        ? parseFloat(listing.data.fixedPrice || "0")
        : parseFloat(listing.data.auctionStartPrice || "0");

    const subtotal = unitPrice * quantity;
    const platformFeeAmount = parseFloat(platformFeeFixed) * quantity;
    const paypalFeeAmount = paymentMethod === 'paypal' 
      ? (subtotal * (parseFloat(paypalFeePercentage) / 100) + parseFloat(paypalFeeFixed))
      : 0;
    const total = subtotal + platformFeeAmount + paypalFeeAmount;

    return {
      subtotal,
      platformFee: platformFeeAmount,
      paypalFee: paypalFeeAmount,
      total,
    };
  };

  const totals = calculateTotals();

  // Redirect if not authenticated
  if (!isAuthenticated) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100 p-4">
        <Card className="w-full max-w-md">
          <CardHeader>
            <CardTitle>Authentifizierung erforderlich</CardTitle>
            <CardDescription>Bitte melden Sie sich an, um zu kaufen.</CardDescription>
          </CardHeader>
          <CardContent>
            <Button className="w-full" onClick={() => navigate("/")}>
              Zur Startseite
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Loading state
  if (listing.isLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <Loader2 className="w-8 h-8 animate-spin text-gray-400" />
      </div>
    );
  }

  // Not found
  if (!listing.data) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <Card className="w-full max-w-md">
          <CardHeader>
            <CardTitle>Angebot nicht gefunden</CardTitle>
          </CardHeader>
          <CardContent>
            <Button className="w-full" onClick={() => navigate("/browse")}>
              Zurück zum Browse
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  const canPurchase = ageVerified && termsAccepted;

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 py-8">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h1 className="text-3xl font-bold mb-8">Checkout</h1>

        <div className="grid md:grid-cols-3 gap-8">
          {/* Order Summary */}
          <div className="md:col-span-2 space-y-6">
            {/* Listing Info */}
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Package className="w-5 h-5" />
                  Produktdetails
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="flex gap-4">
                  {listing.data.images && listing.data.images.length > 0 && (
                    <img
                      src={listing.data.images[0]}
                      alt={listing.data.strain}
                      className="w-24 h-24 object-cover rounded-lg"
                    />
                  )}
                  <div className="flex-1">
                    <h3 className="font-semibold text-lg">{listing.data.strain}</h3>
                    <p className="text-sm text-gray-600 mb-2">{listing.data.type}</p>
                    <div className="flex items-center gap-2">
                      <span className="text-2xl font-bold text-green-600">
                        €{listing.data.priceType === "fixed" ? listing.data.fixedPrice : listing.data.auctionStartPrice}
                      </span>
                      <Badge variant="outline">pro Stück</Badge>
                    </div>
                  </div>
                </div>

                {/* Quantity Selector */}
                <div className="mt-4 pt-4 border-t">
                  <label className="block text-sm font-medium mb-2">Menge</label>
                  <Input
                    type="number"
                    min="1"
                    max={listing.data.quantity || 1}
                    value={quantity}
                    onChange={(e) => setQuantity(Math.max(1, Math.min(parseInt(e.target.value) || 1, listing.data?.quantity || 1)))}
                    className="w-32"
                  />
                  <p className="text-xs text-gray-500 mt-1">
                    Verfügbar: {listing.data.quantity} Stück
                  </p>
                </div>
              </CardContent>
            </Card>

            {/* Payment Method */}
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <CreditCard className="w-5 h-5" />
                  Zahlungsmethode
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                {/* PayPal Option */}
                <label className="flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                  <input
                    type="radio"
                    name="paymentMethod"
                    value="paypal"
                    checked={paymentMethod === 'paypal'}
                    onChange={(e) => setPaymentMethod(e.target.value as 'paypal')}
                    className="w-4 h-4"
                  />
                  <div className="flex-1">
                    <div className="font-medium">PayPal</div>
                    <div className="text-sm text-gray-500">Sichere Online-Zahlung mit Käuferschutz</div>
                  </div>
                  <Badge variant="outline" className="bg-blue-50 text-blue-700 border-blue-200">
                    +€{totals.paypalFee.toFixed(2)} Gebühr
                  </Badge>
                </label>

                {/* Cash Option */}
                <label className="flex items-center gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition">
                  <input
                    type="radio"
                    name="paymentMethod"
                    value="cash"
                    checked={paymentMethod === 'cash'}
                    onChange={(e) => setPaymentMethod(e.target.value as 'cash')}
                    className="w-4 h-4"
                  />
                  <div className="flex-1">
                    <div className="font-medium">Barzahlung bei Abholung</div>
                    <div className="text-sm text-gray-500">Zahlung direkt beim Verkäufer</div>
                  </div>
                  <Badge variant="outline" className="bg-green-50 text-green-700 border-green-200">
                    Keine PayPal-Gebühr
                  </Badge>
                </label>

                {/* Terms & Conditions */}
                <div className="space-y-3 pt-4 border-t">
                  <label className="flex items-start gap-2 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={ageVerified}
                      onChange={(e) => setAgeVerified(e.target.checked)}
                      className="mt-1"
                    />
                    <span className="text-sm">
                      Ich bestätige, dass ich mindestens 18 Jahre alt bin und die{" "}
                      <a href="/age-verification" className="text-blue-600 hover:underline">
                        Altersverifikation
                      </a>{" "}
                      akzeptiere.
                    </span>
                  </label>

                  <label className="flex items-start gap-2 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={termsAccepted}
                      onChange={(e) => setTermsAccepted(e.target.checked)}
                      className="mt-1"
                    />
                    <span className="text-sm">
                      Ich akzeptiere die{" "}
                      <a href="/terms" className="text-blue-600 hover:underline">
                        Nutzungsbedingungen
                      </a>
                      ,{" "}
                      <a href="/privacy" className="text-blue-600 hover:underline">
                        Datenschutzerklärung
                      </a>{" "}
                      und{" "}
                      <a href="/widerruf" className="text-blue-600 hover:underline">
                        Widerrufsbelehrung
                      </a>
                      .
                    </span>
                  </label>
                </div>

                {/* PayPal Button */}
                {paymentMethod === 'paypal' && canPurchase && (
                  <div className="pt-4">
                    <PayPalButton
                      listingId={listingId}
                      quantity={quantity}
                      onSuccess={(transactionId) => {
                        navigate(`/order/${transactionId}`);
                      }}
                      disabled={!canPurchase}
                    />
                  </div>
                )}

                {/* Cash Payment Info */}
                {paymentMethod === 'cash' && (
                  <Alert>
                    <AlertCircle className="h-4 w-4" />
                    <AlertDescription className="text-sm">
                      Bei Barzahlung kontaktieren Sie bitte den Verkäufer direkt, um die Übergabe zu vereinbaren.
                    </AlertDescription>
                  </Alert>
                )}
              </CardContent>
            </Card>
          </div>

          {/* Price Summary */}
          <div className="md:col-span-1">
            <Card className="sticky top-8">
              <CardHeader>
                <CardTitle>Zusammenfassung</CardTitle>
              </CardHeader>
              <CardContent className="space-y-3">
                <div className="flex justify-between text-sm">
                  <span>Zwischensumme ({quantity}x)</span>
                  <span>€{totals.subtotal.toFixed(2)}</span>
                </div>
                <div className="flex justify-between text-sm">
                  <span>Plattformgebühr ({quantity}x €{platformFeeFixed})</span>
                  <span>€{totals.platformFee.toFixed(2)}</span>
                </div>
                {paymentMethod === 'paypal' && totals.paypalFee > 0 && (
                  <div className="flex justify-between text-sm text-blue-600">
                    <span>PayPal-Gebühren</span>
                    <span>€{totals.paypalFee.toFixed(2)}</span>
                  </div>
                )}
                <div className="border-t pt-2 flex justify-between font-bold">
                  <span>Gesamtbetrag</span>
                  <span className="text-green-600">€{totals.total.toFixed(2)}</span>
                </div>

                <Alert>
                  <AlertCircle className="h-4 w-4" />
                  <AlertDescription className="text-xs">
                    {paymentMethod === 'paypal' 
                      ? 'Die PayPal-Gebühren werden zum Gesamtbetrag hinzugerechnet.'
                      : 'Die Plattformgebühr wird zum Gesamtbetrag hinzugerechnet.'}
                  </AlertDescription>
                </Alert>

                {paymentMethod === 'paypal' && (
                  <div className="text-xs text-gray-500 space-y-1">
                    <p>✓ Sichere Zahlung mit PayPal</p>
                    <p>✓ Käuferschutz garantiert</p>
                    <p>✓ Versand nach Zahlungsbestätigung</p>
                  </div>
                )}
                {paymentMethod === 'cash' && (
                  <div className="text-xs text-gray-500 space-y-1">
                    <p>✓ Barzahlung bei Übergabe</p>
                    <p>✓ Keine zusätzlichen PayPal-Gebühren</p>
                    <p>✓ Nur Plattformgebühr von €{platformFeeFixed}</p>
                  </div>
                )}
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: Contact.tsx

**`client/src/components/Contact.tsx`**

```typescript
import BackButton from "@/components/BackButton";
import { Mail, Phone, MapPin, Instagram, MessageCircle } from "lucide-react";

export default function Contact() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 py-12">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <BackButton href="/" label="Zurück zur Startseite" />
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-8 text-gray-900">Kontakt</h1>
          
          <div className="prose prose-lg max-w-none">
            <p className="text-lg text-gray-700 mb-8">
              Hast du Fragen, Anregungen oder Feedback? Wir freuen uns auf deine Nachricht!
            </p>

            {/* Kontakt-Karten */}
            <div className="grid md:grid-cols-2 gap-6 not-prose mb-8">
              {/* deimudda / Vaperge */}
              <div className="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-lg border border-green-200">
                <div className="flex items-center gap-3 mb-4">
                  <img 
                    src="/vaperge-logo.png" 
                    alt="Vaperge Logo" 
                    className="h-12 w-auto"
                  />
                  <h2 className="text-xl font-bold text-gray-900">deimudda / Vaperge</h2>
                </div>
                
                <div className="space-y-3 text-gray-700">
                  <div className="flex items-start gap-3">
                    <MapPin className="h-5 w-5 text-green-600 flex-shrink-0 mt-1" />
                    <div>
                      <p className="font-semibold">Vaperge - Eau de Terpènes</p>
                      <p>Chris Rohleder</p>
                      <p>Lessingstraße 11</p>
                      <p>69254 Malsch</p>
                      <p>Deutschland</p>
                    </div>
                  </div>

                  <div className="flex items-center gap-3">
                    <Mail className="h-5 w-5 text-green-600 flex-shrink-0" />
                    <a href="mailto:info@deimudda.de" className="text-green-600 hover:underline font-semibold">
                      info@deimudda.de
                    </a>
                  </div>

                  <div className="flex items-center gap-3">
                    <Phone className="h-5 w-5 text-green-600 flex-shrink-0" />
                    <span>[Telefonnummer einfügen]</span>
                  </div>
                </div>
              </div>

              {/* Kalidad */}
              <div className="bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-lg border border-purple-200">
                <div className="flex items-center gap-3 mb-4">
                  <img 
                    src="/kalidad-logo.png" 
                    alt="Kalidad Logo" 
                    className="h-12 w-auto bg-white p-2 rounded"
                  />
                  <h2 className="text-xl font-bold text-gray-900">Kalidad</h2>
                </div>
                
                <div className="space-y-3 text-gray-700">
                  <div className="flex items-start gap-3">
                    <MapPin className="h-5 w-5 text-purple-600 flex-shrink-0 mt-1" />
                    <div>
                      <p className="font-semibold">Kalidad - Grow- & Headshop</p>
                      <p>Kahlbachring 16</p>
                      <p>69254 Malsch</p>
                      <p>Deutschland</p>
                    </div>
                  </div>

                  <div className="flex items-center gap-3">
                    <Instagram className="h-5 w-5 text-purple-600 flex-shrink-0" />
                    <a 
                      href="https://www.instagram.com/kalidad420/" 
                      target="_blank" 
                      rel="noopener noreferrer" 
                      className="text-purple-600 hover:underline font-semibold"
                    >
                      @kalidad420
                    </a>
                  </div>
                </div>
              </div>
            </div>

            {/* Kontakt-Bereiche */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Wofür kannst du uns kontaktieren?</h2>
              
              <div className="grid md:grid-cols-2 gap-4 not-prose">
                <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                  <div className="flex items-center gap-2 mb-2">
                    <MessageCircle className="h-5 w-5 text-blue-600" />
                    <h3 className="font-bold text-blue-900">Allgemeine Fragen</h3>
                  </div>
                  <p className="text-sm text-blue-800">
                    Fragen zur Plattform, Registrierung, Nutzung oder Features
                  </p>
                  <p className="text-sm text-blue-600 mt-2">
                    → <a href="mailto:info@deimudda.de" className="hover:underline">info@deimudda.de</a>
                  </p>
                </div>

                <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                  <div className="flex items-center gap-2 mb-2">
                    <Mail className="h-5 w-5 text-green-600" />
                    <h3 className="font-bold text-green-900">Technischer Support</h3>
                  </div>
                  <p className="text-sm text-green-800">
                    Probleme mit der Website, Bugs oder technische Fragen
                  </p>
                  <p className="text-sm text-green-600 mt-2">
                    → <a href="mailto:support@deimudda.de" className="hover:underline">support@deimudda.de</a>
                  </p>
                </div>

                <div className="bg-purple-50 p-4 rounded-lg border border-purple-200">
                  <div className="flex items-center gap-2 mb-2">
                    <MessageCircle className="h-5 w-5 text-purple-600" />
                    <h3 className="font-bold text-purple-900">Verkäufer-Support</h3>
                  </div>
                  <p className="text-sm text-purple-800">
                    Fragen zum Verkaufen, Listings, Gebühren oder Auszahlungen
                  </p>
                  <p className="text-sm text-purple-600 mt-2">
                    → <a href="mailto:seller@deimudda.de" className="hover:underline">seller@deimudda.de</a>
                  </p>
                </div>

                <div className="bg-orange-50 p-4 rounded-lg border border-orange-200">
                  <div className="flex items-center gap-2 mb-2">
                    <Mail className="h-5 w-5 text-orange-600" />
                    <h3 className="font-bold text-orange-900">Datenschutz</h3>
                  </div>
                  <p className="text-sm text-orange-800">
                    Fragen zu deinen Daten, Löschung oder Auskunft
                  </p>
                  <p className="text-sm text-orange-600 mt-2">
                    → <a href="mailto:datenschutz@deimudda.de" className="hover:underline">datenschutz@deimudda.de</a>
                  </p>
                </div>

                <div className="bg-red-50 p-4 rounded-lg border border-red-200">
                  <div className="flex items-center gap-2 mb-2">
                    <MessageCircle className="h-5 w-5 text-red-600" />
                    <h3 className="font-bold text-red-900">Meldungen</h3>
                  </div>
                  <p className="text-sm text-red-800">
                    Rechtswidrige Inhalte, Verstöße gegen Nutzungsbedingungen
                  </p>
                  <p className="text-sm text-red-600 mt-2">
                    → <a href="mailto:report@deimudda.de" className="hover:underline">report@deimudda.de</a>
                  </p>
                </div>

                <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                  <div className="flex items-center gap-2 mb-2">
                    <Mail className="h-5 w-5 text-yellow-600" />
                    <h3 className="font-bold text-yellow-900">Presse & Kooperationen</h3>
                  </div>
                  <p className="text-sm text-yellow-800">
                    Presseanfragen, Partnerschaften oder Business-Anfragen
                  </p>
                  <p className="text-sm text-yellow-600 mt-2">
                    → <a href="mailto:business@deimudda.de" className="hover:underline">business@deimudda.de</a>
                  </p>
                </div>
              </div>
            </section>

            {/* Wichtiger Hinweis */}
            <div className="bg-amber-50 border-l-4 border-amber-400 p-4 mb-8">
              <h3 className="text-lg font-bold text-amber-900 mb-2">⚠️ Wichtiger Hinweis</h3>
              <p className="text-amber-800 text-sm">
                <strong>Bei Problemen mit einem Kauf oder Verkäufer:</strong> deimudda ist nur Vermittler. 
                Wende dich bitte zuerst direkt an den Verkäufer (Kontaktdaten auf der Produktseite). 
                Bei schwerwiegenden Problemen kannst du uns kontaktieren, und wir helfen bei der Vermittlung.
              </p>
            </div>

            {/* Öffnungszeiten / Antwortzeiten */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Antwortzeiten</h2>
              
              <div className="bg-gray-50 p-4 rounded-lg not-prose">
                <p className="text-gray-700 mb-2">
                  Wir bemühen uns, alle Anfragen schnellstmöglich zu beantworten:
                </p>
                <ul className="list-disc pl-6 text-gray-700 space-y-1">
                  <li><strong>Allgemeine Anfragen:</strong> Innerhalb von 24-48 Stunden</li>
                  <li><strong>Technischer Support:</strong> Innerhalb von 48 Stunden</li>
                  <li><strong>Dringende Meldungen:</strong> Innerhalb von 24 Stunden</li>
                </ul>
                <p className="text-sm text-gray-500 mt-3">
                  Bitte beachte: An Wochenenden und Feiertagen kann die Antwortzeit länger sein.
                </p>
              </div>
            </section>

            {/* FAQ-Hinweis */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Häufig gestellte Fragen</h2>
              
              <p className="text-gray-700 mb-4">
                Viele Fragen werden bereits in unseren <a href="/faq" className="text-green-600 hover:underline font-semibold">FAQ</a> beantwortet. 
                Schau dort gerne zuerst nach, bevor du uns kontaktierst!
              </p>

              <div className="bg-green-50 p-4 rounded-lg border border-green-200 not-prose">
                <p className="text-green-800 text-sm">
                  💡 <strong>Tipp:</strong> Die meisten Fragen zu Registrierung, Verkaufen, Gebühren und 
                  rechtlichen Themen werden in den FAQ ausführlich erklärt.
                </p>
              </div>
            </section>

            {/* Social Media */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Folge uns</h2>
              
              <div className="flex items-center gap-4 not-prose">
                <a 
                  href="https://www.instagram.com/kalidad420/" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  className="flex items-center gap-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-2 rounded-lg hover:from-purple-600 hover:to-pink-600 transition"
                >
                  <Instagram className="h-5 w-5" />
                  <span>@kalidad420</span>
                </a>
              </div>
              
              <p className="text-sm text-gray-600 mt-3">
                Bleib auf dem Laufenden über neue Stecklinge, Anbau-Tipps und Community-Events!
              </p>
            </section>

            {/* Besuch uns */}
            <section>
              <h2 className="text-2xl font-bold mb-4">Besuch uns vor Ort</h2>
              
              <div className="bg-gray-50 p-4 rounded-lg not-prose">
                <div className="flex items-start gap-3 mb-4">
                  <MapPin className="h-5 w-5 text-purple-600 flex-shrink-0 mt-1" />
                  <div>
                    <p className="font-bold text-gray-900">Kalidad - Grow- & Headshop</p>
                    <p className="text-gray-700">Kahlbachring 16, 69254 Malsch</p>
                  </div>
                </div>
                
                <p className="text-sm text-gray-600 mb-3">
                  Unser Partner Kalidad bietet vor Ort Beratung, Equipment und Fachwissen rund um den 
                  biologischen Cannabis-Anbau. Schau vorbei und lass dich beraten!
                </p>

                <a 
                  href="https://www.google.com/maps/search/?api=1&query=Kahlbachring+16,+69254+Malsch" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  className="text-blue-600 hover:underline text-sm font-semibold"
                >
                  → Auf Google Maps öffnen
                </a>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: CookieBanner.tsx

**`client/src/components/CookieBanner.tsx`**

```typescript
import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { X } from "lucide-react";

export default function CookieBanner() {
  const [showBanner, setShowBanner] = useState(false);

  useEffect(() => {
    // Check if user has already accepted/declined cookies
    const cookieConsent = localStorage.getItem("cookieConsent");
    if (!cookieConsent) {
      // Show banner after a short delay for better UX
      setTimeout(() => setShowBanner(true), 1000);
    }
  }, []);

  const acceptCookies = () => {
    localStorage.setItem("cookieConsent", "accepted");
    setShowBanner(false);
  };

  const declineCookies = () => {
    localStorage.setItem("cookieConsent", "declined");
    setShowBanner(false);
  };

  if (!showBanner) return null;

  return (
    <div className="fixed bottom-0 left-0 right-0 z-50 bg-gray-900 text-white p-4 shadow-2xl border-t-2 border-green-500">
      <div className="max-w-7xl mx-auto">
        <div className="flex flex-col md:flex-row items-center justify-between gap-4">
          <div className="flex-1">
            <h3 className="text-lg font-bold mb-2">🍪 Cookie-Hinweis</h3>
            <p className="text-sm text-gray-300">
              Wir verwenden nur technisch notwendige Cookies, um die Funktionalität dieser Website zu gewährleisten. 
              Diese Cookies sind für den Betrieb der Seite erforderlich und können nicht deaktiviert werden. 
              Weitere Informationen finden Sie in unserer{" "}
              <a href="/datenschutz" className="text-green-400 hover:text-green-300 underline">
                Datenschutzerklärung
              </a>.
            </p>
          </div>
          
          <div className="flex gap-3 items-center">
            <Button
              variant="outline"
              size="sm"
              onClick={declineCookies}
              className="bg-transparent border-gray-500 text-white hover:bg-gray-800"
            >
              Ablehnen
            </Button>
            <Button
              size="sm"
              onClick={acceptCookies}
              className="bg-green-600 hover:bg-green-700 text-white"
            >
              Akzeptieren
            </Button>
            <button
              onClick={() => setShowBanner(false)}
              className="text-gray-400 hover:text-white ml-2"
              aria-label="Schließen"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: DashboardLayout.tsx

**`client/src/components/DashboardLayout.tsx`**

```typescript
import { Avatar, AvatarFallback } from "@/components/ui/avatar";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarHeader,
  SidebarInset,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarProvider,
  SidebarTrigger,
  useSidebar,
} from "@/components/ui/sidebar";
import { APP_LOGO, APP_TITLE, getLoginUrl } from "@/const";
import { useIsMobile } from "@/hooks/useMobile";
import { LayoutDashboard, LogOut, PanelLeft, Users } from "lucide-react";
import { CSSProperties, useEffect, useRef, useState } from "react";
import { useLocation } from "wouter";
import { DashboardLayoutSkeleton } from './DashboardLayoutSkeleton';
import { Button } from "./ui/button";

const menuItems = [
  { icon: LayoutDashboard, label: "Page 1", path: "/" },
  { icon: Users, label: "Page 2", path: "/some-path" },
];

const SIDEBAR_WIDTH_KEY = "sidebar-width";
const DEFAULT_WIDTH = 280;
const MIN_WIDTH = 200;
const MAX_WIDTH = 480;

export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const [sidebarWidth, setSidebarWidth] = useState(() => {
    const saved = localStorage.getItem(SIDEBAR_WIDTH_KEY);
    return saved ? parseInt(saved, 10) : DEFAULT_WIDTH;
  });
  const { loading, user } = useAuth();

  useEffect(() => {
    localStorage.setItem(SIDEBAR_WIDTH_KEY, sidebarWidth.toString());
  }, [sidebarWidth]);

  if (loading) {
    return <DashboardLayoutSkeleton />
  }

  if (!user) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="flex flex-col items-center gap-8 p-8 max-w-md w-full">
          <div className="flex flex-col items-center gap-6">
            <div className="relative group">
              <div className="relative">
                <img
                  src={APP_LOGO}
                  alt={APP_TITLE}
                  className="h-20 w-20 rounded-xl object-cover shadow"
                />
              </div>
            </div>
            <div className="text-center space-y-2">
              <h1 className="text-2xl font-bold tracking-tight">{APP_TITLE}</h1>
              <p className="text-sm text-muted-foreground">
                Please sign in to continue
              </p>
            </div>
          </div>
          <Button```

#### Schritt 5.x: FAQ.tsx

**`client/src/components/FAQ.tsx`**

```typescript
import BackButton from "@/components/BackButton";
import { useState } from "react";
import { ChevronDown, ChevronUp } from "lucide-react";
import { trpc } from "@/lib/trpc";

interface FAQItem {
  question: string;
  answer: string | React.ReactNode;
  category: string;
}

export default function FAQ() {
  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);
  
  // Load dynamic fees from system settings
  const { data: platformFeeStr } = trpc.admin.getSystemSetting.useQuery('platform_fee_fixed', { staleTime: 300000 });
  const { data: paypalFeePercentageStr } = trpc.admin.getSystemSetting.useQuery('paypal_fee_percentage', { staleTime: 300000 });
  const { data: paypalFeeFixedStr } = trpc.admin.getSystemSetting.useQuery('paypal_fee_fixed', { staleTime: 300000 });
  
  const PLATFORM_FEE = parseFloat(platformFeeStr || "0.42");
  const PAYPAL_FEE_PERCENTAGE = parseFloat(paypalFeePercentageStr || "0.0249");
  const PAYPAL_FEE_FIXED = parseFloat(paypalFeeFixedStr || "0.49");
  const EXAMPLE_PAYPAL_FEE_20 = (20 * PAYPAL_FEE_PERCENTAGE + PAYPAL_FEE_FIXED).toFixed(2);

  const faqData: FAQItem[] = [
  // Allgemeine Fragen
  {
    category: "Allgemein",
    question: "Was ist deimudda?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>deimudda</strong> ist ein Online-Marktplatz für Cannabis-Stecklinge und Samen in Deutschland. 
          Wir vermitteln zwischen privaten und gewerblichen Verkäufern und Käufern.
        </p>
        <p>
          <strong>Wichtig:</strong> deimudda ist <strong>kein Händler</strong>, sondern nur Vermittler. 
          Der Kaufvertrag kommt direkt zwischen Käufer und Verkäufer zustande.
        </p>
      </div>
    )
  },
  {
    category: "Allgemein",
    question: "Ist deimudda legal?",
    answer: (
      <div>
        <p className="mb-2">
          Ja! Cannabis-Stecklinge und Samen sind seit dem <strong>Konsumcannabisgesetz (KCanG)</strong> vom 1. April 2024 
          in Deutschland legal.
        </p>
        <p className="mb-2">
          <strong>Wichtige Einschränkungen:</strong>
        </p>
        <ul className="list-disc pl-6 space-y-1">
          <li>Nur für Personen ab 18 Jahren</li>
          <li>Maximal 3 Pflanzen gleichzeitig im privaten Besitz (§ 3 Abs. 1 KCanG)</li>
          <li>Nur für legale Zwecke (Eigenanbau nach KCanG)</li>
        </ul>
      </div>
    )
  },
  {
    category: "Allgemein",
    question: "Wie funktioniert deimudda?",
    answer: (
      <div>
        <ol className="list-decimal pl-6 space-y-2">
          <li><strong>Registrierung:</strong> Erstelle einen Account (kostenlos)</li>
          <li><strong>Stöbern:</strong> Durchsuche Listings von Verkäufern</li>
          <li><strong>Kaufen:</strong> Wähle ein Listing und schließe den Kauf ab (PayPal)</li>
          <li><strong>Kontakt:</strong> Der Verkäufer kontaktiert dich für Versand/Abholung</li>
          <li><strong>Bewerten:</strong> Nach Erhalt kannst du den Verkäufer bewerten</li>
        </ol>
      </div>
    )
  },
  {
    category: "Allgemein",
    question: "Was kostet die Nutzung von deimudda?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>Für Käufer:</strong> Die Nutzung ist <strong>kostenlos</strong>. Du zahlst nur den Produktpreis + ggf. Versandkosten.
        </p>
        <p>
          <strong>Für Verkäufer:</strong> Pro verkauftem Artikel fällt eine <strong>Plattformgebühr von €{PLATFORM_FEE.toFixed(2).replace('.', ',')}</strong> an. 
          Bei Online-Zahlung über PayPal kommen zusätzlich PayPal-Gebühren hinzu (ca. {(PAYPAL_FEE_PERCENTAGE * 100).toFixed(2)}% + €{PAYPAL_FEE_FIXED.toFixed(2).replace('.', ',')}).
        </p>
      </div>
    )
  },

  // Registrierung & Account
  {
    category: "Registrierung & Account",
    question: "Wie registriere ich mich?",
    answer: (
      <div>
        <ol className="list-decimal pl-6 space-y-2">
          <li>Klicke auf "Zum Dashboard" oder "Registrieren"</li>
          <li>Melde dich über OAuth an (z.B. Google, GitHub)</li>
          <li>Wähle einen Nickname</li>
          <li>Fertig! Du kannst jetzt kaufen und verkaufen</li>
        </ol>
        <p className="mt-3 text-sm text-gray-600">
          <strong>Hinweis:</strong> Wir verwenden OAuth für sichere Authentifizierung. Deine Zugangsdaten werden nicht bei uns gespeichert.
        </p>
      </div>
    )
  },
  {
    category: "Registrierung & Account",
    question: "Kann ich meinen Account löschen?",
    answer: (
      <div>
        <p className="mb-2">
          Ja, du kannst deinen Account jederzeit in den <strong>Profil-Einstellungen</strong> löschen.
        </p>
        <p className="text-sm text-gray-600">
          <strong>Wichtig:</strong> Transaktionsdaten werden aus steuerrechtlichen Gründen 10 Jahre aufbewahrt 
          (anonymisiert nach Account-Löschung).
        </p>
      </div>
    )
  },
  {
    category: "Registrierung & Account",
    question: "Wie ändere ich mein Profil?",
    answer: (
      <div>
        <p className="mb-2">
          Gehe zu <strong>Dashboard → Profil-Einstellungen</strong>. Dort kannst du ändern:
        </p>
        <ul className="list-disc pl-6 space-y-1">
          <li>Nickname</li>
          <li>Standort</li>
          <li>Profilbild</li>
        </ul>
      </div>
    )
  },

  // Kaufen
  {
    category: "Kaufen",
    question: "Wie kaufe ich einen Steckling?",
    answer: (
      <div>
        <ol className="list-decimal pl-6 space-y-2">
          <li>Suche ein Listing auf der <strong>Browse-Seite</strong></li>
          <li>Klicke auf "Details" für mehr Informationen</li>
          <li>Klicke auf "Kaufen" oder mache einen Preisvorschlag (falls aktiviert)</li>
          <li>Wähle Versand oder Abholung</li>
          <li>Zahle über PayPal</li>
          <li>Der Verkäufer wird dich kontaktieren</li>
        </ol>
      </div>
    )
  },
  {
    category: "Kaufen",
    question: "Welche Zahlungsmethoden gibt es?",
    answer: (
      <div>
        <p className="mb-2">
          Aktuell unterstützen wir nur <strong>PayPal</strong> für Online-Zahlungen.
        </p>
        <p className="mb-2">
          <strong>Bei Abholung:</strong> Barzahlung vor Ort möglich (Vereinbarung mit Verkäufer).
        </p>
        <p className="text-sm text-gray-600">
          <strong>Hinweis:</strong> Die Zahlung geht direkt an den Verkäufer, nicht an deimudda.
        </p>
      </div>
    )
  },
  {
    category: "Kaufen",
    question: "Was sind Preisvorschläge?",
    answer: (
      <div>
        <p className="mb-2">
          Verkäufer können bei ihren Listings die <strong>Preisvorschlag-Funktion</strong> aktivieren. 
          Als Käufer kannst du dann ein Angebot machen.
        </p>
        <p className="mb-2">
          <strong>Ablauf:</strong>
        </p>
        <ol className="list-decimal pl-6 space-y-1">
          <li>Du machst ein Angebot mit deinem Wunschpreis</li>
          <li>Der Verkäufer kann annehmen oder ablehnen</li>
          <li>Bei Annahme wird automatisch eine Transaktion erstellt</li>
          <li>Du wirst zur Zahlung weitergeleitet</li>
        </ol>
      </div>
    )
  },
  {
    category: "Kaufen",
    question: "Kann ich einen Kauf widerrufen?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>Grundsätzlich ja</strong>, aber mit Einschränkungen bei lebenden Pflanzen.
        </p>
        <p className="mb-2">
          <strong>Wichtig:</strong> Der Widerruf erfolgt gegenüber dem <strong>Verkäufer</strong>, nicht gegenüber deimudda. 
          Kontaktdaten findest du auf der Produktseite.
        </p>
        <p className="mb-2">
          <strong>Ausschluss des Widerrufsrechts:</strong> Bei lebenden Pflanzen (Stecklinge) kann das Widerrufsrecht 
          ausgeschlossen sein (§ 312g Abs. 2 Nr. 2 BGB), besonders wenn die Verpackung bereits geöffnet wurde.
        </p>
        <p className="text-sm text-gray-600">
          Mehr Infos: <a href="/widerruf" className="text-blue-600 hover:underline">Widerrufsbelehrung</a>
        </p>
      </div>
    )
  },
  {
    category: "Kaufen",
    question: "Was mache ich bei Problemen mit einem Verkäufer?",
    answer: (
      <div>
        <ol className="list-decimal pl-6 space-y-2">
          <li><strong>Erst:</strong> Kontaktiere den Verkäufer direkt (Kontaktdaten auf Produktseite)</li>
          <li><strong>Dann:</strong> Falls keine Lösung, kontaktiere unseren Support: <a href="mailto:support@deimudda.de" className="text-blue-600 hover:underline">support@deimudda.de</a></li>
          <li><strong>Bei schwerwiegenden Verstößen:</strong> Wir können Maßnahmen gegen den Verkäufer ergreifen (z.B. Account-Sperrung)</li>
        </ol>
      </div>
    )
  },

  // Verkaufen
  {
    category: "Verkaufen",
    question: "Wie werde ich Verkäufer?",
    answer: (
      <div>
        <ol className="list-decimal pl-6 space-y-2">
          <li>Registriere dich auf deimudda</li>
          <li>Gehe zu <strong>Dashboard → Verkäufer werden</strong></li>
          <li>Fülle das Verkäufer-Profil aus (Shop-Name, Beschreibung, Standort)</li>
          <li>Erstelle dein erstes Listing</li>
        </ol>
        <p className="mt-3 text-sm text-gray-600">
          <strong>Hinweis:</strong> Gewerbliche Verkäufer müssen ein eigenes Impressum und eine Datenschutzerklärung bereitstellen.
        </p>
      </div>
    )
  },
  {
    category: "Verkaufen",
    question: "Was kostet das Verkaufen?",
    answer: (
      <div>
        <p className="mb-2">
          Pro verkauftem Artikel fällt eine <strong>Plattformgebühr von €{PLATFORM_FEE.toFixed(2).replace('.', ',')}</strong> an.
        </p>
        <p className="mb-2">
          <strong>Bei Online-Zahlung (PayPal):</strong>
        </p>
        <ul className="list-disc pl-6 space-y-1">
          <li>PayPal-Gebühr: ca. {(PAYPAL_FEE_PERCENTAGE * 100).toFixed(2)}% + €{PAYPAL_FEE_FIXED.toFixed(2).replace('.', ',')}</li>
          <li>Beispiel: Bei €20 Verkaufspreis → €{EXAMPLE_PAYPAL_FEE_20.replace('.', ',')} PayPal-Gebühr</li>
        </ul>
        <p className="mt-2 text-sm text-gray-600">
          <strong>Bei Abholung (Barzahlung):</strong> Nur die Plattformgebühr (€{PLATFORM_FEE.toFixed(2).replace('.', ',')}), keine PayPal-Gebühren.
        </p>
      </div>
    )
  },
  {
    category: "Verkaufen",
    question: "Wie erstelle ich ein Listing?",
    answer: (
      <div>
        <ol className="list-decimal pl-6 space-y-2">
          <li>Gehe zu <strong>Verkäufer-Dashboard → Neues Listing</strong></li>
          <li>Fülle alle Pflichtfelder aus:
            <ul className="list-disc pl-6 mt-1">
              <li>Strain-Name (Sorte)</li>
              <li>Produkttyp (Steckling oder Samen)</li>
              <li>Preis</li>
              <li>Menge</li>
              <li>Beschreibung</li>
              <li>Bilder (mindestens 1)</li>
            </ul>
          </li>
          <li>Wähle Versandoptionen (Versand, Abholung oder beides)</li>
          <li>Optional: Aktiviere Preisvorschläge</li>
          <li>Klicke auf "Listing erstellen"</li>
        </ol>
      </div>
    )
  },
  {
    category: "Verkaufen",
    question: "Wie funktioniert die Auszahlung?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>Bei Online-Zahlung (PayPal):</strong> Das Geld geht direkt auf dein PayPal-Konto (abzüglich Gebühren).
        </p>
        <p className="mb-2">
          <strong>Bei Abholung (Barzahlung):</strong> Du erhältst das Geld direkt vom Käufer. Die Plattformgebühr (€{PLATFORM_FEE.toFixed(2).replace('.', ',')}) 
          wird später von deinem PayPal-Konto abgebucht.
        </p>
        <p className="text-sm text-gray-600">
          <strong>Wichtig:</strong> Stelle sicher, dass dein PayPal-Konto ausreichend Guthaben für die Plattformgebühren hat.
        </p>
      </div>
    )
  },
  {
    category: "Verkaufen",
    question: "Muss ich als Verkäufer ein Impressum haben?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>Gewerbliche Verkäufer: Ja!</strong> Du bist verpflichtet, ein eigenes Impressum und eine Datenschutzerklärung bereitzustellen.
        </p>
        <p className="mb-2">
          <strong>Private Verkäufer: Nein.</strong> Bei gelegentlichem Verkauf (z.B. Überschuss aus eigenem Anbau) ist kein Impressum erforderlich.
        </p>
        <p className="text-sm text-gray-600">
          <strong>Tipp:</strong> Bei Unsicherheit konsultiere einen Rechtsanwalt für IT-Recht.
        </p>
      </div>
    )
  },

  // Rechtliches
  {
    category: "Rechtliches",
    question: "Darf ich Cannabis-Blüten verkaufen?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>Nein!</strong> Auf deimudda dürfen nur <strong>Stecklinge und Samen</strong> gehandelt werden.
        </p>
        <p className="mb-2">
          Der Verkauf von <strong>Blütenständen</strong> (Cannabis-Blüten, Ernteprodukte) ist <strong>nicht erlaubt</strong> 
          und verstößt gegen unsere Nutzungsbedingungen.
        </p>
        <p className="text-sm text-gray-600">
          <strong>Konsequenz:</strong> Verstöße führen zur sofortigen Account-Sperrung und ggf. Strafanzeige.
        </p>
      </div>
    )
  },
  {
    category: "Rechtliches",
    question: "Wie viele Pflanzen darf ich besitzen?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>Private Nutzer:</strong> Maximal <strong>3 Pflanzen gleichzeitig</strong> (§ 3 Abs. 1 KCanG).
        </p>
        <p className="mb-2">
          <strong>Anbauvereinigungen:</strong> Andere Regelungen (siehe KCanG).
        </p>
        <p className="text-sm text-gray-600">
          <strong>Wichtig:</strong> deimudda übernimmt keine Haftung für Verstöße gegen das KCanG. 
          Informiere dich über die gesetzlichen Bestimmungen!
        </p>
      </div>
    )
  },
  {
    category: "Rechtliches",
    question: "Wer ist für Widerrufe zuständig?",
    answer: (
      <div>
        <p className="mb-2">
          <strong>Der Verkäufer</strong>, nicht deimudda!
        </p>
        <p className="mb-2">
          deimudda ist nur Vermittler. Der Kaufvertrag kommt direkt zwischen dir und dem Verkäufer zustande. 
          Für Widerrufe, Rücksendungen und Reklamationen ist der Verkäufer verantwortlich.
        </p>
        <p className="text-sm text-gray-600">
          Mehr Infos: <a href="/widerruf" className="text-blue-600 hover:underline">Widerrufsbelehrung</a>
        </p>
      </div>
    )
  },
  {
    category: "Rechtliches",
    question: "Wie werden meine Daten geschützt?",
    answer: (
      <div>
        <p className="mb-2">
          Wir nehmen Datenschutz ernst und halten uns an die <strong>DSGVO</strong>.
        </p>
        <p className="mb-2">
          <strong>Wichtig:</strong> Wenn du einen Kauf tätigst, werden deine Kontaktdaten an den Verkäufer übermittelt 
          (für Versand/Abholung). Der Verkäufer ist eigenständiger Datenverantwortlicher.
        </p>
        <p className="text-sm text-gray-600">
          Mehr Infos: <a href="/datenschutz" className="text-blue-600 hover:underline">Datenschutzerklärung</a>
        </p>
      </div>
    )
  },

  // Technisches
  {
    category: "Technisches",
    question: "Welche Browser werden unterstützt?",
    answer: (
      <div>
        <p className="mb-2">
          deimudda funktioniert mit allen modernen Browsern:
        </p>
        <ul className="list-disc pl-6 space-y-1">
          <li>Chrome / Chromium (empfohlen)</li>
          <li>Firefox</li>
          <li>Safari</li>
          <li>Edge</li>
        </ul>
        <p className="text-sm text-gray-600 mt-2">
          <strong>Hinweis:</strong> Stelle sicher, dass JavaScript aktiviert ist und Cookies erlaubt sind.
        </p>
      </div>
    )
  },
  {
    category: "Technisches",
    question: "Ich habe einen Bug gefunden. Was tun?",
    answer: (
      <div>
        <p className="mb-2">
          Danke für deine Hilfe! Bitte melde Bugs an: <a href="mailto:support@deimudda.de" className="text-blue-600 hover:underline">support@deimudda.de</a>
        </p>
        <p className="mb-2">
          <strong>Bitte gib an:</strong>
        </p>
        <ul className="list-disc pl-6 space-y-1">
          <li>Was ist passiert?</li>
          <li>Was hast du erwartet?</li>
          <li>Welcher Browser / welches Gerät?</li>
          <li>Screenshots (falls möglich)</li>
        </ul>
      </div>
    )
  },
  {
    category: "Technisches",
    question: "Gibt es eine mobile App?",
    answer: (
      <div>
        <p className="mb-2">
          Aktuell nicht, aber die Website ist <strong>mobilfreundlich</strong> (responsive Design).
        </p>
        <p className="text-sm text-gray-600">
          Du kannst deimudda problemlos auf deinem Smartphone oder Tablet nutzen.
        </p>
      </div>
    )
  }
  ];

  const categories = Array.from(new Set(faqData.map(item => item.category)));

  function FAQAccordion({ item }: { item: FAQItem }) {
    const [isOpen, setIsOpen] = useState(false);

    return (
      <div className="border border-gray-200 rounded-lg overflow-hidden">
        <button
          onClick={() => setIsOpen(!isOpen)}
          className="w-full px-6 py-4 text-left bg-white hover:bg-gray-50 transition flex items-center justify-between"
        >
          <span className="font-semibold text-gray-900">{item.question}</span>
          {isOpen ? (
            <ChevronUp className="h-5 w-5 text-gray-500 flex-shrink-0" />
          ) : (
            <ChevronDown className="h-5 w-5 text-gray-500 flex-shrink-0" />
          )}
        </button>
        {isOpen && (
          <div className="px-6 py-4 bg-gray-50 border-t border-gray-200">
            <div className="text-gray-700 prose prose-sm max-w-none">
              {item.answer}
            </div>
          </div>
        )}
      </div>
    );
  }

  const filteredFAQs = selectedCategory
    ? faqData.filter(item => item.category === selectedCategory)
    : faqData;

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 py-12">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <BackButton href="/" label="Zurück zur Startseite" />
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-4 text-gray-900">Häufig gestellte Fragen (FAQ)</h1>
          <p className="text-lg text-gray-700 mb-8">
            Hier findest du Antworten auf die häufigsten Fragen zu deimudda.
          </p>

          {/* Category Filter */}
          <div className="mb-8">
            <h2 className="text-sm font-semibold text-gray-600 mb-3">Kategorie filtern:</h2>
            <div className="flex flex-wrap gap-2">
              <button
                onClick={() => setSelectedCategory(null)}
                className={`px-4 py-2 rounded-lg font-medium transition ${
                  selectedCategory === null
                    ? "bg-green-600 text-white"
                    : "bg-gray-100 text-gray-700 hover:bg-gray-200"
                }`}
              >
                Alle
              </button>
              {categories.map(category => (
                <button
                  key={category}
                  onClick={() => setSelectedCategory(category)}
                  className={`px-4 py-2 rounded-lg font-medium transition ${
                    selectedCategory === category
                      ? "bg-green-600 text-white"
                      : "bg-gray-100 text-gray-700 hover:bg-gray-200"
                  }`}
                >
                  {category}
                </button>
              ))}
            </div>
          </div>

          {/* FAQ Items */}
          <div className="space-y-3">
            {filteredFAQs.map((item, index) => (
              <FAQAccordion key={index} item={item} />
            ))}
          </div>

          {/* Contact Hint */}
          <div className="mt-8 bg-green-50 border-l-4 border-green-500 p-6 rounded-r-lg">
            <h3 className="text-lg font-bold text-green-900 mb-2">Deine Frage ist nicht dabei?</h3>
            <p className="text-green-800 mb-3">
              Kein Problem! Kontaktiere uns einfach:
            </p>
            <a
              href="/contact"
              className="inline-block bg-green-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-green-700 transition"
            >
              Zum Kontaktformular
            </a>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: FeeStructure.tsx

**`client/src/components/FeeStructure.tsx`**

```typescript
import BackButton from "@/components/BackButton";
import { Calculator, Info, TrendingUp } from "lucide-react";
import { useState } from "react";
import { trpc } from "@/lib/trpc";

export default function FeeStructure() {
  const [price, setPrice] = useState<number>(20);
  const [method, setMethod] = useState<"online" | "cash">("online");

  // Load dynamic fees from system settings
  const { data: platformFeeStr } = trpc.admin.getSystemSetting.useQuery('platform_fee_fixed', { staleTime: 300000 });
  const { data: paypalFeePercentageStr } = trpc.admin.getSystemSetting.useQuery('paypal_fee_percentage', { staleTime: 300000 });
  const { data: paypalFeeFixedStr } = trpc.admin.getSystemSetting.useQuery('paypal_fee_fixed', { staleTime: 300000 });
  
  const platformFee = parseFloat(platformFeeStr || "0.42");
  const paypalPercentage = parseFloat(paypalFeePercentageStr || "0.0249");
  const paypalFixed = parseFloat(paypalFeeFixedStr || "0.49");

  const paypalFee = method === "online" ? price * paypalPercentage + paypalFixed : 0;
  const totalFees = platformFee + paypalFee;
  const sellerReceives = price - totalFees;

  return (
    <div className="min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 py-12">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <BackButton href="/" label="Zurück zur Startseite" />
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-8 text-gray-900">Gebührenstruktur</h1>
          
          <div className="prose prose-lg max-w-none">
            <p className="text-lg text-gray-700 mb-8">
              Transparenz ist uns wichtig! Hier erfährst du genau, welche Gebühren auf deimudda anfallen 
              und wie sie berechnet werden.
            </p>

            {/* Übersicht */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">📊 Gebühren-Übersicht</h2>
              
              <div className="grid md:grid-cols-2 gap-6 not-prose">
                {/* Für Käufer */}
                <div className="bg-blue-50 p-6 rounded-lg border border-blue-200">
                  <h3 className="text-xl font-bold text-blue-900 mb-3">Für Käufer</h3>
                  <div className="space-y-2">
                    <div className="flex justify-between items-center">
                      <span className="text-blue-800">Registrierung:</span>
                      <span className="font-bold text-blue-900">Kostenlos</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-blue-800">Nutzung:</span>
                      <span className="font-bold text-blue-900">Kostenlos</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-blue-800">Kaufgebühr:</span>
                      <span className="font-bold text-blue-900">€0,00</span>
                    </div>
                  </div>
                  <p className="text-sm text-blue-700 mt-4">
                    Du zahlst nur den Produktpreis + ggf. Versandkosten. Keine versteckten Gebühren!
                  </p>
                </div>

                {/* Für Verkäufer */}
                <div className="bg-green-50 p-6 rounded-lg border border-green-200">
                  <h3 className="text-xl font-bold text-green-900 mb-3">Für Verkäufer</h3>
                  <div className="space-y-2">
                    <div className="flex justify-between items-center">
                      <span className="text-green-800">Registrierung:</span>
                      <span className="font-bold text-green-900">Kostenlos</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-green-800">Listing erstellen:</span>
                      <span className="font-bold text-green-900">Kostenlos</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-green-800">Plattformgebühr:</span>
                      <span className="font-bold text-green-900">€{platformFee.toFixed(2).replace('.', ',')} / Artikel</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-green-800">PayPal-Gebühr:</span>
                      <span className="font-bold text-green-900">~{(paypalPercentage * 100).toFixed(2)}% + €{paypalFixed.toFixed(2).replace('.', ',')}</span>
                    </div>
                  </div>
                  <p className="text-sm text-green-700 mt-4">
                    Gebühren fallen nur bei erfolgreichem Verkauf an. Keine monatlichen Kosten!
                  </p>
                </div>
              </div>
            </section>

            {/* Detaillierte Gebühren */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">💰 Detaillierte Gebühren für Verkäufer</h2>
              
              <div className="space-y-6">
                {/* Plattformgebühr */}
                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                  <h3 className="text-xl font-semibold text-gray-900 mb-3">1. Plattformgebühr</h3>
                  
                  <div className="flex items-center justify-between mb-4">
                    <span className="text-gray-700">Gebühr pro verkauftem Artikel:</span>
                    <span className="text-2xl font-bold text-green-600">€{platformFee.toFixed(2).replace('.', ',')}</span>
                  </div>

                  <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <p className="text-sm text-blue-800">
                      <Info className="inline h-4 w-4 mr-1" />
                      <strong>Was deckt die Plattformgebühr ab?</strong>
                    </p>
                    <ul className="list-disc pl-6 mt-2 space-y-1 text-sm text-blue-800">
                      <li>Hosting und Betrieb der Plattform</li>
                      <li>Zahlungsabwicklung</li>
                      <li>Sicherheit und Datenschutz</li>
                      <li>Support und Kundenservice</li>
                      <li>Weiterentwicklung der Plattform</li>
                    </ul>
                  </div>
                </div>

                {/* PayPal-Gebühr */}
                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                  <h3 className="text-xl font-semibold text-gray-900 mb-3">2. PayPal-Gebühr (bei Online-Zahlung)</h3>
                  
                  <div className="space-y-3">
                    <div className="flex items-center justify-between">
                      <span className="text-gray-700">Prozentuale Gebühr:</span>
                      <span className="text-xl font-bold text-gray-900">{(paypalPercentage * 100).toFixed(2)}%</span>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-gray-700">Fixe Gebühr:</span>
                      <span className="text-xl font-bold text-gray-900">+ €{paypalFixed.toFixed(2).replace('.', ',')}</span>
                    </div>
                  </div>

                  <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200 mt-4">
                    <p className="text-sm text-yellow-800">
                      <strong>Wichtig:</strong> Die PayPal-Gebühr fällt nur bei <strong>Online-Zahlung</strong> an. 
                      Bei <strong>Abholung mit Barzahlung</strong> entfällt diese Gebühr.
                    </p>
                  </div>

                  <p className="text-sm text-gray-600 mt-3">
                    Die PayPal-Gebühr wird direkt von PayPal erhoben, nicht von deimudda. 
                    Wir haben keinen Einfluss auf die Höhe dieser Gebühr.
                  </p>
                </div>
              </div>
            </section>

            {/* Gebühren-Rechner */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                <Calculator className="h-6 w-6" />
                Gebühren-Rechner
              </h2>
              
              <div className="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-lg border-2 border-green-200 not-prose">
                <p className="text-gray-700 mb-4">
                  Berechne, wie viel du nach Abzug der Gebühren erhältst:
                </p>

                <div className="space-y-4">
                  {/* Verkaufspreis */}
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                      Verkaufspreis (€)
                    </label>
                    <input
                      type="number"
                      value={price}
                      onChange={(e) => setPrice(parseFloat(e.target.value) || 0)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                      min="0"
                      step="0.01"
                    />
                  </div>

                  {/* Zahlungsmethode */}
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                      Zahlungsmethode
                    </label>
                    <div className="flex gap-4">
                      <button
                        onClick={() => setMethod("online")}
                        className={`flex-1 px-4 py-2 rounded-lg font-medium transition ${
                          method === "online"
                            ? "bg-green-600 text-white"
                            : "bg-gray-200 text-gray-700 hover:bg-gray-300"
                        }`}
                      >
                        Online (PayPal)
                      </button>
                      <button
                        onClick={() => setMethod("cash")}
                        className={`flex-1 px-4 py-2 rounded-lg font-medium transition ${
                          method === "cash"
                            ? "bg-green-600 text-white"
                            : "bg-gray-200 text-gray-700 hover:bg-gray-300"
                        }`}
                      >
                        Abholung (Bar)
                      </button>
                    </div>
                  </div>

                  {/* Berechnung */}
                  <div className="bg-white p-4 rounded-lg border border-gray-300 space-y-2">
                    <div className="flex justify-between items-center text-gray-700">
                      <span>Verkaufspreis:</span>
                      <span className="font-semibold">€{price.toFixed(2)}</span>
                    </div>
                    <div className="flex justify-between items-center text-gray-700">
                      <span>Plattformgebühr:</span>
                      <span className="font-semibold text-red-600">- €{platformFee.toFixed(2)}</span>
                    </div>
                    {method === "online" && (
                      <div className="flex justify-between items-center text-gray-700">
                        <span>PayPal-Gebühr:</span>
                        <span className="font-semibold text-red-600">- €{paypalFee.toFixed(2)}</span>
                      </div>
                    )}
                    <div className="border-t border-gray-300 pt-2 mt-2">
                      <div className="flex justify-between items-center">
                        <span className="font-bold text-gray-900">Du erhältst:</span>
                        <span className="text-2xl font-bold text-green-600">€{sellerReceives.toFixed(2)}</span>
                      </div>
                    </div>
                  </div>

                  <div className="bg-blue-50 p-3 rounded-lg border border-blue-200">
                    <p className="text-sm text-blue-800">
                      <Info className="inline h-4 w-4 mr-1" />
                      <strong>Tipp:</strong> Bei Abholung mit Barzahlung sparst du die PayPal-Gebühr!
                    </p>
                  </div>
                </div>
              </div>
            </section>

            {/* Beispielrechnungen */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">📈 Beispielrechnungen</h2>
              
              <div className="space-y-4 not-prose">
                {/* Beispiel 1 */}
                <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                  <h3 className="font-bold text-gray-900 mb-3">Beispiel 1: €10 Steckling (Online-Zahlung)</h3>
                  <div className="space-y-1 text-sm">
                    <div className="flex justify-between">
                      <span>Verkaufspreis:</span>
                      <span className="font-semibold">€10,00</span>
                    </div>
                    <div className="flex justify-between text-red-600">
                      <span>- Plattformgebühr:</span>
                      <span className="font-semibold">€{platformFee.toFixed(2).replace('.', ',')}</span>
                    </div>
                    <div className="flex justify-between text-red-600">
                      <span>- PayPal-Gebühr ({(paypalPercentage * 100).toFixed(2)}% + €{paypalFixed.toFixed(2).replace('.', ',')}):</span>
                      <span className="font-semibold">€{(15 * paypalPercentage + paypalFixed).toFixed(2).replace('.', ',')}</span>
                    </div>
                    <div className="flex justify-between border-t border-gray-300 pt-1 mt-1">
                      <span className="font-bold">Du erhältst:</span>
                      <span className="font-bold text-green-600">€8,70</span>
                    </div>
                  </div>
                </div>

                {/* Beispiel 2 */}
                <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                  <h3 className="font-bold text-gray-900 mb-3">Beispiel 2: €20 Steckling (Online-Zahlung)</h3>
                  <div className="space-y-1 text-sm">
                    <div className="flex justify-between">
                      <span>Verkaufspreis:</span>
                      <span className="font-semibold">€20,00</span>
                    </div>
                    <div className="flex justify-between text-red-600">
                      <span>- Plattformgebühr:</span>
                      <span className="font-semibold">€{platformFee.toFixed(2).replace('.', ',')}</span>
                    </div>
                    <div className="flex justify-between text-red-600">
                      <span>- PayPal-Gebühr ({(paypalPercentage * 100).toFixed(2)}% + €{paypalFixed.toFixed(2).replace('.', ',')}):</span>
                      <span className="font-semibold">€{(20 * paypalPercentage + paypalFixed).toFixed(2).replace('.', ',')}</span>
                    </div>
                    <div className="flex justify-between border-t border-gray-300 pt-1 mt-1">
                      <span className="font-bold">Du erhältst:</span>
                      <span className="font-bold text-green-600">€18,17</span>
                    </div>
                  </div>
                </div>

                {/* Beispiel 3 */}
                <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                  <h3 className="font-bold text-green-900 mb-3">Beispiel 3: €20 Steckling (Abholung, Barzahlung)</h3>
                  <div className="space-y-1 text-sm">
                    <div className="flex justify-between">
                      <span>Verkaufspreis:</span>
                      <span className="font-semibold">€20,00</span>
                    </div>
                    <div className="flex justify-between text-red-600">
                      <span>- Plattformgebühr:</span>
                      <span className="font-semibold">€{platformFee.toFixed(2).replace('.', ',')}</span>
                    </div>
                    <div className="flex justify-between text-gray-500">
                      <span>- PayPal-Gebühr:</span>
                      <span className="font-semibold">€0,00</span>
                    </div>
                    <div className="flex justify-between border-t border-green-300 pt-1 mt-1">
                      <span className="font-bold">Du erhältst:</span>
                      <span className="font-bold text-green-600">€19,58</span>
                    </div>
                  </div>
                  <p className="text-xs text-green-700 mt-2">
                    <TrendingUp className="inline h-3 w-3 mr-1" />
                    Ersparnis: €1,41 durch Barzahlung!
                  </p>
                </div>
              </div>
            </section>

            {/* Tipps zur Gebühren-Optimierung */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">💡 Tipps zur Gebühren-Optimierung</h2>
              
              <div className="space-y-3 not-prose">
                <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                  <h3 className="font-bold text-blue-900 mb-2">1. Abholung anbieten</h3>
                  <p className="text-sm text-blue-800">
                    Bei Barzahlung sparst du die PayPal-Gebühr. Das kann bei höheren Preisen einen großen Unterschied machen!
                  </p>
                </div>

                <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                  <h3 className="font-bold text-green-900 mb-2">2. Gebühren einkalkulieren</h3>
                  <p className="text-sm text-green-800">
                    Setze deinen Preis so, dass du nach Abzug der Gebühren den gewünschten Betrag erhältst. 
                    Nutze den Gebühren-Rechner oben!
                  </p>
                </div>

                <div className="bg-purple-50 p-4 rounded-lg border border-purple-200">
                  <h3 className="font-bold text-purple-900 mb-2">3. Mehrere Artikel verkaufen</h3>
                  <p className="text-sm text-purple-800">
                    Die Plattformgebühr (€{platformFee.toFixed(2).replace('.', ',')}) ist fix. Bei höheren Preisen fällt sie prozentual weniger ins Gewicht.
                  </p>
                </div>

                <div className="bg-orange-50 p-4 rounded-lg border border-orange-200">
                  <h3 className="font-bold text-orange-900 mb-2">4. Versandkosten separat berechnen</h3>
                  <p className="text-sm text-orange-800">
                    Versandkosten können separat angegeben werden und unterliegen nicht den Gebühren.
                  </p>
                </div>
              </div>
            </section>

            {/* Vergleich mit anderen Plattformen */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">🔍 Vergleich mit anderen Plattformen</h2>
              
              <div className="overflow-x-auto not-prose">
                <table className="w-full border-collapse border border-gray-300">
                  <thead className="bg-gray-100">
                    <tr>
                      <th className="border border-gray-300 px-4 py-2 text-left">Plattform</th>
                      <th className="border border-gray-300 px-4 py-2 text-left">Gebühren</th>
                      <th className="border border-gray-300 px-4 py-2 text-left">Bei €20 Verkauf</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr className="bg-green-50">
                      <td className="border border-gray-300 px-4 py-2 font-bold">deimudda</td>
                      <td className="border border-gray-300 px-4 py-2">€{platformFee.toFixed(2).replace('.', ',')} + PayPal (~{(paypalPercentage * 100).toFixed(1)}%)</td>
                      <td className="border border-gray-300 px-4 py-2 font-bold text-green-600">€18,17</td>
                    </tr>
                    <tr>
                      <td className="border border-gray-300 px-4 py-2">eBay</td>
                      <td className="border border-gray-300 px-4 py-2">~13% + PayPal</td>
                      <td className="border border-gray-300 px-4 py-2">~€15,50</td>
                    </tr>
                    <tr>
                      <td className="border border-gray-300 px-4 py-2">eBay Kleinanzeigen</td>
                      <td className="border border-gray-300 px-4 py-2">Kostenlos (keine Zahlung)</td>
                      <td className="border border-gray-300 px-4 py-2">€20,00 (bar)</td>
                    </tr>
                    <tr>
                      <td className="border border-gray-300 px-4 py-2">Etsy</td>
                      <td className="border border-gray-300 px-4 py-2">~8% + PayPal</td>
                      <td className="border border-gray-300 px-4 py-2">~€16,50</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <p className="text-sm text-gray-600 mt-3">
                <strong>Hinweis:</strong> deimudda bietet eine faire Gebührenstruktur speziell für Cannabis-Stecklinge. 
                Andere Plattformen erlauben Cannabis-Produkte oft gar nicht oder haben deutlich höhere Gebühren.
              </p>
            </section>

            {/* FAQ */}
            <section>
              <h2 className="text-2xl font-bold mb-4">❓ Häufige Fragen zu Gebühren</h2>
              
              <div className="space-y-4 not-prose">
                <div className="border border-gray-200 rounded-lg p-4">
                  <h3 className="font-bold text-gray-900 mb-2">Wann werden die Gebühren abgebucht?</h3>
                  <p className="text-sm text-gray-700">
                    Die PayPal-Gebühr wird sofort bei der Zahlung abgezogen. Die Plattformgebühr (€{platformFee.toFixed(2).replace('.', ',')}) wird 
                    nach Abschluss der Transaktion von deinem PayPal-Konto abgebucht.
                  </p>
                </div>

                <div className="border border-gray-200 rounded-lg p-4">
                  <h3 className="font-bold text-gray-900 mb-2">Gibt es versteckte Gebühren?</h3>
                  <p className="text-sm text-gray-700">
                    Nein! Die Gebührenstruktur ist vollständig transparent. Es gibt keine versteckten Kosten, 
                    monatlichen Gebühren oder Überraschungen.
                  </p>
                </div>

                <div className="border border-gray-200 rounded-lg p-4">
                  <h3 className="font-bold text-gray-900 mb-2">Kann ich die Gebühren an den Käufer weitergeben?</h3>
                  <p className="text-sm text-gray-700">
                    Ja, du kannst die Gebühren in deinen Verkaufspreis einkalkulieren. Nutze den Gebühren-Rechner 
                    oben, um den optimalen Preis zu berechnen.
                  </p>
                </div>

                <div className="border border-gray-200 rounded-lg p-4">
                  <h3 className="font-bold text-gray-900 mb-2">Was passiert bei Rückerstattungen?</h3>
                  <p className="text-sm text-gray-700">
                    Bei Rückerstattungen werden die PayPal-Gebühren zurückerstattet. Die Plattformgebühr (€{platformFee.toFixed(2).replace('.', ',')}) 
                    wird nicht zurückerstattet, da die Transaktion bereits abgewickelt wurde.
                  </p>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: Header.tsx

**`client/src/components/Header.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import { Button } from "@/components/ui/button";
import { APP_TITLE, getLoginUrl } from "@/const";
import { Link } from "wouter";
import { NotificationBell } from "@/components/NotificationBell";
import { MessageIcon } from "@/components/MessageIcon";

/**
 * Global navigation header component
 * Displays logo, user info, messages, notifications, dashboard link, and logout
 * Should be used on all main pages for consistent navigation
 */
export function Header() {
  const { user, isAuthenticated, logout } = useAuth();

  return (
    <nav className="bg-white shadow-sm sticky top-0 z-50">
      <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
        <Link href="/">
          <div className="flex items-center gap-2 cursor-pointer hover:opacity-80 transition">
            <img src="/seedling-logo.png" alt="deimudda Logo" className="h-10 w-10" />
            <h1 className="text-2xl font-bold text-green-700">{APP_TITLE}</h1>
          </div>
        </Link>
        <div className="flex items-center gap-4">
          {isAuthenticated ? (
            <>
              <span className="text-sm text-gray-600 hidden sm:inline">Hallo, {user?.name}</span>
              <MessageIcon />
              <NotificationBell />
              <Link href="/profile">
                <Button variant="outline" size="sm">
                  Dashboard
                </Button>
              </Link>
              <Button
                variant="ghost"
                size="sm"
                onClick={() => logout()}
              >
                Logout
              </Button>
            </>
          ) : (
            <Button
              size="sm"
              onClick={() => (window.location.href = getLoginUrl())}
            >
              Login / Registrieren
            </Button>
          )}
        </div>
      </div>
    </nav>
  );
}

```

#### Schritt 5.x: Home.tsx

**`client/src/components/Home.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { APP_LOGO, APP_TITLE, getLoginUrl } from "@/const";
import { Link } from "wouter";
import { trpc } from "@/lib/trpc";
import { ShoppingCart, Leaf, TrendingUp, Lock, Zap, Users, Search } from "lucide-react";
import { useState } from "react";
import type { Listing } from "@/../../shared/types";
import { useLocation } from "wouter";
import { NotificationBell } from "@/components/NotificationBell";
import { MessageIcon } from "@/components/MessageIcon";

export default function Home() {
  const { user, isAuthenticated, logout } = useAuth();
  const activeListings = trpc.listing.getActive.useQuery({ limit: 6 }, { staleTime: 60000 });
  const platformFee = trpc.admin.getSystemSetting.useQuery('platform_fee_fixed', { staleTime: 300000 });
  const paypalFeePercentage = trpc.admin.getSystemSetting.useQuery('paypal_fee_percentage', { staleTime: 300000 });
  const paypalFeeFixed = trpc.admin.getSystemSetting.useQuery('paypal_fee_fixed', { staleTime: 300000 });
  
  const PLATFORM_FEE = parseFloat(platformFee.data || "0.42");
  const PAYPAL_FEE_PERCENTAGE = parseFloat(paypalFeePercentage.data || "0.0249");
  const PAYPAL_FEE_FIXED = parseFloat(paypalFeeFixed.data || "0.49");
  const EXAMPLE_PAYPAL_FEE = (10 * PAYPAL_FEE_PERCENTAGE + PAYPAL_FEE_FIXED); // Example for €10
  const [searchQuery, setSearchQuery] = useState("");
  const [, setLocation] = useLocation();

  const handleSearch = (e: React.FormEvent) => {
    e.preventDefault();
    if (searchQuery.trim()) {
      setLocation(`/browse?search=${encodeURIComponent(searchQuery)}`);
    } else {
      setLocation('/browse');
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      {/* Navigation */}
      <nav className="bg-white shadow-sm sticky top-0 z-50">
        <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
          <div className="flex items-center gap-2">
            <img src="/seedling-logo.png" alt="deimudda Logo" className="h-10 w-10" />
            <h1 className="text-2xl font-bold text-green-700">{APP_TITLE}</h1>
          </div>
          <div className="flex items-center gap-4">
            {isAuthenticated ? (
              <>
                <span className="text-sm text-gray-600">Hallo, {user?.name}</span>
                <MessageIcon />
                <NotificationBell />
                <Link href="/profile">
                  <Button variant="outline" size="sm">
                    Dashboard
                  </Button>
                </Link>
                <Button
                  variant="ghost"
                  size="sm"
                  onClick={() => logout()}
                >
                  Logout
                </Button>
              </>
            ) : (
              <Button
                size="sm"
                onClick={() => (window.location.href = getLoginUrl())}
              >
                Login / Registrieren
              </Button>
            )}
          </div>
        </div>
      </nav>

      {/* Hero Section */}
      <section className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-20 text-center">
        {/* Seedling Logo */}
        <div className="flex justify-center mb-8">
          <img 
            src="/seedling-logo.png" 
            alt="Cannabis Stecklinge" 
            className="h-32 w-auto"
          />
        </div>
        <h2 className="text-5xl font-bold text-gray-900 mb-6">
          Cannabis-Stecklinge & Samen
        </h2>
        <p className="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
          Die erste legale Marktplattform für Cannabis-Vermehrungsmaterial in Deutschland.
          Kaufen und verkaufen Sie Stecklinge und Samen sicher und transparent.
        </p>
        {/* Search Bar */}
        <form onSubmit={handleSearch} className="max-w-2xl mx-auto mb-8">
          <div className="relative">
            <input
              type="text"
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              placeholder="Suche nach Strain, Typ, Verkäufer..."
              className="w-full px-6 py-4 pr-14 text-lg border-2 border-gray-300 rounded-full focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition"
            />
            <button
              type="submit"
              className="absolute right-2 top-1/2 -translate-y-1/2 bg-green-600 text-white p-3 rounded-full hover:bg-green-700 transition"
            >
              <Search className="w-5 h-5" />
            </button>
          </div>
        </form>

        <div className="flex gap-4 justify-center flex-wrap">
          <Link href="/profile">
            <Button size="lg" className="gap-2">
              <Leaf className="w-5 h-5" />
              {isAuthenticated ? "Zum Dashboard" : "Als Verkäufer starten"}
            </Button>
          </Link>
          <Link href="/browse">
            <Button variant="outline" size="lg" className="gap-2">
              <ShoppingCart className="w-5 h-5" />
              Stecklinge kaufen
            </Button>
          </Link>
        </div>
      </section>

      {/* Legal Disclaimer */}
      <section className="bg-red-50 border-l-4 border-red-500 py-8 px-6 mb-8">
        <div className="max-w-4xl mx-auto">
          <h2 className="text-lg font-bold text-red-900 mb-3">⚠️ Wichtiger Disclaimer</h2>
          <div className="text-sm text-red-800 space-y-2">
            <p>
              <strong>Rechtliche Rahmenbedingungen:</strong> Diese Plattform ist ausschließlich für den Handel mit Cannabis-Stecklingen und Samen gemäß des Konsumcannabisgesetzes (KCanG) bestimmt. Alle Nutzer verpflichten sich, die geltenden Gesetze einzuhalten.
            </p>
            <p>
              <strong>Zulässige Produkte:</strong> Es dürfen nur Stecklinge und Samen ohne Blütenstände, Fruchtstände oder andere Pflanzenteile mit Cannabinoid-Gehalt verkauft werden. Blüten, verarbeitete Produkte und andere illegale Waren sind streng verboten.
            </p>
            <p>
              <strong>Eigenverantwortung:</strong> Käufer und Verkäufer handeln in vollständiger Eigenverantwortung. deimudda übernimmt keine Haftung für illegale Nutzung oder Verstöße gegen das KCanG durch Nutzer.
            </p>
            <p>
              <strong>Altersangabe:</strong> Alle Nutzer bestätigen, dass sie mindestens 18 Jahre alt sind und die Nutzungsbedingungen akzeptieren.
            </p>
          </div>
        </div>
      </section>

      {/* Features Section */}
      <section className="bg-white py-16">
        <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
          <h3 className="text-3xl font-bold text-center mb-12">Warum deimudda?</h3>
          <div className="grid md:grid-cols-3 gap-8">
            <Card>
              <CardHeader>
                <Lock className="w-8 h-8 text-green-600 mb-2" />
                <CardTitle>100% Legal</CardTitle>
              </CardHeader>
              <CardContent>
                <p className="text-gray-600">
                  Stecklinge sind freiverkäufliches Vermehrungsmaterial und vollständig legal nach dem KCanG.
                </p>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <Zap className="w-8 h-8 text-green-600 mb-2" />
                <CardTitle>Einfach & Schnell</CardTitle>
              </CardHeader>
              <CardContent>
                <p className="text-gray-600">
                  Registrieren Sie sich, erstellen Sie ein Angebot und beginnen Sie zu verkaufen – in Minuten.
                </p>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <TrendingUp className="w-8 h-8 text-green-600 mb-2" />
                <CardTitle>Faire Gebühren</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-3">
                  <p className="text-gray-600 font-medium">
                    Transparente Gebührenstruktur:
                  </p>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between items-center">
                      <span className="text-gray-600">Plattformgebühr:</span>
                      <span className="font-semibold text-green-600">€{platformFee.data ? parseFloat(platformFee.data).toFixed(2).replace('.', ',') : '0,42'}</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-gray-600">PayPal-Gebühren:</span>
                      <span className="font-semibold text-blue-600">€{EXAMPLE_PAYPAL_FEE.toFixed(2).replace('.', ',')}</span>
                    </div>
                    <div className="border-t pt-2 mt-2">
                      <div className="flex justify-between items-center">
                        <span className="text-gray-700 font-medium">Bei Barzahlung:</span>
                        <span className="font-bold text-gray-800">€{PLATFORM_FEE.toFixed(2).replace('.', ',')}</span>
                      </div>
                      <div className="flex justify-between items-center mt-1">
                        <span className="text-gray-700 font-medium">Bei Online-Zahlung:</span>
                        <span className="font-bold text-gray-800">€{(PLATFORM_FEE + EXAMPLE_PAYPAL_FEE).toFixed(2).replace('.', ',')}</span>
                      </div>
                    </div>
                  </div>
                  <p className="text-xs text-gray-500 mt-2">
                    Keine versteckten Kosten. Alle Gebühren werden transparent angezeigt.
                  </p>
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <Users className="w-8 h-8 text-green-600 mb-2" />
                <CardTitle>Community</CardTitle>
              </CardHeader>
              <CardContent>
                <p className="text-gray-600">
                  Verbinden Sie sich mit anderen Züchtern und Liebhabern. Teilen Sie Ihr Wissen.
                </p>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <ShoppingCart className="w-8 h-8 text-green-600 mb-2" />
                <CardTitle>Auktionen & Festpreise</CardTitle>
              </CardHeader>
              <CardContent>
                <p className="text-gray-600">
                  Wählen Sie zwischen Festpreisen oder Auktionen. Maximale Flexibilität für Verkäufer.
                </p>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <Leaf className="w-8 h-8 text-green-600 mb-2" />
                <CardTitle>Vielfalt</CardTitle>
              </CardHeader>
              <CardContent>
                <p className="text-gray-600">
                  Tausende von Sorten und Züchtern. Finden Sie genau das, was Sie suchen.
                </p>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      {/* Active Listings Section */}
      <section className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <h3 className="text-3xl font-bold mb-8">Aktuelle Angebote</h3>
        {activeListings.isLoading ? (
          <p className="text-gray-500">Lädt...</p>
        ) : activeListings.data && activeListings.data.length > 0 ? (
          <div className="grid md:grid-cols-3 gap-6">
            {activeListings.data.map((listing) => (
              <Card key={listing.id} className="hover:shadow-lg transition-shadow">
                {listing.imageUrl && (
                  <img
                    src={listing.imageUrl}
                    alt={listing.strain}
                    className="w-full h-48 object-cover rounded-t-lg"
                  />
                )}
                <CardHeader>
                  <CardTitle className="text-lg">{listing.strain}</CardTitle>
                  <CardDescription>
                    {listing.type === "cutting" ? "Steckling" : "Samen"} • {listing.quantity} verfügbar
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <p className="text-gray-600 text-sm mb-4">{listing.description}</p>
                  <div className="flex justify-between items-center">
                    <span className="text-2xl font-bold text-green-600">
                      {listing.priceType === "fixed"
                        ? `€${parseFloat(listing.fixedPrice || "0").toFixed(2)}`
                        : `Ab €${parseFloat(listing.auctionStartPrice || "0").toFixed(2)}`}
                    </span>
                    <Button size="sm" onClick={() => window.location.href = `/listing/${listing.id}`}>
                      Details
                    </Button>
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        ) : (
          <p className="text-gray-500 text-center py-8">
            Noch keine Angebote vorhanden. Seien Sie der Erste!
          </p>
        )}
      </section>

      {/* CTA Section */}
      <section className="bg-green-600 text-white py-16">
        <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
          <h3 className="text-3xl font-bold mb-4">Bereit zu starten?</h3>
          <p className="text-lg mb-8 opacity-90">
            Werden Sie Teil der deimudda-Community und verdienen Sie mit Ihren Stecklingen.
          </p>
          {isAuthenticated ? (
            <Link href="/profile">
              <Button size="lg" variant="secondary">
                Zum Dashboard
              </Button>
            </Link>
          ) : (
            <Button
              size="lg"
              variant="secondary"
              onClick={() => (window.location.href = getLoginUrl())}
            >
              Jetzt registrieren
            </Button>
          )}
        </div>
      </section>

      {/* Footer */}
      <footer className="bg-gray-900 text-gray-400 py-8">
        <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="grid md:grid-cols-4 gap-8 mb-8">
            <div>
              <h4 className="text-white font-bold mb-4">deimudda</h4>
              <p className="text-sm">
                Die erste legale Marktplattform für Cannabis-Stecklinge und Samen in Deutschland.
              </p>
            </div>
            <div>
              <h4 className="font-semibold mb-4">Rechtliches</h4>
              <ul className="space-y-2 text-sm text-gray-400">
                <li><a href="/terms" className="hover:text-white">Nutzungsbedingungen</a></li>
                <li><a href="/datenschutz" className="hover:text-white">Datenschutz</a></li>
                <li><a href="/impressum" className="hover:text-white">Impressum</a></li>
              </ul>
            </div>
            <div>
              <h4 className="text-white font-bold mb-4">Plattform</h4>
              <ul className="text-sm space-y-2">
                <li><a href="/about" className="hover:text-white">Über uns</a></li>
                <li><a href="/contact" className="hover:text-white">Kontakt</a></li>
                <li><a href="/faq" className="hover:text-white">FAQ</a></li>
              </ul>
            </div>
            <div>
              <h4 className="text-white font-bold mb-4">Verkäufer</h4>
              <ul className="text-sm space-y-2">
                <li><a href="/seller-guidelines" className="hover:text-white">Verkäufer-Richtlinien</a></li>
                <li><a href="/fee-structure" className="hover:text-white">Gebührenstruktur</a></li>
                <li><a href="/support" className="hover:text-white">Support</a></li>
              </ul>
            </div>
          </div>
          <div className="border-t border-gray-800 pt-8 text-center text-sm">
            <p>&copy; 2025 deimudda. Alle Rechte vorbehalten.</p>
            <p className="mt-2 text-xs">
              Stecklinge sind legales Vermehrungsmaterial nach dem Konsumcannabisgesetz (KCanG).
            </p>
          </div>
        </div>
      </footer>
    </div>
  );
}

```

#### Schritt 5.x: ImageGallery.tsx

**`client/src/components/ImageGallery.tsx`**

```typescript
import { useState } from "react";
import { ChevronLeft, ChevronRight } from "lucide-react";

interface ImageGalleryProps {
  images: string[];
  altText?: string;
}

export function ImageGallery({ images, altText = "Bild" }: ImageGalleryProps) {
  const [currentIndex, setCurrentIndex] = useState(0);

  if (!images || images.length === 0) {
    return (
      <div className="w-full h-96 bg-gray-200 rounded-lg flex items-center justify-center">
        <span className="text-gray-500">Kein Bild</span>
      </div>
    );
  }

  const goToPrevious = () => {
    setCurrentIndex((prev) => (prev === 0 ? images.length - 1 : prev - 1));
  };

  const goToNext = () => {
    setCurrentIndex((prev) => (prev === images.length - 1 ? 0 : prev + 1));
  };

  return (
    <div className="space-y-4">
      {/* Main Image */}
      <div className="relative w-full h-96 bg-gray-100 rounded-lg overflow-hidden">
        <img
          src={images[currentIndex]}
          alt={`${altText} ${currentIndex + 1}`}
          className="w-full h-full object-contain"
        />

        {/* Navigation Arrows (only show if more than 1 image) */}
        {images.length > 1 && (
          <>
            <button
              onClick={goToPrevious}
              className="absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white rounded-full p-2 transition-colors"
            >
              <ChevronLeft className="h-6 w-6" />
            </button>
            <button
              onClick={goToNext}
              className="absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white rounded-full p-2 transition-colors"
            >
              <ChevronRight className="h-6 w-6" />
            </button>

            {/* Image Counter */}
            <div className="absolute bottom-4 right-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm">
              {currentIndex + 1} / {images.length}
            </div>
          </>
        )}
      </div>

      {/* Thumbnail Strip (only show if more than 1 image) */}
      {images.length > 1 && (
        <div className="flex gap-2 overflow-x-auto pb-2">
          {images.map((image, index) => (
            <button
              key={index}
              onClick={() => setCurrentIndex(index)}
              className={`flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden border-2 transition-all ${
                index === currentIndex
                  ? "border-blue-500 ring-2 ring-blue-200"
                  : "border-gray-300 hover:border-gray-400"
              }`}
            >
              <img
                src={image}
                alt={`Thumbnail ${index + 1}`}
                className="w-full h-full object-cover"
              />
            </button>
          ))}
        </div>
      )}
    </div>
  );
}

```

#### Schritt 5.x: ImageUpload.tsx

**`client/src/components/ImageUpload.tsx`**

```typescript
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { trpc } from "@/lib/trpc";
import { Upload, X } from "lucide-react";
import { useState, useEffect } from "react";
import { toast } from "sonner";

interface ImageUploadProps {
  label: string;
  currentImageUrl?: string;
  onImageUploaded: (url: string) => void;
  maxSizeMB?: number;
}

export default function ImageUpload({ label, currentImageUrl, onImageUploaded, maxSizeMB = 5 }: ImageUploadProps) {
  const [uploading, setUploading] = useState(false);
  const [previewUrl, setPreviewUrl] = useState<string | undefined>(currentImageUrl);

  // Update preview when currentImageUrl changes
  useEffect(() => {
    if (currentImageUrl) {
      setPreviewUrl(currentImageUrl);
    }
  }, [currentImageUrl]);

  const uploadImage = trpc.upload.image.useMutation({
    onSuccess: (data) => {
      setPreviewUrl(data.url);
      onImageUploaded(data.url);
      toast.success("Bild erfolgreich hochgeladen!");
      setUploading(false);
    },
    onError: (error: any) => {
      toast.error("Fehler beim Hochladen: " + error.message);
      setUploading(false);
    },
  });

  const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    // Check file size
    const fileSizeMB = file.size / (1024 * 1024);
    if (fileSizeMB > maxSizeMB) {
      toast.error(`Bild ist zu groß (max. ${maxSizeMB} MB)`);
      return;
    }
```

#### Schritt 5.x: Impressum.tsx

**`client/src/components/Impressum.tsx`**

```typescript
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";

export default function Impressum() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-8">
      <div className="max-w-4xl mx-auto">
        <Card>
          <CardHeader>
            <CardTitle className="text-3xl">Impressum</CardTitle>
          </CardHeader>
          <CardContent className="space-y-6">
            {/* Betreiber mit Logo */}
            <div>
              <h2 className="text-xl font-semibold mb-4">Angaben gemäß § 5 TMG</h2>
              <div className="flex items-center gap-6 mb-4">
                <img 
                  src="/vaperge-logo.png" 
                  alt="Vaperge Logo" 
                  className="h-32 w-auto"
                />
                <div>
                  <p className="text-gray-700">
                    <strong>Vaperge - Eau de Terpènes</strong><br />
                    Chris Rohleder<br />
                    Lessingstraße 11<br />
                    69254 Malsch<br />
                    Deutschland
                  </p>
                </div>
              </div>
            </div>

            {/* Kontakt */}
            <div>
              <h2 className="text-xl font-semibold mb-2">Kontakt</h2>
              <p className="text-gray-700">
                E-Mail: <a href="mailto:info@deimudda.de" className="text-blue-600 hover:underline">info@deimudda.de</a><br />
                Telefon: [Telefonnummer einfügen]
              </p>
            </div>

            {/* Umsatzsteuer-ID */}
            <div>
              <h2 className="text-xl font-semibold mb-2">Umsatzsteuer-ID</h2>
              <p className="text-gray-700">
                Umsatzsteuer-Identifikationsnummer gemäß § 27a UStG:<br />
                [USt-IdNr. einfügen, falls vorhanden]
              </p>
              <p className="text-sm text-gray-500 mt-1">
                Falls keine USt-IdNr. vorhanden, bitte diesen Abschnitt entfernen.
              </p>
            </div>

            {/* Kooperation */}
            <div>
              <h2 className="text-xl font-semibold mb-2">In Kooperation mit</h2>
              <div className="flex items-center gap-4">
                <img 
                  src="/kalidad-logo.png" 
                  alt="Kalidad Logo" 
                  className="h-20 w-auto bg-white p-2 rounded"
                />
                <div>
                  <p className="text-gray-700">
                    <strong>Kalidad - Grow- & Headshop</strong><br />
                    Kahlbachring 16<br />
                    69254 Malsch<br />
                    Deutschland
                  </p>
                  <p className="text-sm text-gray-500 mt-1">
                    Instagram: <a href="https://www.instagram.com/kalidad420/" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">@kalidad420</a>
                  </p>
                </div>
              </div>
            </div>

            {/* Verantwortlich für den Inhalt */}
            <div>
              <h2 className="text-xl font-semibold mb-2">Verantwortlich für den Inhalt nach § 18 Abs. 2 MStV</h2>
              <p className="text-gray-700">
                Chris Rohleder<br />
                Lessingstraße 11<br />
                69254 Malsch<br />
                Deutschland
              </p>
              <p className="text-sm text-gray-500 mt-2">
                Hinweis: § 55 Abs. 2 RStV wurde durch § 18 Abs. 2 MStV (Medienstaatsvertrag) ersetzt.
              </p>
            </div>

            {/* EU-Streitschlichtung */}
            <div>
              <h2 className="text-xl font-semibold mb-2">EU-Streitschlichtung</h2>
              <p className="text-gray-700 text-sm">
                Die Europäische Kommission stellt eine Plattform zur Online-Streitbeilegung (OS) bereit:<br />
                <a href="https://ec.europa.eu/consumers/odr/" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">
                  https://ec.europa.eu/consumers/odr/
                </a>
              </p>
              <p className="text-gray-700 text-sm mt-2">
                Unsere E-Mail-Adresse finden Sie oben im Impressum.
              </p>
            </div>

            {/* Verbraucherstreitbeilegung */}
            <div>
              <h2 className="text-xl font-semibold mb-2">Verbraucherstreitbeilegung / Universalschlichtungsstelle</h2>
              <p className="text-gray-700 text-sm">
                Wir sind nicht bereit oder verpflichtet, an Streitbeilegungsverfahren vor einer Verbraucherschlichtungsstelle teilzunehmen.
              </p>
              <p className="text-sm text-gray-500 mt-2">
                Hinweis: Falls Sie an Streitbeilegungsverfahren teilnehmen möchten, ändern Sie diese Formulierung entsprechend.
              </p>
            </div>

            {/* Marktplatz-Hinweis */}
            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
              <h2 className="text-xl font-semibold mb-2">deimudda ist ein Marktplatz</h2>
              <p className="text-gray-700 text-sm">
                <strong>Wichtiger Hinweis:</strong> deimudda ist ein Online-Marktplatz, der ausschließlich die Vermittlung zwischen Käufern und Verkäufern ermöglicht. 
                <strong> Wir sind nicht Vertragspartner</strong> der über die Plattform geschlossenen Kaufverträge.
              </p>
              <p className="text-gray-700 text-sm mt-2">
                Der Kaufvertrag kommt direkt zwischen dem Käufer und dem jeweiligen Verkäufer zustande. Der Verkäufer ist allein verantwortlich für:
              </p>
              <ul className="list-disc pl-6 text-sm text-gray-700 mt-2">
                <li>Die Qualität und Beschaffenheit der angebotenen Waren</li>
                <li>Die Erfüllung des Kaufvertrags (Versand, Lieferung)</li>
                <li>Die Einhaltung gesetzlicher Vorschriften (z.B. Widerrufsrecht, Gewährleistung)</li>
                <li>Die Bereitstellung eines eigenen Impressums (bei gewerblichen Verkäufern)</li>
                <li>Die Bereitstellung einer eigenen Datenschutzerklärung</li>
              </ul>
            </div>

            {/* Haftungsausschluss */}
            <div>
              <h2 className="text-xl font-semibold mb-2">Haftungsausschluss</h2>
              
              <h3 className="font-semibold mt-4 mb-2">Haftung für Inhalte (§ 7 TMG)</h3>
              <p className="text-gray-700 text-sm">
                Als Diensteanbieter sind wir gemäß § 7 Abs.1 TMG für eigene Inhalte auf diesen Seiten nach den allgemeinen Gesetzen verantwortlich. 
                Nach §§ 8 bis 10 TMG sind wir als Diensteanbieter jedoch nicht verpflichtet, übermittelte oder gespeicherte fremde Informationen zu überwachen 
                oder nach Umständen zu forschen, die auf eine rechtswidrige Tätigkeit hinweisen.
              </p>
              <p className="text-gray-700 text-sm mt-2">
                Verpflichtungen zur Entfernung oder Sperrung der Nutzung von Informationen nach den allgemeinen Gesetzen bleiben hiervon unberührt. 
                Eine diesbezügliche Haftung ist jedoch erst ab dem Zeitpunkt der Kenntnis einer konkreten Rechtsverletzung möglich. Bei Bekanntwerden 
                von entsprechenden Rechtsverletzungen werden wir diese Inhalte umgehend entfernen.
              </p>

              <h3 className="font-semibold mt-4 mb-2">Haftung für Verkäufer-Inhalte (§ 10 TMG - Speicherung von Informationen)</h3>
              <p className="text-gray-700 text-sm">
                Als Marktplatz-Betreiber speichern wir fremde Informationen (Listings, Produktbeschreibungen, Bilder) der Verkäufer. 
                Wir sind gemäß § 10 TMG nicht verpflichtet, diese Informationen zu überwachen oder nach Umständen zu forschen, die auf eine 
                rechtswidrige Tätigkeit hinweisen.
              </p>
              <p className="text-gray-700 text-sm mt-2">
                <strong>Bei Kenntnis von Rechtsverletzungen werden wir entsprechende Inhalte umgehend entfernen.</strong> Falls Sie rechtswidrige 
                Inhalte auf unserer Plattform feststellen, melden Sie diese bitte umgehend an: <a href="mailto:info@deimudda.de" className="text-blue-600 hover:underline">info@deimudda.de</a>
              </p>

              <h3 className="font-semibold mt-4 mb-2">Haftung für Links</h3>
              <p className="text-gray-700 text-sm">
                Unser Angebot enthält Links zu externen Webseiten Dritter, auf deren Inhalte wir keinen Einfluss haben. Deshalb können wir für 
                diese fremden Inhalte auch keine Gewähr übernehmen. Für die Inhalte der verlinkten Seiten ist stets der jeweilige Anbieter oder 
                Betreiber der Seiten verantwortlich. Die verlinkten Seiten wurden zum Zeitpunkt der Verlinkung auf mögliche Rechtsverstöße überprüft. 
                Rechtswidrige Inhalte waren zum Zeitpunkt der Verlinkung nicht erkennbar.
              </p>
              <p className="text-gray-700 text-sm mt-2">
                Eine permanente inhaltliche Kontrolle der verlinkten Seiten ist jedoch ohne konkrete Anhaltspunkte einer Rechtsverletzung nicht zumutbar. 
                Bei Bekanntwerden von Rechtsverletzungen werden wir derartige Links umgehend entfernen.
              </p>

              <h3 className="font-semibold mt-4 mb-2">Urheberrecht</h3>
              <p className="text-gray-700 text-sm">
                Die durch die Seitenbetreiber erstellten Inhalte und Werke auf diesen Seiten unterliegen dem deutschen Urheberrecht. Die Vervielfältigung, 
                Bearbeitung, Verbreitung und jede Art der Verwertung außerhalb der Grenzen des Urheberrechtes bedürfen der schriftlichen Zustimmung des 
                jeweiligen Autors bzw. Erstellers. Downloads und Kopien dieser Seite sind nur für den privaten, nicht kommerziellen Gebrauch gestattet.
              </p>
              <p className="text-gray-700 text-sm mt-2">
                Soweit die Inhalte auf dieser Seite nicht vom Betreiber erstellt wurden, werden die Urheberrechte Dritter beachtet. Insbesondere werden 
                Inhalte Dritter als solche gekennzeichnet. Sollten Sie trotzdem auf eine Urheberrechtsverletzung aufmerksam werden, bitten wir um einen 
                entsprechenden Hinweis. Bei Bekanntwerden von Rechtsverletzungen werden wir derartige Inhalte umgehend entfernen.
              </p>

              <h3 className="font-semibold mt-4 mb-2">Haftung für Qualität und Beschaffenheit der Waren</h3>
              <p className="text-gray-700 text-sm">
                deimudda haftet nicht für die Qualität, Beschaffenheit oder Rechtmäßigkeit der von Verkäufern angebotenen Waren. 
                Die Verkäufer sind allein verantwortlich für die Einhaltung gesetzlicher Vorschriften (z.B. Produktsicherheit, Gewährleistung, Widerrufsrecht).
              </p>
              <p className="text-gray-700 text-sm mt-2">
                Bei Problemen mit einem Kauf wenden Sie sich bitte direkt an den Verkäufer. Bei schwerwiegenden Verstößen gegen unsere 
                Nutzungsbedingungen können wir Maßnahmen gegen den Verkäufer ergreifen (z.B. Sperrung des Accounts).
              </p>
            </div>

            {/* Rechtliche Hinweise */}
            <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
              <h2 className="text-xl font-semibold mb-2">Rechtliche Hinweise zum Handel mit Cannabis-Stecklingen</h2>
              <p className="text-gray-700 text-sm mb-2">
                Diese Plattform dient ausschließlich dem Handel mit Cannabis-Stecklingen und Samen gemäß des <strong>Konsumcannabisgesetzes (KCanG)</strong>. 
                Alle Nutzer verpflichten sich, die geltenden Gesetze einzuhalten.
              </p>
              <p className="text-gray-700 text-sm mb-2">
                <strong>Wichtige Hinweise:</strong>
              </p>
              <ul className="list-disc pl-6 text-sm text-gray-700">
                <li>Nur Personen ab 18 Jahren dürfen Cannabis-Stecklinge und Samen erwerben</li>
                <li>Private Nutzer dürfen maximal 3 Pflanzen gleichzeitig besitzen (§ 3 Abs. 1 KCanG)</li>
                <li>Der Handel mit Blütenständen (Cannabis-Blüten) ist über diese Plattform nicht gestattet</li>
                <li>Die Nutzung der Plattform für illegale Zwecke ist strengstens untersagt</li>
              </ul>
              <p className="text-gray-700 text-sm mt-2">
                Der Plattformbetreiber übernimmt keine Haftung für illegale Nutzung oder Verstöße gegen das KCanG durch Nutzer. 
                Bei Verstößen gegen das KCanG oder unsere Nutzungsbedingungen behalten wir uns vor, Accounts zu sperren und 
                gegebenenfalls Strafverfolgungsbehörden zu informieren.
              </p>
            </div>

            {/* Bildnachweise */}
            <div>
              <h2 className="text-xl font-semibold mb-2">Bildnachweise</h2>
              <p className="text-gray-700 text-sm">
                Logos und Bilder auf dieser Seite sind Eigentum der jeweiligen Rechteinhaber:
              </p>
              <ul className="list-disc pl-6 text-sm text-gray-700 mt-2">
                <li>Vaperge Logo: © Vaperge - Eau de Terpènes</li>
                <li>Kalidad Logo: © Kalidad - Grow- & Headshop</li>
                <li>Produktbilder: © Jeweiliger Verkäufer (hochgeladen durch Verkäufer)</li>
              </ul>
            </div>

            {/* Technischer Betrieb */}
            <div>
              <h2 className="text-xl font-semibold mb-2">Technischer Betrieb</h2>
              <p className="text-gray-700 text-sm">
                Diese Website wird gehostet von: [Hosting-Provider einfügen]<br />
                Zahlungsabwicklung: PayPal (Europe) S.à.r.l. et Cie, S.C.A., 22-24 Boulevard Royal, L-2449 Luxembourg
              </p>
            </div>

            {/* Hinweis auf Plattform-Regeln */}
            <div className="bg-gray-50 border border-gray-200 rounded-lg p-4">
              <h2 className="text-xl font-semibold mb-2">Plattform-Regeln</h2>
              <p className="text-gray-700 text-sm">
                Alle Nutzer (Käufer und Verkäufer) sind verpflichtet, unsere <a href="/terms" className="text-blue-600 hover:underline">Nutzungsbedingungen</a> einzuhalten.
              </p>
              <p className="text-gray-700 text-sm mt-2">
                Verkäufer sind zusätzlich verpflichtet:
              </p>
              <ul className="list-disc pl-6 text-sm text-gray-700 mt-2">
                <li>Ein eigenes Impressum bereitzustellen (bei gewerblichem Verkauf)</li>
                <li>Eine eigene Datenschutzerklärung bereitzustellen</li>
                <li>Eine Widerrufsbelehrung bereitzustellen</li>
                <li>Die gesetzlichen Gewährleistungsrechte einzuhalten</li>
                <li>Nur legale Produkte gemäß KCanG anzubieten</li>
              </ul>
            </div>

            {/* Footer-Hinweis */}
            <div className="text-center text-sm text-gray-500 pt-4 border-t">
              <p>© 2025 deimudda. Alle Rechte vorbehalten.</p>
              <p className="mt-1">
                Stecklinge sind legales Vermehrungsmaterial nach dem Konsumcannabisgesetz (KCanG).
              </p>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: ListingDetail.tsx

**`client/src/components/ListingDetail.tsx`**

```typescript
import { Link, useParams } from "wouter";
import { useState } from "react";
import type { Listing } from "@/../../shared/types";
import { useAuth } from "@/_core/hooks/useAuth";
import { trpc } from "@/lib/trpc";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { AlertCircle, ShoppingCart, Gavel, MapPin, User, Star, MessageCircle } from "lucide-react";
import { ImageGallery } from "@/components/ImageGallery";
import { Alert, AlertDescription } from "@/components/ui/alert";
import NotFound from "./NotFound";
import { Breadcrumbs } from "@/components/Breadcrumbs";
import { Header } from "@/components/Header";

export default function ListingDetail() {
  const { id } = useParams<{ id: string }>();
  const { isAuthenticated } = useAuth();
  const listingId = parseInt(id || "0");
  const [showOfferDialog, setShowOfferDialog] = useState(false);
  const [offerAmount, setOfferAmount] = useState("");
  const [offerMessage, setOfferMessage] = useState("");
  const [offerError, setOfferError] = useState("");
  const [offerSuccess, setOfferSuccess] = useState(false);

  const createOffer = trpc.offer.create.useMutation({
    onSuccess: () => {
      setOfferSuccess(true);
      setTimeout(() => {
        setShowOfferDialog(false);
        setOfferSuccess(false);
        setOfferAmount("");
        setOfferMessage("");
      }, 2000);
    },
    onError: (error) => {
      setOfferError(error.message);
    },
  });

  const listing = trpc.listing.getById.useQuery(listingId, {
    enabled: !!id,
  });

  const sellerProfile = trpc.seller.getProfileById.useQuery(listing.data?.sellerId || 0, {
    enabled: !!listing.data?.sellerId,
  });

  const reviews = trpc.review.getBySellerId.useQuery(listing.data?.sellerId || 0, {
    enabled: !!listing.data?.sellerId,
  });

  if (listing.isLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <p className="text-gray-500">Lädt...</p>
      </div>
    );
  }

  if (!listing.data) {
    return <NotFound />;
  }

  const data = listing.data;

  // Parse images field (can be JSON string or array)
  const getImages = (): string[] => {
    if (data.images) {
      // If images is a string, try to parse it as JSON
      if (typeof data.images === 'string') {
        try {
          const parsed = JSON.parse(data.images);
          return Array.isArray(parsed) ? parsed : [];
        } catch {
          return [];
        }
      }
      // If images is already an array
      if (Array.isArray(data.images)) {
        return data.images;
      }
    }
    // Fallback to imageUrl if no images array
    return data.imageUrl ? [data.imageUrl] : [];
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      <Header />
      <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <Breadcrumbs 
          items={[
            { label: "Stecklinge & Samen", href: "/browse" },
            { label: data.strain }
          ]} 
        />
        {/* Back Button */}
        <a href="/" className="text-blue-600 hover:text-blue-800 mb-6 inline-block">
          ← Zurück
        </a>

        <div className="grid md:grid-cols-3 gap-8">
          {/* Main Content */}
          <div className="md:col-span-2">
            {/* Image Gallery */}
            <Card className="mb-6 overflow-hidden p-4">
              <ImageGallery 
                images={getImages()} 
                altText={data.strain}
              />
            </Card>

            {/* Details */}
            <Card>
              <CardHeader>
                <div className="flex justify-between items-start mb-4">
                  <div>
                    <CardTitle className="text-3xl">{data.strain}</CardTitle>
                    <CardDescription>
                      {data.type === "cutting" ? "Steckling" : "Samen"}
                    </CardDescription>
                  </div>
                  <Badge variant={data.status === "active" ? "default" : "secondary"}>
                    {data.status === "active" ? "Verfügbar" : "Nicht verfügbar"}
                  </Badge>
                </div>
              </CardHeader>
              <CardContent className="space-y-6">
                {/* Description */}
                {data.description && (
                  <div>
                    <h3 className="font-semibold mb-2">Beschreibung</h3>
                    <p className="text-gray-700">{data.description}</p>
                  </div>
                )}

                {/* Specs */}
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <p className="text-sm text-gray-600">Verfügbare Menge</p>
                    <p className="text-2xl font-bold">{data.quantity}</p>
                  </div>
                  <div>
                    <p className="text-sm text-gray-600">Preis</p>
                    <p className="text-2xl font-bold text-green-600">
                      {data.priceType === "fixed"
                        ? `€${parseFloat(data.fixedPrice || "0").toFixed(2)}`
                        : `Ab €${parseFloat(data.auctionStartPrice || "0").toFixed(2)}`}
                    </p>
                  </div>
                </div>

                {/* Additional Details */}
                {(data.genetics || data.seedBank || data.growMethod || data.seedType || data.thcContent || data.cbdContent || data.floweringTime || data.yieldInfo || data.flavorProfile || data.origin) && (
                  <div className="border-t pt-4 mt-4">
                    <h3 className="font-semibold mb-3">Zusätzliche Details</h3>
                    <div className="grid grid-cols-2 gap-4">
                      {data.genetics && (
                        <div>
                          <p className="text-sm text-gray-600">Genetik</p>
                          <p className="font-medium capitalize">{data.genetics}</p>
                        </div>
                      )}
                      {data.seedBank && (
                        <div>
                          <p className="text-sm text-gray-600">Samenbank/Breeder</p>
                          <p className="font-medium">{data.seedBank}</p>
                        </div>
                      )}
                      {data.growMethod && (
                        <div>
                          <p className="text-sm text-gray-600">Anbaumethode</p>
                          <p className="font-medium capitalize">{data.growMethod}</p>
                        </div>
                      )}
                      {data.seedType && (
                        <div>
                          <p className="text-sm text-gray-600">Samentyp</p>
                          <p className="font-medium capitalize">{data.seedType}</p>
                        </div>
                      )}
                      {data.thcContent && (
                        <div>
                          <p className="text-sm text-gray-600">THC-Gehalt</p>
                          <p className="font-medium">{data.thcContent}</p>
                        </div>
                      )}
                      {data.cbdContent && (
                        <div>
                          <p className="text-sm text-gray-600">CBD-Gehalt</p>
                          <p className="font-medium">{data.cbdContent}</p>
                        </div>
                      )}
                      {data.floweringTime && (
                        <div>
                          <p className="text-sm text-gray-600">Blütezeit</p>
                          <p className="font-medium">{data.floweringTime}</p>
                        </div>
                      )}
                      {data.yieldInfo && (
                        <div>
                          <p className="text-sm text-gray-600">Ertrag</p>
                          <p className="font-medium">{data.yieldInfo}</p>
                        </div>
                      )}
                      {data.origin && (
                        <div>
                          <p className="text-sm text-gray-600">Herkunft</p>
                          <p className="font-medium">{data.origin}</p>
                        </div>
                      )}
                      {data.flavorProfile && (
                        <div className="col-span-2">
                          <p className="text-sm text-gray-600">Geschmack/Aroma</p>
                          <p className="font-medium">{data.flavorProfile}</p>
                        </div>
                      )}
                    </div>
                  </div>
                )}

                {/* Auction Info */}
                {data.priceType === "auction" && data.auctionEndTime && (
                  <Alert>
                    <Gavel className="h-4 w-4" />
                    <AlertDescription>
                      Auktion endet am{" "}
                      {new Date(data.auctionEndTime).toLocaleDateString("de-DE", {
                        year: "numeric",
                        month: "long",
                        day: "numeric",
                        hour: "2-digit",
                        minute: "2-digit",
                      })}
                    </AlertDescription>
                  </Alert>
                )}

                {/* Legal Notice */}
                <Alert>
                  <AlertCircle className="h-4 w-4" />
                  <AlertDescription>
                    Stecklinge sind legales Vermehrungsmaterial nach dem Konsumcannabisgesetz (KCanG).
                    Sie dürfen keine Blüten oder Fruchtstände haben.
                  </AlertDescription>
                </Alert>
              </CardContent>
            </Card>
          </div>

          {/* Sidebar */}
          <div className="space-y-6">
            {/* Seller Info */}
            {sellerProfile.data && (
              <Card>
                <CardHeader>
                  <CardTitle className="text-lg">Verkäufer</CardTitle>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="flex items-center gap-3">
                    {sellerProfile.data.profileImageUrl ? (
                      <img
                        src={sellerProfile.data.profileImageUrl}
                        alt={sellerProfile.data.shopName}
                        className="w-12 h-12 rounded-full object-cover"
                      />
                    ) : (
                      <div className="w-12 h-12 rounded-full bg-gray-300 flex items-center justify-center">
                        <User className="w-6 h-6 text-gray-600" />
                      </div>
                    )}
                    <div className="flex-1">
                      <p className="font-semibold">{sellerProfile.data.shopName}</p>
                      <div className="flex items-center gap-1 text-sm">
                        <div className="flex items-center">
                          {[1, 2, 3, 4, 5].map((star) => (
                            <Star
                              key={star}
                              className={`w-4 h-4 ${
                                star <= Math.round(parseFloat(sellerProfile.data.rating || "0"))
                                  ? "fill-yellow-400 text-yellow-400"
                                  : "text-gray-300"
                              }`}
                            />
                          ))}
                        </div>
                        <span className="text-gray-600 ml-1">
                          {parseFloat(sellerProfile.data.rating || "0").toFixed(1)} ({sellerProfile.data.totalReviews})
                        </span>
                      </div>
                    </div>
                  </div>

                  {sellerProfile.data.location && (
                    <div className="flex items-center gap-2 text-sm text-gray-600">
                      <MapPin className="w-4 h-4" />
                      {sellerProfile.data.location}
                    </div>
                  )}

                  {sellerProfile.data.description && (
                    <p className="text-sm text-gray-700">{sellerProfile.data.description}</p>
                  )}

                  <Link href={`/seller/${data.sellerId}`}>
                    <Button variant="outline" className="w-full">
                      Zum Shop
                    </Button>
                  </Link>
                </CardContent>
              </Card>
            )}

            {/* Reviews */}
            {reviews.data && reviews.data.length > 0 && (
              <Card>
                <CardHeader>
                  <CardTitle className="text-lg">Bewertungen</CardTitle>
                  <CardDescription>
                    {reviews.data.length} Bewertung{reviews.data.length !== 1 ? 'en' : ''}
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  {reviews.data.map((review) => (
                    <div key={review.id} className="border-b last:border-b-0 pb-4 last:pb-0">
                      <div className="flex items-center gap-2 mb-2">
                        <div className="flex">
                          {[...Array(5)].map((_, i) => (
                            <span key={i} className={i < review.rating ? "text-yellow-400" : "text-gray-300"}>
                              ★
                            </span>
                          ))}
                        </div>
                        <span className="text-sm text-gray-600">
                          {review.buyerName || 'Anonym'}
                        </span>
                      </div>
                      {review.comment && (
                        <p className="text-sm text-gray-700">{review.comment}</p>
                      )}
                      <p className="text-xs text-gray-500 mt-2">
                        {new Date(review.createdAt).toLocaleDateString('de-DE')}
                      </p>
                    </div>
                  ))}
                </CardContent>
              </Card>
            )}

            {/* Purchase Card */}
            <Card>
              <CardHeader>
                <CardTitle>Kaufen</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                {!isAuthenticated ? (
                  <Alert>
                    <AlertCircle className="h-4 w-4" />
                    <AlertDescription>
                      Bitte melden Sie sich an, um zu kaufen.
                    </AlertDescription>
                  </Alert>
                ) : (
                  <>
                    {data.status === "active" ? (
                      <>
                        {/* Price Offer Button - Show if acceptsOffers is enabled */}
                        {data.acceptsOffers && (
                          <Button 
                            className="w-full gap-2 mb-3" 
                            size="lg" 
                            variant="secondary"
                            onClick={() => setShowOfferDialog(true)}
                          >
                            <Gavel className="w-5 h-5" />
                            Preisvorschlag senden
                          </Button>
                        )}
                        {data.priceType === "fixed" ? (
                          <a href={`/checkout/${data.id}`}>
                            <Button className="w-full gap-2" size="lg">
                              <ShoppingCart className="w-5 h-5" />
                              Jetzt kaufen
                            </Button>
                          </a>
                        ) : (
                          <Button className="w-full gap-2" size="lg" variant="outline">
                            <Gavel className="w-5 h-5" />
                            Bieten
                          </Button>
                        )}
                        <p className="text-xs text-gray-500 text-center">
                          Sichere Zahlung mit PayPal
                        </p>
                        
                        {/* Contact Seller Button */}
                        <div className="pt-3 border-t">
                          <a href={`/messages/new?listingId=${data.id}&sellerId=${data.sellerId}`}>
                            <Button className="w-full gap-2" size="lg" variant="outline">
                              <MessageCircle className="w-5 h-5" />
                              Verkäufer kontaktieren
                            </Button>
                          </a>
                        </div>
                      </>                   ) : (
                      <Alert>
                        <AlertCircle className="h-4 w-4" />
                        <AlertDescription>
                          Dieses Angebot ist nicht mehr verfügbar.
                        </AlertDescription>
                      </Alert>
                    )}
                  </>
                )}
              </CardContent>
            </Card>

            {/* Share Card */}
            <Card>
              <CardHeader>
                <CardTitle className="text-lg">Teilen</CardTitle>
              </CardHeader>
              <CardContent>
                <Button
                  variant="outline"
                  className="w-full"
                  onClick={() => {
                    navigator.share({
                      title: data.strain,
                      text: `Schauen Sie sich diese ${data.type === "cutting" ? "Steckling" : "Samen"} an!`,
                      url: window.location.href,
                    });
                  }}
                >
                  Teilen
                </Button>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>

      {/* Price Offer Dialog */}
      {showOfferDialog && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <Card className="w-full max-w-md">
            <CardHeader>
              <CardTitle>Preisvorschlag senden</CardTitle>
              <CardDescription>
                Machen Sie dem Verkäufer ein Angebot für {data.strain}
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              {offerSuccess && (
                <Alert className="bg-green-50 border-green-200">
                  <AlertCircle className="h-4 w-4 text-green-600" />
                  <AlertDescription className="text-green-800">
                    ✅ Ihr Angebot wurde erfolgreich gesendet!
                  </AlertDescription>
                </Alert>
              )}
              
              {offerError && (
                <Alert className="bg-red-50 border-red-200">
                  <AlertCircle className="h-4 w-4 text-red-600" />
                  <AlertDescription className="text-red-800">
                    {offerError}
                  </AlertDescription>
                </Alert>
              )}
              
              {data.offerMinPrice && (
                <Alert>
                  <AlertCircle className="h-4 w-4" />
                  <AlertDescription>
                    Mindestpreis: €{parseFloat(data.offerMinPrice).toFixed(2)}
                  </AlertDescription>
                </Alert>
              )}
              
              <div>
                <label className="block text-sm font-medium mb-2">
                  Ihr Angebot (€) *
                </label>
                <input
                  type="number"
                  step="0.01"
                  min={data.offerMinPrice || "0"}
                  value={offerAmount}
                  onChange={(e) => setOfferAmount(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="z.B. 12.50"
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">
                  Nachricht an Verkäufer (optional)
                </label>
                <textarea
                  value={offerMessage}
                  onChange={(e) => setOfferMessage(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  rows={3}
                  placeholder="z.B. Ich würde gerne mehrere Stecklinge kaufen..."
                />
              </div>

              <div className="flex gap-2">
                <Button
                  variant="outline"
                  className="flex-1"
                  onClick={() => {
                    setShowOfferDialog(false);
                    setOfferAmount("");
                    setOfferMessage("");
                  }}
                >
                  Abbrechen
                </Button>
                <Button
                  className="flex-1"
                  onClick={() => {
                    setOfferError("");
                    createOffer.mutate({
                      listingId,
                      offerAmount,
                      message: offerMessage || undefined,
                    });
                  }}
                  disabled={!offerAmount || parseFloat(offerAmount) <= 0 || createOffer.isPending}
                >
                  {createOffer.isPending ? "Wird gesendet..." : "Angebot senden"}
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      )}
    </div>
  );
}

```

#### Schritt 5.x: ListingSkeleton.tsx

**`client/src/components/ListingSkeleton.tsx`**

```typescript
import { Card, CardContent, CardHeader } from "@/components/ui/card";

export function ListingSkeleton() {
  return (
    <Card className="overflow-hidden animate-pulse">
      <CardHeader className="p-0">
        <div className="h-48 bg-gray-200" />
      </CardHeader>
      <CardContent className="p-4 space-y-3">
        <div className="h-6 bg-gray-200 rounded w-3/4" />
        <div className="h-4 bg-gray-200 rounded w-1/2" />
        <div className="h-4 bg-gray-200 rounded w-2/3" />
        <div className="flex justify-between items-center mt-4">
          <div className="h-8 bg-gray-200 rounded w-20" />
          <div className="h-10 bg-gray-200 rounded w-24" />
        </div>
      </CardContent>
    </Card>
  );
}

export function ListingSkeletonGrid({ count = 8 }: { count?: number }) {
  return (
    <div className="grid md:grid-cols-3 lg:grid-cols-4 gap-6">
      {Array.from({ length: count }).map((_, i) => (
        <ListingSkeleton key={i} />
      ))}
    </div>
  );
}

```

#### Schritt 5.x: Maintenance.tsx

**`client/src/components/Maintenance.tsx`**

```typescript
import { Construction, Shield } from "lucide-react";
import { Link } from "wouter";

export default function Maintenance() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4">
      <div className="max-w-2xl w-full bg-white rounded-2xl shadow-xl p-8 md:p-12 text-center">
        <div className="flex justify-center mb-6">
          <div className="bg-orange-100 p-6 rounded-full">
            <Construction className="w-16 h-16 text-orange-600" />
          </div>
        </div>
        
        <h1 className="text-4xl font-bold text-gray-900 mb-4">
          Wartungsarbeiten
        </h1>
        
        <p className="text-xl text-gray-600 mb-6">
          Wir führen gerade wichtige Wartungsarbeiten durch, um deimudda für Sie zu verbessern.
        </p>
        
        <div className="bg-orange-50 border border-orange-200 rounded-lg p-6 mb-8">
          <p className="text-gray-700 leading-relaxed">
            Die Plattform ist vorübergehend nicht verfügbar. Wir arbeiten daran, 
            so schnell wie möglich wieder online zu sein.
          </p>
        </div>
        
        <div className="space-y-3 text-sm text-gray-500">
          <p>
            <strong>Geschätzte Dauer:</strong> Die Wartungsarbeiten sollten in Kürze abgeschlossen sein.
          </p>
          <p>
            Bei Fragen kontaktieren Sie uns unter:{" "}
            <a 
              href="mailto:support@deimudda.de" 
              className="text-green-600 hover:text-green-700 underline"
            >
              support@deimudda.de
            </a>
          </p>
        </div>
        
        {/* Admin login link */}
        <div className="mt-8 pt-6 border-t border-gray-200">
          <Link href="/admin-login">
            <span className="inline-flex items-center gap-2 text-sm text-gray-500 hover:text-blue-600 transition-colors cursor-pointer">
              <Shield className="h-4 w-4" />
              Administrator-Zugang
            </span>
          </Link>
        </div>
        
        <div className="mt-4 pt-4 border-t border-gray-200">
          <p className="text-xs text-gray-400">
            © 2025 deimudda – Cannabis-Stecklingsbörse
          </p>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: ManusDialog.tsx

**`client/src/components/ManusDialog.tsx`**

```typescript
import { useEffect, useState } from "react";

import { Button } from "@/components/ui/button";
import { APP_TITLE } from "@/const";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogTitle,
} from "@/components/ui/dialog";

interface ManusDialogProps {
  title?: string;
  logo?: string;
  open?: boolean;
  onLogin: () => void;
  onOpenChange?: (open: boolean) => void;
  onClose?: () => void;
}

export function ManusDialog({
  title = APP_TITLE,
  logo = "/seedling-logo.png",
  open = false,
  onLogin,
  onOpenChange,
  onClose,
}: ManusDialogProps) {
  const [internalOpen, setInternalOpen] = useState(open);

  useEffect(() => {
    if (!onOpenChange) {
      setInternalOpen(open);
    }
  }, [open, onOpenChange]);

  const handleOpenChange = (nextOpen: boolean) => {
    if (onOpenChange) {
      onOpenChange(nextOpen);
    } else {
      setInternalOpen(nextOpen);
    }

    if (!nextOpen) {
      onClose?.();
    }
  };

  return (
    <Dialog
      open={onOpenChange ? open : internalOpen}
      onOpenChange={handleOpenChange}
    >
      <DialogContent className="py-5 bg-[#f8f8f7] rounded-[20px] w-[400px] shadow-[0px_4px_11px_0px_rgba(0,0,0,0.08)] border border-[rgba(0,0,0,0.08)] backdrop-blur-2xl p-0 gap-0 text-center">
        <div className="flex flex-col items-center gap-2 p-5 pt-12">
          <div className="w-16 h-16 bg-white rounded-xl border border-[rgba(0,0,0,0.08)] flex items-center justify-center">
            <img src={logo} alt="deimudda Logo" className="w-12 h-12" />
          </div>

          {/* Title and subtitle */}
          <DialogTitle className="text-xl font-semibold text-[#34322d] leading-[26px] tracking-[-0.44px]">
            {title}
          </DialogTitle>
          <DialogDescription className="text-sm text-[#858481] leading-5 tracking-[-0.154px]">
            Please login with Manus to continue
          </DialogDescription>
        </div>

        <DialogFooter className="px-5 py-5">
          {/* Login button */}
          <Button
            onClick={onLogin}
            className="w-full h-10 bg-[#1a1a19] hover:bg-[#1a1a19]/90 text-white rounded-[10px] text-sm font-medium leading-5 tracking-[-0.154px]"
          >
            Login with Manus
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
```

#### Schritt 5.x: MessageIcon.tsx

**`client/src/components/MessageIcon.tsx`**

```typescript
import { MessageCircle } from "lucide-react";
import { trpc } from "@/lib/trpc";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { useLocation } from "wouter";

export function MessageIcon() {
  const [, setLocation] = useLocation();

  // Get unread message count
  const { data: unreadCount = 0 } = trpc.chat.getUnreadCount.useQuery(undefined, {
    refetchInterval: 30000, // Refresh every 30 seconds
  });

  const handleClick = () => {
    setLocation("/messages");
  };

  return (
    <Button 
      variant="ghost" 
      size="icon" 
      className="relative" 
      onClick={handleClick}
      title="Nachrichten"
    >
      <MessageCircle className="h-5 w-5" />
      {unreadCount > 0 && (
        <Badge 
          variant="destructive" 
          className="absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs"
        >
          {unreadCount > 9 ? "9+" : unreadCount}
        </Badge>
      )}
    </Button>
  );
}

```

#### Schritt 5.x: Messages.tsx

**`client/src/components/Messages.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { trpc } from "@/lib/trpc";
import { Link, useLocation } from "wouter";
import { MessageCircle, Send, AlertCircle } from "lucide-react";
import { Header } from "@/components/Header";
import { formatDistanceToNow } from "date-fns";
import { de } from "date-fns/locale";

export default function Messages() {
  const { user, isAuthenticated } = useAuth();
  const [, setLocation] = useLocation();

  // Get all conversations
  const { data: conversations = [], isLoading } = trpc.chat.getConversations.useQuery(undefined, {
    refetchInterval: 10000, // Refresh every 10 seconds
  });

  if (!isAuthenticated) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center">
        <Card className="max-w-md">
          <CardHeader>
            <CardTitle>Zugriff verweigert</CardTitle>
            <CardDescription>
              Sie müssen eingeloggt sein, um Ihre Nachrichten zu sehen.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Link href="/">
              <Button>Zur Startseite</Button>
            </Link>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      <Header />
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        {/* Legal Disclaimer */}
        <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-6 rounded-r-lg">
          <div className="flex items-start gap-3">
            <AlertCircle className="h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5" />
            <div className="text-sm text-yellow-800">
              <p className="font-semibold mb-1">⚠️ Wichtige Hinweise zum Chat:</p>
              <ul className="list-disc pl-5 space-y-1">
                <li>Tauschen Sie <strong>keine illegalen Inhalte</strong> aus (Verkauf von Blütenständen ist verboten)</li>
                <li><strong>Geben Sie persönliche Daten</strong> (Telefonnummer, vollständige Adresse) <strong>erst nach Kaufabschluss</strong> weiter</li>
                <li>Der <strong>Standort des Verkäufers</strong> ist bereits auf der Plattform sichtbar</li>
                <li><strong>🔒 Empfehlung:</strong> Tauschen Sie sensible Daten (Adresse, Telefon) über <strong>verschlüsselte Messenger</strong> (Signal, Telegram, WhatsApp) aus - nicht über diese Plattform</li>
                <li>Alle Nachrichten können von Moderatoren eingesehen werden</li>
              </ul>
            </div>
          </div>
        </div>

        <Card>
          <CardHeader>
            <div className="flex items-center gap-3">
              <MessageCircle className="h-6 w-6 text-blue-600" />
              <div>
                <CardTitle>Nachrichten</CardTitle>
                <CardDescription>
                  Kommunizieren Sie mit Käufern und Verkäufern
                </CardDescription>
              </div>
            </div>
          </CardHeader>
          <CardContent>
            {isLoading ? (
              <div className="text-center py-12">
                <p className="text-muted-foreground">Lädt...</p>
              </div>
            ) : conversations.length === 0 ? (
              <div className="text-center py-12">
                <MessageCircle className="h-16 w-16 mx-auto mb-4 text-muted-foreground opacity-50" />
                <p className="text-lg font-medium text-muted-foreground">
                  Keine Nachrichten
                </p>
                <p className="text-sm text-muted-foreground mt-2">
                  Starten Sie eine Konversation, indem Sie auf "Verkäufer kontaktieren" bei einem Inserat klicken.
                </p>
              </div>
            ) : (
              <div className="space-y-3">
                {conversations.map((conversation: { id: number; otherUser: { name: string; avatarUrl?: string }; lastMessage?: { content: string; createdAt: Date }; unreadCount: number }) => {
                  const isUserBuyer = conversation.buyerId === user?.id;
                  const otherUserName = isUserBuyer ? conversation.sellerName : conversation.buyerName;
                  const role = isUserBuyer ? "Verkäufer" : "Käufer";

                  return (
                    <div
                      key={conversation.id}
                      className="p-4 rounded-lg border-2 border-gray-200 hover:border-blue-300 hover:shadow-md transition-all cursor-pointer bg-white"
                      onClick={() => setLocation(`/messages/${conversation.id}`)}
                    >
                      <div className="flex items-start gap-4">
                        {/* Listing Image */}
                        {conversation.listingImage && (
                          <img
                            src={conversation.listingImage}
                            alt={conversation.listingStrain}
                            className="w-16 h-16 rounded-lg object-cover flex-shrink-0"
                          />
                        )}

                        {/* Conversation Info */}
                        <div className="flex-1 min-w-0">
                          <div className="flex items-center gap-2 mb-1">
                            <h3 className="font-semibold text-base truncate">
                              {conversation.listingStrain}
                            </h3>
                            {conversation.unreadCount > 0 && (
                              <Badge variant="destructive" className="text-xs">
                                {conversation.unreadCount} neu
                              </Badge>
                            )}
                          </div>
                          <p className="text-sm text-muted-foreground mb-1">
                            {role}: {otherUserName}
                          </p>
                          <p className="text-xs text-muted-foreground">
                            Letzte Nachricht:{" "}
                            {formatDistanceToNow(new Date(conversation.lastMessageAt), {
                              addSuffix: true,
                              locale: de,
                            })}
                          </p>
                        </div>

                        {/* Action Button */}
                        <Button variant="outline" size="sm" className="flex-shrink-0">
                          <Send className="h-4 w-4 mr-2" />
                          Öffnen
                        </Button>
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: MultiImageUpload.tsx

**`client/src/components/MultiImageUpload.tsx`**

```typescript
import { Upload, X } from "lucide-react";
import { trpc } from "../lib/trpc";
import { toast } from "sonner";

interface MultiImageUploadProps {
  label: string;
  currentImages?: string[]; // Array of image URLs
  maxImages?: number;
  maxSizeMB?: number;
  onImagesChange: (imageUrls: string[]) => void;
}

export function MultiImageUpload({
  label,
  currentImages = [],
  maxImages = 5,
  maxSizeMB = 5,
  onImagesChange,
}: MultiImageUploadProps) {
  const [imageUrls, setImageUrls] = useState<string[]>(currentImages);
  const [uploading, setUploading] = useState(false);
  const uploadMutation = trpc.upload.image.useMutation();

  // Sync internal state with prop on mount only
  useEffect(() => {
    setImageUrls(currentImages);
  }, []); // Only run on mount

  // Update parent when images change (but not on initial render)
  useEffect(() => {
    // Only call onImagesChange if imageUrls is different from currentImages
    const isDifferent = JSON.stringify(imageUrls) !== JSON.stringify(currentImages);
    if (isDifferent) {
      onImagesChange(imageUrls);
    }
  }, [imageUrls]); // Remove onImagesChange from dependencies to prevent loop

  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const files = e.target.files;
    if (!files || files.length === 0) return;

    // Check if adding these files would exceed max images
    if (imageUrls.length + files.length > maxImages) {
      toast.error(`Sie können maximal ${maxImages} Bilder hochladen.`);
      return;
    }

    setUploading(true);
```

#### Schritt 5.x: NewMessage.tsx

**`client/src/components/NewMessage.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { trpc } from "@/lib/trpc";
import { Link, useLocation } from "wouter";
import { useEffect } from "react";
import { toast } from "sonner";

export default function NewMessage() {
  const { isAuthenticated } = useAuth();
  const [, setLocation] = useLocation();

  // Get query params
  const params = new URLSearchParams(window.location.search);
  const listingId = parseInt(params.get("listingId") || "0");
  const sellerId = parseInt(params.get("sellerId") || "0");

  // Create or get conversation
  const createConversationMutation = trpc.chat.getOrCreateConversation.useMutation({
    onSuccess: (conversation) => {
      // Redirect to chat window
      setLocation(`/messages/${conversation.id}`);
    },
    onError: (error) => {
      toast.error("Fehler beim Erstellen der Konversation: " + error.message);
    },
  });

  useEffect(() => {
    if (isAuthenticated && listingId > 0 && sellerId > 0) {
      // Automatically create conversation
      createConversationMutation.mutate({
        listingId,
        sellerId,
      });
    }
  }, [isAuthenticated, listingId, sellerId]);

  if (!isAuthenticated) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center">
        <Card className="max-w-md">
          <CardHeader>
            <CardTitle>Zugriff verweigert</CardTitle>
            <CardDescription>
              Sie müssen eingeloggt sein, um Nachrichten zu senden.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Link href="/">
              <Button>Zur Startseite</Button>
            </Link>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center">
      <Card className="max-w-md">
        <CardHeader>
          <CardTitle>Chat wird geöffnet...</CardTitle>
          <CardDescription>
            Bitte warten Sie einen Moment.
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="text-center">
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p className="text-gray-600">Konversation wird erstellt...</p>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: NotificationBell.tsx

**`client/src/components/NotificationBell.tsx`**

```typescript
import { Bell } from "lucide-react";
import type { Notification } from "@/../../shared/types";
import { useState } from "react";
import { trpc } from "@/lib/trpc";
import { Button } from "@/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { Badge } from "@/components/ui/badge";
import { ScrollArea } from "@/components/ui/scroll-area";
import { formatDistanceToNow } from "date-fns";
import { de } from "date-fns/locale";
import { toast } from "sonner";
import { useLocation } from "wouter";

export function NotificationBell() {
  const [open, setOpen] = useState(false);
  const [, setLocation] = useLocation();
  const utils = trpc.useUtils();

  // Get unread count
  const { data: unreadCount = 0 } = trpc.notifications.getUnreadCount.useQuery(undefined, {
    refetchInterval: 30000, // Refresh every 30 seconds
    staleTime: 10000, // 10s - Real-time: Unread count changes frequently
  });

  // Get all notifications
  const { data: notifications = [] } = trpc.notifications.getMyNotifications.useQuery(undefined, {
    enabled: open, // Only fetch when dropdown is open
    staleTime: 10000, // 10s - Real-time: Notifications change frequently
  });

  // Mark as read mutation
  const markAsReadMutation = trpc.notifications.markAsRead.useMutation({
    onSuccess: () => {
      utils.notifications.getUnreadCount.invalidate();
      utils.notifications.getMyNotifications.invalidate();
    },
  });

  // Mark all as read mutation
  const markAllAsReadMutation = trpc.notifications.markAllAsRead.useMutation({
    onSuccess: () => {
      utils.notifications.getUnreadCount.invalidate();
      utils.notifications.getMyNotifications.invalidate();
      toast.success("Alle Benachrichtigungen als gelesen markiert");
    },
  });

  // Delete notification mutation
  const deleteNotificationMutation = trpc.notifications.deleteNotification.useMutation({
    onSuccess: () => {
      utils.notifications.getUnreadCount.invalidate();
      utils.notifications.getMyNotifications.invalidate();
      toast.success("Benachrichtigung gelöscht");
    },
  });

  const handleNotificationClick = (notification: Notification) => {
    // Mark as read
    if (!notification.read) {
      markAsReadMutation.mutate(notification.id);
    }

    // Navigate to action URL if exists
    if (notification.actionUrl) {
      setOpen(false);
      setLocation(notification.actionUrl);
    }
  };

  const handleMarkAllAsRead = () => {
    markAllAsReadMutation.mutate();
  };

  const handleDeleteNotification = (e: React.MouseEvent, notificationId: number) => {
    e.stopPropagation();
    deleteNotificationMutation.mutate(notificationId);
  };

  return (
    <DropdownMenu open={open} onOpenChange={setOpen}>
      <DropdownMenuTrigger asChild>
        <Button variant="ghost" size="icon" className="relative">
          <Bell className="h-5 w-5" />
          {unreadCount > 0 && (
            <Badge 
              variant="destructive" 
              className="absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs"
            >
              {unreadCount > 9 ? "9+" : unreadCount}
            </Badge>
          )}
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end" className="w-80">
        <div className="flex items-center justify-between p-4 border-b">
          <h3 className="font-semibold">Benachrichtigungen</h3>
          {unreadCount > 0 && (
            <Button
              variant="ghost"
              size="sm"
              onClick={handleMarkAllAsRead}
              className="text-xs"
            >
              Alle als gelesen markieren
            </Button>
          )}
        </div>
        <ScrollArea className="h-[400px]">
          {notifications.length === 0 ? (
            <div className="p-8 text-center text-muted-foreground">
              <Bell className="h-12 w-12 mx-auto mb-2 opacity-50" />
              <p>Keine Benachrichtigungen</p>
            </div>
          ) : (
            <div className="divide-y">
              {notifications.map((notification: Notification) => (
                <div
                  key={notification.id}
                  className={`p-4 cursor-pointer hover:bg-muted/50 transition-colors ${
                    !notification.read ? "bg-muted/30" : ""
                  }`}
                  onClick={() => handleNotificationClick(notification)}
                >
                  <div className="flex items-start justify-between gap-2">
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 mb-1">
                        <p className="font-medium text-sm truncate">
                          {notification.title}
                        </p>
                        {!notification.read && (
                          <div className="h-2 w-2 rounded-full bg-blue-500 flex-shrink-0" />
                        )}
                      </div>
                      <p className="text-sm text-muted-foreground whitespace-pre-line line-clamp-2">
                        {notification.message}
                      </p>
                      <p className="text-xs text-muted-foreground mt-1">
                        {formatDistanceToNow(new Date(notification.createdAt), {
                          addSuffix: true,
                          locale: de,
                        })}
                      </p>
                    </div>
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={(e) => handleDeleteNotification(e, notification.id)}
                      className="flex-shrink-0"
                    >
                      ×
                    </Button>
                  </div>
                </div>
              ))}
            </div>
          )}
        </ScrollArea>
      </DropdownMenuContent>
    </DropdownMenu>
  );
}

```

#### Schritt 5.x: Notifications.tsx

**`client/src/components/Notifications.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import type { Notification } from "@/../../shared/types";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { trpc } from "@/lib/trpc";
import { Link, useLocation } from "wouter";
import { Bell, Trash2, CheckCheck, ArrowLeft } from "lucide-react";
import { formatDistanceToNow } from "date-fns";
import { de } from "date-fns/locale";
import { toast } from "sonner";
import { Header } from "@/components/Header";

export default function Notifications() {
  const { user, isAuthenticated } = useAuth();
  const [, setLocation] = useLocation();
  const utils = trpc.useUtils();

  // Get all notifications
  const { data: notifications = [], isLoading } = trpc.notifications.getMyNotifications.useQuery(undefined, { staleTime: 10000 });

  // Mark as read mutation
  const markAsReadMutation = trpc.notifications.markAsRead.useMutation({
    onSuccess: () => {
      utils.notifications.getMyNotifications.invalidate();
      utils.notifications.getUnreadCount.invalidate();
    },
  });

  // Mark all as read mutation
  const markAllAsReadMutation = trpc.notifications.markAllAsRead.useMutation({
    onSuccess: () => {
      utils.notifications.getMyNotifications.invalidate();
      utils.notifications.getUnreadCount.invalidate();
      toast.success("Alle Benachrichtigungen als gelesen markiert");
    },
  });

  // Delete notification mutation
  const deleteNotificationMutation = trpc.notifications.deleteNotification.useMutation({
    onSuccess: () => {
      utils.notifications.getMyNotifications.invalidate();
      utils.notifications.getUnreadCount.invalidate();
      toast.success("Benachrichtigung gelöscht");
    },
  });

  if (!isAuthenticated) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center">
        <Card className="max-w-md">
          <CardHeader>
            <CardTitle>Zugriff verweigert</CardTitle>
            <CardDescription>
              Sie müssen eingeloggt sein, um Ihre Benachrichtigungen zu sehen.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Link href="/">
              <Button>Zur Startseite</Button>
            </Link>
          </CardContent>
        </Card>
      </div>
    );
  }

  const handleNotificationClick = (notification: Notification) => {
    // Mark as read
    if (!notification.read) {
      markAsReadMutation.mutate(notification.id);
    }

    // Navigate to action URL if exists
    if (notification.actionUrl) {
      setLocation(notification.actionUrl);
    }
  };

  const handleDeleteNotification = (e: React.MouseEvent, notificationId: number) => {
    e.stopPropagation();
    deleteNotificationMutation.mutate(notificationId);
  };

  const handleMarkAllAsRead = () => {
    markAllAsReadMutation.mutate();
  };

  const getNotificationTypeColor = (type: string) => {
    switch (type) {
      case 'warning':
        return 'bg-yellow-100 text-yellow-800 border-yellow-300';
      case 'suspension':
        return 'bg-orange-100 text-orange-800 border-orange-300';
      case 'ban':
        return 'bg-red-100 text-red-800 border-red-300';
      case 'unban':
        return 'bg-green-100 text-green-800 border-green-300';
      case 'listing_approved':
        return 'bg-blue-100 text-blue-800 border-blue-300';
      case 'listing_rejected':
        return 'bg-gray-100 text-gray-800 border-gray-300';
      case 'offer_received':
        return 'bg-purple-100 text-purple-800 border-purple-300';
      case 'offer_accepted':
        return 'bg-green-100 text-green-800 border-green-300';
      case 'offer_rejected':
        return 'bg-gray-100 text-gray-800 border-gray-300';
      case 'message_received':
        return 'bg-indigo-100 text-indigo-800 border-indigo-300';
      case 'system':
        return 'bg-slate-100 text-slate-800 border-slate-300';
      default:
        return 'bg-gray-100 text-gray-800 border-gray-300';
    }
  };

  const getNotificationTypeLabel = (type: string) => {
    switch (type) {
      case 'warning':
        return 'Verwarnung';
      case 'suspension':
        return 'Sperrung';
      case 'ban':
        return 'Bann';
      case 'unban':
        return 'Entsperrung';
      case 'listing_approved':
        return 'Angebot genehmigt';
      case 'listing_rejected':
        return 'Angebot abgelehnt';
      case 'offer_received':
        return 'Angebot erhalten';
      case 'offer_accepted':
        return 'Angebot akzeptiert';
      case 'offer_rejected':
        return 'Angebot abgelehnt';
      case 'message_received':
        return 'Neue Nachricht';
      case 'system':
        return 'System';
      default:
        return type;
    }
  };

  const unreadCount = notifications.filter((n: Notification) => !n.read).length;

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      <Header />
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="mb-6">
          <Link href="/profile">
            <Button variant="outline" size="sm" className="hidden">
              <ArrowLeft className="h-4 w-4 mr-2" />
              Zurück zum Dashboard
            </Button>
          </Link>
        </div>

        <Card>
          <CardHeader>
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <Bell className="h-6 w-6 text-blue-600" />
                <div>
                  <CardTitle>Benachrichtigungen</CardTitle>
                  <CardDescription>
                    {unreadCount > 0
                      ? `${unreadCount} ungelesene Benachrichtigung${unreadCount > 1 ? 'en' : ''}`
                      : 'Alle Benachrichtigungen gelesen'}
                  </CardDescription>
                </div>
              </div>
              {unreadCount > 0 && (
                <Button
                  variant="outline"
                  size="sm"
                  onClick={handleMarkAllAsRead}
                  disabled={markAllAsReadMutation.isPending}
                >
                  <CheckCheck className="h-4 w-4 mr-2" />
                  Alle als gelesen markieren
                </Button>
              )}
            </div>
          </CardHeader>
          <CardContent>
            {isLoading ? (
              <div className="text-center py-12">
                <p className="text-muted-foreground">Lädt...</p>
              </div>
            ) : notifications.length === 0 ? (
              <div className="text-center py-12">
                <Bell className="h-16 w-16 mx-auto mb-4 text-muted-foreground opacity-50" />
                <p className="text-lg font-medium text-muted-foreground">
                  Keine Benachrichtigungen
                </p>
                <p className="text-sm text-muted-foreground mt-2">
                  Sie haben noch keine Benachrichtigungen erhalten.
                </p>
              </div>
            ) : (
              <div className="space-y-3">
                {notifications.map((notification: Notification) => (
                  <div
                    key={notification.id}
                    className={`p-4 rounded-lg border-2 cursor-pointer hover:shadow-md transition-all ${
                      !notification.read
                        ? 'bg-blue-50/50 border-blue-200'
                        : 'bg-white border-gray-200'
                    }`}
                    onClick={() => handleNotificationClick(notification)}
                  >
                    <div className="flex items-start justify-between gap-4">
                      <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-2 mb-2">
                          <Badge
                            variant="outline"
                            className={`${getNotificationTypeColor(notification.type)} text-xs`}
                          >
                            {getNotificationTypeLabel(notification.type)}
                          </Badge>
                          {!notification.read && (
                            <div className="h-2 w-2 rounded-full bg-blue-500 flex-shrink-0" />
                          )}
                          <span className="text-xs text-muted-foreground">
                            {formatDistanceToNow(new Date(notification.createdAt), {
                              addSuffix: true,
                              locale: de,
                            })}
                          </span>
                        </div>
                        <h3 className="font-semibold text-base mb-1">
                          {notification.title}
                        </h3>
                        <p className="text-sm text-muted-foreground whitespace-pre-line">
                          {notification.message}
                        </p>
                      </div>
                      <Button
                        variant="ghost"
                        size="sm"
                        onClick={(e) => handleDeleteNotification(e, notification.id)}
                        disabled={deleteNotificationMutation.isPending}
                        className="flex-shrink-0"
                      >
                        <Trash2 className="h-4 w-4 text-red-500" />
                      </Button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: OfferManagement.tsx

**`client/src/components/OfferManagement.tsx`**

```typescript
                            <p className="text-sm text-gray-700 italic">"{offer.message}"</p>
                          </div>
                        )}
                      </div>
                      <div className="flex gap-2 ml-4">
                        <Button
                          size="sm"
                          className="bg-green-600 hover:bg-green-700"
                          onClick={() => {
                            if (confirm(`Möchten Sie das Angebot von €${parseFloat(offer.offerAmount).toFixed(2)} annehmen?`)) {
                              acceptOffer.mutate(offer.id);
                            }
                          }}
                          disabled={acceptOffer.isPending}
                        >
                          <Check className="w-4 h-4 mr-1" />
                          Annehmen
                        </Button>
                        <Button
                          size="sm"
                          variant="destructive"
                          onClick={() => {
                            if (confirm("Möchten Sie dieses Angebot ablehnen?")) {
                              declineOffer.mutate(offer.id);
                            }
                          }}
                          disabled={declineOffer.isPending}
                        >
                          <X className="w-4 h-4 mr-1" />
                          Ablehnen
                        </Button>
                      </div>
                    </div>
                  </CardContent>
                </Card>```

#### Schritt 5.x: PayPalButton.tsx

**`client/src/components/PayPalButton.tsx`**

```typescript
import { PayPalButtons, PayPalScriptProvider } from "@paypal/react-paypal-js";
import { trpc } from "@/lib/trpc";
import { toast } from "sonner";
import { useState } from "react";

interface PayPalButtonProps {
  listingId: number;
  quantity: number;
  onSuccess: (transactionId: number) => void;
  onError?: (error: Error) => void;
  disabled?: boolean;
}

export default function PayPalButton({ 
  listingId,
  quantity,
  onSuccess, 
  onError,
  disabled = false,
}: PayPalButtonProps) {
  const [transactionId, setTransactionId] = useState<number | null>(null);
  const createOrderMutation = trpc.paypal.createOrder.useMutation();
  const captureOrderMutation = trpc.paypal.captureOrder.useMutation();

  const initialOptions = {
    clientId: import.meta.env.VITE_PAYPAL_CLIENT_ID || "",
    currency: "EUR",
    intent: "capture",
  };

  if (!import.meta.env.VITE_PAYPAL_CLIENT_ID) {
    return (
      <div className="text-red-600 text-sm">
        PayPal Client ID nicht konfiguriert. Bitte kontaktieren Sie den Support.
      </div>
    );
  }

  return (
    <PayPalScriptProvider options={initialOptions}>
      <div className={disabled ? "opacity-50 pointer-events-none" : ""}>
        <PayPalButtons
          style={{
            layout: "vertical",
            color: "gold",
            shape: "rect",
            label: "paypal",
          }}
          disabled={disabled}
          createOrder={async () => {
            try {
              const result = await createOrderMutation.mutateAsync({
                listingId,
                quantity,
              });
              setTransactionId(result.transactionId);
              return result.orderId;
            } catch (error) {
              console.error("[PayPal] Error creating order:", error);
              toast.error("Fehler beim Erstellen der Bestellung");
              throw error;
            }
          }}
          onApprove={async (data) => {
            try {
              if (!transactionId) {
                throw new Error("Transaction ID not found");
              }

              await captureOrderMutation.mutateAsync({
                orderId: data.orderID,
                transactionId,
              });
              
              toast.success("Zahlung erfolgreich!");
              onSuccess(transactionId);
            } catch (error) {
              console.error("[PayPal] Error capturing order:", error);
              toast.error("Fehler beim Abschließen der Zahlung");
              if (onError) {
                onError(error as Error);
              }
            }
          }}
          onError={(err) => {
            console.error("[PayPal] Button error:", err);
            toast.error("PayPal-Fehler aufgetreten");
            if (onError) {
              onError(err as Error);
            }
          }}
        />
      </div>
    </PayPalScriptProvider>
  );
}

```

#### Schritt 5.x: Privacy.tsx

**`client/src/components/Privacy.tsx`**

```typescript
import { trpc } from "@/lib/trpc";

export default function Privacy() {
  // Load dynamic platform fee from system settings
  const { data: platformFeeStr } = trpc.admin.getSystemSetting.useQuery('platform_fee_fixed', { staleTime: 300000 });
  const PLATFORM_FEE = parseFloat(platformFeeStr || "0.42");
  
  return (
    <div className="min-h-screen bg-gray-50 py-12">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-8 text-gray-900">Datenschutzerklärung</h1>
          
          <div className="prose prose-lg max-w-none">
            <p className="text-sm text-gray-600 mb-8">Stand: 24. Oktober 2025</p>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-6 mb-8">
              <h3 className="text-lg font-bold text-blue-900 mb-2">deimudda ist ein Marktplatz</h3>
              <p className="text-blue-800">
                <strong>Wichtig:</strong> deimudda vermittelt nur zwischen Käufern und Verkäufern. Wir sind kein Händler. 
                Der Kaufvertrag kommt direkt zwischen Ihnen und dem jeweiligen Verkäufer zustande.
              </p>
              <p className="text-blue-800 mt-2">
                Diese Datenschutzerklärung gilt für die Datenverarbeitung durch <strong>deimudda als Plattformbetreiber</strong>. 
                Für die Datenverarbeitung im Rahmen der Kaufabwicklung (Versand, Rechnungsstellung) ist der jeweilige 
                <strong> Verkäufer eigenständig verantwortlich</strong>. Bitte beachten Sie auch die Datenschutzerklärung 
                des Verkäufers.
              </p>
            </div>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">1. Datenschutz auf einen Blick</h2>
              
              <h3 className="text-xl font-semibold mb-3">Allgemeine Hinweise</h3>
              <p className="mb-4">
                Die folgenden Hinweise geben einen einfachen Überblick darüber, was mit Ihren personenbezogenen Daten 
                passiert, wenn Sie diese Website besuchen. Personenbezogene Daten sind alle Daten, mit denen Sie 
                persönlich identifiziert werden können.
              </p>

              <h3 className="text-xl font-semibold mb-3">Wer ist verantwortlich für die Datenverarbeitung?</h3>
              <p className="mb-4">
                <strong>Für die Plattform deimudda:</strong> Der Betreiber von deimudda (siehe Impressum) ist verantwortlich 
                für die Verarbeitung Ihrer Daten im Zusammenhang mit der Nutzung der Plattform (Registrierung, Profil, 
                Bewertungen, etc.).
              </p>
              <p className="mb-4">
                <strong>Für die Kaufabwicklung:</strong> Der jeweilige Verkäufer ist verantwortlich für die Verarbeitung 
                Ihrer Daten im Zusammenhang mit dem Kaufvertrag (Versand, Rechnungsstellung, Gewährleistung, etc.).
              </p>

              <h3 className="text-xl font-semibold mb-3">Welche Daten erheben wir?</h3>
              <p className="mb-4">
                <strong>deimudda erhebt folgende Daten:</strong>
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Bei Registrierung: Open ID (eindeutige Nutzer-ID vom OAuth-Provider), optional Name und E-Mail</li>
                <li>Bei Profil-Erstellung: Nickname, Standort (optional), Profilbild (optional)</li>
                <li>Bei Verkäufer-Aktivierung: Shop-Name, Beschreibung, Standort</li>
                <li>Bei Listing-Erstellung: Produktdaten (Strain, Beschreibung, Preis, Bilder)</li>
                <li>Bei Transaktionen: PayPal-Transaktions-ID, Kaufbetrag, Gebühren</li>
                <li>Bei Bewertungen: Rating, Kommentar, Zeitstempel</li>
                <li>Bei Preisvorschlägen: Angebotspreis, Nachricht, Status</li>
                <li>Technische Daten: IP-Adresse, Browser-Typ, Zugriffszeiten (Server-Logs)</li>
              </ul>

              <h3 className="text-xl font-semibold mb-3">Wofür nutzen wir Ihre Daten?</h3>
              <p className="mb-4">
                Wir nutzen Ihre Daten ausschließlich zur Bereitstellung und Verbesserung der Plattform deimudda:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Bereitstellung der Plattform-Funktionen (Registrierung, Profil, Listings, Transaktionen)</li>
                <li>Vermittlung zwischen Käufern und Verkäufern</li>
                <li>Abwicklung von Zahlungen über PayPal</li>
                <li>Bewertungs- und Reputationssystem</li>
                <li>Technische Sicherheit und Fehleranalyse</li>
              </ul>

              <h3 className="text-xl font-semibold mb-3">Welche Rechte haben Sie?</h3>
              <p className="mb-4">
                Sie haben jederzeit das Recht auf:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Auskunft über Ihre gespeicherten Daten</li>
                <li>Berichtigung unrichtiger Daten</li>
                <li>Löschung Ihrer Daten (soweit keine Aufbewahrungspflichten bestehen)</li>
                <li>Einschränkung der Verarbeitung</li>
                <li>Datenübertragbarkeit</li>
                <li>Widerruf Ihrer Einwilligung</li>
                <li>Beschwerde bei einer Aufsichtsbehörde</li>
              </ul>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">2. Verantwortliche Stellen</h2>
              
              <h3 className="text-xl font-semibold mb-3">deimudda als Plattformbetreiber</h3>
              <p className="mb-4">
                Verantwortlich für die Datenverarbeitung auf der Plattform deimudda:
              </p>
              <p className="mb-4 font-mono text-sm bg-gray-100 p-4 rounded">
                [Betreibername]<br />
                [Straße und Hausnummer]<br />
                [PLZ und Ort]<br />
                <br />
                E-Mail: [E-Mail-Adresse]<br />
                Telefon: [Telefonnummer]
              </p>

              <h3 className="text-xl font-semibold mb-3">Verkäufer als eigenständige Verantwortliche</h3>
              <p className="mb-4">
                Wenn Sie einen Kauf tätigen, werden Ihre Daten (Name, Adresse, Kontaktdaten) an den Verkäufer übermittelt, 
                damit dieser den Kaufvertrag erfüllen kann. <strong>Der Verkäufer ist eigenständiger Datenverantwortlicher</strong> 
                für diese Daten und muss Ihnen eine eigene Datenschutzerklärung bereitstellen.
              </p>
              <p className="mb-4">
                Die Kontaktdaten des Verkäufers finden Sie auf der Produktseite und in Ihrer Bestellbestätigung.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">3. Datenerfassung auf deimudda</h2>
              
              <h3 className="text-xl font-semibold mb-3">3.1 Registrierung und Authentifizierung (OAuth)</h3>
              <p className="mb-4">
                Zur Nutzung von deimudda ist eine Registrierung erforderlich. Wir nutzen <strong>OAuth</strong> für die 
                Authentifizierung. Bei der Anmeldung über OAuth werden Sie zu einem externen Authentifizierungsdienst 
                weitergeleitet.
              </p>
              <p className="mb-4">
                <strong>Erhobene Daten:</strong>
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Open ID (eindeutige Nutzer-ID)</li>
                <li>Optional: Name, E-Mail-Adresse (falls vom OAuth-Provider bereitgestellt und von Ihnen freigegeben)</li>
              </ul>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragserfüllung) und Art. 6 Abs. 1 lit. a DSGVO (Einwilligung)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> Bis zur Löschung Ihres Accounts
              </p>

              <h3 className="text-xl font-semibold mb-3">3.2 Profil-Daten</h3>
              <p className="mb-4">
                Sie können Ihr Profil mit folgenden Daten anreichern:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Nickname / Anzeigename (Pflicht)</li>
                <li>Standort (optional)</li>
                <li>Profilbild (optional, wird auf S3 gespeichert)</li>
              </ul>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragserfüllung)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> Bis zur Löschung durch Sie oder Löschung Ihres Accounts
              </p>

              <h3 className="text-xl font-semibold mb-3">3.3 Verkäufer-Daten</h3>
              <p className="mb-4">
                Wenn Sie als Verkäufer aktiv werden, erheben wir zusätzlich:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Shop-Name</li>
                <li>Shop-Beschreibung</li>
                <li>Standort</li>
                <li>Shop-Logo (optional, wird auf S3 gespeichert)</li>
              </ul>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragserfüllung)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> Bis zur Deaktivierung des Verkäufer-Status oder Löschung des Accounts
              </p>

              <h3 className="text-xl font-semibold mb-3">3.4 Listings (Produktangebote)</h3>
              <p className="mb-4">
                Verkäufer können Listings erstellen mit folgenden Daten:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Strain-Name (Sorte)</li>
                <li>Produkttyp (Steckling oder Samen)</li>
                <li>Beschreibung</li>
                <li>Preis (Festpreis oder Preisvorschlag)</li>
                <li>Menge</li>
                <li>Bilder (werden auf S3 gespeichert)</li>
                <li>Versandoptionen (Versand, Abholung)</li>
              </ul>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragserfüllung)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> Bis zur Löschung durch den Verkäufer
              </p>

              <h3 className="text-xl font-semibold mb-3">3.5 Transaktionen und Zahlungen</h3>
              <p className="mb-4">
                Bei Käufen über deimudda werden folgende Daten gespeichert:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Transaktions-ID</li>
                <li>Käufer-ID und Verkäufer-ID</li>
                <li>Listing-ID (Produkt)</li>
                <li>Kaufbetrag</li>
                <li>Plattformgebühr (€{PLATFORM_FEE.toFixed(2).replace('.', ',')} pro Artikel)</li>
                <li>PayPal-Gebühr (bei Online-Zahlung)</li>
                <li>PayPal-Transaktions-ID</li>
                <li>Zahlungsstatus</li>
                <li>Zeitstempel</li>
              </ul>
              <p className="mb-4">
                <strong>Zahlungsabwicklung über PayPal:</strong> Die Zahlung erfolgt über PayPal. Dabei werden Ihre 
                Zahlungsdaten direkt an PayPal übermittelt. deimudda erhält nur die Transaktions-ID und den Zahlungsstatus.
              </p>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragserfüllung) und Art. 6 Abs. 1 lit. c DSGVO (rechtliche Verpflichtung)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> 10 Jahre (steuerrechtliche Aufbewahrungspflicht gemäß § 147 AO)
              </p>

              <h3 className="text-xl font-semibold mb-3">3.6 Bewertungen</h3>
              <p className="mb-4">
                Käufer können Verkäufer bewerten:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Rating (1-5 Sterne)</li>
                <li>Kommentar (optional)</li>
                <li>Zeitstempel</li>
                <li>Käufer-ID (wird nicht öffentlich angezeigt)</li>
              </ul>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. a DSGVO (Einwilligung) und Art. 6 Abs. 1 lit. f DSGVO (berechtigtes Interesse an Transparenz)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> Bis zur Löschung durch Sie oder bei Account-Löschung
              </p>

              <h3 className="text-xl font-semibold mb-3">3.7 Preisvorschläge</h3>
              <p className="mb-4">
                Bei Listings mit Preisvorschlag-Option können Käufer Angebote abgeben:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Angebotspreis</li>
                <li>Nachricht (optional)</li>
                <li>Status (ausstehend, angenommen, abgelehnt)</li>
                <li>Zeitstempel</li>
              </ul>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragsanbahnung)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> 2 Jahre nach letzter Aktivität
              </p>

              <h3 className="text-xl font-semibold mb-3">3.8 Cookies</h3>
              <p className="mb-4">
                Wir verwenden nur <strong>technisch notwendige Cookies</strong>, um die Funktionalität der Website zu gewährleisten:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Session-Cookie (für Login-Status)</li>
                <li>Cookie-Consent-Cookie (speichert Ihre Cookie-Einstellung)</li>
              </ul>
              <p className="mb-4">
                Diese Cookies sind für den Betrieb der Seite erforderlich und können nicht deaktiviert werden.
              </p>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. f DSGVO (berechtigtes Interesse an technisch fehlerfreier Bereitstellung)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> Session-Cookies bis zum Schließen des Browsers, Cookie-Consent-Cookie 1 Jahr
              </p>

              <h3 className="text-xl font-semibold mb-3">3.9 Server-Log-Dateien</h3>
              <p className="mb-4">
                Unser Hosting-Provider erhebt automatisch folgende Daten:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>IP-Adresse</li>
                <li>Browsertyp und Browserversion</li>
                <li>Betriebssystem</li>
                <li>Referrer URL (vorherige Seite)</li>
                <li>Hostname des zugreifenden Rechners</li>
                <li>Uhrzeit der Serveranfrage</li>
              </ul>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. f DSGVO (berechtigtes Interesse an technischer Sicherheit und Fehleranalyse)
              </p>
              <p className="mb-4">
                <strong>Speicherdauer:</strong> 7 Tage, dann automatische Löschung
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">4. Weitergabe von Daten an Dritte</h2>
              
              <h3 className="text-xl font-semibold mb-3">4.1 Verkäufer</h3>
              <p className="mb-4">
                Wenn Sie einen Kauf tätigen, werden Ihre Kontaktdaten (Name, E-Mail, ggf. Adresse) an den Verkäufer 
                übermittelt, damit dieser den Kaufvertrag erfüllen kann (Versand, Rechnungsstellung).
              </p>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragserfüllung)
              </p>

              <h3 className="text-xl font-semibold mb-3">4.2 PayPal (Zahlungsdienstleister)</h3>
              <p className="mb-4">
                Bei Zahlung über PayPal werden Ihre Zahlungsdaten direkt an PayPal (Europe) S.à.r.l. et Cie, S.C.A., 
                22-24 Boulevard Royal, L-2449 Luxembourg übermittelt.
              </p>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. b DSGVO (Vertragserfüllung)
              </p>
              <p className="mb-4">
                Weitere Informationen: <a href="https://www.paypal.com/de/webapps/mpp/ua/privacy-full" target="_blank" className="text-blue-600 hover:underline">PayPal Datenschutzerklärung</a>
              </p>

              <h3 className="text-xl font-semibold mb-3">4.3 S3 / Cloud-Storage (Bild-Hosting)</h3>
              <p className="mb-4">
                Hochgeladene Bilder (Profilbilder, Produktbilder) werden auf einem S3-kompatiblen Cloud-Storage gespeichert.
              </p>
              <p className="mb-4">
                <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. f DSGVO (berechtigtes Interesse an effizienter Bereitstellung)
              </p>

              <h3 className="text-xl font-semibold mb-3">4.4 Hosting-Provider</h3>
              <p className="mb-4">
                Diese Website wird extern gehostet. Die personenbezogenen Daten, die auf dieser Website erfasst werden, 
                werden auf den Servern des Hosters gespeichert.
              </p>
              <p className="mb-4">
                Das externe Hosting erfolgt zum Zwecke der Vertragserfüllung gegenüber unseren potenziellen und 
                bestehenden Kunden (Art. 6 Abs. 1 lit. b DSGVO) und im Interesse einer sicheren, schnellen und 
                effizienten Bereitstellung unseres Online-Angebots durch einen professionellen Anbieter (Art. 6 Abs. 1 lit. f DSGVO).
              </p>
              <p className="mb-4">
                Unser Hoster verarbeitet Ihre Daten nur insoweit, wie dies zur Erfüllung seiner Leistungspflichten 
                erforderlich ist und befolgt unsere Weisungen (Auftragsverarbeitung gemäß Art. 28 DSGVO).
              </p>

              <h3 className="text-xl font-semibold mb-3">4.5 Keine Weitergabe an sonstige Dritte</h3>
              <p className="mb-4">
                Eine Weitergabe Ihrer Daten an sonstige Dritte erfolgt nicht, es sei denn:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>Sie haben ausdrücklich eingewilligt (Art. 6 Abs. 1 lit. a DSGVO)</li>
                <li>Die Weitergabe ist zur Erfüllung einer rechtlichen Verpflichtung erforderlich (Art. 6 Abs. 1 lit. c DSGVO)</li>
                <li>Die Weitergabe ist zur Geltendmachung, Ausübung oder Verteidigung von Rechtsansprüchen erforderlich (Art. 6 Abs. 1 lit. f DSGVO)</li>
              </ul>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">5. Ihre Rechte</h2>
              
              <p className="mb-4">
                Sie haben folgende Rechte bezüglich Ihrer personenbezogenen Daten:
              </p>

              <h3 className="text-xl font-semibold mb-3">Recht auf Auskunft (Art. 15 DSGVO)</h3>
              <p className="mb-4">
                Sie können Auskunft über Ihre von uns verarbeiteten personenbezogenen Daten verlangen.
              </p>

              <h3 className="text-xl font-semibold mb-3">Recht auf Berichtigung (Art. 16 DSGVO)</h3>
              <p className="mb-4">
                Sie können die Berichtigung unrichtiger oder die Vervollständigung Ihrer bei uns gespeicherten 
                personenbezogenen Daten verlangen. Dies können Sie direkt in Ihrem Profil vornehmen.
              </p>

              <h3 className="text-xl font-semibold mb-3">Recht auf Löschung (Art. 17 DSGVO)</h3>
              <p className="mb-4">
                Sie können die Löschung Ihrer bei uns gespeicherten personenbezogenen Daten verlangen, soweit nicht 
                die Verarbeitung zur Erfüllung einer rechtlichen Verpflichtung (z.B. steuerrechtliche Aufbewahrungsfristen) 
                erforderlich ist.
              </p>
              <p className="mb-4">
                <strong>Account löschen:</strong> Sie können Ihren Account jederzeit in den Profil-Einstellungen löschen. 
                Bitte beachten Sie, dass Transaktionsdaten aus steuerrechtlichen Gründen 10 Jahre aufbewahrt werden müssen 
                (anonymisiert nach Account-Löschung).
              </p>

              <h3 className="text-xl font-semibold mb-3">Recht auf Einschränkung (Art. 18 DSGVO)</h3>
              <p className="mb-4">
                Sie haben das Recht, die Einschränkung der Verarbeitung Ihrer personenbezogenen Daten zu verlangen.
              </p>

              <h3 className="text-xl font-semibold mb-3">Recht auf Datenübertragbarkeit (Art. 20 DSGVO)</h3>
              <p className="mb-4">
                Sie haben das Recht, Ihre personenbezogenen Daten in einem strukturierten, gängigen und maschinenlesbaren 
                Format zu erhalten.
              </p>
              <p className="mb-4">
                <strong>Daten exportieren:</strong> Sie können Ihre Daten jederzeit in den Profil-Einstellungen exportieren.
              </p>

              <h3 className="text-xl font-semibold mb-3">Widerspruchsrecht (Art. 21 DSGVO)</h3>
              <p className="mb-4">
                Sie haben das Recht, aus Gründen, die sich aus Ihrer besonderen Situation ergeben, jederzeit gegen die 
                Verarbeitung Sie betreffender personenbezogener Daten Widerspruch einzulegen.
              </p>

              <h3 className="text-xl font-semibold mb-3">Beschwerderecht (Art. 77 DSGVO)</h3>
              <p className="mb-4">
                Sie haben das Recht, sich bei einer Aufsichtsbehörde zu beschweren, wenn Sie der Ansicht sind, dass die 
                Verarbeitung Ihrer personenbezogenen Daten gegen die DSGVO verstößt.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">6. Datensicherheit</h2>
              
              <p className="mb-4">
                Wir verwenden geeignete technische und organisatorische Sicherheitsmaßnahmen, um Ihre Daten gegen 
                zufällige oder vorsätzliche Manipulationen, Verlust, Zerstörung oder den Zugriff unberechtigter Personen zu schützen:
              </p>
              <ul className="list-disc pl-6 mb-4">
                <li>SSL/TLS-Verschlüsselung für alle Datenübertragungen</li>
                <li>Sichere Passwort-Speicherung (OAuth)</li>
                <li>Regelmäßige Sicherheits-Updates</li>
                <li>Zugriffsbeschränkungen auf Datenbanken</li>
                <li>Regelmäßige Backups</li>
              </ul>
              <p className="mb-4">
                Wir weisen darauf hin, dass die Datenübertragung im Internet (z.B. bei der Kommunikation per E-Mail) 
                Sicherheitslücken aufweisen kann. Ein lückenloser Schutz der Daten vor dem Zugriff durch Dritte ist nicht möglich.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">7. Kontakt</h2>
              
              <p className="mb-4">
                Bei Fragen zum Datenschutz oder zur Ausübung Ihrer Rechte können Sie uns jederzeit kontaktieren:
              </p>

              <p className="mb-4 font-mono text-sm bg-gray-100 p-4 rounded">
                E-Mail: [Datenschutz-E-Mail]<br />
                Telefon: [Telefonnummer]<br />
                Post: [Adresse aus Impressum]
              </p>
            </section>

            <p className="text-sm text-gray-600 mt-8">
              Diese Datenschutzerklärung wurde speziell für das Marktplatz-Modell von deimudda erstellt und 
              berücksichtigt die DSGVO sowie das Konsumcannabisgesetz (KCanG).
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: Profile.tsx

**`client/src/components/Profile.tsx`**

```typescript
import { useAuth } from "@/_core/hooks/useAuth";
import ImageUpload from "@/components/ImageUpload";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from "@/components/ui/dialog";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { trpc } from "@/lib/trpc";
import { useState, useEffect } from "react";
import { toast } from "sonner";
import { useLocation } from "wouter";
import { Header } from "@/components/Header";

export default function Profile() {
  const { user, loading } = useAuth();
  const [, setLocation] = useLocation();
  const utils = trpc.useUtils();

  const [formData, setFormData] = useState({
    nickname: "",
    location: "",
    profileImageUrl: "",
  });

  // Load user data when available
  useEffect(() => {
    if (user) {
      setFormData({
        nickname: user.nickname || "",
        location: user.location || "",
        profileImageUrl: user.profileImageUrl || "",
      });
    }
  }, [user]);

  const [sellerFormData, setSellerFormData] = useState({
    shopName: "",
    description: "",
  });

  const updateProfile = trpc.profile.update.useMutation({
    onSuccess: () => {
      toast.success("Profil erfolgreich aktualisiert!");
      utils.auth.me.invalidate(); // Refresh session without page reload
    },
    onError: (error) => {
      console.error("[Profile] Update profile error:", error);
      toast.error("Fehler beim Aktualisieren: " + error.message);
    },
  });

  const activateSeller = trpc.profile.activateSeller.useMutation({
    onSuccess: () => {
      toast.success("Verkäufer-Modus aktiviert!");
      utils.auth.me.invalidate(); // Refresh session without page reload
    },
    onError: (error) => {
      console.error("[Profile] Activate seller error:", error);
      toast.error("Fehler beim Aktivieren: " + error.message);
    },
  });

  const deactivateSeller = trpc.profile.deactivateSeller.useMutation({
    onSuccess: () => {
      toast.success("Verkäufer-Modus deaktiviert!");
      utils.auth.me.invalidate(); // Refresh session without page reload
    },
    onError: (error) => {
      console.error("[Profile] Deactivate seller error:", error);
      toast.error("Fehler beim Deaktivieren: " + error.message);
    },
  });

  const deleteAccount = trpc.profile.deleteAccount.useMutation({
    onSuccess: () => {
      toast.success("Account erfolgreich gelöscht!");
      setTimeout(() => {
        window.location.href = "/";
      }, 1500);
    },
    onError: (error) => {
      console.error("[Profile] Delete account error:", error);
      toast.error("Fehler beim L\u00f6schen: " + error.message);
    },
  });

  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);

  const handleUpdateProfile = (e: React.FormEvent) => {
    e.preventDefault();
    updateProfile.mutate(formData);
  };

  const handleActivateSeller = (e: React.FormEvent) => {
    e.preventDefault();
    if (!sellerFormData.shopName) {
      toast.error("Shop-Name ist erforderlich");
      return;
    }
    activateSeller.mutate(sellerFormData);
  };

  // Redirect to home if not logged in
  useEffect(() => {
    if (!loading && !user) {
      setLocation("/");
    }
  }, [loading, user, setLocation]);

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p className="text-gray-600">Lade Profil...</p>
        </div>
      </div>
    );
  }

  if (!user) {
    return null; // Will redirect via useEffect
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <Header />
      <div className="container max-w-4xl py-8">
        <h1 className="text-3xl font-bold mb-8">Mein Profil</h1>

        {/* Basic Profile */}
        <Card className="mb-6">
          <CardHeader>
            <CardTitle>Profil-Informationen</CardTitle>
            <CardDescription>Verwalten Sie Ihre persönlichen Informationen</CardDescription>
          </CardHeader>
          <CardContent>
            <form onSubmit={handleUpdateProfile} className="space-y-4">
              <div>
                <Label htmlFor="nickname">Nickname / Anzeigename</Label>
                <Input
                  id="nickname"
                  value={formData.nickname}
                  onChange={(e) => setFormData({ ...formData, nickname: e.target.value })}
                  placeholder="z.B. GreenThumb420"
                />
              </div>

              <div>
                <Label htmlFor="location">Standort (optional)</Label>
                <Input
                  id="location"
                  value={formData.location}
                  onChange={(e) => setFormData({ ...formData, location: e.target.value })}
                  placeholder="z.B. Berlin, Deutschland"
                />
              </div>

              <ImageUpload
                label="Profilbild (optional)"
                currentImageUrl={formData.profileImageUrl}
                onImageUploaded={(url) => setFormData({ ...formData, profileImageUrl: url })}
                maxSizeMB={2}
              />

              <Button type="submit" disabled={updateProfile.isPending}>
                {updateProfile.isPending ? "Wird gespeichert..." : "Profil aktualisieren"}
              </Button>
            </form>
          </CardContent>
        </Card>

        {/* Buyer Dashboard */}
        <Card className="mb-6">
          <CardHeader>
            <CardTitle>Meine Käufe</CardTitle>
            <CardDescription>
              Verwalten Sie Ihre Bestellungen und geben Sie Bewertungen ab
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button onClick={() => setLocation("/buyer/dashboard")} variant="default">
              Zu meinen Käufen
            </Button>
          </CardContent>
        </Card>

        {/* Notifications */}
        <Card className="mb-6">
          <CardHeader>
            <CardTitle>Benachrichtigungen</CardTitle>
            <CardDescription>
              Verwalten Sie Ihre Benachrichtigungen und Mitteilungen
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button onClick={() => setLocation("/notifications")} variant="default">
              Zu meinen Benachrichtigungen
            </Button>
          </CardContent>
        </Card>

        {/* Messages */}
        <Card className="mb-6">
          <CardHeader>
            <CardTitle>Nachrichten</CardTitle>
            <CardDescription>
              Kommunizieren Sie mit Käufern und Verkäufern
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button onClick={() => setLocation("/messages")} variant="default">
              Zu meinen Nachrichten
            </Button>
          </CardContent>
        </Card>

        {/* Admin Dashboard - Only visible for admins */}
        {(user.role === 'admin' || user.role === 'super_admin') && (
          <Card className="mb-6 border-purple-200 bg-purple-50">
            <CardHeader>
              <CardTitle className="text-purple-800">Admin-Dashboard</CardTitle>
              <CardDescription className="text-purple-600">
                Sie haben Admin-Rechte und können die Plattform verwalten
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-4">
                <div className="bg-purple-100 border border-purple-300 rounded-lg p-4">
                  <p className="text-purple-900 font-medium">✓ {user.role === 'super_admin' ? 'Super Admin' : 'Admin'}</p>
                  <p className="text-purple-700 text-sm mt-1">
                    Zugriff auf Nutzer-Verwaltung, Transaktionen, Listing-Moderation und mehr
                  </p>
                </div>

                <Button 
                  onClick={() => setLocation("/admin")} 
                  variant="default"
                  className="bg-purple-600 hover:bg-purple-700"
                >
                  Zum Admin-Dashboard
                </Button>
              </div>
            </CardContent>
          </Card>
        )}

        {/* Seller Mode */}
        <Card>
          <CardHeader>
            <CardTitle>Verkäufer-Modus</CardTitle>
            <CardDescription>
              {user.isSellerActive
                ? "Sie sind als Verkäufer aktiv und können Stecklinge anbieten"
                : "Aktivieren Sie den Verkäufer-Modus, um Stecklinge anzubieten"}
            </CardDescription>
          </CardHeader>
          <CardContent>
            {user.isSellerActive ? (
              <div className="space-y-4">
                <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                  <p className="text-green-800 font-medium">✓ Verkäufer-Modus ist aktiv</p>
                  <p className="text-green-600 text-sm mt-1">
                    Sie können jetzt Angebote erstellen und verwalten
                  </p>
                </div>

                <div className="flex gap-4">
                  <Button onClick={() => setLocation("/seller/dashboard")} variant="default">
                    Zum Verkäufer-Dashboard
                  </Button>
                  <Button
                    onClick={() => deactivateSeller.mutate()}
                    variant="outline"
                    disabled={deactivateSeller.isPending}
                  >
                    {deactivateSeller.isPending ? "Wird deaktiviert..." : "Verkäufer-Modus deaktivieren"}
                  </Button>
                </div>
              </div>
            ) : (
              <form onSubmit={handleActivateSeller} className="space-y-4">
                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                  <p className="text-blue-800 font-medium">Verkäufer werden</p>
                  <p className="text-blue-600 text-sm mt-1">
                    Erstellen Sie einen Shop-Namen und beginnen Sie, Stecklinge anzubieten
                  </p>
                </div>

                <div>
                  <Label htmlFor="shopName">Shop-Name *</Label>
                  <Input
                    id="shopName"
                    value={sellerFormData.shopName}
                    onChange={(e) => setSellerFormData({ ...sellerFormData, shopName: e.target.value })}
                    placeholder="z.B. German Kali"
                    required
                  />
                </div>

                <div>
                  <Label htmlFor="description">Shop-Beschreibung (optional)</Label>
                  <Textarea
                    id="description"
                    value={sellerFormData.description}
                    onChange={(e) => setSellerFormData({ ...sellerFormData, description: e.target.value })}
                    placeholder="Beschreiben Sie Ihren Shop und Ihre Spezialitäten..."
                    rows={4}
                  />
                </div>

                <Button type="submit" disabled={activateSeller.isPending}>
                  {activateSeller.isPending ? "Wird aktiviert..." : "Verkäufer-Modus aktivieren"}
                </Button>
              </form>
            )}
          </CardContent>
        </Card>

        {/* Account Deletion */}
        <Card className="border-red-200">
          <CardHeader>
            <CardTitle className="text-red-600">Gefahrenzone</CardTitle>
            <CardDescription>
              Account unwiderruflich löschen (DSGVO-konform)
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
              <p className="text-red-800 font-medium">⚠️ Warnung: Diese Aktion kann nicht rückgängig gemacht werden!</p>
              <p className="text-red-600 text-sm mt-2">
                Alle Ihre Daten werden permanent gelöscht:
              </p>
              <ul className="text-red-600 text-sm mt-2 ml-4 list-disc">
                <li>Profil und Verkäufer-Informationen</li>
                <li>Alle Listings und Angebote</li>
                <li>Transaktionen und Bewertungen</li>
                <li>Nachrichten und Benachrichtigungen</li>
                <li>Verwarnungen und Admin-Logs</li>
              </ul>
            </div>

            <Dialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>
              <DialogTrigger asChild>
                <Button variant="destructive">
                  Account löschen
                </Button>
              </DialogTrigger>
              <DialogContent>
                <DialogHeader>
                  <DialogTitle>Account wirklich löschen?</DialogTitle>
                  <DialogDescription>
                    Diese Aktion kann nicht rückgängig gemacht werden. Alle Ihre Daten werden permanent aus unserer Datenbank entfernt.
                  </DialogDescription>
                </DialogHeader>
                <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 my-4">
                  <p className="text-yellow-800 text-sm">
                    ⚠️ Bitte bestätigen Sie, dass Sie verstehen:
                  </p>
                  <ul className="text-yellow-700 text-sm mt-2 ml-4 list-disc">
                    <li>Ihr Account wird sofort gelöscht</li>
                    <li>Sie werden ausgeloggt</li>
                    <li>Alle Daten sind unwiederbringlich verloren</li>
                    <li>Laufende Transaktionen werden abgebrochen</li>
                  </ul>
                </div>
                <DialogFooter>
                  <Button
                    variant="outline"
                    onClick={() => setIsDeleteDialogOpen(false)}
                  >
                    Abbrechen
                  </Button>
                  <Button
                    variant="destructive"
                    onClick={() => {
                      deleteAccount.mutate();
                      setIsDeleteDialogOpen(false);
                    }}
                    disabled={deleteAccount.isPending}
                  >
                    {deleteAccount.isPending ? "Lösche..." : "Ja, Account löschen"}
                  </Button>
                </DialogFooter>
              </DialogContent>
            </Dialog>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: QueryError.tsx

**`client/src/components/QueryError.tsx`**

```typescript
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";

interface QueryErrorProps {
  title?: string;
  message?: string;
  error?: Error | null;
  onRetry?: () => void;
  showDetails?: boolean;
}

export default function QueryError({
  title = "Fehler beim Laden",
  message = "Die Daten konnten nicht geladen werden. Bitte versuchen Sie es erneut.",
  error,
  onRetry,
  showDetails = false,
}: QueryErrorProps) {
  return (
    <div className="flex items-center justify-center min-h-[400px] p-4">
      <Card className="max-w-md w-full border-red-200">
        <CardHeader>
          <CardTitle className="text-red-600 flex items-center gap-2">
            <span className="text-xl">⚠️</span>
            {title}
          </CardTitle>
          <CardDescription>{message}</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {showDetails && error && (
            <div className="bg-red-50 border border-red-200 rounded-lg p-3">
              <p className="text-red-800 font-medium text-sm mb-1">Fehlerdetails:</p>
              <p className="text-red-600 text-xs font-mono break-all">
                {error.message}
              </p>
            </div>
          )}

          {onRetry && (
            <Button onClick={onRetry} variant="default" className="w-full">
              Erneut versuchen
            </Button>
          )}

          <Button
            onClick={() => (window.location.href = "/")}
            variant="outline"
            className="w-full"
          >
            Zur Startseite
          </Button>
        </CardContent>
      </Card>
    </div>
  );
}

```

#### Schritt 5.x: SellerDashboard.tsx

**`client/src/components/SellerDashboard.tsx`**

```typescript
import { useState } from "react";
import type { Listing, ListingType, PriceType, Genetics, GrowMethod, SeedType } from "@/../../shared/types";
import { Link } from "wouter";
import { useAuth } from "@/_core/hooks/useAuth";
import { trpc } from "@/lib/trpc";
import ImageUpload from "@/components/ImageUpload";
import { MultiImageUpload } from "@/components/MultiImageUpload";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from "@/components/ui/dialog";
import { Badge } from "@/components/ui/badge";
import { AlertCircle, Plus, Edit2, Trash2, MessageSquare, MessageCircle, User, ExternalLink, Euro } from "lucide-react";
import { Alert, AlertDescription } from "@/components/ui/alert";
import { toast } from "sonner";
import { Header } from "@/components/Header";
import QueryError from "@/components/QueryError";

export default function SellerDashboard() {
  const { user, isAuthenticated } = useAuth();
  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);
  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);
  const [editingListing, setEditingListing] = useState<Listing | null>(null);

  // Queries
  const sellerProfile = trpc.seller.getProfile.useQuery(undefined, {
    enabled: isAuthenticated,
    staleTime: 300000, // 5min - Static: Profile changes rarely
  });

  const myListings = trpc.listing.getMine.useQuery(undefined, {
    enabled: isAuthenticated,
    staleTime: 60000, // 1min - Semi-static: Listings change occasionally
  });

  const { data: unreadMessageCount = 0 } = trpc.chat.getUnreadCount.useQuery(undefined, {
    enabled: isAuthenticated,
    refetchInterval: 30000, // Refresh every 30 seconds
    staleTime: 10000, // 10s - Real-time: Unread count changes frequently
  });

  // Fetch max listing images from system settings
  const { data: maxListingImages } = trpc.admin.getSystemSetting.useQuery('max_listing_images', { staleTime: 300000 }); // 5min - Static
  const maxImages = maxListingImages ? parseInt(maxListingImages) : 10; // Default to 10 if not set

  // Mutations
  const createProfile = trpc.seller.createProfile.useMutation({
    onSuccess: () => {
      toast.success("Verkaufer-Profil erfolgreich erstellt!");
      sellerProfile.refetch();
    },
    onError: (error) => {
      console.error("[SellerDashboard] Create profile error:", error);
      toast.error("Fehler beim Erstellen des Profils: " + error.message);
    },
  });

  const createListing = trpc.listing.create.useMutation({
    onSuccess: () => {
      toast.success("Angebot erfolgreich erstellt!");
      myListings.refetch();
      setIsCreateDialogOpen(false);
      setFormData(initialFormData);
    },
    onError: (error) => {
      console.error("[SellerDashboard] Create listing error:", error);
      toast.error("Fehler beim Erstellen des Angebots: " + error.message);
    },
  });

  const updateListing = trpc.listing.update.useMutation({
    onSuccess: () => {
      myListings.refetch();
    },
  });

  const deleteListing = trpc.listing.delete.useMutation({
    onSuccess: () => {
      toast.success("Angebot erfolgreich geloscht!");
      myListings.refetch();
    },
    onError: (error) => {
      console.error("[SellerDashboard] Delete listing error:", error);
      toast.error("Fehler beim L\u00f6schen: " + error.message);
    },
  });

  // Form state
  const initialFormData = {
    type: "cutting" as const,
    strain: "",
    listingDescription: "",
    quantity: 1,
    priceType: "fixed" as const,
    fixedPrice: 0,
    auctionStartPrice: 0,
    acceptsOffers: false,
    offerMinPrice: 0,
    imageUrl: "",
    images: [] as string[],
    shippingVerified: true,
    shippingPickup: false,
    // Additional optional fields
    genetics: "" as "sativa" | "indica" | "hybrid" | "",
    seedBank: "",
    growMethod: "" as "hydro" | "bio" | "soil" | "",
    seedType: "" as "feminized" | "regular" | "autoflower" | "",
    thcContent: "",
    cbdContent: "",
    floweringTime: "",
    yieldInfo: "",
    flavorProfile: "",
    origin: "",
  };

  const [formData, setFormData] = useState(initialFormData);
  const [profileFormData, setProfileFormData] = useState({
    shopName: "",
    description: "",
    location: "",
  });
  const [ageVerifiedSeller, setAgeVerifiedSeller] = useState(false);

  // Handle edit button click - open edit dialog
  const handleEditClick = (listing: Listing) => {
    setEditingListing(listing);
    
    // Parse images array if it's a JSON string
    let imagesArray: string[] = [];
    if (listing.images) {
      try {
        imagesArray = typeof listing.images === 'string' ? JSON.parse(listing.images) : listing.images;
      } catch (e) {
        imagesArray = [];
      }
    }
    
    setFormData({
      ...formData,
      type: listing.type,
      strain: listing.strain,
      listingDescription: listing.description,
      quantity: listing.quantity,
      priceType: listing.priceType,
      fixedPrice: listing.priceType === 'fixed' ? parseFloat(listing.fixedPrice) : 0,
      auctionStartPrice: listing.priceType === 'auction' && listing.auctionStartPrice ? parseFloat(listing.auctionStartPrice) : 0,
      imageUrl: listing.imageUrl || "",
      images: imagesArray,
      shippingVerified: listing.shippingVerified ?? true,
      shippingPickup: listing.shippingPickup ?? false,
      acceptsOffers: listing.acceptsOffers ?? false,
      offerMinPrice: listing.offerMinPrice ? parseFloat(listing.offerMinPrice) : 0,
      // Additional fields
      genetics: listing.genetics || "",
      seedBank: listing.seedBank || "",
      growMethod: listing.growMethod || "",
      seedType: listing.seedType || "",
      thcContent: listing.thcContent || "",
      cbdContent: listing.cbdContent || "",
      floweringTime: listing.floweringTime || "",
      yieldInfo: listing.yieldInfo || "",
      origin: listing.origin || "",
      flavorProfile: listing.flavorProfile || "",
    });
    setIsEditDialogOpen(true);
  };

  if (!isAuthenticated) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <Card className="w-full max-w-md">
          <CardHeader>
            <CardTitle>Zugriff verweigert</CardTitle>
            <CardDescription>Bitte melden Sie sich an, um auf das Seller-Dashboard zuzugreifen.</CardDescription>
          </CardHeader>
        </Card>
      </div>
    );
  }

  // Show error state
  if (sellerProfile.isError) {
    return (
      <QueryError
        title="Fehler beim Laden des Verk\u00e4ufer-Profils"
        message="Das Verk\u00e4ufer-Profil konnte nicht geladen werden. Bitte versuchen Sie es erneut."
        error={sellerProfile.error}
        onRetry={() => sellerProfile.refetch()}
        showDetails={process.env.NODE_ENV === 'development'}
      />
    );
  }

  // Show loading state
  if (sellerProfile.isLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p className="text-gray-600">Lade Profil...</p>
        </div>
      </div>
    );
  }

  // Show profile creation if user doesn't have a seller profile
  if (!sellerProfile.data) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-8">
        <div className="max-w-2xl mx-auto">
          <Card>
            <CardHeader>
              <CardTitle>Verkäufer-Profil erstellen</CardTitle>
              <CardDescription>
                Erstellen Sie Ihr Verkäufer-Profil, um Stecklinge und Samen anzubieten.
              </CardDescription>
            </CardHeader>
            <CardContent>
              <form
                onSubmit={(e) => {
                  e.preventDefault();
                  if (!profileFormData.shopName.trim()) {
                    alert('Bitte geben Sie einen Shop-Namen ein');
                    return;
                  }
                  createProfile.mutate(profileFormData);
                }}
                className="space-y-4"
              >
                <div>
                  <label className="text-sm font-medium">Shop-Name *</label>
                  <Input
                    placeholder="z.B. Meine Cannabis-Stecklinge"
                    value={profileFormData.shopName}
                    onChange={(e) =>
                      setProfileFormData({ ...profileFormData, shopName: e.target.value })
                    }
                    required
                  />
                </div>

                <div>
                  <label className="text-sm font-medium">Beschreibung</label>
                  <Textarea
                    placeholder="Beschreiben Sie Ihren Shop und Ihre Spezialitäten..."
                    value={profileFormData.description}
                    onChange={(e) =>
                      setProfileFormData({ ...profileFormData, description: e.target.value })
                    }
                  />
                </div>

                <div>
                  <label className="text-sm font-medium">Standort</label>
                  <Input
                    placeholder="z.B. Berlin, Deutschland"
                    value={profileFormData.location}
                    onChange={(e) =>
                      setProfileFormData({ ...profileFormData, location: e.target.value })
                    }
                  />
                </div>

                <Alert>
                  <AlertCircle className="h-4 w-4" />
                  <AlertDescription>
                    Indem Sie ein Verkäufer-Profil erstellen, erklären Sie sich damit einverstanden, dass Ihre Stecklinge und Samen den Anforderungen des Konsumcannabisgesetzes (KCanG) entsprechen und keine Blüten oder Fruchtstände haben.
                  </AlertDescription>
                </Alert>

                {createProfile.error && (
                  <Alert variant="destructive">
                    <AlertCircle className="h-4 w-4" />
                    <AlertDescription>{createProfile.error?.message || 'Fehler beim Erstellen des Profils'}</AlertDescription>
                  </Alert>
                )}

                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                  <label className="flex items-start gap-3 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={ageVerifiedSeller}
                      onChange={(e) => setAgeVerifiedSeller(e.target.checked)}
                      className="mt-1"
                    />
                    <span className="text-sm text-blue-900">
                      <strong>Altersbestaetigung:</strong> Ich bestaettige, dass ich mindestens 18 Jahre alt bin und dass alle Stecklinge und Samen, die ich anbiete, den Anforderungen des Konsumcannabisgesetzes (KCanG) entsprechen und keine Blueten, Fruchtstande oder verarbeitete Produkte sind.
                    </span>
                  </label>
                </div>

                <Button
                  type="submit"
                  disabled={createProfile.isPending || !profileFormData.shopName.trim() || !ageVerifiedSeller}
                  className="w-full"
                >
                  {createProfile.isPending ? "Wird erstellt..." : "Profil erstellen"}
                </Button>
              </form>
            </CardContent>
          </Card>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
      <Header />
      <div className="max-w-6xl mx-auto p-8">
        {/* Header */}
        <div className="mb-8">
          <h1 className="text-3xl font-bold mb-2">Seller Dashboard</h1>
          <p className="text-gray-600">
            Verwalten Sie Ihre Stecklinge und Samen auf der deimudda-Plattform.
          </p>
        </div>

        {/* Profile Card */}
        {sellerProfile.data && (
          <Card className="mb-8">
            <CardContent className="p-6">
              <div className="flex items-start gap-6">
                {/* Profile Image */}
                <div className="flex-shrink-0">
                  {sellerProfile.data.profileImageUrl ? (
                    <img
                      src={sellerProfile.data.profileImageUrl}
                      alt={sellerProfile.data.shopName}
                      className="w-24 h-24 rounded-full object-cover border-4 border-green-100"
                    />
                  ) : (
                    <div className="w-24 h-24 rounded-full bg-gray-300 flex items-center justify-center border-4 border-green-100">
                      <User className="w-12 h-12 text-gray-600" />
                    </div>
                  )}
                </div>

                {/* Profile Info */}
                <div className="flex-1">
                  <h2 className="text-2xl font-bold mb-1">{sellerProfile.data.shopName}</h2>
                  <p className="text-gray-600 mb-4">{sellerProfile.data.location}</p>

                  <div className="grid grid-cols-2 gap-4 mb-4">
                    <div>
                      <p className="text-sm text-gray-600">Bewertung</p>
                      <p className="text-2xl font-bold">
                        {parseFloat(sellerProfile.data.rating || "0").toFixed(1)} ⭐
                      </p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-600">Bewertungen</p>
                      <p className="text-2xl font-bold">{sellerProfile.data.totalReviews}</p>
                    </div>
                  </div>

                  {sellerProfile.data.description && (
                    <p className="text-gray-700 mb-4">{sellerProfile.data.description}</p>
                  )}

                  <div className="flex items-center gap-3">
                    <Badge variant={sellerProfile.data.verificationStatus === "verified" ? "default" : "outline"}>
                      {sellerProfile.data.verificationStatus === "verified" ? "✓ Verifiziert" : "Ausstehend"}
                    </Badge>
                    
                    {user && (
                      <Link to={`/seller/${user.id}`}>
                        <Button variant="outline" size="sm" className="gap-2">
                          <ExternalLink className="w-4 h-4" />
                          Mein Shop ansehen
                        </Button>
                      </Link>
                    )}
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>
        )}

        {/* Create Listing Button */}
        <div className="mb-8">
          <div className="flex gap-3">
            <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>
              <DialogTrigger asChild>
                <Button size="lg" className="gap-2">
                  <Plus className="w-5 h-5" />
                  Neues Angebot erstellen
                </Button>
              </DialogTrigger>
            </Dialog>
            <Link href="/seller/transactions">
              <Button size="lg" variant="outline" className="gap-2">
                <Euro className="w-5 h-5" />
                Verkäufe & Gebühren
              </Button>
            </Link>
            <Link href="/seller/offers">
              <Button size="lg" variant="outline" className="gap-2">
                <MessageSquare className="w-5 h-5" />
                Preisvorschläge verwalten
              </Button>
            </Link>
            <Link href="/messages">
              <Button size="lg" variant="outline" className="gap-2 relative">
                <MessageCircle className="w-5 h-5" />
                Nachrichten
                {unreadMessageCount > 0 && (
                  <Badge 
                    variant="destructive" 
                    className="absolute -top-2 -right-2 h-6 w-6 flex items-center justify-center p-0 text-xs"
                  >
                    {unreadMessageCount > 9 ? "9+" : unreadMessageCount}
                  </Badge>
                )}
              </Button>
            </Link>
          </div>
          <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>
            <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
              <DialogHeader>
                <DialogTitle>Neues Angebot erstellen</DialogTitle>
                <DialogDescription>
                  Erstellen Sie ein neues Angebot für Stecklinge oder Samen.
                </DialogDescription>
              </DialogHeader>

              {/* RED WARNING BANNER */}
              <div className="bg-red-50 border-l-4 border-red-600 p-4 rounded-r-lg mb-4">
                <div className="flex items-start gap-3">
                  <AlertCircle className="h-5 w-5 text-red-600 flex-shrink-0 mt-0.5" />
                  <div className="text-sm text-red-800">
                    <p className="font-bold mb-1">⚠️ ACHTUNG: Verkauf von Blütenständen ist VERBOTEN!</p>
                    <p className="mb-2">Der Verkauf von Cannabis-Blüten, Haschisch, Öl oder anderen Cannabisprodukten führt zur <strong>sofortigen Account-Sperrung</strong> und kann strafrechtlich verfolgt werden.</p>
                    <p className="text-xs"><strong>🔒 Datenschutz:</strong> Speichern Sie <strong>keine privaten Kontaktdaten</strong> in der Produktbeschreibung. Nutzen Sie das Chat-System und verschlüsselte Messenger (Signal, Telegram) für den Austausch sensibler Daten.</p>
                  </div>
                </div>
              </div>

              <form
                onSubmit={(e) => {
                  e.preventDefault();
                  
                  // Validation
                  if (!formData.strain.trim()) {
                    toast.error("Bitte geben Sie eine Sorte ein");
                    return;
                  }
                  if (formData.quantity <= 0) {
                    toast.error("Menge muss grosser als 0 sein");
                    return;
                  }
                  if (String(formData.priceType) === "fixed" && formData.fixedPrice <= 0) {
                    toast.error("Preis muss grosser als 0 sein");
                    return;
                  }
                  if (String(formData.priceType) === "auction" && formData.auctionStartPrice <= 0) {
                    toast.error("Startgebot muss grosser als 0 sein");
                    return;
                  }

                  createListing.mutate({
                    type: formData.type as ListingType,
                    strain: formData.strain,
                    description: formData.listingDescription,
                    quantity: formData.quantity,
                    priceType: formData.priceType as PriceType,
                    fixedPrice: formData.fixedPrice || undefined,
                    auctionStartPrice: formData.auctionStartPrice || undefined,
                    imageUrl: formData.imageUrl || undefined,
                    images: formData.images || undefined,
                    shippingVerified: formData.shippingVerified,
                    shippingPickup: formData.shippingPickup,
                    acceptsOffers: formData.acceptsOffers,
                    offerMinPrice: formData.offerMinPrice || undefined,
                    // Additional optional fields
                    genetics: formData.genetics || undefined,
                    seedBank: formData.seedBank || undefined,
                    growMethod: formData.growMethod || undefined,
                    seedType: formData.seedType || undefined,
                    thcContent: formData.thcContent || undefined,
                    cbdContent: formData.cbdContent || undefined,
                    floweringTime: formData.floweringTime || undefined,
                    yieldInfo: formData.yieldInfo || undefined,
                    flavorProfile: formData.flavorProfile || undefined,
                    origin: formData.origin || undefined,
                  });
                }}
                className="space-y-4"
              >
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="text-sm font-medium">Typ *</label>
                    <Select value={formData.type} onValueChange={(value: ListingType) => setFormData({ ...formData, type: value })}>
                      <SelectTrigger>
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="cutting">Steckling</SelectItem>
                        <SelectItem value="seed">Samen</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>

                  <div>
                    <label className="text-sm font-medium">Sorte *</label>
                    <Input
                      placeholder="z.B. Blue Dream"
                      value={formData.strain}
                      onChange={(e) => setFormData({ ...formData, strain: e.target.value })}
                      required
                    />
                  </div>
                </div>

                <div>
                  <label className="text-sm font-medium">Beschreibung</label>
                  <Textarea
                    placeholder="Beschreiben Sie Ihre Stecklinge/Samen..."
                    value={formData.listingDescription}
                    onChange={(e) => setFormData({ ...formData, listingDescription: e.target.value })}
                  />
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="text-sm font-medium">Menge *</label>
                    <Input
                      type="number"
                      min="1"
                      value={formData.quantity}
                      onChange={(e) => setFormData({ ...formData, quantity: parseInt(e.target.value) })}
                      required
                    />
                  </div>

                  <div>
                    <label className="text-sm font-medium">Verkaufstyp *</label>
                    <Select value={formData.priceType} onValueChange={(value: PriceType) => setFormData({ ...formData, priceType: value })}>
                      <SelectTrigger>
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="fixed">Festpreis</SelectItem>
                        <SelectItem value="auction">Auktion</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {String(formData.priceType) === "fixed" && (
                  <div>
                    <label className="text-sm font-medium">Preis pro Stück (€) *</label>
                    <Input
                      type="number"
                      step="0.01"
                      min="0"
                      value={formData.fixedPrice}
                      onChange={(e) => setFormData({ ...formData, fixedPrice: parseFloat(e.target.value) })}
                      required
                    />
                  </div>
                )}

                {String(formData.priceType) === "auction" && (
                  <div>
                    <label className="text-sm font-medium">Startgebot (€) *</label>
                    <Input
                      type="number"
                      step="0.01"
                      min="0"
                      value={formData.auctionStartPrice}
                      onChange={(e) => setFormData({ ...formData, auctionStartPrice: parseFloat(e.target.value) })}
                      required
                    />
                  </div>
                )}

                {/* Price Offer Section */}
                <div className="border rounded-lg p-4 bg-blue-50">
                  <div className="flex items-start gap-3">
                    <input
                      type="checkbox"
                      id="acceptsOffers"
                      checked={formData.acceptsOffers}
                      onChange={(e) => setFormData({ ...formData, acceptsOffers: e.target.checked })}
                      className="mt-1"
                    />
                    <div className="flex-1">
                      <label htmlFor="acceptsOffers" className="text-sm font-medium cursor-pointer">
                        Preisvorschläge akzeptieren
                      </label>
                      <p className="text-xs text-gray-600 mt-1">
                        Käufer können Ihnen Preisvorschläge senden, die Sie annehmen oder ablehnen können.
                      </p>
                    </div>
                  </div>

                  {formData.acceptsOffers && (
                    <div className="mt-3">
                      <label className="text-sm font-medium">Mindestpreis (€) (optional)</label>
                      <Input
                        type="number"
                        step="0.01"
                        min="0"
                        value={formData.offerMinPrice}
                        onChange={(e) => setFormData({ ...formData, offerMinPrice: parseFloat(e.target.value) })}
                        placeholder="z.B. 10.00"
                      />
                      <p className="text-xs text-gray-500 mt-1">
                        Angebote unter diesem Preis werden automatisch abgelehnt.
                      </p>
                    </div>
                  )}
                </div>

                {/* Additional Optional Fields */}
                <div className="border-t pt-4 mt-4">
                  <h4 className="text-sm font-semibold mb-3">Zusätzliche Details (optional)</h4>
                  
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="text-sm font-medium">Genetik</label>
                      <Select value={formData.genetics} onValueChange={(value: Genetics) => setFormData({ ...formData, genetics: value })}>
                        <SelectTrigger>
                          <SelectValue placeholder="Wählen..." />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="sativa">Sativa</SelectItem>
                          <SelectItem value="indica">Indica</SelectItem>
                          <SelectItem value="hybrid">Hybrid</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div>
                      <label className="text-sm font-medium">Samenbank/Breeder</label>
                      <Input
                        value={formData.seedBank}
                        onChange={(e) => setFormData({ ...formData, seedBank: e.target.value })}
                        placeholder="z.B. Dutch Passion"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Anbaumethode</label>
                      <Select value={formData.growMethod} onValueChange={(value: GrowMethod) => setFormData({ ...formData, growMethod: value })}>
                        <SelectTrigger>
                          <SelectValue placeholder="Wählen..." />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="hydro">Hydro</SelectItem>
                          <SelectItem value="bio">Bio</SelectItem>
                          <SelectItem value="soil">Soil</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div>
                      <label className="text-sm font-medium">Samentyp</label>
                      <Select value={formData.seedType} onValueChange={(value: SeedType) => setFormData({ ...formData, seedType: value })}>
                        <SelectTrigger>
                          <SelectValue placeholder="Wählen..." />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="feminized">Feminisiert</SelectItem>
                          <SelectItem value="regular">Regular</SelectItem>
                          <SelectItem value="autoflower">Autoflower</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div>
                      <label className="text-sm font-medium">THC-Gehalt</label>
                      <Input
                        value={formData.thcContent}
                        onChange={(e) => setFormData({ ...formData, thcContent: e.target.value })}
                        placeholder="z.B. 15-20%"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">CBD-Gehalt</label>
                      <Input
                        value={formData.cbdContent}
                        onChange={(e) => setFormData({ ...formData, cbdContent: e.target.value })}
                        placeholder="z.B. < 1%"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Blütezeit</label>
                      <Input
                        value={formData.floweringTime}
                        onChange={(e) => setFormData({ ...formData, floweringTime: e.target.value })}
                        placeholder="z.B. 8-9 Wochen"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Ertrag</label>
                      <Input
                        value={formData.yieldInfo}
                        onChange={(e) => setFormData({ ...formData, yieldInfo: e.target.value })}
                        placeholder="z.B. 400-500g/m²"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Herkunft</label>
                      <Input
                        value={formData.origin}
                        onChange={(e) => setFormData({ ...formData, origin: e.target.value })}
                        placeholder="z.B. Kalifornien, USA"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Geschmack/Aroma</label>
                      <Input
                        value={formData.flavorProfile}
                        onChange={(e) => setFormData({ ...formData, flavorProfile: e.target.value })}
                        placeholder="z.B. Zitrus, Diesel, Erdig"
                      />
                    </div>
                  </div>
                </div>

                <MultiImageUpload
                  label="Produktbilder (optional)"
                  currentImages={formData.images}
                  maxImages={maxImages}
                  maxSizeMB={5}
                  onImagesChange={(urls) => setFormData({ ...formData, images: urls, imageUrl: urls[0] || "" })}
                />

                <div className="space-y-3">
                  <label className="text-sm font-medium">Versandarten * (mindestens eine auswählen)</label>
                  <div className="space-y-2">
                    <label className="flex items-center space-x-2 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={formData.shippingVerified}
                        onChange={(e) => setFormData({ ...formData, shippingVerified: e.target.checked })}
                        className="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"
                      />
                      <span className="text-sm">Versand mit Altersverifikation (DHL/DPD/Hermes)</span>
                    </label>
                    <label className="flex items-center space-x-2 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={formData.shippingPickup}
                        onChange={(e) => setFormData({ ...formData, shippingPickup: e.target.checked })}
                        className="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"
                      />
                      <span className="text-sm">Persönliche Abholung (lokal)</span>
                    </label>
                  </div>
                  <p className="text-xs text-gray-500">Sie können beide Optionen anbieten. Altersverifikation schützt Sie rechtlich und ist empfohlen.</p>
                </div>

                <Alert>
                  <AlertCircle className="h-4 w-4" />
                  <AlertDescription>
                    Stellen Sie sicher, dass Ihre Stecklinge/Samen den KCanG-Anforderungen entsprechen (keine Blueten oder Fruchtstande).
                  </AlertDescription>
                </Alert>

                <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                  <label className="flex items-start gap-3 cursor-pointer">
                    <input
                      type="checkbox"
                      required
                      className="mt-1"
                    />
                    <span className="text-sm text-green-900">
                      <strong>Bestaetigung:</strong> Ich bestaettige, dass diese Stecklinge/Samen den KCanG-Anforderungen entsprechen und keine Blueten, Fruchtstande oder verarbeitete Produkte enthalten.
                    </span>
                  </label>
                </div>

                <Button type="submit" disabled={createListing.isPending} className="w-full">
                  {createListing.isPending ? "Wird erstellt..." : "Angebot erstellen"}
                </Button>
              </form>
            </DialogContent>
          </Dialog>

          {/* Edit Dialog */}
          <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>
            <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
              <DialogHeader>
                <DialogTitle>Angebot bearbeiten</DialogTitle>
                <DialogDescription>Aktualisieren Sie die Details Ihres Angebots</DialogDescription>
              </DialogHeader>
              <form
                onSubmit={(e) => {
                  e.preventDefault();
                  if (editingListing) {
                    updateListing.mutate({
                      listingId: editingListing.id,
                      strain: formData.strain,
                      description: formData.listingDescription,
                      quantity: formData.quantity,
                      fixedPrice: formData.priceType === 'fixed' ? formData.fixedPrice : undefined,
                      imageUrl: formData.imageUrl || undefined,
                      images: formData.images && formData.images.length > 0 ? formData.images : undefined,
                      // Professional fields
                      genetics: formData.genetics || undefined,
                      seedBank: formData.seedBank || undefined,
                      growMethod: formData.growMethod || undefined,
                      seedType: formData.seedType || undefined,
                      thcContent: formData.thcContent || undefined,
                      cbdContent: formData.cbdContent || undefined,
                      floweringTime: formData.floweringTime || undefined,
                      yieldInfo: formData.yieldInfo || undefined,
                      flavorProfile: formData.flavorProfile || undefined,
                      origin: formData.origin || undefined,
                      shippingVerified: formData.shippingVerified,
                      shippingPickup: formData.shippingPickup,
                      acceptsOffers: formData.acceptsOffers,
                      offerMinPrice: formData.acceptsOffers ? formData.offerMinPrice : undefined,
                    });
                  }
                }}
                className="space-y-4"
              >
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="text-sm font-medium">Typ *</label>
                    <Select value={formData.type} onValueChange={(value: ListingType) => setFormData({ ...formData, type: value })} disabled>
                      <SelectTrigger>
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="cutting">Steckling</SelectItem>
                        <SelectItem value="seed">Samen</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <label className="text-sm font-medium">Sorte *</label>
                    <Input
                      value={formData.strain}
                      onChange={(e) => setFormData({ ...formData, strain: e.target.value })}
                      placeholder="z.B. Blue Dream"
                      required
                    />
                  </div>
                </div>

                <div>
                  <label className="text-sm font-medium">Beschreibung</label>
                  <Textarea
                    value={formData.listingDescription}
                    onChange={(e) => setFormData({ ...formData, listingDescription: e.target.value })}
                    placeholder="Beschreiben Sie Ihr Angebot..."
                    rows={3}
                  />
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="text-sm font-medium">Menge *</label>
                    <Input
                      type="number"
                      min="1"
                      value={formData.quantity}
                      onChange={(e) => setFormData({ ...formData, quantity: parseInt(e.target.value) })}
                      required
                    />
                  </div>
                  <div>
                    <label className="text-sm font-medium">Verkaufstyp *</label>
                    <Select value={formData.priceType} onValueChange={(value: PriceType) => setFormData({ ...formData, priceType: value })}>
                      <SelectTrigger>
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="fixed">Festpreis</SelectItem>
                        <SelectItem value="auction">Auktion</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {String(formData.priceType) === "fixed" && (
                  <div>
                    <label className="text-sm font-medium">Preis pro Stück (€) *</label>
                    <Input
                      type="number"
                      step="0.01"
                      min="0"
                      value={formData.fixedPrice}
                      onChange={(e) => setFormData({ ...formData, fixedPrice: parseFloat(e.target.value) })}
                      required
                    />
                  </div>
                )}

                {String(formData.priceType) === "auction" && (
                  <div>
                    <label className="text-sm font-medium">Startgebot (€) *</label>
                    <Input
                      type="number"
                      step="0.01"
                      min="0"
                      value={formData.auctionStartPrice}
                      onChange={(e) => setFormData({ ...formData, auctionStartPrice: parseFloat(e.target.value) })}
                      required
                    />
                  </div>
                )}

                {/* Price Offer Section */}
                <div className="border rounded-lg p-4 bg-blue-50">
                  <div className="flex items-start gap-3">
                    <input
                      type="checkbox"
                      id="acceptsOffers"
                      checked={formData.acceptsOffers}
                      onChange={(e) => setFormData({ ...formData, acceptsOffers: e.target.checked })}
                      className="mt-1"
                    />
                    <div className="flex-1">
                      <label htmlFor="acceptsOffers" className="text-sm font-medium cursor-pointer">
                        Preisvorschläge akzeptieren
                      </label>
                      <p className="text-xs text-gray-600 mt-1">
                        Käufer können Ihnen Preisvorschläge senden, die Sie annehmen oder ablehnen können.
                      </p>
                    </div>
                  </div>

                  {formData.acceptsOffers && (
                    <div className="mt-3">
                      <label className="text-sm font-medium">Mindestpreis (€) (optional)</label>
                      <Input
                        type="number"
                        step="0.01"
                        min="0"
                        value={formData.offerMinPrice}
                        onChange={(e) => setFormData({ ...formData, offerMinPrice: parseFloat(e.target.value) })}
                        placeholder="z.B. 10.00"
                      />
                      <p className="text-xs text-gray-500 mt-1">
                        Angebote unter diesem Preis werden automatisch abgelehnt.
                      </p>
                    </div>
                  )}
                </div>

                {/* Additional Optional Fields */}
                <div className="border-t pt-4 mt-4">
                  <h4 className="text-sm font-semibold mb-3">Zusätzliche Details (optional)</h4>
                  
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="text-sm font-medium">Genetik</label>
                      <Select value={formData.genetics} onValueChange={(value: Genetics) => setFormData({ ...formData, genetics: value })}>
                        <SelectTrigger>
                          <SelectValue placeholder="Wählen..." />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="sativa">Sativa</SelectItem>
                          <SelectItem value="indica">Indica</SelectItem>
                          <SelectItem value="hybrid">Hybrid</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div>
                      <label className="text-sm font-medium">Samenbank/Breeder</label>
                      <Input
                        value={formData.seedBank}
                        onChange={(e) => setFormData({ ...formData, seedBank: e.target.value })}
                        placeholder="z.B. Dutch Passion"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Anbaumethode</label>
                      <Select value={formData.growMethod} onValueChange={(value: GrowMethod) => setFormData({ ...formData, growMethod: value })}>
                        <SelectTrigger>
                          <SelectValue placeholder="Wählen..." />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="hydro">Hydro</SelectItem>
                          <SelectItem value="bio">Bio</SelectItem>
                          <SelectItem value="soil">Soil</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div>
                      <label className="text-sm font-medium">Samentyp</label>
                      <Select value={formData.seedType} onValueChange={(value: SeedType) => setFormData({ ...formData, seedType: value })}>
                        <SelectTrigger>
                          <SelectValue placeholder="Wählen..." />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="feminized">Feminisiert</SelectItem>
                          <SelectItem value="regular">Regular</SelectItem>
                          <SelectItem value="autoflower">Autoflower</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div>
                      <label className="text-sm font-medium">THC-Gehalt</label>
                      <Input
                        value={formData.thcContent}
                        onChange={(e) => setFormData({ ...formData, thcContent: e.target.value })}
                        placeholder="z.B. 15-20%"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">CBD-Gehalt</label>
                      <Input
                        value={formData.cbdContent}
                        onChange={(e) => setFormData({ ...formData, cbdContent: e.target.value })}
                        placeholder="z.B. < 1%"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Blütezeit</label>
                      <Input
                        value={formData.floweringTime}
                        onChange={(e) => setFormData({ ...formData, floweringTime: e.target.value })}
                        placeholder="z.B. 8-9 Wochen"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Ertrag</label>
                      <Input
                        value={formData.yieldInfo}
                        onChange={(e) => setFormData({ ...formData, yieldInfo: e.target.value })}
                        placeholder="z.B. 400-500g/m²"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Herkunft</label>
                      <Input
                        value={formData.origin}
                        onChange={(e) => setFormData({ ...formData, origin: e.target.value })}
                        placeholder="z.B. Kalifornien, USA"
                      />
                    </div>

                    <div>
                      <label className="text-sm font-medium">Geschmack/Aroma</label>
                      <Input
                        value={formData.flavorProfile}
                        onChange={(e) => setFormData({ ...formData, flavorProfile: e.target.value })}
                        placeholder="z.B. Zitrus, Diesel, Erdig"
                      />
                    </div>
                  </div>
                </div>

                <MultiImageUpload
                  label="Produktbilder (optional)"
                  currentImages={formData.images}
                  maxImages={maxImages}
                  maxSizeMB={5}
                  onImagesChange={(urls) => setFormData({ ...formData, images: urls, imageUrl: urls[0] || "" })}
                />

                <div className="space-y-3">
                  <label className="text-sm font-medium">Versandarten * (mindestens eine auswählen)</label>
                  <div className="space-y-2">
                    <label className="flex items-center space-x-2 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={formData.shippingVerified}
                        onChange={(e) => setFormData({ ...formData, shippingVerified: e.target.checked })}
                        className="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"
                      />
                      <span className="text-sm">Versand mit Altersverifikation (DHL/DPD/Hermes)</span>
                    </label>
                    <label className="flex items-center space-x-2 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={formData.shippingPickup}
                        onChange={(e) => setFormData({ ...formData, shippingPickup: e.target.checked })}
                        className="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"
                      />
                      <span className="text-sm">Persönliche Abholung (lokal)</span>
                    </label>
                  </div>
                  <p className="text-xs text-gray-500">Sie können beide Optionen anbieten. Altersverifikation schützt Sie rechtlich und ist empfohlen.</p>
                </div>

                <Alert>
                  <AlertCircle className="h-4 w-4" />
                  <AlertDescription>
                    Stellen Sie sicher, dass Ihre Stecklinge/Samen den KCanG-Anforderungen entsprechen (keine Blueten oder Fruchtstande).
                  </AlertDescription>
                </Alert>

                <Button type="submit" disabled={updateListing.isPending} className="w-full">
                  {updateListing.isPending ? "Wird aktualisiert..." : "Angebot aktualisieren"}
                </Button>
              </form>
            </DialogContent>
          </Dialog>

        </div>

        {/* Listings Table */}
        <Card>
          <CardHeader>
            <CardTitle>Meine Angebote</CardTitle>
            <CardDescription>
              {myListings.data?.length || 0} Angebot{(myListings.data?.length || 0) !== 1 ? "e" : ""}
            </CardDescription>
          </CardHeader>
          <CardContent>
            {myListings.isLoading ? (
              <div className="space-y-3">
                <div className="h-12 bg-gray-200 rounded animate-pulse"></div>
                <div className="h-12 bg-gray-200 rounded animate-pulse"></div>
                <div className="h-12 bg-gray-200 rounded animate-pulse"></div>
              </div>
            ) : myListings.data?.length === 0 ? (
              <p className="text-gray-500">Keine Angebote vorhanden. Erstellen Sie Ihr erstes Angebot!</p>
            ) : (
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead className="border-b">
                    <tr>
                      <th className="text-left py-2 px-4">Sorte</th>
                      <th className="text-left py-2 px-4">Typ</th>
                      <th className="text-left py-2 px-4">Menge</th>
                      <th className="text-left py-2 px-4">Preis</th>
                      <th className="text-left py-2 px-4">Status</th>
                      <th className="text-right py-2 px-4">Aktionen</th>
                    </tr>
                  </thead>
                  <tbody>
                    {myListings.data?.map((listing) => (
                      <tr key={listing.id} className="border-b hover:bg-slate-50">
                        <td className="py-2 px-4 font-medium">{listing.strain}</td>
                        <td className="py-2 px-4">
                          {listing.type === "cutting" ? "Steckling" : "Samen"}
                        </td>
                        <td className="py-2 px-4">{listing.quantity}</td>
                        <td className="py-2 px-4">
                          {String(listing.priceType) === "fixed"
                            ? `€${parseFloat(listing.fixedPrice || "0").toFixed(2)}`
                            : `Ab €${parseFloat(listing.auctionStartPrice || "0").toFixed(2)}`}
                        </td>
                        <td className="py-2 px-4">
                          <Badge variant={listing.status === "active" ? "default" : "secondary"}>
                            {listing.status === "active" ? "Aktiv" : listing.status === "sold" ? "Verkauft" : "Beendet"}
                          </Badge>
                        </td>
                        <td className="py-2 px-4 text-right space-x-2">
                          <Button
                            variant="ghost"
                            size="sm"
                            disabled={updateListing.isPending}
                            onClick={() => handleEditClick(listing)}
                          >
                            <Edit2 className="w-4 h-4" />
                          </Button>
                          <Button
                            variant="ghost"
                            size="sm"
                            disabled={deleteListing.isPending}
                            onClick={() => deleteListing.mutate(listing.id)}
                          >
                            <Trash2 className="w-4 h-4" />
                          </Button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: SellerGuidelines.tsx

**`client/src/components/SellerGuidelines.tsx`**

```typescript
import BackButton from "@/components/BackButton";
import { CheckCircle, AlertTriangle, XCircle, Info } from "lucide-react";
import { trpc } from "@/lib/trpc";

export default function SellerGuidelines() {
  // Load dynamic fees from system settings
  const { data: platformFeeStr } = trpc.admin.getSystemSetting.useQuery('platform_fee_fixed', { staleTime: 300000 });
  const { data: paypalFeePercentageStr } = trpc.admin.getSystemSetting.useQuery('paypal_fee_percentage', { staleTime: 300000 });
  const { data: paypalFeeFixedStr } = trpc.admin.getSystemSetting.useQuery('paypal_fee_fixed', { staleTime: 300000 });
  
  const PLATFORM_FEE = parseFloat(platformFeeStr || "0.42");
  const PAYPAL_FEE_PERCENTAGE = parseFloat(paypalFeePercentageStr || "0.0249");
  const PAYPAL_FEE_FIXED = parseFloat(paypalFeeFixedStr || "0.49");
  const EXAMPLE_TOTAL_FEES_20 = (PLATFORM_FEE + 20 * PAYPAL_FEE_PERCENTAGE + PAYPAL_FEE_FIXED).toFixed(2);
  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 py-12">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <BackButton href="/" label="Zurück zur Startseite" />
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-8 text-gray-900">Verkäufer-Richtlinien</h1>
          
          <div className="prose prose-lg max-w-none">
            <p className="text-lg text-gray-700 mb-8">
              Als Verkäufer auf deimudda trägst du Verantwortung für deine Listings und die Abwicklung deiner Verkäufe. 
              Diese Richtlinien helfen dir, erfolgreich und rechtskonform zu verkaufen.
            </p>

            {/* Grundregeln */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                <CheckCircle className="h-6 w-6 text-green-600" />
                Grundregeln für Verkäufer
              </h2>
              
              <div className="space-y-4">
                <div className="bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg">
                  <h3 className="font-bold text-green-900 mb-2">✅ Erlaubt</h3>
                  <ul className="list-disc pl-6 space-y-1 text-green-800">
                    <li>Verkauf von <strong>Cannabis-Stecklingen</strong> (lebende Pflanzen)</li>
                    <li>Verkauf von <strong>Cannabis-Samen</strong></li>
                    <li>Verkauf von <strong>eigenem Vermehrungsmaterial</strong></li>
                    <li>Verkauf als <strong>Privatperson</strong> oder <strong>Gewerbetreibender</strong></li>
                    <li><strong>Preisvorschlag-Funktion</strong> nutzen</li>
                    <li><strong>Versand</strong> oder <strong>Abholung</strong> anbieten</li>
                  </ul>
                </div>

                <div className="bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg">
                  <h3 className="font-bold text-red-900 mb-2">❌ Verboten</h3>
                  <ul className="list-disc pl-6 space-y-1 text-red-800">
                    <li>Verkauf von <strong>Cannabis-Blüten</strong> (Ernteprodukte)</li>
                    <li>Verkauf von <strong>Haschisch, Öl oder anderen Cannabisprodukten</strong></li>
                    <li>Verkauf an <strong>Minderjährige</strong> (unter 18 Jahren)</li>
                    <li><strong>Falsche oder irreführende Produktbeschreibungen</strong></li>
                    <li><strong>Gestohlene oder illegal erworbene Pflanzen</strong></li>
                    <li><strong>Kranke oder befallene Pflanzen</strong> ohne Hinweis</li>
                    <li><strong>Spam oder Werbung</strong> in Produktbeschreibungen</li>
                  </ul>
                </div>
              </div>
            </section>

            {/* Listing-Qualität */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">📸 Listing-Qualität</h2>
              
              <div className="space-y-4">
                <h3 className="text-xl font-semibold">Produktbilder</h3>
                <ul className="list-disc pl-6 space-y-2 text-gray-700">
                  <li><strong>Mindestens 1 Bild</strong> ist Pflicht</li>
                  <li>Bilder sollten <strong>klar und gut beleuchtet</strong> sein</li>
                  <li>Zeige die <strong>tatsächliche Pflanze</strong>, die verkauft wird</li>
                  <li>Keine <strong>Stock-Fotos</strong> oder fremde Bilder verwenden</li>
                  <li>Mehrere Bilder aus verschiedenen Winkeln sind empfohlen</li>
                </ul>

                <h3 className="text-xl font-semibold mt-4">Produktbeschreibung</h3>
                <ul className="list-disc pl-6 space-y-2 text-gray-700">
                  <li><strong>Strain-Name</strong> (Sorte) korrekt angeben</li>
                  <li><strong>Produkttyp</strong>: Steckling oder Samen</li>
                  <li><strong>Größe/Alter</strong> der Pflanze (bei Stecklingen)</li>
                  <li><strong>Gesundheitszustand</strong>: Sind die Pflanzen gesund?</li>
                  <li><strong>Besonderheiten</strong>: z.B. Terpenen-Profil, Wuchsform, etc.</li>
                  <li><strong>Versandbedingungen</strong>: Wie werden die Pflanzen verpackt?</li>
                </ul>

                <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                  <p className="text-blue-800 text-sm">
                    <Info className="inline h-4 w-4 mr-1" />
                    <strong>Tipp:</strong> Je detaillierter deine Beschreibung, desto weniger Rückfragen und desto zufriedener die Käufer!
                  </p>
                </div>
              </div>
            </section>

            {/* Preisgestaltung */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">💰 Preisgestaltung</h2>
              
              <div className="space-y-4">
                <h3 className="text-xl font-semibold">Faire Preise</h3>
                <p className="text-gray-700">
                  Setze <strong>realistische Preise</strong>, die den Wert deiner Pflanzen widerspiegeln. 
                  Berücksichtige dabei:
                </p>
                <ul className="list-disc pl-6 space-y-1 text-gray-700">
                  <li>Qualität und Gesundheit der Pflanzen</li>
                  <li>Seltenheit der Sorte</li>
                  <li>Größe/Alter der Stecklinge</li>
                  <li>Marktpreise für vergleichbare Angebote</li>
                </ul>

                <h3 className="text-xl font-semibold mt-4">Gebühren einkalkulieren</h3>
                <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                  <p className="text-yellow-800 mb-2">
                    <strong>Wichtig:</strong> Kalkuliere die Gebühren in deinen Preis ein!
                  </p>
                  <ul className="list-disc pl-6 space-y-1 text-yellow-800 text-sm">
                    <li><strong>Plattformgebühr:</strong> €{PLATFORM_FEE.toFixed(2).replace('.', ',')} pro Artikel</li>
                    <li><strong>PayPal-Gebühr (bei Online-Zahlung):</strong> ca. {(PAYPAL_FEE_PERCENTAGE * 100).toFixed(2)}% + €{PAYPAL_FEE_FIXED.toFixed(2).replace('.', ',')}</li>
                    <li><strong>Beispiel:</strong> Bei €20 Verkaufspreis → €{EXAMPLE_TOTAL_FEES_20.replace('.', ',')} Gebühren gesamt</li>
                  </ul>
                </div>

                <h3 className="text-xl font-semibold mt-4">Preisvorschläge</h3>
                <p className="text-gray-700">
                  Du kannst die <strong>Preisvorschlag-Funktion</strong> aktivieren, um Verhandlungen zu ermöglichen. 
                  Das kann die Verkaufschancen erhöhen, besonders bei höherpreisigen Artikeln.
                </p>
              </div>
            </section>

            {/* Versand & Abholung */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">📦 Versand & Abholung</h2>
              
              <div className="space-y-4">
                <h3 className="text-xl font-semibold">Versand</h3>
                <ul className="list-disc pl-6 space-y-2 text-gray-700">
                  <li><strong>Sichere Verpackung:</strong> Pflanzen müssen sicher verpackt sein (Schutz vor Kälte, Hitze, Beschädigung)</li>
                  <li><strong>Schneller Versand:</strong> Stecklinge sollten innerhalb von 1-2 Tagen versandt werden</li>
                  <li><strong>Tracking:</strong> Nutze Versandmethoden mit Sendungsverfolgung (empfohlen)</li>
                  <li><strong>Versandkosten:</strong> Gib die Versandkosten klar an (oder biete kostenlosen Versand an)</li>
                </ul>

                <h3 className="text-xl font-semibold mt-4">Abholung</h3>
                <ul className="list-disc pl-6 space-y-2 text-gray-700">
                  <li><strong>Standort angeben:</strong> Gib deinen Standort im Verkäufer-Profil an</li>
                  <li><strong>Terminvereinbarung:</strong> Vereinbare einen konkreten Termin mit dem Käufer</li>
                  <li><strong>Barzahlung:</strong> Bei Abholung ist Barzahlung üblich</li>
                  <li><strong>Sicherheit:</strong> Treffe dich an einem öffentlichen Ort (z.B. Parkplatz)</li>
                </ul>

                <div className="bg-amber-50 p-4 rounded-lg border border-amber-200">
                  <p className="text-amber-800 text-sm">
                    <AlertTriangle className="inline h-4 w-4 mr-1" />
                    <strong>Wichtig:</strong> Lebende Pflanzen sind empfindlich! Achte auf sorgfältige Verpackung und schnellen Versand.
                  </p>
                </div>
              </div>
            </section>

            {/* Kommunikation */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">💬 Kommunikation mit Käufern</h2>
              
              <ul className="list-disc pl-6 space-y-2 text-gray-700">
                <li><strong>Schnelle Antworten:</strong> Antworte auf Anfragen innerhalb von 24 Stunden</li>
                <li><strong>Höflich und professionell:</strong> Auch bei schwierigen Käufern</li>
                <li><strong>Transparenz:</strong> Informiere über Versandstatus und Lieferzeiten</li>
                <li><strong>Probleme lösen:</strong> Bei Problemen (z.B. beschädigte Pflanzen) biete Lösungen an</li>
                <li><strong>Kontaktdaten bereitstellen:</strong> Stelle sicher, dass Käufer dich erreichen können</li>
              </ul>
            </section>

            {/* Rechtliche Pflichten */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">⚖️ Rechtliche Pflichten</h2>
              
              <div className="space-y-4">
                <h3 className="text-xl font-semibold">Für alle Verkäufer</h3>
                <ul className="list-disc pl-6 space-y-2 text-gray-700">
                  <li><strong>Widerrufsrecht:</strong> Du bist verantwortlich für die Abwicklung von Widerrufen (nicht deimudda)</li>
                  <li><strong>Gewährleistung:</strong> Du haftest für Mängel an deinen Produkten (§ 437 BGB)</li>
                  <li><strong>Keine Blüten verkaufen:</strong> Nur Stecklinge und Samen sind erlaubt</li>
                  <li><strong>Keine Verkäufe an Minderjährige:</strong> Nur an Personen ab 18 Jahren</li>
                </ul>

                <h3 className="text-xl font-semibold mt-4">Für gewerbliche Verkäufer</h3>
                <div className="bg-red-50 p-4 rounded-lg border border-red-200">
                  <p className="text-red-800 mb-2">
                    <strong>Zusätzliche Pflichten:</strong>
                  </p>
                  <ul className="list-disc pl-6 space-y-1 text-red-800 text-sm">
                    <li><strong>Impressumspflicht:</strong> Du musst ein eigenes Impressum bereitstellen (§ 5 TMG)</li>
                    <li><strong>Datenschutzerklärung:</strong> Du musst eine eigene Datenschutzerklärung bereitstellen (DSGVO)</li>
                    <li><strong>Widerrufsbelehrung:</strong> Du musst eine Widerrufsbelehrung bereitstellen</li>
                    <li><strong>Gewerbeanmeldung:</strong> Du musst ein Gewerbe angemeldet haben</li>
                    <li><strong>Steuerpflicht:</strong> Du musst Einnahmen versteuern</li>
                  </ul>
                </div>

                <p className="text-sm text-gray-600 mt-3">
                  <strong>Wann bin ich gewerblich?</strong> Wenn du regelmäßig und mit Gewinnabsicht verkaufst. 
                  Bei Unsicherheit konsultiere einen Steuerberater oder Rechtsanwalt.
                </p>
              </div>
            </section>

            {/* Bewertungen */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">⭐ Bewertungen</h2>
              
              <p className="text-gray-700 mb-4">
                Bewertungen sind das Herzstück deines Erfolgs auf deimudda. Gute Bewertungen führen zu mehr Verkäufen!
              </p>

              <h3 className="text-xl font-semibold mb-2">Wie bekomme ich gute Bewertungen?</h3>
              <ul className="list-disc pl-6 space-y-2 text-gray-700">
                <li><strong>Qualität:</strong> Verkaufe nur gesunde, hochwertige Pflanzen</li>
                <li><strong>Ehrlichkeit:</strong> Beschreibe deine Produkte wahrheitsgemäß</li>
                <li><strong>Schnelligkeit:</strong> Versende schnell und kommuniziere proaktiv</li>
                <li><strong>Service:</strong> Sei hilfsbereit und lösungsorientiert bei Problemen</li>
                <li><strong>Verpackung:</strong> Verpacke sorgfältig, damit die Pflanzen heil ankommen</li>
              </ul>

              <div className="bg-green-50 p-4 rounded-lg border border-green-200 mt-4">
                <p className="text-green-800 text-sm">
                  <CheckCircle className="inline h-4 w-4 mr-1" />
                  <strong>Tipp:</strong> Bitte zufriedene Käufer um eine Bewertung! Das erhöht deine Sichtbarkeit.
                </p>
              </div>
            </section>

            {/* Verstöße */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                <XCircle className="h-6 w-6 text-red-600" />
                Verstöße und Konsequenzen
              </h2>
              
              <p className="text-gray-700 mb-4">
                Verstöße gegen diese Richtlinien oder unsere Nutzungsbedingungen können zu folgenden Maßnahmen führen:
              </p>

              <div className="space-y-3">
                <div className="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                  <p className="font-semibold text-yellow-900">⚠️ Verwarnung</p>
                  <p className="text-sm text-yellow-800">Bei leichten Verstößen (z.B. unvollständige Produktbeschreibung)</p>
                </div>

                <div className="bg-orange-50 p-3 rounded-lg border border-orange-200">
                  <p className="font-semibold text-orange-900">🚫 Listing-Löschung</p>
                  <p className="text-sm text-orange-800">Bei Verstößen gegen Listing-Richtlinien (z.B. falsche Bilder)</p>
                </div>

                <div className="bg-red-50 p-3 rounded-lg border border-red-200">
                  <p className="font-semibold text-red-900">❌ Account-Sperrung</p>
                  <p className="text-sm text-red-800">Bei schwerwiegenden Verstößen (z.B. Verkauf von Blüten, Betrug)</p>
                </div>

                <div className="bg-gray-900 text-white p-3 rounded-lg">
                  <p className="font-semibold">🚨 Strafanzeige</p>
                  <p className="text-sm">Bei illegalen Aktivitäten (z.B. Verkauf an Minderjährige, illegale Produkte)</p>
                </div>
              </div>
            </section>

            {/* Best Practices */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">✨ Best Practices</h2>
              
              <div className="grid md:grid-cols-2 gap-4">
                <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                  <h3 className="font-bold text-blue-900 mb-2">📸 Professionelle Fotos</h3>
                  <p className="text-sm text-blue-800">
                    Nutze natürliches Licht und einen neutralen Hintergrund. Zeige die Pflanze aus mehreren Winkeln.
                  </p>
                </div>

                <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                  <h3 className="font-bold text-green-900 mb-2">💬 Schnelle Kommunikation</h3>
                  <p className="text-sm text-green-800">
                    Antworte innerhalb von 24 Stunden auf Anfragen. Das zeigt Professionalität und erhöht das Vertrauen.
                  </p>
                </div>

                <div className="bg-purple-50 p-4 rounded-lg border border-purple-200">
                  <h3 className="font-bold text-purple-900 mb-2">📦 Sichere Verpackung</h3>
                  <p className="text-sm text-purple-800">
                    Investiere in gute Verpackungsmaterialien. Beschädigte Pflanzen führen zu schlechten Bewertungen.
                  </p>
                </div>

                <div className="bg-orange-50 p-4 rounded-lg border border-orange-200">
                  <h3 className="font-bold text-orange-900 mb-2">⭐ Exzellenter Service</h3>
                  <p className="text-sm text-orange-800">
                    Gehe die Extra-Meile: Lege Pflegehinweise bei, biete Hilfe an, sei freundlich. Das zahlt sich aus!
                  </p>
                </div>
              </div>
            </section>

            {/* Support */}
            <section>
              <h2 className="text-2xl font-bold mb-4">❓ Fragen?</h2>
              
              <p className="text-gray-700 mb-4">
                Bei Fragen zu den Verkäufer-Richtlinien oder Problemen beim Verkaufen kontaktiere uns:
              </p>

              <div className="flex gap-4">
                <a
                  href="/contact"
                  className="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition"
                >
                  Kontakt aufnehmen
                </a>
                <a
                  href="/faq"
                  className="bg-gray-200 text-gray-800 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300 transition"
                >
                  FAQ lesen
                </a>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: SellerShop.tsx

**`client/src/components/SellerShop.tsx`**

```typescript
import { trpc } from "../lib/trpc";
import { Card, CardContent, CardHeader, CardTitle } from "../components/ui/card";
import { Button } from "../components/ui/button";
import { MapPin, Star, User, ArrowLeft } from "lucide-react";

export default function SellerShop() {
  const { sellerId } = useParams<{ sellerId: string }>();
  const sellerIdNum = parseInt(sellerId || "0", 10);

  const sellerProfile = trpc.seller.getProfileById.useQuery(sellerIdNum);
  const listings = trpc.listing.getBySellerID.useQuery(sellerIdNum);

  if (sellerProfile.isLoading || listings.isLoading) {
    return (
      <div className="container mx-auto px-4 py-8">
        <p className="text-center text-gray-600">Laden...</p>
      </div>
    );
  }

  if (sellerProfile.isError || !sellerProfile.data) {
    return (
      <div className="container mx-auto px-4 py-8">
        <p className="text-center text-red-600">Verkäufer nicht gefunden</p>
      </div>
    );
  }

  const seller = sellerProfile.data;
  const activeListings = listings.data?.filter((l) => l.status === "active") || [];

  return (
    <div className="container mx-auto px-4 py-8">
      {/* Back Button */}
      <Link to="/" className="inline-flex items-center gap-2 text-green-600 hover:text-green-700 mb-6">
        <ArrowLeft className="w-4 h-4" />
        Zurück zur Startseite
      </Link>

      {/* Seller Profile Header */}
      <Card className="mb-8">
        <CardContent className="p-6">
          <div className="flex items-start gap-6">
            {/* Profile Image */}
            <div className="flex-shrink-0">
              {seller.profileImageUrl ? (
                <img
                  src={seller.profileImageUrl}
                  alt={seller.shopName}
                  className="w-24 h-24 rounded-full object-cover border-4 border-green-100"
                />
              ) : (
                <div className="w-24 h-24 rounded-full bg-gray-300 flex items-center justify-center border-4 border-green-100">
                  <User className="w-12 h-12 text-gray-600" />
                </div>
              )}
            </div>

            {/* Profile Info */}
            <div className="flex-1">
              <h1 className="text-3xl font-bold mb-2">{seller.shopName}</h1>
              
              <div className="flex items-center gap-4 mb-4">
                <div className="flex items-center gap-1">
                  <Star className="w-5 h-5 text-yellow-500 fill-yellow-500" />
                  <span className="font-semibold">{parseFloat(seller.rating || "0").toFixed(1)}</span>
                  <span className="text-gray-600">({seller.totalReviews || 0} Bewertungen)</span>
                </div>
                
                {seller.location && (
                  <div className="flex items-center gap-1 text-gray-600">
                    <MapPin className="w-4 h-4" />
                    <span>{seller.location}</span>
                  </div>
                )}
              </div>

              {seller.description && (
                <p className="text-gray-700 whitespace-pre-wrap">{seller.description}</p>
              )}
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Listings Section */}
      <div className="mb-6">
        <h2 className="text-2xl font-bold mb-4">
          Angebote ({activeListings.length})
        </h2>
      </div>

      {activeListings.length === 0 ? (
        <Card>
          <CardContent className="p-8 text-center text-gray-600">
            <p>Dieser Verkäufer hat derzeit keine aktiven Angebote.</p>
          </CardContent>
        </Card>
      ) : (```

#### Schritt 5.x: SellerTransactions.tsx

**`client/src/components/SellerTransactions.tsx`**

```typescript
import { useState } from "react";
import { useAuth } from "@/_core/hooks/useAuth";
import type { Transaction } from "@/../../shared/types";
import { trpc } from "@/lib/trpc";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Header } from "@/components/Header";
import BackButton from "@/components/BackButton";
import { Euro, TrendingUp, ShoppingBag, AlertCircle } from "lucide-react";
import { Alert, AlertDescription } from "@/components/ui/alert";

export default function SellerTransactions() {
  const { user } = useAuth();
  const { data: transactions, isLoading, error } = trpc.transaction.getSellerTransactions.useQuery(undefined, { staleTime: 60000 });
  const { data: platformFeeStr } = trpc.admin.getSystemSetting.useQuery('platform_fee_fixed', { staleTime: 300000 }); // 5min cache
  const PLATFORM_FEE = parseFloat(platformFeeStr || "0.42");

  // Calculate statistics
  const totalSales = transactions?.length || 0;
  const totalRevenue = transactions?.reduce((sum, t) => sum + t.totalPrice, 0) || 0;
  const totalPlatformFees = totalSales * PLATFORM_FEE;
  const totalPaymentFees = transactions?.reduce((sum, t) => sum + (parseFloat(t.paymentFee || "0")), 0) || 0;
  const totalFees = totalPlatformFees + totalPaymentFees;
  const netRevenue = totalRevenue - totalFees;

  const getStatusBadge = (status: string) => {
    switch (status) {
      case "completed":
        return <Badge className="bg-green-500">Abgeschlossen</Badge>;
      case "pending":
        return <Badge className="bg-yellow-500">Ausstehend</Badge>;
      case "cancelled":
        return <Badge className="bg-red-500">Storniert</Badge>;
      default:
        return <Badge>{status}</Badge>;
    }
  };

  return (
    <>
      <Header />
      <div className="container mx-auto px-4 py-8">
        <BackButton href="/seller/dashboard" label="Zurück zum Verkäufer-Dashboard" />
        
        <h1 className="text-3xl font-bold mb-6">Meine Verkäufe & Gebühren</h1>

        {/* Statistics Cards */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Gesamt-Verkäufe</CardTitle>
              <ShoppingBag className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">{totalSales}</div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Gesamt-Umsatz</CardTitle>
              <TrendingUp className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">€{totalRevenue.toFixed(2)}</div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Gesamt-Gebühren</CardTitle>
              <Euro className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold text-red-600">-€{totalFees.toFixed(2)}</div>
              <p className="text-xs text-muted-foreground mt-1">
                PayPal: -€{totalPaymentFees.toFixed(2)} | Plattform: -€{totalPlatformFees.toFixed(2)}
              </p>
            </CardContent>
          </Card>

          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Netto-Einnahmen</CardTitle>
              <TrendingUp className="h-4 w-4 text-green-600" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold text-green-600">€{netRevenue.toFixed(2)}</div>
            </CardContent>
          </Card>
        </div>

        {/* Info Alert */}
        <Alert className="mb-6">
          <AlertCircle className="h-4 w-4" />
          <AlertDescription>
            <strong>Gebühren-Struktur:</strong> PayPal-Gebühren (2,49% + €0.49) + Plattform-Gebühr (€{PLATFORM_FEE.toFixed(2)}) werden automatisch bei Online-Zahlungen abgezogen. 
            Bei Offline-Zahlungen wird die Plattform-Gebühr monatlich abgerechnet.
          </AlertDescription>
        </Alert>

        {/* Transactions Table */}
        <Card>
          <CardHeader>
            <CardTitle>Alle Verkäufe</CardTitle>
            <CardDescription>
              Übersicht über alle Ihre abgeschlossenen und ausstehenden Verkäufe
            </CardDescription>
          </CardHeader>
          <CardContent>
            {isLoading && (
              <div className="text-center py-8">
                <p className="text-muted-foreground">Lade Transaktionen...</p>
              </div>
            )}

            {error && (
              <Alert variant="destructive">
                <AlertCircle className="h-4 w-4" />
                <AlertDescription>
                  Fehler beim Laden der Transaktionen: {error.message}
                </AlertDescription>
              </Alert>
            )}

            {!isLoading && !error && transactions && transactions.length === 0 && (
              <div className="text-center py-8">
                <p className="text-muted-foreground">Sie haben noch keine Verkäufe getätigt.</p>
              </div>
            )}

            {!isLoading && !error && transactions && transactions.length > 0 && (
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead>
                    <tr className="border-b">
                      <th className="text-left py-3 px-4">Datum</th>
                      <th className="text-left py-3 px-4">Käufer</th>
                      <th className="text-left py-3 px-4">Artikel</th>
                      <th className="text-right py-3 px-4">Brutto</th>
                      <th className="text-right py-3 px-4">PayPal</th>
                      <th className="text-right py-3 px-4">Plattform</th>
                      <th className="text-right py-3 px-4">Netto</th>
                      <th className="text-center py-3 px-4">Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    {transactions.map((transaction: Transaction) => {
                      const paymentFee = parseFloat(transaction.paymentFee || "0");
                      const netAmount = transaction.totalPrice - paymentFee - PLATFORM_FEE;
                      
                      return (
                        <tr key={transaction.id} className="border-b hover:bg-muted/50">
                          <td className="py-3 px-4">
                            {new Date(transaction.createdAt).toLocaleDateString('de-DE')}
                          </td>
                          <td className="py-3 px-4">
                            {transaction.buyer?.name || 'Unbekannt'}
                          </td>
                          <td className="py-3 px-4">
                            {transaction.listing?.strain || 'Gelöscht'}
                          </td>
                          <td className="text-right py-3 px-4">
                            €{transaction.totalPrice.toFixed(2)}
                          </td>
                          <td className="text-right py-3 px-4 text-red-600">
                            -€{paymentFee.toFixed(2)}
                          </td>
                          <td className="text-right py-3 px-4 text-red-600">
                            -€{PLATFORM_FEE.toFixed(2)}
                          </td>
                          <td className="text-right py-3 px-4 font-semibold text-green-600">
                            €{netAmount.toFixed(2)}
                          </td>
                          <td className="text-center py-3 px-4">
                            {getStatusBadge(transaction.status)}
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </>
  );
}

```

#### Schritt 5.x: Support.tsx

**`client/src/components/Support.tsx`**

```typescript
import { Mail, MessageCircle, Book, HelpCircle, AlertCircle } from "lucide-react";

export default function Support() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50 py-12">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-8 text-gray-900">Support & Hilfe</h1>
          
          <div className="prose prose-lg max-w-none">
            <p className="text-lg text-gray-700 mb-8">
              Brauchst du Hilfe? Wir sind für dich da! Hier findest du verschiedene Wege, um Unterstützung zu erhalten.
            </p>

            {/* Schnellhilfe */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">🚀 Schnellhilfe</h2>
              
              <div className="grid md:grid-cols-2 gap-4 not-prose">
                <a
                  href="/faq"
                  className="bg-blue-50 p-6 rounded-lg border border-blue-200 hover:bg-blue-100 transition group"
                >
                  <div className="flex items-center gap-3 mb-3">
                    <Book className="h-6 w-6 text-blue-600" />
                    <h3 className="text-xl font-bold text-blue-900">FAQ</h3>
                  </div>
                  <p className="text-sm text-blue-800">
                    Die meisten Fragen werden bereits in unseren FAQ beantwortet. Schau dort zuerst nach!
                  </p>
                  <p className="text-sm text-blue-600 mt-2 group-hover:underline">
                    → Zu den FAQ
                  </p>
                </a>

                <a
                  href="/contact"
                  className="bg-green-50 p-6 rounded-lg border border-green-200 hover:bg-green-100 transition group"
                >
                  <div className="flex items-center gap-3 mb-3">
                    <Mail className="h-6 w-6 text-green-600" />
                    <h3 className="text-xl font-bold text-green-900">Kontakt</h3>
                  </div>
                  <p className="text-sm text-green-800">
                    Kontaktiere uns direkt per E-Mail. Wir antworten innerhalb von 24-48 Stunden.
                  </p>
                  <p className="text-sm text-green-600 mt-2 group-hover:underline">
                    → Kontakt aufnehmen
                  </p>
                </a>
              </div>
            </section>

            {/* Support-Bereiche */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">📋 Support-Bereiche</h2>
              
              <div className="space-y-4 not-prose">
                {/* Technischer Support */}
                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                  <div className="flex items-start gap-4">
                    <div className="flex-shrink-0">
                      <div className="bg-red-100 p-3 rounded-lg">
                        <AlertCircle className="h-6 w-6 text-red-600" />
                      </div>
                    </div>
                    <div className="flex-1">
                      <h3 className="text-xl font-bold text-gray-900 mb-2">Technischer Support</h3>
                      <p className="text-gray-700 mb-3">
                        Probleme mit der Website, Bugs, Fehler beim Login oder Zahlungsprobleme?
                      </p>
                      <div className="space-y-2 text-sm">
                        <p className="text-gray-600">
                          <strong>E-Mail:</strong> <a href="mailto:support@deimudda.de" className="text-blue-600 hover:underline">support@deimudda.de</a>
                        </p>
                        <p className="text-gray-600">
                          <strong>Antwortzeit:</strong> Innerhalb von 48 Stunden
                        </p>
                      </div>
                      <div className="bg-yellow-50 p-3 rounded mt-3 border border-yellow-200">
                        <p className="text-sm text-yellow-800">
                          <strong>Bitte gib an:</strong> Was ist passiert? Welcher Browser? Screenshots (falls möglich)
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Verkäufer-Support */}
                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                  <div className="flex items-start gap-4">
                    <div className="flex-shrink-0">
                      <div className="bg-purple-100 p-3 rounded-lg">
                        <MessageCircle className="h-6 w-6 text-purple-600" />
                      </div>
                    </div>
                    <div className="flex-1">
                      <h3 className="text-xl font-bold text-gray-900 mb-2">Verkäufer-Support</h3>
                      <p className="text-gray-700 mb-3">
                        Fragen zum Verkaufen, Listings, Gebühren, Auszahlungen oder Verkäufer-Richtlinien?
                      </p>
                      <div className="space-y-2 text-sm">
                        <p className="text-gray-600">
                          <strong>E-Mail:</strong> <a href="mailto:seller@deimudda.de" className="text-blue-600 hover:underline">seller@deimudda.de</a>
                        </p>
                        <p className="text-gray-600">
                          <strong>Antwortzeit:</strong> Innerhalb von 24-48 Stunden
                        </p>
                      </div>
                      <div className="bg-blue-50 p-3 rounded mt-3 border border-blue-200">
                        <p className="text-sm text-blue-800">
                          <strong>Tipp:</strong> Schau auch in die <a href="/seller-guidelines" className="underline">Verkäufer-Richtlinien</a> 
                          und <a href="/fee-structure" className="underline">Gebührenstruktur</a>!
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Käufer-Support */}
                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                  <div className="flex items-start gap-4">
                    <div className="flex-shrink-0">
                      <div className="bg-green-100 p-3 rounded-lg">
                        <HelpCircle className="h-6 w-6 text-green-600" />
                      </div>
                    </div>
                    <div className="flex-1">
                      <h3 className="text-xl font-bold text-gray-900 mb-2">Käufer-Support</h3>
                      <p className="text-gray-700 mb-3">
                        Fragen zum Kaufen, Zahlungen, Versand oder Problemen mit einem Verkäufer?
                      </p>
                      <div className="space-y-2 text-sm">
                        <p className="text-gray-600">
                          <strong>E-Mail:</strong> <a href="mailto:info@deimudda.de" className="text-blue-600 hover:underline">info@deimudda.de</a>
                        </p>
                        <p className="text-gray-600">
                          <strong>Antwortzeit:</strong> Innerhalb von 24-48 Stunden
                        </p>
                      </div>
                      <div className="bg-amber-50 p-3 rounded mt-3 border border-amber-200">
                        <p className="text-sm text-amber-800">
                          <strong>Wichtig:</strong> Bei Problemen mit einem Verkäufer kontaktiere bitte zuerst den Verkäufer direkt 
                          (Kontaktdaten auf der Produktseite). Wir helfen gerne bei der Vermittlung, wenn keine Lösung gefunden wird.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Datenschutz */}
                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                  <div className="flex items-start gap-4">
                    <div className="flex-shrink-0">
                      <div className="bg-blue-100 p-3 rounded-lg">
                        <Mail className="h-6 w-6 text-blue-600" />
                      </div>
                    </div>
                    <div className="flex-1">
                      <h3 className="text-xl font-bold text-gray-900 mb-2">Datenschutz-Anfragen</h3>
                      <p className="text-gray-700 mb-3">
                        Fragen zu deinen Daten, Account-Löschung, Daten-Export oder DSGVO-Anfragen?
                      </p>
                      <div className="space-y-2 text-sm">
                        <p className="text-gray-600">
                          <strong>E-Mail:</strong> <a href="mailto:datenschutz@deimudda.de" className="text-blue-600 hover:underline">datenschutz@deimudda.de</a>
                        </p>
                        <p className="text-gray-600">
                          <strong>Antwortzeit:</strong> Innerhalb von 30 Tagen (gesetzliche Frist)
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Meldungen */}
                <div className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                  <div className="flex items-start gap-4">
                    <div className="flex-shrink-0">
                      <div className="bg-red-100 p-3 rounded-lg">
                        <AlertCircle className="h-6 w-6 text-red-600" />
                      </div>
                    </div>
                    <div className="flex-1">
                      <h3 className="text-xl font-bold text-gray-900 mb-2">Meldungen</h3>
                      <p className="text-gray-700 mb-3">
                        Rechtswidrige Inhalte, Verstöße gegen Nutzungsbedingungen oder verdächtige Aktivitäten melden?
                      </p>
                      <div className="space-y-2 text-sm">
                        <p className="text-gray-600">
                          <strong>E-Mail:</strong> <a href="mailto:report@deimudda.de" className="text-blue-600 hover:underline">report@deimudda.de</a>
                        </p>
                        <p className="text-gray-600">
                          <strong>Antwortzeit:</strong> Innerhalb von 24 Stunden
                        </p>
                      </div>
                      <div className="bg-red-50 p-3 rounded mt-3 border border-red-200">
                        <p className="text-sm text-red-800">
                          <strong>Wichtig:</strong> Bitte gib so viele Details wie möglich an (Link zum Listing, Username, 
                          Beschreibung des Verstoßes). Wir nehmen alle Meldungen ernst!
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            {/* Häufige Support-Anfragen */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">🔍 Häufige Support-Anfragen</h2>
              
              <div className="space-y-3 not-prose">
                <details className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                  <summary className="font-semibold text-gray-900 cursor-pointer">
                    Ich kann mich nicht einloggen
                  </summary>
                  <div className="mt-3 text-sm text-gray-700 space-y-2">
                    <p><strong>Lösung:</strong></p>
                    <ol className="list-decimal pl-6 space-y-1">
                      <li>Stelle sicher, dass du den richtigen OAuth-Provider verwendest (z.B. Google, GitHub)</li>
                      <li>Lösche Cookies und Cache in deinem Browser</li>
                      <li>Versuche es mit einem anderen Browser</li>
                      <li>Wenn das Problem weiterhin besteht: <a href="mailto:support@deimudda.de" className="text-blue-600 hover:underline">support@deimudda.de</a></li>
                    </ol>
                  </div>
                </details>

                <details className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                  <summary className="font-semibold text-gray-900 cursor-pointer">
                    Die Zahlung funktioniert nicht
                  </summary>
                  <div className="mt-3 text-sm text-gray-700 space-y-2">
                    <p><strong>Lösung:</strong></p>
                    <ol className="list-decimal pl-6 space-y-1">
                      <li>Stelle sicher, dass dein PayPal-Konto ausreichend Guthaben hat</li>
                      <li>Prüfe, ob deine Zahlungsmethode bei PayPal verifiziert ist</li>
                      <li>Versuche es mit einem anderen Browser oder Gerät</li>
                      <li>Kontaktiere PayPal-Support bei PayPal-spezifischen Problemen</li>
                      <li>Wenn das Problem weiterhin besteht: <a href="mailto:support@deimudda.de" className="text-blue-600 hover:underline">support@deimudda.de</a></li>
                    </ol>
                  </div>
                </details>

                <details className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                  <summary className="font-semibold text-gray-900 cursor-pointer">
                    Ich habe ein Problem mit einem Verkäufer
                  </summary>
                  <div className="mt-3 text-sm text-gray-700 space-y-2">
                    <p><strong>Lösung:</strong></p>
                    <ol className="list-decimal pl-6 space-y-1">
                      <li><strong>Erst:</strong> Kontaktiere den Verkäufer direkt (Kontaktdaten auf Produktseite)</li>
                      <li><strong>Dann:</strong> Versuche eine einvernehmliche Lösung zu finden</li>
                      <li><strong>Falls keine Lösung:</strong> Kontaktiere uns unter <a href="mailto:info@deimudda.de" className="text-blue-600 hover:underline">info@deimudda.de</a></li>
                      <li>Wir helfen bei der Vermittlung und können bei schwerwiegenden Verstößen Maßnahmen ergreifen</li>
                    </ol>
                  </div>
                </details>

                <details className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                  <summary className="font-semibold text-gray-900 cursor-pointer">
                    Mein Listing wird nicht angezeigt
                  </summary>
                  <div className="mt-3 text-sm text-gray-700 space-y-2">
                    <p><strong>Lösung:</strong></p>
                    <ol className="list-decimal pl-6 space-y-1">
                      <li>Prüfe, ob du alle Pflichtfelder ausgefüllt hast</li>
                      <li>Stelle sicher, dass dein Listing nicht gegen unsere Richtlinien verstößt</li>
                      <li>Warte 5-10 Minuten, manchmal dauert die Veröffentlichung etwas</li>
                      <li>Wenn das Problem weiterhin besteht: <a href="mailto:seller@deimudda.de" className="text-blue-600 hover:underline">seller@deimudda.de</a></li>
                    </ol>
                  </div>
                </details>

                <details className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                  <summary className="font-semibold text-gray-900 cursor-pointer">
                    Wie lösche ich meinen Account?
                  </summary>
                  <div className="mt-3 text-sm text-gray-700 space-y-2">
                    <p><strong>Lösung:</strong></p>
                    <ol className="list-decimal pl-6 space-y-1">
                      <li>Gehe zu <strong>Dashboard → Profil-Einstellungen</strong></li>
                      <li>Scrolle nach unten zu "Account löschen"</li>
                      <li>Bestätige die Löschung</li>
                      <li>Deine Daten werden gelöscht (Transaktionsdaten werden anonymisiert und 10 Jahre aufbewahrt)</li>
                    </ol>
                    <p className="mt-2">
                      <strong>Hinweis:</strong> Die Account-Löschung ist endgültig und kann nicht rückgängig gemacht werden!
                    </p>
                  </div>
                </details>
              </div>
            </section>

            {/* Hilfreiche Ressourcen */}
            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">📚 Hilfreiche Ressourcen</h2>
              
              <div className="grid md:grid-cols-2 gap-4 not-prose">
                <a
                  href="/seller-guidelines"
                  className="bg-purple-50 p-4 rounded-lg border border-purple-200 hover:bg-purple-100 transition"
                >
                  <h3 className="font-bold text-purple-900 mb-2">Verkäufer-Richtlinien</h3>
                  <p className="text-sm text-purple-800">
                    Alles, was du als Verkäufer wissen musst: Regeln, Best Practices und Tipps.
                  </p>
                </a>

                <a
                  href="/fee-structure"
                  className="bg-green-50 p-4 rounded-lg border border-green-200 hover:bg-green-100 transition"
                >
                  <h3 className="font-bold text-green-900 mb-2">Gebührenstruktur</h3>
                  <p className="text-sm text-green-800">
                    Transparente Übersicht über alle Gebühren mit Gebühren-Rechner.
                  </p>
                </a>

                <a
                  href="/datenschutz"
                  className="bg-blue-50 p-4 rounded-lg border border-blue-200 hover:bg-blue-100 transition"
                >
                  <h3 className="font-bold text-blue-900 mb-2">Datenschutzerklärung</h3>
                  <p className="text-sm text-blue-800">
                    Wie wir mit deinen Daten umgehen und welche Rechte du hast.
                  </p>
                </a>

                <a
                  href="/widerruf"
                  className="bg-orange-50 p-4 rounded-lg border border-orange-200 hover:bg-orange-100 transition"
                >
                  <h3 className="font-bold text-orange-900 mb-2">Widerrufsbelehrung</h3>
                  <p className="text-sm text-orange-800">
                    Informationen zu deinem Widerrufsrecht und wie du es ausübst.
                  </p>
                </a>
              </div>
            </section>

            {/* Feedback */}
            <section>
              <h2 className="text-2xl font-bold mb-4">💬 Feedback & Verbesserungsvorschläge</h2>
              
              <p className="text-gray-700 mb-4">
                Wir sind ständig dabei, deimudda zu verbessern. Dein Feedback ist uns wichtig!
              </p>

              <div className="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-lg border border-green-200 not-prose">
                <p className="text-gray-700 mb-4">
                  Hast du Ideen, wie wir deimudda besser machen können? Fehlt dir ein Feature? 
                  Hast du Verbesserungsvorschläge?
                </p>
                <a
                  href="mailto:feedback@deimudda.de"
                  className="inline-block bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition"
                >
                  Feedback senden
                </a>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: Terms.tsx

**`client/src/components/Terms.tsx`**

```typescript
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";

export default function Terms() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 py-8">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <a href="/" className="text-blue-600 hover:text-blue-800 mb-6 inline-block">
          ← Zurück
        </a>

        <h1 className="text-4xl font-bold mb-8">Nutzungsbedingungen & Rechtliche Hinweise</h1>

        <div className="space-y-6">
          {/* Disclaimer */}
          <Card className="border-l-4 border-red-500">
            <CardHeader>
              <CardTitle className="text-red-700">⚠️ Wichtiger Disclaimer</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <p>
                Diese Plattform ist <strong>ausschließlich</strong> für den Handel mit Cannabis-Stecklingen und Samen gemäß des Konsumcannabisgesetzes (KCanG) bestimmt.
              </p>
              <p>
                Alle Nutzer verpflichten sich, die geltenden deutschen Gesetze einzuhalten. deimudda übernimmt <strong>keine Haftung</strong> für illegale Nutzung oder Verstöße gegen das KCanG durch Nutzer.
              </p>
            </CardContent>
          </Card>

          {/* Zulässige Produkte */}
          <Card>
            <CardHeader>
              <CardTitle>1. Zulässige Produkte</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <p className="font-semibold">Erlaubt:</p>
              <ul className="list-disc pl-6 space-y-2">
                <li>Cannabis-Stecklinge <strong>ohne Blütenstände</strong></li>
                <li>Cannabis-Samen</li>
                <li>Junge Pflanzen (Setzlinge) <strong>ohne Blütenentwicklung</strong></li>
              </ul>

              <p className="font-semibold mt-4">Nicht erlaubt:</p>
              <ul className="list-disc pl-6 space-y-2">
                <li>Blüten oder Blütenstände</li>
                <li>Fruchtstände</li>
                <li>Verarbeitete Produkte (Öle, Extrakte, etc.)</li>
                <li>Getrocknete oder verarbeitete Pflanzenteile</li>
                <li>Alle anderen illegalen Waren</li>
              </ul>
            </CardContent>
          </Card>

          {/* Rechtliche Rahmenbedingungen */}
          <Card>
            <CardHeader>
              <CardTitle>2. Rechtliche Rahmenbedingungen (KCanG)</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <p>
                Das Konsumcannabisgesetz (KCanG) regelt den Anbau und Konsum von Cannabis in Deutschland. Diese Plattform operiert im Rahmen dieser Gesetze.
              </p>
              <p>
                <strong>Wichtig:</strong> Stecklinge und Samen sind gemäß aktueller Rechtsprechung <strong>nicht als Cannabis definiert</strong> und sind daher freiverkäuflich, solange sie keine Blütenstände aufweisen.
              </p>
              <p>
                Alle Nutzer sind selbst verantwortlich für die Einhaltung lokaler und regionaler Gesetze.
              </p>
            </CardContent>
          </Card>

          {/* Eigenverantwortung */}
          <Card>
            <CardHeader>
              <CardTitle>3. Eigenverantwortung der Nutzer</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <p>
                <strong>Käufer und Verkäufer handeln in vollständiger Eigenverantwortung.</strong>
              </p>
              <p>
                Jeder Nutzer erklärt sich damit einverstanden, dass:
              </p>
              <ul className="list-disc pl-6 space-y-2">
                <li>Er/Sie die Gesetze einhält und nur legale Produkte kauft/verkauft</li>
                <li>Er/Sie die Produkte nur für legale Zwecke nutzt</li>
                <li>Er/Sie mindestens 18 Jahre alt ist</li>
                <li>deimudda nicht verantwortlich für illegale Nutzung ist</li>
              </ul>
            </CardContent>
          </Card>

          {/* Altersbestätigung */}
          <Card>
            <CardHeader>
              <CardTitle>4. Altersbestätigung</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <p>
                Durch die Nutzung dieser Plattform bestätigen Sie, dass Sie <strong>mindestens 18 Jahre alt</strong> sind.
              </p>
              <p>
                deimudda behält sich das Recht vor, Nutzer zu sperren, die gegen diese Bedingung verstoßen.
              </p>
            </CardContent>
          </Card>

          {/* Haftungsausschluss */}
          <Card>
            <CardHeader>
              <CardTitle>5. Haftungsausschluss</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <p>
                <strong>deimudda übernimmt KEINE Haftung für:</strong>
              </p>
              <ul className="list-disc pl-6 space-y-2">
                <li>Illegale Nutzung von Produkten durch Käufer</li>
                <li>Verstöße gegen das KCanG oder andere Gesetze</li>
                <li>Qualität oder Authentizität der angebotenen Produkte</li>
                <li>Lieferverzögerungen oder Versandprobleme</li>
                <li>Schäden durch unsachgemäße Lagerung oder Handhabung</li>
              </ul>
            </CardContent>
          </Card>

          {/* Kontakt */}
          <Card>
            <CardHeader>
              <CardTitle>6. Kontakt & Support</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <p>
                Bei Fragen zu den Nutzungsbedingungen oder rechtlichen Aspekten kontaktieren Sie uns über:
              </p>
              <p>
                <strong>E-Mail:</strong> support@deimudda.de
              </p>
              <p>
                <strong>Hinweis:</strong> Dies ist keine Rechtsberatung. Bei Fragen zu Ihrer spezifischen Situation konsultieren Sie bitte einen Rechtsanwalt.
              </p>
            </CardContent>
          </Card>

          {/* Last Updated */}
          <div className="text-xs text-gray-500 text-center py-4">
            <p>Zuletzt aktualisiert: Oktober 2025</p>
            <p>Diese Nutzungsbedingungen können jederzeit geändert werden.</p>
          </div>
        </div>
      </div>
    </div>
  );
}

```

#### Schritt 5.x: Widerruf.tsx

**`client/src/components/Widerruf.tsx`**

```typescript
export default function Widerruf() {
  return (
    <div className="min-h-screen bg-gray-50 py-12">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-4xl font-bold mb-8 text-gray-900">Widerrufsbelehrung</h1>
          
          <div className="prose prose-lg max-w-none">
            <p className="text-sm text-gray-600 mb-8">Stand: 24. Oktober 2025</p>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-6 mb-8">
              <h3 className="text-lg font-bold text-blue-900 mb-2">Wichtiger Hinweis</h3>
              <p className="text-blue-800">
                <strong>deimudda ist ein Marktplatz.</strong> Wir vermitteln nur zwischen Käufern und Verkäufern. 
                Der Kaufvertrag kommt direkt zwischen Ihnen und dem jeweiligen Verkäufer zustande. 
                <strong> Der Verkäufer ist Ihr Vertragspartner</strong>, nicht deimudda.
              </p>
              <p className="text-blue-800 mt-2">
                Für Widerrufe, Rücksendungen und Reklamationen wenden Sie sich bitte direkt an den Verkäufer. 
                Die Kontaktdaten des Verkäufers finden Sie auf der Produktseite und in Ihrer Bestellbestätigung.
              </p>
            </div>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Widerrufsrecht bei Fernabsatzverträgen</h2>
              
              <p className="mb-4">
                Als Verbraucher haben Sie bei Käufen im Fernabsatz (Online-Kauf) grundsätzlich ein gesetzliches 
                Widerrufsrecht gemäß § 312g BGB.
              </p>

              <h3 className="text-xl font-semibold mb-3">Widerrufsfrist</h3>
              <p className="mb-4">
                Sie haben das Recht, binnen vierzehn Tagen ohne Angabe von Gründen den Vertrag mit dem Verkäufer zu widerrufen.
              </p>

              <p className="mb-4">
                Die Widerrufsfrist beträgt vierzehn Tage ab dem Tag, an dem Sie oder ein von Ihnen benannter Dritter, 
                der nicht der Beförderer ist, die Waren in Besitz genommen haben bzw. hat.
              </p>

              <h3 className="text-xl font-semibold mb-3">Ausübung des Widerrufsrechts</h3>
              <p className="mb-4">
                Um Ihr Widerrufsrecht auszuüben, müssen Sie <strong>den Verkäufer</strong> (nicht deimudda) mittels 
                einer eindeutigen Erklärung (z.B. ein mit der Post versandter Brief oder E-Mail) über Ihren Entschluss, 
                den Vertrag zu widerrufen, informieren.
              </p>

              <div className="bg-gray-100 p-4 rounded-lg mb-4">
                <p className="font-semibold mb-2">Die Kontaktdaten des Verkäufers finden Sie:</p>
                <ul className="list-disc pl-6">
                  <li>Auf der Produktseite unter "Verkäufer-Informationen"</li>
                  <li>In Ihrer Bestellbestätigung</li>
                  <li>Im Verkäufer-Profil (klicken Sie auf den Verkäufer-Namen)</li>
                </ul>
              </div>

              <p className="mb-4">
                Sie können dafür das unten stehende Muster-Widerrufsformular verwenden, das jedoch nicht vorgeschrieben ist.
              </p>

              <p className="mb-4">
                Zur Wahrung der Widerrufsfrist reicht es aus, dass Sie die Mitteilung über die Ausübung des 
                Widerrufsrechts vor Ablauf der Widerrufsfrist an den Verkäufer absenden.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Folgen des Widerrufs</h2>
              
              <p className="mb-4">
                Wenn Sie den Vertrag widerrufen, hat der Verkäufer Ihnen alle Zahlungen, die er von Ihnen erhalten hat, 
                einschließlich der Lieferkosten (mit Ausnahme der zusätzlichen Kosten, die sich daraus ergeben, dass 
                Sie eine andere Art der Lieferung als die vom Verkäufer angebotene, günstigste Standardlieferung gewählt haben), 
                unverzüglich und spätestens binnen vierzehn Tagen ab dem Tag zurückzuzahlen, an dem die Mitteilung über 
                Ihren Widerruf beim Verkäufer eingegangen ist.
              </p>

              <p className="mb-4">
                Für diese Rückzahlung verwendet der Verkäufer dasselbe Zahlungsmittel, das Sie bei der ursprünglichen 
                Transaktion eingesetzt haben, es sei denn, mit Ihnen wurde ausdrücklich etwas anderes vereinbart; in 
                keinem Fall werden Ihnen wegen dieser Rückzahlung Entgelte berechnet.
              </p>

              <p className="mb-4">
                Der Verkäufer kann die Rückzahlung verweigern, bis er die Waren wieder zurückerhalten hat oder bis Sie 
                den Nachweis erbracht haben, dass Sie die Waren zurückgesandt haben, je nachdem, welches der frühere Zeitpunkt ist.
              </p>

              <p className="mb-4">
                Sie haben die Waren unverzüglich und in jedem Fall spätestens binnen vierzehn Tagen ab dem Tag, an dem 
                Sie den Verkäufer über den Widerruf unterrichten, an den Verkäufer zurückzusenden oder zu übergeben. 
                Die Frist ist gewahrt, wenn Sie die Waren vor Ablauf der Frist von vierzehn Tagen absenden.
              </p>

              <p className="mb-4">
                <strong>Rücksendekosten:</strong> Sie tragen die unmittelbaren Kosten der Rücksendung der Waren, sofern 
                der Verkäufer nicht zugesagt hat, diese Kosten zu übernehmen.
              </p>

              <p className="mb-4">
                Sie müssen für einen etwaigen Wertverlust der Waren nur aufkommen, wenn dieser Wertverlust auf einen 
                zur Prüfung der Beschaffenheit, Eigenschaften und Funktionsweise der Waren nicht notwendigen Umgang 
                mit ihnen zurückzuführen ist.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Besonderheit bei Cannabis-Stecklingen</h2>
              
              <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                <p className="text-yellow-800">
                  <strong>Wichtiger Hinweis:</strong> Das Widerrufsrecht kann bei lebenden Pflanzen unter bestimmten 
                  Umständen ausgeschlossen sein.
                </p>
              </div>

              <p className="mb-4">
                Gemäß § 312g Abs. 2 Nr. 2 BGB besteht kein Widerrufsrecht bei Verträgen zur Lieferung von Waren, die 
                schnell verderben können oder deren Verfallsdatum schnell überschritten würde.
              </p>

              <p className="mb-4">
                Da Cannabis-Stecklinge <strong>lebende Pflanzen</strong> sind, die besonderer Pflege bedürfen und schnell 
                verderben können, kann das Widerrufsrecht in bestimmten Fällen ausgeschlossen sein. Dies gilt insbesondere, wenn:
              </p>

              <ul className="list-disc pl-6 mb-4">
                <li className="mb-2">Die Stecklinge bereits in Empfang genommen und die Verpackung geöffnet wurde</li>
                <li className="mb-2">Die Stecklinge sichtbare Schäden aufweisen, die auf unsachgemäße Behandlung durch den Käufer zurückzuführen sind</li>
                <li className="mb-2">Der Verkäufer in seiner Produktbeschreibung ausdrücklich auf den Ausschluss des Widerrufsrechts hingewiesen hat</li>
              </ul>

              <p className="mb-4">
                <strong>Mängelrechte bleiben unberührt:</strong> Auch wenn das Widerrufsrecht ausgeschlossen ist, haben 
                Sie bei mangelhaften Stecklingen (z.B. kranke Pflanzen, falsche Sorte) weiterhin Anspruch auf Gewährleistung 
                gegenüber dem Verkäufer (§ 437 BGB).
              </p>

              <p className="mb-4">
                Bitte beachten Sie, dass Sie bei Erhalt der Ware diese unverzüglich auf Mängel überprüfen sollten. 
                Sollten Sie Mängel feststellen, kontaktieren Sie bitte umgehend den Verkäufer und dokumentieren Sie 
                die Mängel mit Fotos.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Muster-Widerrufsformular</h2>
              
              <div className="bg-gray-100 p-6 rounded-lg">
                <p className="mb-4 text-sm">
                  (Wenn Sie den Vertrag widerrufen wollen, dann füllen Sie bitte dieses Formular aus und senden Sie es 
                  an den Verkäufer zurück. Die Kontaktdaten des Verkäufers finden Sie auf der Produktseite oder in Ihrer Bestellbestätigung.)
                </p>

                <div className="space-y-4 text-sm">
                  <p className="font-semibold">An den Verkäufer:</p>
                  <div className="bg-white p-4 rounded space-y-2">
                    <p>[Name des Verkäufers]</p>
                    <p>[Anschrift des Verkäufers]</p>
                    <p>[E-Mail-Adresse des Verkäufers]</p>
                    <p className="text-xs text-gray-500 mt-2">
                      (Diese Informationen finden Sie auf der Produktseite unter "Verkäufer-Informationen")
                    </p>
                  </div>

                  <p className="font-semibold mt-4">Hiermit widerrufe(n) ich/wir (*) den von mir/uns (*) abgeschlossenen Vertrag über den Kauf der folgenden Waren (*):</p>
                  
                  <div className="bg-white p-4 rounded space-y-2">
                    <p>_____________________________________________</p>
                    <p className="text-xs text-gray-500">(Bezeichnung der Ware, z.B. "Purple Kush Steckling")</p>
                  </div>

                  <div className="bg-white p-4 rounded space-y-2">
                    <p>Bestellt am (*) / erhalten am (*): _____________________________________________</p>
                  </div>

                  <div className="bg-white p-4 rounded space-y-2">
                    <p>Bestellnummer / Transaktions-ID: _____________________________________________</p>
                  </div>

                  <div className="bg-white p-4 rounded space-y-2">
                    <p>Name des/der Verbraucher(s): _____________________________________________</p>
                  </div>

                  <div className="bg-white p-4 rounded space-y-2">
                    <p>Anschrift des/der Verbraucher(s): _____________________________________________</p>
                  </div>

                  <div className="bg-white p-4 rounded space-y-2">
                    <p>E-Mail-Adresse: _____________________________________________</p>
                  </div>

                  <div className="bg-white p-4 rounded space-y-2">
                    <p>Unterschrift des/der Verbraucher(s) (nur bei Mitteilung auf Papier): _____________________________________________</p>
                  </div>

                  <div className="bg-white p-4 rounded space-y-2">
                    <p>Datum: _____________________________________________</p>
                  </div>

                  <p className="text-xs text-gray-500 mt-4">(*) Unzutreffendes streichen.</p>
                </div>
              </div>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Ausschluss des Widerrufsrechts</h2>
              
              <p className="mb-4">
                Das Widerrufsrecht besteht gemäß § 312g Abs. 2 BGB nicht bei folgenden Verträgen:
              </p>

              <ul className="list-disc pl-6 mb-4">
                <li className="mb-2">
                  Verträge zur Lieferung von Waren, die nicht vorgefertigt sind und für deren Herstellung eine 
                  individuelle Auswahl oder Bestimmung durch den Verbraucher maßgeblich ist oder die eindeutig auf 
                  die persönlichen Bedürfnisse des Verbrauchers zugeschnitten sind
                </li>
                <li className="mb-2">
                  <strong>Verträge zur Lieferung von Waren, die schnell verderben können oder deren Verfallsdatum schnell 
                  überschritten würde</strong> (betrifft lebende Pflanzen wie Cannabis-Stecklinge)
                </li>
                <li className="mb-2">
                  Verträge zur Lieferung versiegelter Waren, die aus Gründen des Gesundheitsschutzes oder der Hygiene 
                  nicht zur Rückgabe geeignet sind, wenn ihre Versiegelung nach der Lieferung entfernt wurde
                </li>
              </ul>

              <p className="mb-4">
                Bitte beachten Sie die Produktbeschreibung des jeweiligen Verkäufers, ob das Widerrufsrecht für das 
                konkrete Produkt ausgeschlossen ist.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Rolle von deimudda</h2>
              
              <p className="mb-4">
                <strong>deimudda ist ausschließlich Vermittler</strong> und nicht Vertragspartner des Kaufvertrags. 
                Wir stellen lediglich die Plattform bereit, auf der Käufer und Verkäufer zusammenfinden können.
              </p>

              <p className="mb-4">
                <strong>Für Widerrufe, Rücksendungen, Reklamationen und Gewährleistungsansprüche ist ausschließlich 
                der Verkäufer zuständig.</strong> deimudda haftet nicht für die Abwicklung von Widerrufen oder die 
                Qualität der verkauften Waren.
              </p>

              <p className="mb-4">
                Bei Problemen mit einem Verkäufer können Sie sich jedoch gerne an unseren Support wenden. Wir helfen 
                Ihnen bei der Vermittlung und können bei schwerwiegenden Verstößen gegen unsere Nutzungsbedingungen 
                Maßnahmen gegen den Verkäufer ergreifen.
              </p>
            </section>

            <section className="mb-8">
              <h2 className="text-2xl font-bold mb-4">Kontakt bei Fragen</h2>
              
              <p className="mb-4">
                <strong>Bei Fragen zum Widerruf eines konkreten Kaufs:</strong><br />
                Wenden Sie sich bitte direkt an den Verkäufer (Kontaktdaten auf der Produktseite).
              </p>

              <p className="mb-4">
                <strong>Bei allgemeinen Fragen zur Plattform oder Problemen mit einem Verkäufer:</strong><br />
                Kontaktieren Sie den deimudda-Support über das Kontaktformular oder per E-Mail.
              </p>
            </section>

            <p className="text-sm text-gray-600 mt-8">
              Quelle: Erstellt unter Berücksichtigung von § 312g BGB (Widerrufsrecht bei Fernabsatzverträgen) 
              und angepasst für das Marktplatz-Modell von deimudda.
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}

```


---

## 6. Nächste Schritte und Abschluss

Nachdem alle oben genannten Dateien mit dem exakten Inhalt erstellt wurden, ist das Projekt vollständig rekonstruiert und entspricht dem letzten bekannten Stand.

### Schritt 6.1: Abhängigkeiten installieren

Führe im Hauptverzeichnis des Projekts den folgenden Befehl aus, um alle notwendigen Abhängigkeiten zu installieren:

```bash
pnpm install
```

### Schritt 6.2: Projekt starten

Nach der erfolgreichen Installation kann das Projekt mit dem folgenden Befehl gestartet werden. Dies startet den Frontend-Vite-Server und den Backend-Node.js-Server gleichzeitig.

```bash
pnpm run dev
```

- Das Frontend wird unter `http://localhost:5173` verfügbar sein.
- Das Backend läuft auf `http://localhost:3000`.

### Schritt 6.3: Wichtige Hinweise für die Weiterentwicklung

- **Datenbank:** Das Projekt ist so konfiguriert, dass es eine MySQL-Datenbank erwartet. Die Verbindungsdetails müssen in einer `.env`-Datei im Hauptverzeichnis des Projekts hinterlegt werden, basierend auf der `server/db.ts`-Datei.
- **OAuth:** Die Authentifizierung läuft über Manus OAuth. Für eine lokale Entwicklungsumgebung müssen die entsprechenden Client-ID und Secret-Schlüssel in der `.env`-Datei konfiguriert werden.
- **Offene Punkte:** Beachte die verschiedenen `TODO`-Listen und Audit-Dokumente im ursprünglichen Projektarchiv. Diese enthalten wertvolle Informationen über nicht implementierte Features (z.B. fehlende Admin-Seiten) und bekannte Bugs. Diese Dokumente sind der Ausgangspunkt für die Weiterentwicklung.

---

**Ende der Rekonstruktionsanleitung.**
